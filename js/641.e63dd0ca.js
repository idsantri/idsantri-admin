"use strict";(globalThis["webpackChunkidsantri_app"]=globalThis["webpackChunkidsantri_app"]||[]).push([[641],{20641:(a,e,l)=>{l.r(e),l.d(e,{default:()=>D});l(60939),l(17008),l(44520),l(7049),l(84151);var t=l(51347),n=l(8633),o=l(37763),s=l(58094),i=l(59678),r=l(18348),u=l(81730),d=l(34187),c=l(16138);const p={class:"row"},m={class:"col-sm-6 col-xs-12"},b={class:"col-sm-6 col-xs-12"},k={__name:"UploadPage",setup(a){const e=(0,d.KR)({category:"ujian"}),l=(0,d.KR)(),k=(0,d.KR)([]),v=(0,d.KR)([]),g=(0,d.KR)([{}]),_=(0,d.KR)(1),{loadingMain:h}=(0,d.QW)((0,r.A)());(0,t.sV)((async()=>{const a=await(0,s.A)({endPoint:"mapel",loading:h});g.value=a.mapel;const e=a.mapel.map((a=>a.id));v.value=e}));const f=a=>{const e=a.target.files[0],l=new FileReader;l.onload=a=>{const e=a.target.result,l=(0,c.LF)(e,{type:"array"}),t=l.SheetNames[0],n=l.Sheets[t],o=c.Wp.sheet_to_json(n,{defval:null});q(o,v.value)?(k.value=o,_.value=2):((0,u.KQ)("Data tidak dapat diproses"),(0,u.KQ)("Pastikan baris pertama adalah judul kolom dan baris berikutnya adalah konten data"))},l.readAsArrayBuffer(e)};function q(a,e){return e.some((e=>Object.prototype.hasOwnProperty.call(a[0],e)))&&Object.prototype.hasOwnProperty.call(a[0],"kelas_id")}function F({nilaiPivot:a,mapelIds:e,category:l,ujian_ke:t}){let n=[];return e.forEach((e=>{if(Object.prototype.hasOwnProperty.call(a[0],e)){const o=a.map((a=>({kelas_id:a.kelas_id,mapel_id:e,ujian_ke:parseInt(t),["n_"+l]:a[e]||null})));n=n.concat(o)}})),n}async function w(){const a=F({nilaiPivot:k.value,mapelIds:v.value,category:e.value.category,ujian_ke:e.value.ujian_ke}),l=await(0,i.A)({endPoint:"nilai-mapel",data:{data:a},loading:h});l&&(_.value=1)}return(0,t.wB)(l,(a=>{a||(k.value=[])})),(0,t.wB)(_,(a=>{1!=a&&(k.value.length||(_.value=1))})),(a,s)=>{const i=(0,t.g2)("q-space"),r=(0,t.g2)("q-btn"),u=(0,t.g2)("q-card-section"),d=(0,t.g2)("q-separator"),c=(0,t.g2)("q-icon"),v=(0,t.g2)("q-file"),h=(0,t.g2)("q-step"),q=(0,t.g2)("q-th"),F=(0,t.g2)("q-tr"),y=(0,t.g2)("q-table"),x=(0,t.g2)("q-select"),A=(0,t.g2)("q-input"),L=(0,t.g2)("q-form"),Q=(0,t.g2)("q-card"),K=(0,t.g2)("q-stepper"),j=(0,t.g2)("q-page");return(0,t.uX)(),(0,t.Wv)(j,{class:"q-pa-sm"},{default:(0,t.k6)((()=>[(0,t.bF)(Q,null,{default:(0,t.k6)((()=>[(0,t.bF)(u,{class:"q-pa-sm bg-green-8 text-green-11 flex"},{default:(0,t.k6)((()=>[s[6]||(s[6]=(0,t.Lk)("div",{tag:"h1",class:"text-subtitle1"},"Upload Nilai",-1)),(0,t.bF)(i),(0,t.bF)(r,{label:"Kembali",to:"/madrasah/nilai-mapel",dense:"",outline:"","no-caps":"",icon:"arrow_back",class:"q-px-sm q-mr-md"}),(0,t.bF)(r,{label:"Download",to:"/madrasah/nilai-mapel/download",dense:"",outline:"","no-caps":"",icon:"download",class:"q-px-sm"})])),_:1}),(0,t.bF)(u,{class:"no-padding"},{default:(0,t.k6)((()=>[(0,t.bF)(K,{modelValue:_.value,"onUpdate:modelValue":s[5]||(s[5]=a=>_.value=a),ref:"stepper","done-color":"green-8","active-color":"green-10",animated:"",flat:"","header-nav":""},{default:(0,t.k6)((()=>[(0,t.bF)(h,{name:1,title:"Pilih File",caption:"*.xls, *.xlsx",icon:"create_new_folder",done:_.value>1},{default:(0,t.k6)((()=>[(0,t.bF)(d,{class:"q-mb-md"}),(0,t.bF)(v,{onInput:f,outlined:"","bottom-slots":"",modelValue:l.value,"onUpdate:modelValue":s[2]||(s[2]=a=>l.value=a),label:"Pilih file excel",counter:"",dense:"",style:{"max-width":"500px"}},{prepend:(0,t.k6)((()=>[(0,t.bF)(c,{name:"cloud_upload",onClick:s[0]||(s[0]=(0,n.D$)((()=>{}),["stop","prevent"]))})])),after:(0,t.k6)((()=>[(0,t.bF)(c,{name:"close",onClick:s[1]||(s[1]=(0,n.D$)((a=>l.value=null),["stop","prevent"])),class:"cursor-pointer"})])),hint:(0,t.k6)((()=>s[7]||(s[7]=[(0,t.Lk)("span",{class:"text-green text-italic"}," Hanya membaca sheet pertama ",-1)]))),_:1},8,["modelValue"])])),_:1},8,["done"]),(0,t.bF)(h,{name:2,title:"Cek Data",caption:"Konfirmasi",icon:"assignment_turned_in",done:_.value>2},{default:(0,t.k6)((()=>[(0,t.bF)(d,{class:"q-mb-md"}),(0,t.bF)(y,{rows:k.value,flat:"",bordered:"",class:"","rows-per-page-options":[10,25,50,75,100,0]},{header:(0,t.k6)((a=>[(0,t.bF)(F,{props:a},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(a.cols,(e=>((0,t.uX)(),(0,t.Wv)(q,{key:e.name,props:a,class:"text-bold",title:g.value.find((a=>a.id.toLowerCase()==e.label.toLowerCase()))?.name||""},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.label.toLowerCase())+" ",1),g.value.find((a=>a.id.toLowerCase()==e.label.toLowerCase()))||"kelas_id"==e.label.toLowerCase()?((0,t.uX)(),(0,t.Wv)(c,{key:0,name:"check_circle",color:"green",size:"1.3em"})):(0,t.Q3)("",!0)])),_:2},1032,["props","title"])))),128))])),_:2},1032,["props"])])),_:1},8,["rows"])])),_:1},8,["done"]),(0,t.bF)(h,{name:3,title:"Lengkapi Data",caption:"Langkah Terakhir",icon:"article"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{class:"q-mb-md"}),(0,t.Lk)("div",p,[(0,t.Lk)("div",m,[(0,t.bF)(Q,{bordered:"",flat:"",class:"q-ma-xs"},{default:(0,t.k6)((()=>[(0,t.bF)(u,null,{default:(0,t.k6)((()=>[(0,t.bF)(L,{style:{"max-width":"500px"},onSubmit:(0,n.D$)(w,["prevent"])},{default:(0,t.k6)((()=>[(0,t.bF)(x,{dense:"",class:"q-mt-sm",outlined:"",label:"Kategori Nilai",modelValue:e.value.category,"onUpdate:modelValue":s[3]||(s[3]=a=>e.value.category=a),required:"",hint:"Kesalahan karena hal ini berakibat fatal",options:[{value:"ujian",label:"Nilai Ujian"},{value:"harian",label:"Nilai Harian"}],"emit-value":"","map-options":""},null,8,["modelValue"]),(0,t.bF)(A,{dense:"",class:"q-mt-sm",outlined:"",label:"Ujian Ke",modelValue:e.value.ujian_ke,"onUpdate:modelValue":s[4]||(s[4]=a=>e.value.ujian_ke=a),required:"",type:"number",hint:"Kesalahan karena hal ini berakibat fatal",rules:[a=>a>0&&a<5||"antara 1 s.d. 4"]},null,8,["modelValue","rules"]),(0,t.bF)(r,{type:"submit",label:"Simpan",icon:"save",dense:"",class:"q-mt-sm q-px-sm","no-caps":""})])),_:1})])),_:1})])),_:1})]),(0,t.Lk)("div",b,[(0,t.bF)(Q,{flat:"",bordered:"",class:"q-ma-xs"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{class:""},{default:(0,t.k6)((()=>s[8]||(s[8]=[(0,t.eW)(" Pastikan data berikut sudah benar: "),(0,t.Lk)("ul",null,[(0,t.Lk)("li",null,"Kelas ID"),(0,t.Lk)("li",null,"Mapel ID"),(0,t.Lk)("li",null,"Kategori Nilai"),(0,t.Lk)("li",null,"Ujian Ke-?")],-1),(0,t.Lk)("br",null,null,-1),(0,t.eW)(" Kesalahan karena hal ini akan susah diperbaiki. ")]))),_:1})])),_:1})])])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})}}};var v=l(75013),g=l(83341),_=l(60222),h=l(5873),f=l(22677),q=l(94527),F=l(5226),w=l(86915),y=l(85621),x=l(93933),A=l(27010),L=l(87339),Q=l(22517),K=l(53417),j=l(76941),C=l(46395),P=l(272),V=l.n(P);const S=k,D=S;V()(k,"components",{QPage:v.A,QCard:g.A,QCardSection:_.A,QSpace:h.A,QBtn:f.A,QStepper:q.A,QStep:F.A,QSeparator:w.A,QFile:y.A,QIcon:x.A,QTable:A.A,QTr:L.A,QTh:Q.A,QForm:K.A,QSelect:j.A,QInput:C.A})}}]);