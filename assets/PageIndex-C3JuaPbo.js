import{Q as $}from"./QSelect-LIcm9uTB.js";import{q as p,ap as O,s as D,Y as A,E as b,c as h,o as d,w as u,g as a,af as M,f as R,G as E,Q as V,a9 as q,l as U,e as I,a as t,b as g,v as F,F as J,D as L,t as _,J as j}from"./index-DutRA_CO.js";import{Q as K}from"./QSpinnerFacebook-Ct4f1NED.js";import{Q as z}from"./QMarkupTable-soH4YcMw.js";import{Q as G}from"./QForm-DRzvYkEB.js";import{l as Y}from"./lists-store-NC8-X11g.js";import{_ as W}from"./InputCurrency-ouhMLSuH.js";import{_ as X}from"./InputSelectArray-5WdULfX-.js";import{I as B}from"./IuranPaket-bo5CUDk2.js";import{u as Z}from"./useCrudForm-L8fi9UCL.js";import"./QField-BhEqSw-i.js";import"./QChip-D_SQIzNi.js";import"./QItem-qGBVeF8-.js";import"./QItemLabel-WimR8O_E.js";import"./QMenu-JGhTZEq-.js";import"./selection-BSDJEjKX.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./ArrayCrud-CByp4EUn.js";import"./DropDownAfter-8SRzBjks.js";import"./QBtnDropdown-DEivjYd9.js";import"./QBtnGroup-_ujcPxic.js";import"./ClosePopup-RQcL-rG0.js";import"./Lists-CyIViPOd.js";import"./ApiCrud-CZFmsy5d.js";import"./Api-AjNxW92f.js";import"./index-BAyNzCk6.js";import"./index-Cpf3S9fo.js";import"./apiPost-BTbDNFlR.js";const ee={__name:"IuranPaketForm",props:{data:{type:Object,required:!1,default:()=>{}}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(Q,{emit:m}){const i=Q,c=m,f=Y().getStateByKey("iuran"),n=p({...i.data}),k=p([...f]),x=!i.data?.id,v=O("firstInput");D(async()=>{await A(),v.value&&v.value.focus()});const{handleDelete:w,handleCreate:P,handleUpdate:N,loading:o}=Z(B,{emit:c,responseKey:"iuran_paket"}),e=l=>{const r=k.value.find(y=>y.val0===l);r&&(n.value.nominal=r.val1)},S=async()=>{const l=JSON.parse(JSON.stringify(n.value));return delete l.id,x?await P(l,!0):await N(i.data.id,l,!0)},C=async()=>await w(i.data.id);return(l,r)=>{const y=b("FormHeader"),T=b("FormLoading"),H=b("FormActions");return d(),h(U,{class:"full-width",style:{"max-width":"425px"}},{default:u(()=>[a(G,{onSubmit:M(S,["prevent"])},{default:u(()=>[a(y,{title:"Input Paket Iuran","is-new":x}),E(o)?(d(),h(T,{key:0})):R("",!0),a(V,null,{default:u(()=>[a(q,{dense:"",class:"q-my-sm",outlined:"",modelValue:n.value.urut,"onUpdate:modelValue":r[0]||(r[0]=s=>n.value.urut=s),label:"Nomor Urut",rules:[s=>!s||!isNaN(s)||"Hanya angka"],ref_key:"firstInput",ref:v},null,8,["modelValue","rules"]),a(q,{dense:"",class:"q-my-sm",outlined:"",modelValue:n.value.paket,"onUpdate:modelValue":r[1]||(r[1]=s=>n.value.paket=s),required:"",label:"Nama Paket",rules:[s=>!!s||"Harus diisi!"]},null,8,["modelValue","rules"]),a(X,{modelValue:n.value.item,"onUpdate:modelValue":[r[2]||(r[2]=s=>n.value.item=s),e],url:"iuran",label:"Nama Iuran",class:"q-my-sm"},null,8,["modelValue"]),a(W,{dense:"",class:"q-my-sm",outlined:"",modelValue:n.value.nominal,"onUpdate:modelValue":r[3]||(r[3]=s=>n.value.nominal=s),required:"",label:"Nominal",rules:[s=>!!s||"Harus diisi!"]},null,8,["modelValue","rules"])]),_:1}),a(H,{"btn-delete":!x,onOnDelete:C},null,8,["btn-delete"])]),_:1})]),_:1})}}},te={key:0},ae={colspan:"7",class:"text-center bg-grey-1 no-padding"},le={key:1},ne={key:2},oe={class:"text-center"},se={class:"text-left"},re={class:"text-left"},ue={class:"text-right"},ie={class:"text-center"},de={class:"bg-green-1"},me={class:"text-right text-bold"},Me={__name:"PageIndex",setup(Q){const m=p(!1),i=p([]),c=p(""),f=p(!1),n=p({});async function k(){try{m.value=!0;const o=await B.getAll();i.value=o.iuran_paket}catch(o){console.error("ðŸš€ ~ getData ~ error:",o)}finally{m.value=!1}}D(async()=>{await k()});function x(){const o=i.value.map(e=>e.paket);return Array.from(new Set(o))}function v(){return i.value.filter(o=>o.paket==c.value)}function w(){return v().reduce(function(o,e){return o+Number(e.nominal)},0)}function P(){n.value={paket:c.value},f.value=!0}function N(o){n.value=o,f.value=!0}return(o,e)=>{const S=b("CardHeader"),C=b("CardPage");return d(),h(C,null,{default:u(()=>[a(S,{title:"Pengaturan Paket Iuran",onOnReload:k}),a(V,{class:"q-pa-sm"},{default:u(()=>[a(U,{style:{"max-width":"800px"},flat:"",bordered:""},{default:u(()=>[a(V,{class:"q-pa-sm flex justify-between"},{default:u(()=>[a($,{label:"Pilih nama paket",dense:"",outlined:"",options:x(),loading:m.value,modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l),clearable:"",style:{width:"250px","min-width":"200px"}},null,8,["options","loading","modelValue"]),a(I,{dense:"",icon:"add",label:"Baru",color:"green-10","no-caps":"",outline:"",class:"q-px-sm",title:"Buat/tambahkan data baru",onClick:e[1]||(e[1]=l=>P())})]),_:1}),a(V,{class:"q-pa-sm"},{default:u(()=>[a(z,{flat:"",bordered:""},{default:u(()=>[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",{class:"text-center"},"No"),t("th",{class:"text-left"},"Nama Paket"),t("th",{class:"text-left"},"Iuran"),t("th",{class:"text-right"},"Nominal"),t("th",{class:"text-center"},"Edit")])],-1)),t("tbody",null,[m.value?(d(),g("tr",te,[t("td",ae,[a(K,{color:"green",size:"md",class:"text-center flex flex-center q-mx-auto"})])])):!i.value.length&&!m.value?(d(),g("tr",le,[...e[5]||(e[5]=[t("td",{colspan:"7",class:"text-center text-italic text-negative bg-red-2"},[F(" Tidak ada data untuk ditampikan!"),t("br"),F(" Silakan Tambahkan data baru! ")],-1)])])):c.value?(d(!0),g(J,{key:3},L(v(),(l,r)=>(d(),g("tr",{key:r},[t("td",oe,_(l.urut),1),t("td",se,_(l.paket),1),t("td",re,_(l.item),1),t("td",ue,_(l.nominal.toRupiah()),1),t("td",ie,[a(I,{icon:"edit",flat:"",color:"green-10",onClick:y=>N(l)},null,8,["onClick"])])]))),128)):(d(),g("tr",ne,[...e[6]||(e[6]=[t("td",{colspan:"7",class:"text-center text-italic text-negative bg-red-1"}," Pilih filter! ",-1)])]))]),t("tfoot",null,[t("tr",de,[e[7]||(e[7]=t("td",{class:"text-right text-italic",colspan:"3"},"Total",-1)),t("td",me,_(w().toRupiah()),1),e[8]||(e[8]=t("td",{class:"text-center"},null,-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),a(j,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value=l)},{default:u(()=>[a(ee,{data:n.value,onSuccessSubmit:e[2]||(e[2]=l=>k()),onSuccessDelete:e[3]||(e[3]=l=>k())},null,8,["data"])]),_:1},8,["modelValue"])]),_:1})}}};export{Me as default};
