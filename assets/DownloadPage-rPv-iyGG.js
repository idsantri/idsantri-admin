import{q as d,s as T,N as g,E as v,c as V,o as q,w as r,g as n,e as h,Q as _,af as w,l as C,a9 as N,m as Q}from"./index-B_fOp8I2.js";import{Q as m}from"./QSelect-udWnZaoN.js";import{Q as U}from"./QForm-XW60lmKZ.js";import{l as u}from"./lists-madrasah-store-Cygt4UTW.js";import{K as c}from"./Kelas-lQqvgFhW.js";import{D as K}from"./DownloadUrl-BSy0AflU.js";import"./QChip-5TM6hDLU.js";import"./QItem-BIr2qAQs.js";import"./QItemLabel-Dzv1rcUf.js";import"./QMenu-BsVEoqbp.js";import"./selection-CtPAXORa.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./ApiCrud-DVH4XNNQ.js";import"./Api-BNo_L0HG.js";import"./index-Bv8s4jzG.js";import"./index-BF457XYG.js";import"./apiPost-TFI76I_W.js";const Z={__name:"DownloadPage",setup(S){const p=d(!1),l=d({}),s=d([]),o=d([]),k=[{value:"ujian",label:"Nilai Ujian"},{value:"harian",label:"Nilai Harian"},{value:"rapor",label:"Nilai Rapor"},{value:"ijazah",label:"Nilai Ijazah"}],f=u().getThAjaran;o.value.th_ajaran=f,T(async()=>{const t=u().getThAjaran;if(o.value.th_ajaran=t,t?.length)o.value.th_ajaran=t;else try{s.value.th_ajaran=!0;const a=await c.list();u().setThAjaran(a.th_ajaran),o.value.th_ajaran=a.th_ajaran}catch(a){console.error("ðŸš€ ~ error:",a)}finally{s.value.th_ajaran=!1}});async function j(){const t=JSON.parse(JSON.stringify(l.value));try{p.value=!0,await K.nilaiMapel(t)}catch(a){console.error("ðŸš€ ~ onSubmit ~ error:",a)}finally{p.value=!1}}return g(()=>l.value.th_ajaran_h,async t=>{if(l.value.tingkat_id="",l.value.kelas="",t){const a=u().getTingkatByTahun(t);if(a.length)o.value.tingkat=a;else try{s.value.tingkat=!0;const i=await c.list({th_ajaran_h:t});u().addTingkatToTahun(i.tingkat,t),o.value.tingkat=i.tingkat}catch(i){console.error("ðŸš€ ~ error:",i)}finally{s.value.tingkat=!1}}else o.value.tingkat=[];o.value.kelas=[]}),g(()=>l.value.tingkat_id,async t=>{if(l.value.kelas="",t){const a=u().getKelasByTingkatAndTahun(t,l.value.th_ajaran_h);if(a.length)o.value.kelas=a;else try{s.value.kelas=!0;const i=await c.list({th_ajaran_h:l.value.th_ajaran_h,tingkat_id:t});u().addKelasToTingkatByTahun(i.kelas,t,l.value.th_ajaran_h),o.value.kelas=i.kelas}catch(i){console.error("ðŸš€ ~ error:",i)}finally{s.value.kelas=!1}}else o.value.kelas=[]}),(t,a)=>{const i=v("CardHeader"),b=v("CardLoading"),y=v("CardPage");return q(),V(y,null,{default:r(()=>[n(i,{title:"Download Nilai","show-reload":!1},{buttons:r(()=>[n(h,{label:"Nilai Mapel",to:"/madrasah/nilai-mapel",dense:"",outline:"","no-caps":"",class:"q-px-sm",icon:"show_chart"}),n(h,{label:"Upload",to:"/madrasah/nilai-mapel/upload",dense:"",outline:"","no-caps":"",icon:"upload",class:"q-px-sm"})]),_:1}),n(_,{class:"q-pa-sm"},{default:r(()=>[n(U,{onSubmit:w(j,["prevent"])},{default:r(()=>[n(C,{style:{"max-width":"425px"}},{default:r(()=>[n(_,{class:"q-pa-sm"},{default:r(()=>[n(m,{dense:"",class:"",outlined:"",label:"Tahun Ajaran","emit-value":"","map-options":"",modelValue:l.value.th_ajaran_h,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.th_ajaran_h=e),options:o.value.th_ajaran,"option-value":"th_ajaran_h","option-label":"th_ajaran_h",clearable:"",behavior:"menu",required:"",rules:[e=>!!e||"Harus diisi!"],loading:s.value.th_ajaran},null,8,["modelValue","options","rules","loading"]),n(m,{dense:"",class:"",outlined:"",label:"Tingkat Pendidikan","emit-value":"","map-options":"","option-value":"tingkat_id","option-label":"tingkat",modelValue:l.value.tingkat_id,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.tingkat_id=e),options:o.value.tingkat,loading:s.value.tingkat,clearable:"",behavior:"menu",required:"",rules:[e=>!!e||"Harus diisi!"]},null,8,["modelValue","options","loading","rules"]),n(m,{dense:"",class:"",outlined:"",label:"Kelas","emit-value":"","map-options":"",modelValue:l.value.kelas,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.kelas=e),options:o.value.kelas,loading:s.value.kelas,clearable:"",behavior:"menu",required:"",rules:[e=>!!e||"Harus diisi!"]},null,8,["modelValue","options","loading","rules"]),n(m,{dense:"",class:"q-mt-sm",outlined:"",label:"Kategori Nilai",modelValue:l.value.category,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.category=e),behavior:"menu",required:"",options:k,"emit-value":"","map-options":"",rules:[e=>!!e||"Harus diisi!"]},null,8,["modelValue","rules"]),n(N,{dense:"",class:"q-mt-sm",outlined:"",label:"Ujian Ke",modelValue:l.value.ujian_ke,"onUpdate:modelValue":a[4]||(a[4]=e=>l.value.ujian_ke=e),required:"",type:"number",rules:[e=>e>0&&e<5||"antara 1 s.d. 4"]},null,8,["modelValue","rules"])]),_:1}),n(Q,{class:"bg-green-6",align:"right"},{default:r(()=>[n(h,{class:"",type:"submit",label:"Download",icon:"download",color:"green-11","no-caps":"",outline:"",dense:""})]),_:1}),n(b,{showing:p.value},null,8,["showing"])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Z as default};
