import{q as d,A as N,s as O,E as b,c as v,o as u,w as l,g as e,Q as y,v as c,l as Q,ah as A,b as _,F as S,D as T,e as V,t as w}from"./index-Ba6UWhY3.js";import{Q as P,a as h}from"./QTable-CayST3Th.js";import{Q as $}from"./QTr-CZCQ6VxO.js";import{Q as x}from"./QTd-zFUom1jF.js";import{Q as F}from"./QTooltip-BGDziMMJ.js";import{_ as H}from"./InputSearch-CK7yvAqj.js";import{A as U}from"./ApiCrud-8mMJRmXF.js";import{A as q}from"./ArrayCrud-CkcA-ixF.js";import{c as j}from"./format-date-OVhbBx9F.js";import{c as K}from"./index-CQzYHC66.js";import"./QList-2dqJxDl-.js";import"./QMarkupTable-CoELrt1n.js";import"./QSelect-dWftgJmx.js";import"./QChip-DSNXL-H8.js";import"./QItem-DG0wxRWx.js";import"./QItemLabel-DG2jRLkC.js";import"./QMenu-UHPuzKke.js";import"./selection-B-msF6Vz.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-B0gFlgzg.js";import"./Api-BMf39EYj.js";import"./index-ChQSy5Ts.js";import"./api-error-DVIp_c6X.js";import"./id-BuNGTsqN.js";class z extends U{constructor(){super("alumni")}}const C=new z,J={key:0},R={key:1},ya={__name:"IndexPage",setup(B){const s=d([]),p=d(!1),g=d(!1),k=d(""),m=d(!1);async function D(){try{p.value=!0;const a=await C.getAll();s.value=a.alumni}catch(a){console.log("üöÄ ~ loadData ~ error:",a)}finally{p.value=!1}}async function E(a){const n=!!a.sent_to_alumni_at;try{m.value=!0;const i=["belum terkirim","sudah terkirim"],f=["Data yang sudah terkirim tidak bisa ditarik lagi!","Jika data belum terkirim, Anda perlu klik tombol kirim setelah ini!"];let o=`Tandai ${n?i[0]:i[1]}?`;if(o+="<br/><br/><hr/>",o+="<small>",o+="<em>Aksi ini hanya mengubah status!</em><br/>",o+=`<em>${n?f[0]:f[1]}</em><br/>`,o+="</small>",o+="<hr/>",!await K(o))return;await C.update({id:a.id,data:{activated:!n}});const r={...a,sent_to_alumni_at:a.sent_to_alumni_at?null:new Date().toISOString()};s.value=q.update(s.value,a.id,r)}catch(i){console.log("Error updating sent status:",i)}finally{m.value=!1}}async function I(a){if(await K("Kirim data ke aplikasi alumni?"))try{m.value=!0,await C.create({data:{id:a.id}});const i={...a,sent_to_alumni_at:new Date().toISOString()};s.value=q.update(s.value,a.id,i)}catch(i){console.log("Error updating sent status:",i)}finally{m.value=!1}}const L=N(()=>g.value?s.value.filter(a=>a.sent_to_alumni_at):s.value.filter(a=>!a.sent_to_alumni_at));O(async()=>{await D()});const M=[{name:"santri_id",label:"Santri ID",align:"center",field:"santri_id",sortable:!0},{name:"nama",label:"Name",align:"left",field:"nama",sortable:!0},{name:"created_at",label:"Tanggal",field:"created_at",format:a=>j(a,"dd-MM-yyyy"),sortable:!0},{name:"alamat",label:"Alamat",align:"left",field:a=>a.desa+" "+a.kecamatan+" "+a.kabupaten}];return(a,n)=>{const i=b("CardHeader"),f=b("CardLoading"),o=b("CardPage");return u(),v(o,null,{default:l(()=>[e(i,{title:"Data Alumni",onOnReload:D}),e(y,{class:"bg-green-12 q-pa-xs text-caption"},{default:l(()=>[...n[2]||(n[2]=[c(" Menampilkan data santri berhenti/diberhentikan ",-1)])]),_:1}),e(y,{class:"q-pa-sm tw:grid tw:grid-cols-1 tw:sm:flex tw:sm:justify-between tw:gap-2 bg-green-11"},{default:l(()=>[e(Q,{flat:"",bordered:"",style:{"min-width":"300px"}},{default:l(()=>[e(A,{modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=t=>g.value=t),label:"Terkirim",color:"green-7","checked-icon":"check","unchecked-icon":"clear"},null,8,["modelValue"])]),_:1}),e(Q,{flat:"",bordered:"",style:{"min-width":"300px"}},{default:l(()=>[e(H,{modelValue:k.value,"onUpdate:modelValue":n[1]||(n[1]=t=>k.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{class:"q-pa-sm"},{default:l(()=>[e(f,{showing:m.value},null,8,["showing"]),e(P,{rows:L.value,loading:p.value,filter:k.value,"rows-per-page-options":[10,25,50,75,100,0],flat:"",bordered:"","row-key":"id",columns:M},{header:l(t=>[e($,{props:t},{default:l(()=>[(u(!0),_(S,null,T(t.cols,r=>(u(),v(h,{key:r.name,props:t},{default:l(()=>[c(w(r.label),1)]),_:2},1032,["props"]))),128)),e(h,{class:"text-center"},{default:l(()=>[...n[3]||(n[3]=[c("Kirim",-1)])]),_:1}),e(h,{class:"text-center"},{default:l(()=>[...n[4]||(n[4]=[c("Selesai",-1)])]),_:1})]),_:2},1032,["props"])]),body:l(t=>[e($,{props:t},{default:l(()=>[(u(!0),_(S,null,T(t.cols,r=>(u(),v(x,{key:r.name,props:t},{default:l(()=>[r.name=="santri_id"?(u(),_("span",J,[e(V,{label:r.value,"no-caps":"",size:"sm",outline:"",class:"text-green-10",to:`/santri/${r.value}`},null,8,["label","to"])])):(u(),_("span",R,w(r.value),1))]),_:2},1032,["props"]))),128)),e(x,{class:"text-center"},{default:l(()=>[e(V,{disable:!!t.row.sent_to_alumni_at,class:"q-px-sm",dense:"",icon:"sym_o_forward",outline:!!t.row.sent_to_alumni_at,color:"green",onClick:r=>I(t.row),label:"Kirim","no-caps":""},null,8,["disable","outline","onClick"])]),_:2},1024),e(x,{class:"text-center"},{default:l(()=>[e(A,{"model-value":!!t.row.sent_to_alumni_at,onClick:r=>E(t.row),"checked-icon":"check","unchecked-icon":"clear",color:"green-7"},null,8,["model-value","onClick"]),e(F,null,{default:l(()=>[c(w(t.row.sent_to_alumni_at?"Data sudah terkirim ‚úÖ ‚Äî Klik untuk mengubah status!":"Data belum terkirim ‚ùå ‚Äî Klik untuk mengubah status!"),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","filter"])]),_:1})]),_:1})}}};export{ya as default};
