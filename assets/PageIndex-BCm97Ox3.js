import{Q as $}from"./QSelect-DyXiAk3o.js";import{v as p,R as Q,x as P,f as q,o as m,w as d,i as o,a8 as I,Q as y,r as v,y as h,B as C,a4 as w,q as B,p as N,k as l,j as S,F as D,s as F,t as g}from"./index-1h6WQa8x.js";import{Q as O}from"./QSpinnerFacebook-BRzBKvtE.js";import{Q as T}from"./QMarkupTable-CljO3Fff.js";import{Q as H}from"./QPage-B_WVg178.js";import{a as j}from"./api-get-BY6mtHh6.js";import{Q as E}from"./QSpinnerCube-CdFtSnRz.js";import{Q as M}from"./QForm-Dcqp4yj8.js";import{l as R}from"./lists-store-DUO5Gnb9.js";import{a as A}from"./api-delete-BHdy2F2f.js";import{a as z}from"./api-update-Damf_6Ly.js";import{a as J}from"./api-post-C74Y7wCj.js";import{_ as G}from"./InputCurrency-C4S6SfTn.js";import{_ as L}from"./InputSelectArray-f2GqfPam.js";import{_ as K}from"./CardHeader-9jHTR91R.js";import"./QChip-DJ1cSnO8.js";import"./QItemSection-CDMonx4a.js";import"./QItemLabel-BCrbjFPh.js";import"./QMenu-C8eKSCkY.js";import"./selection-Bkxc-DqK.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./index-CpzetzrR.js";import"./index-_Ec9HkD1.js";import"./api-error-B2Y93K9w.js";import"./lists-data-L-iOlbK0.js";import"./api-get-lists-BZgeu587.js";import"./DropDownAfter-vvhC7sAZ.js";import"./QBtnDropdown-BuGH-2yX.js";import"./QBtnGroup-GiM85D-N.js";import"./ClosePopup-DlITPM1C.js";import"./QSpace-CR7bsMEl.js";const W={key:0},X={__name:"IuranPaketForm",props:{data:{type:Object,required:!1,default:()=>{}}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(V,{emit:f}){const k=V,r=f,s=p({}),u=p(!1),c=p([]);Q(async()=>{Object.assign(s.value,k.data),c.value=R().getByStateName("iuran")});const b=i=>{const a=c.value.find(n=>n.val0===i);a&&(s.value.nominal=a.val1)},x=async()=>{const i=JSON.parse(JSON.stringify(s.value));delete i.id;let a=null;const n=!s.value.id;n?a=await J({endPoint:"iuran-paket",data:i,loading:u}):a=await z({endPoint:`iuran-paket/${s.value.id}`,data:i,confirm:!0,notify:!0,loading:u}),a&&(document.getElementById("btn-close-form").click(),r("successSubmit",a?.iuran_paket),r(n?"successCreate":"successUpdate",a?.iuran_paket))},_=async()=>{const i=s.value.id;await A({endPoint:`iuran-paket/${i}`,loading:u})&&(document.getElementById("btn-close-form").click(),r("successDelete",i))};return(i,a)=>{const n=P("FormHeader"),t=P("FormActions");return m(),q(B,{class:"full-width",style:{"max-width":"425px"}},{default:d(()=>[o(M,{onSubmit:I(x,["prevent"])},{default:d(()=>[o(n,{title:"Input Paket Iuran","is-new":!s.value.id},null,8,["is-new"]),o(y,null,{default:d(()=>[u.value?(m(),v("div",W,[o(C,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),persistent:""},{default:d(()=>[o(E,{color:"green-12",size:"8em",class:"flex q-ma-lg q-mx-auto"})]),_:1},8,["modelValue"])])):h("",!0),o(w,{dense:"",class:"",outlined:"",modelValue:s.value.urut,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value.urut=e),label:"Nomor Urut",rules:[e=>!e||!isNaN(e)||"Hanya angka"]},null,8,["modelValue","rules"]),o(w,{dense:"",class:"q-mt-sm",outlined:"",modelValue:s.value.paket,"onUpdate:modelValue":a[2]||(a[2]=e=>s.value.paket=e),required:"",label:"Nama Paket",rules:[e=>!!e||"Harus diisi!"]},null,8,["modelValue","rules"]),o(L,{modelValue:s.value.item,"onUpdate:modelValue":[a[3]||(a[3]=e=>s.value.item=e),b],url:"iuran",label:"Nama Iuran",class:"q-mt-sm"},null,8,["modelValue"]),o(G,{dense:"",class:"q-mt-sm",outlined:"",modelValue:s.value.nominal,"onUpdate:modelValue":a[4]||(a[4]=e=>s.value.nominal=e),required:"",label:"Nominal",rules:[e=>!!e||"Harus diisi!"]},null,8,["modelValue","rules"])]),_:1}),o(t,{"btn-delete":!!s.value.id,onOnDelete:_},null,8,["btn-delete"])]),_:1})]),_:1})}}},Y={key:0},Z={colspan:"7",class:"text-center bg-grey-1 no-padding"},ee={key:1},te={key:2},ae={class:"text-center"},le={class:"text-left"},se={class:"text-left"},oe={class:"text-right"},ne={class:"text-center"},ie={class:"bg-green-1"},re={class:"text-right text-bold"},Me={__name:"PageIndex",setup(V){const f=p(!1),k=p([]),r=p(""),s=p(!1),u=p({});async function c(){const n=await j({endPoint:"iuran-paket",loading:f});n&&(k.value=n.iuran_paket)}Q(async()=>{await c()});function b(){const n=k.value.map(t=>t.paket);return Array.from(new Set(n))}function x(){return k.value.filter(n=>n.paket==r.value)}function _(){return x().reduce(function(n,t){return n+Number(t.nominal)},0)}function i(){u.value={paket:r.value},s.value=!0}function a(n){u.value=n,s.value=!0}return(n,t)=>(m(),q(H,{class:"q-pa-sm"},{default:d(()=>[o(B,{class:"",style:{"max-width":"800px"}},{default:d(()=>[o(K,{title:"Pengaturan Paket Iuran",onOnReload:c}),o(y,{class:"q-pa-sm flex justify-between"},{default:d(()=>[o($,{label:"Pilih nama paket",dense:"",outlined:"",options:b(),loading:f.value,modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),clearable:"",style:{width:"250px","min-width":"200px"}},null,8,["options","loading","modelValue"]),o(N,{dense:"",icon:"add",label:"Baru",color:"green-10","no-caps":"",outline:"",class:"q-px-sm",title:"Buat/tambahkan data baru",onClick:t[1]||(t[1]=e=>i())})]),_:1}),o(y,{class:"q-pa-sm"},{default:d(()=>[o(T,{flat:"",bordered:""},{default:d(()=>[t[9]||(t[9]=l("thead",null,[l("tr",null,[l("th",{class:"text-center"},"No"),l("th",{class:"text-left"},"Nama Paket"),l("th",{class:"text-left"},"Iuran"),l("th",{class:"text-right"},"Nominal"),l("th",{class:"text-center"},"Edit")])],-1)),l("tbody",null,[f.value?(m(),v("tr",Y,[l("td",Z,[o(O,{color:"green",size:"md"})])])):!k.value.length&&!f.value?(m(),v("tr",ee,[...t[5]||(t[5]=[l("td",{colspan:"7",class:"text-center text-italic text-negative bg-red-2"},[S(" Tidak ada data untuk ditampikan!"),l("br"),S(" Silakan Tambahkan data baru! ")],-1)])])):r.value?(m(!0),v(D,{key:3},F(x(),(e,U)=>(m(),v("tr",{key:U},[l("td",ae,g(e.urut),1),l("td",le,g(e.paket),1),l("td",se,g(e.item),1),l("td",oe,g(e.nominal.toRupiah()),1),l("td",ne,[o(N,{icon:"edit",flat:"",color:"green-10",onClick:ue=>a(e)},null,8,["onClick"])])]))),128)):(m(),v("tr",te,[...t[6]||(t[6]=[l("td",{colspan:"7",class:"text-center text-italic text-negative bg-red-1"}," Pilih filter! ",-1)])]))]),l("tfoot",null,[l("tr",ie,[t[7]||(t[7]=l("td",{class:"text-right text-italic",colspan:"3"}," Total ",-1)),l("td",re,g(_().toRupiah()),1),t[8]||(t[8]=l("td",{class:"text-center"},null,-1))])])]),_:1})]),_:1})]),_:1}),o(C,{modelValue:s.value,"onUpdate:modelValue":t[4]||(t[4]=e=>s.value=e)},{default:d(()=>[o(X,{data:u.value,onSuccessSubmit:t[2]||(t[2]=e=>c()),onSuccessDelete:t[3]||(t[3]=e=>c())},null,8,["data"])]),_:1},8,["modelValue"])]),_:1}))}};export{Me as default};
