import{q as y,ap as N,s as L,Y as P,E as k,c as _,o as w,w as a,g as e,af as K,f as $,G as O,Q as H,a9 as g,l as R,n as I,v as n,p as M,e as b,t as D,m as E,a as j,J as G}from"./index-DEh4UAKk.js";import{Q as T}from"./QItemLabel-CulQpTC_.js";import{Q as U,a as p}from"./QItem-BTdNNvAd.js";import{Q as J}from"./QList-DhKPmN5Y.js";import{Q as Y,a as f}from"./QTable-6Gk1SYjv.js";import{Q as h}from"./QTr--0CoeY6I.js";import{Q as c}from"./QTd-CjulTPqJ.js";import{C as F}from"./ClosePopup-BXwyq4AY.js";import{Q as z}from"./QForm-BUEZNW1c.js";import{_ as W}from"./InputSelectArray-DJMMXyVK.js";import{M as Q}from"./Mutasi-njEjgOe6.js";import{u as X}from"./useCrudForm-vQEJO8b7.js";import{D as Z}from"./DownloadUrl-BqP1m1Fc.js";import"./QMarkupTable-Cqq_cQ7g.js";import"./QSelect-DNJsugZb.js";import"./QField-69w4fhxK.js";import"./QChip-lnLCnRVJ.js";import"./QMenu-CObjFV0N.js";import"./selection-KIVhQnt8.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-DdVG38xO.js";import"./lists-store-11MsQNSk.js";import"./ArrayCrud-CByp4EUn.js";import"./DropDownAfter-RHUW-wI2.js";import"./QBtnDropdown-BRJ1Ephg.js";import"./QBtnGroup-BPjWXio5.js";import"./Lists-C2wzKE7K.js";import"./ApiCrud-DGpYTBeQ.js";import"./Api-Cf9F4lBj.js";import"./index-C8LJz6c6.js";import"./index-Cm_fkxN3.js";import"./apiPost-PqFHjFje.js";const ee={__name:"MutasiForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(B,{emit:u}){const o=B,v=u,s=y({...o.data}),r=N("firstInput");L(async()=>{await P(),r.value&&r.value.focus()});const{handleDelete:C,handleUpdate:x,loading:S}=X(Q,{emit:v,responseKey:"mutasi"});async function q(){const t={new_domisili:s.value.new_domisili,new_keterangan:s.value.new_keterangan};return await x(o.data.id,t,!0)}async function i(){return await C(o.data.id)}return(t,d)=>{const V=k("FormHeader"),A=k("FormLoading"),l=k("FormActions");return w(),_(R,{class:"full-width",style:{"max-width":"425px"}},{default:a(()=>[e(z,{onSubmit:K(q,["prevent"])},{default:a(()=>[e(V,{title:"Data Domisili Baru","is-new":!1}),O(S)?(w(),_(A,{key:0})):$("",!0),e(H,null,{default:a(()=>[e(g,{"model-value":s.value.nama+" ("+s.value.santri_id+")",class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Nama (ID)"},null,8,["model-value"]),e(g,{"model-value":s.value.tingkat+" â€” "+s.value.kelas,class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Tingkat â€” Kelas"},null,8,["model-value"]),e(g,{"model-value":s.value.domisili,class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Domisili (Asal)"},null,8,["model-value"]),e(W,{modelValue:s.value.new_domisili,"onUpdate:modelValue":d[0]||(d[0]=m=>s.value.new_domisili=m),url:"domisili",label:"Domisili (Baru) *",class:"q-my-sm",rules:[m=>!!m||"Harus diisi!"],clearable:!1,ref_key:"firstInput",ref:r},null,8,["modelValue","rules"]),e(g,{modelValue:s.value.new_keterangan,"onUpdate:modelValue":d[1]||(d[1]=m=>s.value.new_keterangan=m),class:"q-my-sm",dense:"",outlined:"",label:"Keterangan (Baru)",autogrow:!0},null,8,["modelValue"])]),_:1}),e(l,{"btn-delete":!0,onOnDelete:i})]),_:1})]),_:1})}}},Fe={__name:"ResultMutasi",setup(B){const u=y([]),o=y(!1),v=y(!1),s=y({});async function r(){try{o.value=!0;const i=await Q.getAll({notifySuccess:!1});u.value=i.mutasi.map(t=>({...t,tk:t.tingkat_id+" "+t.kelas}))}catch(i){console.error("ðŸš€ ~ loadData ~ error:",i)}finally{o.value=!1}}L(async()=>{await r()});async function C(i){s.value=i,v.value=!0}async function x(){const i=`<hr><span style="color:blue">Update Domisili?</span><hr>
		<em>
			<strong>Peringatan:</strong>
			<ul style="margin:0">
				<li>Pastikan semua keperluan Administrasi (terkait domisili asal) telah selesai!</li>
				<li>Sebaiknya data di-download/ diunduh terlebih dahulu sebagai backup!</li>
				<li>Setelah update selesai, semua data mutasi akan <strong>dihapus</strong>!</li>
			</ul>
		</em>`;try{o.value=!0,await Q.execute(i)&&await r()}catch(t){console.error("ðŸš€ ~ updateDomisili ~ error:",t)}finally{o.value=!1}}async function S(){try{o.value=!0,await Q.removeAll(),u.value=[]}catch(i){console.error("ðŸš€ ~ deleteAll ~ error:",i)}finally{o.value=!1}}async function q(){try{o.value=!0,await Z.mutasi()}catch(i){console.error("ðŸš€ ~ downloadMutasi ~ error:",i)}finally{o.value=!1}}return(i,t)=>{const d=k("CardHeader"),V=k("CardLoading"),A=k("CardPage");return w(),_(A,{"dynamic-height":!1},{default:a(()=>[e(d,{title:"Data Mutasi Domisili",onOnReload:r},{buttons:a(()=>[e(b,{icon:"tune",label:"Atur Mutasi",dense:"",outline:"","no-caps":"",class:"q-px-sm",to:"/mutasi/start"})]),more:a(()=>[e(J,null,{default:a(()=>[I((w(),_(U,{to:"/info/download"},{default:a(()=>[e(p,null,{default:a(()=>[e(T,null,{default:a(()=>[...t[1]||(t[1]=[n("Cetak",-1)])]),_:1})]),_:1}),e(p,{avatar:""},{default:a(()=>[e(M,{name:"print",flat:""})]),_:1})]),_:1})),[[F]]),I((w(),_(U,{onClick:q,clickable:""},{default:a(()=>[e(p,null,{default:a(()=>[e(T,null,{default:a(()=>[...t[2]||(t[2]=[n("Unduh/Download",-1)])]),_:1})]),_:1}),e(p,{avatar:""},{default:a(()=>[e(M,{name:"download",flat:""})]),_:1})]),_:1})),[[F]]),I((w(),_(U,{onClick:S,clickable:""},{default:a(()=>[e(p,null,{default:a(()=>[e(T,null,{default:a(()=>[...t[3]||(t[3]=[n("Hapus Semua",-1)])]),_:1})]),_:1}),e(p,{avatar:""},{default:a(()=>[e(M,{name:"delete_forever",flat:""})]),_:1})]),_:1})),[[F]])]),_:1})]),_:1}),e(V,{showing:o.value},null,8,["showing"]),e(H,{class:"q-pa-sm"},{default:a(()=>[e(Y,{class:"q-pa-sm",rows:u.value,loading:o.value,"rows-per-page-options":[10,25,50,75,100,0],flat:"",bordered:""},{header:a(l=>[e(h,{props:l},{default:a(()=>[e(f,{key:"santri_id",props:l,class:"text-left"},{default:a(()=>[...t[4]||(t[4]=[n(" ID Santri ",-1)])]),_:1},8,["props"]),e(f,{key:"nama",props:l},{default:a(()=>[...t[5]||(t[5]=[n(" Nama ",-1)])]),_:1},8,["props"]),e(f,{key:"tk",props:l},{default:a(()=>[...t[6]||(t[6]=[n(" Tingkat â€” Kelas ",-1)])]),_:1},8,["props"]),e(f,{key:"domisili",props:l},{default:a(()=>[...t[7]||(t[7]=[n(" Domisili (Asal) ",-1)])]),_:1},8,["props"]),e(f,{key:"new_domisili",props:l},{default:a(()=>[...t[8]||(t[8]=[n(" Domisili (Baru) ",-1)])]),_:1},8,["props"]),e(f,{class:"text-center"})]),_:2},1032,["props"])]),body:a(l=>[e(h,{props:l},{default:a(()=>[e(c,{key:"santri_id",props:l,class:"text-left"},{default:a(()=>[e(b,{label:l.row.santri_id,outline:"",color:"green-10",class:"text-caption q-px-sm",dense:"",to:`/santri/${l.row.santri_id}`},null,8,["label","to"])]),_:2},1032,["props"]),e(c,{key:"nama",props:l},{default:a(()=>[n(D(l.row.nama),1)]),_:2},1032,["props"]),e(c,{key:"tk",props:l},{default:a(()=>[n(D(l.row.tk),1)]),_:2},1032,["props"]),e(c,{key:"domisili",props:l},{default:a(()=>[n(D(l.row.domisili),1)]),_:2},1032,["props"]),e(c,{key:"new_domisili",props:l},{default:a(()=>[n(D(l.row.new_domisili),1)]),_:2},1032,["props"]),e(c,{key:"id",props:l,class:"text-center"},{default:a(()=>[e(b,{icon:"edit",flat:"",color:"green-10",onClick:m=>C(l.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1}),e(E,{class:"q-pa-sm bg-green-7 text-green-11 row"},{default:a(()=>[t[9]||(t[9]=j("div",{class:"col text-italic"}," 1) Teliti kembali sebelum Anda menekan tombol Update; 2) Lakukan backup data dengan menekan tombol download!; ",-1)),e(b,{style:{"max-width":"150px"},class:"col bg-green-8 q-ml-md",label:"Update Domisili",glossy:"","no-caps":"",dense:"",outline:"",icon:"sym_o_edit_arrow_up",disable:!u.value.length>0||o.value,onClick:x},null,8,["disable"])]),_:1}),e(G,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=l=>v.value=l)},{default:a(()=>[e(ee,{data:s.value,onSuccessDelete:r,onSuccessSubmit:r},null,8,["data"])]),_:1},8,["modelValue"])]),_:1})}}};export{Fe as default};
