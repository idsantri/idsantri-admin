import{q as o,E as b,c as D,o as z,w as v,g as l,af as F,f as $,G as y,Q as j,a9 as c,l as q,ad as U,s as I,b as M,J as C}from"./index-CQ0qIhEP.js";import{i as x,f as H,a as Q}from"./format-date-OVhbBx9F.js";import{f as A,m as K}from"./hijri-Bs48DFvR.js";import{g as N}from"./array-object-BytDdNh7.js";import{a as B}from"./api-get-Byi7HYvF.js";import{_ as E}from"./TemplateArray-By5fIGbH.js";import{Q as O}from"./QForm-BKVRYDjQ.js";import{_ as S}from"./InputSelectArray-CWQ77YQP.js";import{u as P}from"./useCrudForm-CdMW2jfj.js";import{A as G}from"./ApiCrud-CTqzeVEQ.js";import{_ as L}from"./ReportViewer-CjUe5C5L.js";import"./id-BuNGTsqN.js";import"./format-number-B34ySHL_.js";import"./index-C36Pt7tG.js";import"./index-2V1OGIJG.js";import"./api-error-B4jdTJfc.js";import"./QItem-CyQ3ZeWO.js";import"./QItemLabel-xsvcZ1pF.js";import"./QList-Cm7tLIM_.js";import"./QSelect-DO368R1o.js";import"./QChip-DCZlNK59.js";import"./QMenu-BzidYdHX.js";import"./selection-z3L9X0ok.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./lists-store-ChrMIcaE.js";import"./ArrayCrud-CkcA-ixF.js";import"./DropDownAfter-DjwH34eY.js";import"./QBtnDropdown-BPgUBuO5.js";import"./QBtnGroup-F-zmrqby.js";import"./ClosePopup-BUMqc0WT.js";import"./Lists-NDY-gRf7.js";import"./Api-BqJ70Mc-.js";class R extends G{constructor(){super("izin-madrasah")}async riwayat(_){const u=await this._apiGet({endPoint:`${this._path}/kelas/${_}`});return this._showSuccess(u.message),u.data}}const T=new R,J={__name:"IzinMadrasahForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(h,{emit:_}){const u=h,f=_,a=o({keperluan:"Sakit",durasi:1,...u.data}),t=!u.data?.id,{handleDelete:g,handleCreate:d,handleUpdate:s,loading:k}=P(T,{emit:f,responseKey:"izin_madrasah"}),m=async()=>{const p={kelas_id:a.value.kelas_id,dari_tgl:a.value.dari_tgl,durasi:a.value.durasi,keperluan:a.value.keperluan,keterangan:a.value.keterangan,catatan:a.value.catatan};return t?await d(p,!0):await s(u.data.id,p,!0)},V=async()=>await g(u.data.id);return(p,r)=>{const w=b("FormHeader"),i=b("FormLoading"),n=b("FormActions");return z(),D(q,{class:"full-width",style:{"max-width":"425px"}},{default:v(()=>[l(O,{onSubmit:F(m,["prevent"])},{default:v(()=>[l(w,{title:"Input Izin Madrasah","is-new":t}),y(k)?(z(),D(i,{key:0})):$("",!0),l(j,null,{default:v(()=>[l(c,{dense:"",class:"q-my-sm",outlined:"",label:"Nama","model-value":a.value?.nama+" ("+a.value?.santri_id+")",disable:"",filled:""},null,8,["model-value"]),l(c,{dense:"",class:"q-my-sm",outlined:"",label:"Data Kelas","model-value":a.value?.th_ajaran_h+" | "+a.value?.tingkat_id+" | "+a.value?.kelas,disable:"",filled:""},null,8,["model-value"]),l(c,{dense:"",hint:y(x)(a.value.dari_tgl)?y(H)(a.value.dari_tgl):"",class:"q-my-sm",outlined:"",label:"Tanggal (M)*",modelValue:a.value.dari_tgl,"onUpdate:modelValue":r[0]||(r[0]=e=>a.value.dari_tgl=e),type:"date",rules:[e=>!!e||"Harus diisi!"],"error-color":"negative"},null,8,["hint","modelValue","rules"]),l(c,{dense:"",class:"q-my-sm",outlined:"",label:"Durasi (hari)*",modelValue:a.value.durasi,"onUpdate:modelValue":r[1]||(r[1]=e=>a.value.durasi=e),rules:[e=>!!e||"Harus diisi!",e=>!e||!isNaN(e)||"Hanya angka"],"error-color":"negative"},null,8,["modelValue","rules"]),l(S,{modelValue:a.value.keperluan,"onUpdate:modelValue":r[2]||(r[2]=e=>a.value.keperluan=e),url:"keperluan-izin",label:"Keperluan *",class:"q-my-sm",rules:[e=>!!e||"Harus diisi!"]},null,8,["modelValue","rules"]),l(S,{modelValue:a.value.keterangan,"onUpdate:modelValue":r[3]||(r[3]=e=>a.value.keterangan=e),url:"keterangan-izin",label:"Keterangan",class:"q-my-sm"},null,8,["modelValue"]),l(c,{dense:"",class:"q-my-sm",outlined:"",label:"Catatan",modelValue:a.value.catatan,"onUpdate:modelValue":r[4]||(r[4]=e=>a.value.catatan=e),autogrow:""},null,8,["modelValue"])]),_:1}),l(n,{"btn-delete":!t,onOnDelete:V},null,8,["btn-delete"])]),_:1})]),_:1})}}},$a={__name:"KelasIzin",setup(h){const u=U().params,f=o([]),a=o([]),t=o({}),g=o(!1),d=o(!1),s=o({}),k=o("");async function m(){const i=await B({endPoint:`izin-madrasah/kelas/${u.id}`,loading:g});i.izin_madrasah&&(f.value=i.izin_madrasah,s.value=i.kelas,a.value=i.izin_madrasah.map(n=>({Tanggal:Q(n.dari_tgl)+" | "+A(K(n.dari_tgl)),Durasi:n.durasi+" hari",Keperluan:n.keperluan+`${n.keterangan?.length>0?" ("+n.keterangan+")":""}`,Catatan:n.catatan,id:n.id})))}I(async()=>{await m()});const V=()=>{t.value={},t.value.santri_id=s.value.santri_id,t.value.nama=s.value.nama,t.value.th_ajaran_h=s.value.th_ajaran_h,t.value.tingkat_id=s.value.tingkat_id,t.value.kelas=s.value.kelas,t.value.kelas_id=s.value.id,d.value=!0},p=({id:i})=>{t.value={},t.value=N(f,i),t.value.santri_id=s.value.santri_id,t.value.nama=s.value.nama,t.value.th_ajaran_h=s.value.th_ajaran_h,t.value.tingkat_id=s.value.tingkat_id,t.value.kelas=s.value.kelas,d.value=!0},r=o(!1);function w(i){k.value=`reports/izin-madrasah/view?id=${i.id}}`,r.value=!0}return(i,n)=>(z(),M("div",null,[l(E,{data:a.value,spinner:g.value,"btn-print":!0,onAdd:V,onEdit:p,onPrint:w},null,8,["data","spinner"]),l(C,{modelValue:d.value,"onUpdate:modelValue":n[0]||(n[0]=e=>d.value=e)},{default:v(()=>[l(J,{data:t.value,onSuccessSubmit:m,onSuccessDelete:m},null,8,["data"])]),_:1},8,["modelValue"]),l(C,{modelValue:r.value,"onUpdate:modelValue":n[1]||(n[1]=e=>r.value=e)},{default:v(()=>[l(L,{url:k.value},null,8,["url"])]),_:1},8,["modelValue"])]))}};export{$a as default};
