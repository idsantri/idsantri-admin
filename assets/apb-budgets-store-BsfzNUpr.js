import{be as D,q as s,A as l}from"./index-B5Gb-mLe.js";import{A as S}from"./ApiCrud-DSLkdATC.js";import{A as v}from"./ArrayCrud-CByp4EUn.js";import{c as B}from"./index-w3oJRLyV.js";class j extends S{constructor(){super("apb/budgets")}async listTahunAjaran(){return(await this._apiGet({endPoint:`${this._path}/lists/th-ajaran-h`})).data}}const c=new j,H=D("budgets-store",()=>{const o=s(!1),u=s(!1),r=s([]),y=s(""),p=s(""),n=s(""),i=s(""),d=s([]),m=l(()=>r.value.map(e=>{const t=Number(e.total_budget),a=Number(e.total_absorbed);let f=0,g="normal";return t>0?f=(a/t*100).toFixed(2):t===0&&a>0&&(f=100,g="unbudgeted"),{...e,sisa:e.category.toUpperCase()==="PENDAPATAN"?a-t:t-a,percentage:f,status:g}})),b=l(()=>{if(n.value){const e=r.value.filter(t=>t.category===n.value).map(t=>t.group);return[...new Set(e)].sort()}else{const e=r.value.map(t=>t.group);return[...new Set(e)].sort()}}),h=l(()=>{const e=r.value.map(t=>t.category).filter(t=>t!==null);return[...new Set(e)]}),A=l(()=>m.value.filter(a=>n.value?a.category===n.value:!0).filter(a=>i.value?a.group===i.value:!0));async function w(){try{u.value=!0;const e=await c.listTahunAjaran();d.value=e.th_ajaran_h}catch(e){console.error(e)}finally{u.value=!1}}async function C(e,t=!0){try{o.value=!0;const a=await c.getAll({params:{th_ajaran_h:e},notifySuccess:t});r.value=a.budgets,p.value=e}catch(a){console.error("ðŸš€ ~ loadData ~ _err:",a)}finally{o.value=!1}}async function T(e){try{o.value=!0;const t=await c.getById({id:e});return r.value=v.update(r.value,e,t.budget),t.budget}catch(t){console.error("ðŸš€ ~ loadData ~ _err:",t)}finally{o.value=!1}}async function _(e){if(!await B('<span style="color: red">Hapus anggaran ini?</span>'))return!1;try{return o.value=!0,await c.remove({id:e,confirm:!1}),r.value=v.remove(r.value,e),!0}catch(a){console.error("ðŸš€ ~ remove ~ error:",a)}finally{o.value=!1}}return{loading:o,loadingTh:u,budgets:r,loadByTahun:C,loadById:T,listTahun:w,removeData:_,filterText:y,filterThAjaranH:p,filterCategory:n,filterGroup:i,optionsThAjaran:d,optionsGroup:b,optionsCategory:h,filteredData:A}},{persist:{storage:sessionStorage}});export{c as A,H as u};
