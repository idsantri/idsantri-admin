import{B as k,C as g,c,o as _,w as e,g as a,ae as T,f as N,D as L,Q as I,a8 as b,l as $,a9 as K,X as O,n as A,y as i,a4 as M,e as y,t as v,m as R,a as E,H as j}from"./index-BSwPLBvN.js";import{Q as P}from"./QItemLabel-CIOWhTht.js";import{Q as U,a as m}from"./QItemSection-WqxvrlOw.js";import{Q as G}from"./QList-Dn-IYx8z.js";import{Q as W,a as p}from"./QTable-CXpNMcKn.js";import{Q as F}from"./QTr-DMSAWICM.js";import{Q as f}from"./QTd-DdHwQKAz.js";import{C as B}from"./ClosePopup-9H5qeAFV.js";import{a as X}from"./api-delete-CqpIERoM.js";import{a as H}from"./api-get-DLoYpnPD.js";import{a as h}from"./api-post-BOYik2y6.js";import{l as z}from"./loading-store-CK_HsbiT.js";import{n as J}from"./index-DWKPJyX7.js";import{Q as Y}from"./QForm-pLnIPDm5.js";import{_ as Z}from"./InputSelectArray-CW313qGw.js";import{A as aa}from"./ApiCrud-CsgpJEPb.js";import{u as ea}from"./useCrudForm-Di2BQFx5.js";import"./QMarkupTable-BHGuGSYT.js";import"./QSelect-BjGQaI4Q.js";import"./QChip-Br_mmnnr.js";import"./QMenu-BnIg5_Ug.js";import"./selection-CiLPAPFJ.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-Ct_nQl4F.js";import"./index-BaAeepf0.js";import"./api-error-CD6hOSn6.js";import"./lists-store-BQBJ2JOd.js";import"./DropDownAfter-B_WHSSYE.js";import"./QBtnDropdown-C4ZtMkBn.js";import"./QBtnGroup-CFUVAF62.js";import"./Lists-kDpWTKyN.js";import"./Api-gH9zfM44.js";class ta extends aa{constructor(){super("mutasi")}}const la=new ta,sa={__name:"MutasiForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(D,{emit:u}){const d=u,n=D,o=k({...n.data}),{handleDelete:Q,handleUpdate:r,loading:C}=ea(la,{emit:d,responseKey:"mutasi"});async function x(){const w={new_domisili:o.value.new_domisili,new_keterangan:o.value.new_keterangan};return await r(n.data.id,w,!0)}async function S(){return await Q(n.data.id)}return(w,s)=>{const t=g("FormHeader"),V=g("FormLoading"),q=g("FormActions");return _(),c($,{class:"full-width",style:{"max-width":"425px"}},{default:e(()=>[a(Y,{onSubmit:T(x,["prevent"])},{default:e(()=>[a(t,{title:"Data Domisili Baru","is-new":!1}),L(C)?(_(),c(V,{key:0})):N("",!0),a(I,null,{default:e(()=>[a(b,{"model-value":o.value.nama+" ("+o.value.santri_id+")",class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Nama (ID)"},null,8,["model-value"]),a(b,{"model-value":o.value.tingkat+" — "+o.value.kelas,class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Tingkat — Kelas"},null,8,["model-value"]),a(b,{"model-value":o.value.domisili,class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Domisili (Asal)"},null,8,["model-value"]),a(Z,{modelValue:o.value.new_domisili,"onUpdate:modelValue":s[0]||(s[0]=l=>o.value.new_domisili=l),url:"domisili",label:"Domisili (Baru) *",class:"q-my-sm",rules:[l=>!!l||"Harus diisi!"],clearable:!1},null,8,["modelValue","rules"]),a(b,{modelValue:o.value.new_keterangan,"onUpdate:modelValue":s[1]||(s[1]=l=>o.value.new_keterangan=l),class:"q-my-sm",dense:"",outlined:"",label:"Keterangan (Baru)",autogrow:!0},null,8,["modelValue"])]),_:1}),a(q,{"btn-delete":!0,onOnDelete:S})]),_:1})]),_:1})}}},La={__name:"ResultMutasi",setup(D){const u=k([]),d=k(!1),n=k(!1),o=k({}),{loadingMain:Q}=K(z());async function r(){const s=await H({endPoint:"mutasi",loading:d});s&&(u.value=s.mutasi.map(t=>({...t,tk:t.tingkat_id+" "+t.kelas})))}O(async()=>{await r()});async function C(s){o.value=s,n.value=!0}async function x(){await h({endPoint:"mutasi/execute",data:null,loading:d,confirm:!0,message:`<hr><span style="color:blue">Update Domisili?</span><hr>
		<em>
			<strong>Peringatan:</strong>
			<ul style="margin:0">
				<li>Pastikan semua keperluan Administrasi (terkait domisili asal) telah selesai!</li>
				<li>Sebaiknya data di-download/ diunduh terlebih dahulu sebagai backup!</li>
				<li>Setelah update selesai, semua data mutasi akan <strong>dihapus</strong>!</li>
			</ul>
		</em>`})&&await r()}async function S(){await X({endPoint:"mutasi/clean",loading:d,message:"Hapus semua data mutasi?"})&&(u.value=[])}async function w(){const s=await H({endPoint:"export/mutasi",loading:Q,notify:!0});if(!s)return;if(!s.url)return J("Url tidak ditemukan");const t=document.createElement("a");t.href=s.url,t.click(),t.remove()}return(s,t)=>{const V=g("CardHeader"),q=g("CardPage");return _(),c(q,null,{default:e(()=>[a(V,{title:"Data Mutasi Domisili",onOnReload:r},{buttons:e(()=>[a(y,{icon:"tune",label:"Atur Mutasi",dense:"",outline:"","no-caps":"",class:"q-px-sm",to:"/mutasi/start"})]),more:e(()=>[a(G,null,{default:e(()=>[A((_(),c(U,{to:"/info/download"},{default:e(()=>[a(m,null,{default:e(()=>[a(P,null,{default:e(()=>[...t[1]||(t[1]=[i("Cetak",-1)])]),_:1})]),_:1}),a(m,{avatar:""},{default:e(()=>[a(M,{name:"print",flat:""})]),_:1})]),_:1})),[[B]]),A((_(),c(U,{onClick:w,clickable:""},{default:e(()=>[a(m,null,{default:e(()=>[a(P,null,{default:e(()=>[...t[2]||(t[2]=[i("Unduh/Download",-1)])]),_:1})]),_:1}),a(m,{avatar:""},{default:e(()=>[a(M,{name:"download",flat:""})]),_:1})]),_:1})),[[B]]),A((_(),c(U,{onClick:S,clickable:""},{default:e(()=>[a(m,null,{default:e(()=>[a(P,null,{default:e(()=>[...t[3]||(t[3]=[i("Hapus Semua",-1)])]),_:1})]),_:1}),a(m,{avatar:""},{default:e(()=>[a(M,{name:"delete_forever",flat:""})]),_:1})]),_:1})),[[B]])]),_:1})]),_:1}),a(I,{class:"q-pa-sm"},{default:e(()=>[a(W,{class:"q-pa-sm",rows:u.value,loading:d.value,"rows-per-page-options":[10,25,50,75,100,0],flat:"",bordered:""},{header:e(l=>[a(F,{props:l},{default:e(()=>[a(p,{key:"santri_id",props:l,class:"text-left"},{default:e(()=>[...t[4]||(t[4]=[i(" ID Santri ",-1)])]),_:1},8,["props"]),a(p,{key:"nama",props:l},{default:e(()=>[...t[5]||(t[5]=[i(" Nama ",-1)])]),_:1},8,["props"]),a(p,{key:"tk",props:l},{default:e(()=>[...t[6]||(t[6]=[i(" Tingkat — Kelas ",-1)])]),_:1},8,["props"]),a(p,{key:"domisili",props:l},{default:e(()=>[...t[7]||(t[7]=[i(" Domisili (Asal) ",-1)])]),_:1},8,["props"]),a(p,{key:"new_domisili",props:l},{default:e(()=>[...t[8]||(t[8]=[i(" Domisili (Baru) ",-1)])]),_:1},8,["props"]),a(p,{class:"text-center"})]),_:2},1032,["props"])]),body:e(l=>[a(F,{props:l},{default:e(()=>[a(f,{key:"santri_id",props:l,class:"text-left"},{default:e(()=>[a(y,{label:l.row.santri_id,outline:"",color:"green-10",class:"text-caption q-px-sm",dense:"",to:`/santri/${l.row.santri_id}`},null,8,["label","to"])]),_:2},1032,["props"]),a(f,{key:"nama",props:l},{default:e(()=>[i(v(l.row.nama),1)]),_:2},1032,["props"]),a(f,{key:"tk",props:l},{default:e(()=>[i(v(l.row.tk),1)]),_:2},1032,["props"]),a(f,{key:"domisili",props:l},{default:e(()=>[i(v(l.row.domisili),1)]),_:2},1032,["props"]),a(f,{key:"new_domisili",props:l},{default:e(()=>[i(v(l.row.new_domisili),1)]),_:2},1032,["props"]),a(f,{key:"id",props:l,class:"text-center"},{default:e(()=>[a(y,{icon:"edit",flat:"",color:"green-10",onClick:oa=>C(l.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1}),a(R,{class:"q-pa-sm bg-green-7 text-green-11 row"},{default:e(()=>[t[9]||(t[9]=E("div",{class:"col text-italic"}," 1) Teliti kembali sebelum Anda menekan tombol Update; 2) Lakukan backup data dengan menekan tombol download!; ",-1)),a(y,{style:{"max-width":"150px"},class:"col bg-green-8 q-ml-md",label:"Update Domisili",glossy:"","no-caps":"",dense:"",outline:"",icon:"settings_applications",disable:!u.value.length>0,onClick:x},null,8,["disable"])]),_:1}),a(j,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l)},{default:e(()=>[a(sa,{data:o.value,onSuccessDelete:r,onSuccessSubmit:r},null,8,["data"])]),_:1},8,["modelValue"])]),_:1})}}};export{La as default};
