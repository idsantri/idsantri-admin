import{Q as b}from"./QSpace-CR7bsMEl.js";import{a2 as j,v as d,R as y,G as v,f as V,o as T,w as n,i,q as k,Q as m,k as q,p,a8 as Q,a4 as x,m as N}from"./index-1h6WQa8x.js";import{Q as u}from"./QSelect-DyXiAk3o.js";import{Q as A}from"./QForm-Dcqp4yj8.js";import{Q as S}from"./QPage-B_WVg178.js";import{a as U}from"./api-get-BY6mtHh6.js";import{a as g}from"./api-get-lists-BZgeu587.js";import{l as o}from"./lists-madrasah-store-C0k6j_EP.js";import{l as w}from"./loading-store-De2ZIFfx.js";import{n as B}from"./index-_Ec9HkD1.js";import"./QChip-DJ1cSnO8.js";import"./QItemSection-CDMonx4a.js";import"./QItemLabel-BCrbjFPh.js";import"./QMenu-C8eKSCkY.js";import"./selection-Bkxc-DqK.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./index-CpzetzrR.js";import"./api-error-B2Y93K9w.js";const aa={__name:"DownloadPage",setup(K){const{loadingMain:c}=j(w()),l=d({}),r=d([]),s=d([]),h=[{value:"ujian",label:"Nilai Ujian"},{value:"harian",label:"Nilai Harian"},{value:"rapor",label:"Nilai Rapor"},{value:"ijazah",label:"Nilai Ijazah"}],_=o().getThAjaran;s.value.th_ajaran=_,y(async()=>{const t=o().getThAjaran;if(s.value.th_ajaran=t,t.length==0){const e=await g({url:"kelas/lists",key:"th_ajaran",loadingArray:r});o().setThAjaran(e),s.value.th_ajaran=e}else s.value.th_ajaran=t});async function f(){const t=JSON.parse(JSON.stringify(l.value)),e=await U({endPoint:"export/nilai-mapel",loading:c,params:t});if(!e)return;if(!e.url)return B("Url tidak ditemukan");const a=document.createElement("a");a.href=e.url,a.click(),a.remove()}return v(()=>l.value.th_ajaran_h,async t=>{if(l.value.tingkat_id="",l.value.kelas="",t){const e=o().getTingkatByTahun(t);if(e.length)s.value.tingkat=e;else{const a=await g({url:"kelas/lists",params:{th_ajaran_h:t},key:"tingkat",loadingArray:r,sort:"asc"});o().addTingkatToTahun(a,t),s.value.tingkat=a}}else s.value.tingkat=[];s.value.kelas=[]}),v(()=>l.value.tingkat_id,async t=>{if(l.value.kelas="",t){const e=o().getKelasByTingkatAndTahun(t,l.value.th_ajaran_h);if(e.length)s.value.kelas=e;else{const a=await g({url:"kelas/lists",params:{th_ajaran_h:l.value.th_ajaran_h,tingkat_id:t},key:"kelas",loadingArray:r,sort:"asc"});o().addKelasToTingkatByTahun(a,t,l.value.th_ajaran_h),s.value.kelas=a}}else s.value.kelas=[]}),(t,e)=>(T(),V(S,{class:"q-pa-sm"},{default:n(()=>[i(k,null,{default:n(()=>[i(m,{class:"q-pa-sm bg-green-8 text-green-11 flex"},{default:n(()=>[e[5]||(e[5]=q("div",{tag:"h1",class:"text-subtitle1"},"Download Nilai",-1)),i(b),i(p,{label:"Kembali",to:"/madrasah/nilai-mapel",dense:"",outline:"","no-caps":"",icon:"arrow_back",class:"q-px-sm q-mr-md"}),i(p,{label:"Upload",to:"/madrasah/nilai-mapel/upload",dense:"",outline:"","no-caps":"",icon:"upload",class:"q-px-sm"})]),_:1}),i(m,{class:"q-pa-sm"},{default:n(()=>[i(A,{onSubmit:Q(f,["prevent"])},{default:n(()=>[i(k,{style:{"max-width":"425px"}},{default:n(()=>[i(m,{class:"q-pa-sm"},{default:n(()=>[i(u,{dense:"",class:"",outlined:"",label:"Tahun Ajaran","emit-value":"","map-options":"",modelValue:l.value.th_ajaran_h,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.th_ajaran_h=a),options:s.value.th_ajaran,"option-value":"th_ajaran_h","option-label":"th_ajaran_h",clearable:"",behavior:"menu",required:"",rules:[a=>!!a||"Harus diisi!"]},null,8,["modelValue","options","rules"]),i(u,{dense:"",class:"",outlined:"",label:"Tingkat Pendidikan","emit-value":"","map-options":"","option-value":"tingkat_id","option-label":"tingkat",modelValue:l.value.tingkat_id,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.tingkat_id=a),options:s.value.tingkat,loading:r.value.tingkat,clearable:"",behavior:"menu",required:"",rules:[a=>!!a||"Harus diisi!"]},null,8,["modelValue","options","loading","rules"]),i(u,{dense:"",class:"",outlined:"",label:"Kelas","emit-value":"","map-options":"",modelValue:l.value.kelas,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.kelas=a),options:s.value.kelas,loading:r.value.kelas,clearable:"",behavior:"menu",required:"",rules:[a=>!!a||"Harus diisi!"]},null,8,["modelValue","options","loading","rules"]),i(u,{dense:"",class:"q-mt-sm",outlined:"",label:"Kategori Nilai",modelValue:l.value.category,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.category=a),behavior:"menu",required:"",options:h,"emit-value":"","map-options":"",rules:[a=>!!a||"Harus diisi!"]},null,8,["modelValue","rules"]),i(x,{dense:"",class:"q-mt-sm",outlined:"",label:"Ujian Ke",modelValue:l.value.ujian_ke,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.ujian_ke=a),required:"",type:"number",rules:[a=>a>0&&a<5||"antara 1 s.d. 4"]},null,8,["modelValue","rules"])]),_:1}),i(N,{class:"bg-green-6",align:"right"},{default:n(()=>[i(p,{class:"",type:"submit",label:"Download",icon:"download",color:"green-11","no-caps":"",outline:"",dense:""})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{aa as default};
