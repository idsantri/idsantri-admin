import{q as d,A as M,s as N,E as k,c as v,o as u,w as l,g as e,Q as y,v as c,l as A,ah as O,b as _,F as S,D as T,e as w,t as h}from"./index-D90ocF1D.js";import{Q as P,a as x}from"./QTable-Bu_370bI.js";import{Q as V}from"./QTr-NSg-Zwt3.js";import{Q as C}from"./QTd-DsSp9maT.js";import{Q as z}from"./QTooltip-BYzHphVI.js";import{_ as F}from"./InputSearch-BMbRQTxM.js";import{A as H}from"./ApiCrud-DtzlNG9K.js";import{A as $}from"./ArrayCrud-CkcA-ixF.js";import{c as U}from"./format-date-OVhbBx9F.js";import{c as q}from"./index-Be_dPAgR.js";import"./QList-DEOYyLCD.js";import"./QMarkupTable-BpASZURf.js";import"./QSelect-gygC61jt.js";import"./QChip-Dj9MEpEc.js";import"./QItem-D68KFekb.js";import"./QItemLabel-B1ScV3U0.js";import"./QMenu-TNZV1d7v.js";import"./selection-DgWDtM22.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-DLsyYIB5.js";import"./Api-BPweku69.js";import"./index-Bi0oEnE7.js";import"./api-error-CAe2zLvt.js";import"./id-BuNGTsqN.js";class j extends H{constructor(){super("alumni")}}const D=new j,J={key:0},R={key:1},ya={__name:"IndexPage",setup(K){const s=d([]),p=d(!1),g=d(!1),b=d(""),m=d(!1);async function Q(){try{p.value=!0;const a=await D.getAll();s.value=a.alumni}catch(a){console.log("üöÄ ~ loadData ~ error:",a)}finally{p.value=!1}}async function B(a){const n=!!a.sent_to_alumni_at;try{m.value=!0;const i=["belum terkirim","sudah terkirim"],f=["Data yang sudah terkirim tidak bisa ditarik lagi!","Jika data belum terkirim, Anda perlu klik tombol kirim setelah ini!"];let o=`Tandai ${n?i[0]:i[1]}?`;if(o+="<br/><br/><hr/>",o+="<small>",o+="<em>Aksi ini hanya mengubah status!</em><br/>",o+=`<em>${n?f[0]:f[1]}</em><br/>`,o+="</small>",o+="<hr/>",!await q(o))return;await D.update({id:a.id,data:{activated:!n}});const r={...a,sent_to_alumni_at:a.sent_to_alumni_at?null:new Date().toISOString()};s.value=$.update(s.value,a.id,r)}catch(i){console.log("Error updating sent status:",i)}finally{m.value=!1}}async function E(a){if(await q("Kirim data ke aplikasi alumni?"))try{m.value=!0,await D.create({data:{id:a.id}});const i={...a,sent_to_alumni_at:new Date().toISOString()};s.value=$.update(s.value,a.id,i)}catch(i){console.log("Error updating sent status:",i)}finally{m.value=!1}}const I=M(()=>g.value?s.value.filter(a=>a.sent_to_alumni_at):s.value.filter(a=>!a.sent_to_alumni_at));N(async()=>{await Q()});const L=[{name:"santri_id",label:"Santri ID",align:"center",field:"santri_id",sortable:!0},{name:"nama",label:"Name",align:"left",field:"nama",sortable:!0},{name:"created_at",label:"Tanggal",field:"created_at",format:a=>U(a,"dd-MM-yyyy"),sortable:!0},{name:"alamat",label:"Alamat",align:"left",field:a=>a.desa+" "+a.kecamatan+" "+a.kabupaten}];return(a,n)=>{const i=k("CardHeader"),f=k("CardLoading"),o=k("CardPage");return u(),v(o,null,{default:l(()=>[e(i,{title:"Data Alumni",onOnReload:Q}),e(y,{class:"bg-green-12 q-pa-xs text-caption"},{default:l(()=>[...n[2]||(n[2]=[c(" Menampilkan data santri berhenti/diberhentikan ",-1)])]),_:1}),e(y,{class:"q-pa-sm tw:grid tw:grid-cols-1 tw:sm:flex tw:sm:justify-between tw:gap-2 bg-green-11"},{default:l(()=>[e(A,{flat:"",bordered:"",style:{"min-width":"300px"}},{default:l(()=>[e(O,{modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=t=>g.value=t),label:"Terkirim",color:"green"},null,8,["modelValue"])]),_:1}),e(A,{flat:"",bordered:"",style:{"min-width":"300px"}},{default:l(()=>[e(F,{modelValue:b.value,"onUpdate:modelValue":n[1]||(n[1]=t=>b.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{class:"q-pa-sm"},{default:l(()=>[e(f,{showing:m.value},null,8,["showing"]),e(P,{rows:I.value,loading:p.value,filter:b.value,"rows-per-page-options":[10,25,50,75,100,0],flat:"",bordered:"","row-key":"id",columns:L},{header:l(t=>[e(V,{props:t},{default:l(()=>[(u(!0),_(S,null,T(t.cols,r=>(u(),v(x,{key:r.name,props:t},{default:l(()=>[c(h(r.label),1)]),_:2},1032,["props"]))),128)),e(x,{class:"text-center"},{default:l(()=>[...n[3]||(n[3]=[c("Kirim",-1)])]),_:1}),e(x,{class:"text-center"},{default:l(()=>[...n[4]||(n[4]=[c("Selesai",-1)])]),_:1})]),_:2},1032,["props"])]),body:l(t=>[e(V,{props:t},{default:l(()=>[(u(!0),_(S,null,T(t.cols,r=>(u(),v(C,{key:r.name,props:t},{default:l(()=>[r.name=="santri_id"?(u(),_("span",J,[e(w,{label:r.value,"no-caps":"",size:"sm",outline:"",class:"text-green-10",to:`/santri/${r.value}`},null,8,["label","to"])])):(u(),_("span",R,h(r.value),1))]),_:2},1032,["props"]))),128)),e(C,{class:"text-center"},{default:l(()=>[e(w,{disable:!!t.row.sent_to_alumni_at,class:"q-px-sm",dense:"",icon:"sym_o_forward",outline:!!t.row.sent_to_alumni_at,color:"green",onClick:r=>E(t.row),label:"Kirim","no-caps":""},null,8,["disable","outline","onClick"])]),_:2},1024),e(C,{class:"text-center"},{default:l(()=>[e(w,{class:"q-px-sm",dense:"",icon:"sym_o_done",round:"",size:"sm",outline:!t.row.sent_to_alumni_at,color:"green",onClick:r=>B(t.row),"no-caps":""},null,8,["outline","onClick"]),e(z,null,{default:l(()=>[c(h(t.row.sent_to_alumni_at?"Data sudah terkirim ‚úÖ ‚Äî Klik untuk mengubah status!":"Data belum terkirim ‚ùå ‚Äî Klik untuk mengubah status!"),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","filter"])]),_:1})]),_:1})}}};export{ya as default};
