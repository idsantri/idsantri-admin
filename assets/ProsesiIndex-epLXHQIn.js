import{be as J,bQ as A,q as b,A as $,c as V,o as v,w as n,a as l,g as e,e as g,b as y,F as S,D as N,t as c,G as x,N as T,Q as k,v as h,C as q,m as B,l as F,s as H,a9 as Q,n as O,J as W,ae as X,E as L}from"./index-DutRA_CO.js";import{Q as P,a as E}from"./QToolbar-DJQywJGe.js";import{Q as I}from"./QSpace-RyUqKbav.js";import{e as Y}from"./index-BAyNzCk6.js";import{_ as C}from"./InputSelectArray-5WdULfX-.js";import{_ as Z}from"./InputSelectTingkatPendidikan-BEo5P2Hh.js";import{Q as K}from"./QSpinnerBars-CAyZGQYt.js";import{Q as M}from"./QInnerLoading-dRLmOkoN.js";import{Q as R}from"./QMarkupTable-soH4YcMw.js";import{M as j}from"./Mutasi-pY2w9gIw.js";import{Q as U}from"./QSelect-LIcm9uTB.js";import{Q as ee}from"./QSpinnerTail-BQlW82sN.js";import{Q as te}from"./QForm-DRzvYkEB.js";import{C as le}from"./ClosePopup-RQcL-rG0.js";import"./lists-store-NC8-X11g.js";import"./ArrayCrud-CByp4EUn.js";import"./DropDownAfter-8SRzBjks.js";import"./QBtnDropdown-DEivjYd9.js";import"./QBtnGroup-_ujcPxic.js";import"./QMenu-JGhTZEq-.js";import"./selection-BSDJEjKX.js";import"./Lists-CyIViPOd.js";import"./ApiCrud-CZFmsy5d.js";import"./Api-AjNxW92f.js";import"./index-Cpf3S9fo.js";import"./apiPost-BTbDNFlR.js";import"./QField-BhEqSw-i.js";import"./QChip-D_SQIzNi.js";import"./QItem-qGBVeF8-.js";import"./QItemLabel-WimR8O_E.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const D=J("mutasi-domisili",{state:()=>({santri:[],newFilter:{domisili:""}}),getters:{getSantri:d=>d.santri},actions:{resetSantri(){this.santri=[]},addSantri(d){this.resetSantri(),d.forEach(t=>{this.santri.push({id:t.id,santri_id:t.id,nama:t.nama,domisili:t.domisili,tingkat_id:t.tingkat_id,tingkat:t.tingkat,kelas:t.kelas,new_domisili:"",new_keterangan:"",proses:!1})})},getProsesTrue(){return this.santri.filter(d=>d.proses==!0)},getProsesFalse(){return this.santri.filter(d=>d.proses==!1)},prosesTrue(d){if(!this.newFilter.domisili)return Y("Tentukan domisili baru");const t=this.santri.findIndex(r=>r.id===d),a=this.santri[t];a.proses=!0,a.new_domisili=this.newFilter.domisili,a.new_keterangan="Mutasi Domisili"},prosesFalse(d){const t=this.santri.findIndex(r=>r.id===d),a=this.santri[t];a.proses=!1,a.new_domisili=null,a.new_keterangan=null},deleteTrueProses(){const d=[];this.santri.forEach(t=>{t.proses||d.push(t)}),this.santri=d}},persist:!0}),se={class:"text-right"},ae={class:"text-center"},ie={class:"text-right"},ne={__name:"LeftTable",props:{onLoading:{type:Boolean,default:!1}},setup(d){const t=d,a=A(()=>t.onLoading),r=b(!1),m=D(),u=$(()=>m.getProsesFalse());function o(){const s=u.value.length;if(!s)return;let i=0;r.value=!0,u.value.forEach(f=>{setTimeout(()=>{m.prosesTrue(f.id),i++,i===s&&(r.value=!1)},500)})}return(s,i)=>(v(),V(R,{flat:"",bordered:"",style:{height:"530px"}},{default:n(()=>[l("thead",null,[l("tr",null,[i[0]||(i[0]=l("th",{class:"text-center"},"ID Santri",-1)),i[1]||(i[1]=l("th",{class:"text-left"},"Nama",-1)),i[2]||(i[2]=l("th",{class:"text-left"},"Domisili",-1)),i[3]||(i[3]=l("th",{class:"text-left"},"Kelas",-1)),i[4]||(i[4]=l("th",{class:"text-left"},"Tingkat",-1)),l("th",se,[e(g,{icon:"keyboard_double_arrow_right",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!u.value.length,onClick:o},null,8,["disable"])])])]),l("tbody",null,[(v(!0),y(S,null,N(u.value,(f,w)=>(v(),y("tr",{key:w},[l("td",ae,c(f.id),1),l("td",null,c(f.nama),1),l("td",null,c(f.domisili),1),l("td",null,c(f.kelas),1),l("td",null,c(f.tingkat),1),l("td",ie,[e(g,{icon:"arrow_right",dense:"",outline:"",color:"green-10",glossy:"",onClick:p=>x(m).prosesTrue(f.id)},null,8,["onClick"])])]))),128))]),e(M,{showing:a.value||r.value},{default:n(()=>[e(K,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1}))}},oe={class:"row"},re={class:"text-caption text-italic"},de={__name:"LeftCard",setup(d){const t=b({tingkat_id:"",kelas:"",domisili:""}),a=D(),r=b(!1),m=$(()=>a.getProsesFalse());T(()=>t.value.tingkat_id,o=>{o&&(t.value.kelas="",t.value.domisili="")}),T(()=>t.value.kelas,async o=>{o&&(t.value.domisili="")}),T(()=>t.value.domisili,async o=>{o&&(t.value.tingkat_id="",t.value.kelas="")}),T(t,async o=>{a.resetSantri(),o.tingkat_id&&o.kelas?await u({tingkat_id:o.tingkat_id,kelas:o.kelas}):o.domisili&&await u({domisili:o.domisili})},{deep:!0});async function u(o){try{r.value=!0;const s=await j.getNotMutate(o);a.addSantri(s.santri)}catch(s){console.error("Error fetching data:",s)}finally{r.value=!1}}return(o,s)=>(v(),V(F,{class:"",flat:"",bordered:""},{default:n(()=>[e(k,{class:"q-pa-sm bg-green-7"},{default:n(()=>[e(P,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:n(()=>[e(E,{class:"text-subtitle1"},{default:n(()=>[...s[3]||(s[3]=[h(" Data Santri ",-1)])]),_:1}),e(g,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:i=>null,disable:""})]),_:1})]),_:1}),e(k,{class:"q-pa-sm"},{default:n(()=>[l("div",oe,[e(Z,{modelValue:t.value.tingkat_id,"onUpdate:modelValue":s[0]||(s[0]=i=>t.value.tingkat_id=i),label:"Tingkat Pendidikan",class:"col no-padding q-mr-md",hint:null},null,8,["modelValue"]),e(C,{modelValue:t.value.kelas,"onUpdate:modelValue":s[1]||(s[1]=i=>t.value.kelas=i),url:"kelas",label:"Kelas",class:"col no-padding",disable:!t.value.tingkat_id},null,8,["modelValue","disable"])]),e(C,{modelValue:t.value.domisili,"onUpdate:modelValue":s[2]||(s[2]=i=>t.value.domisili=i),url:"domisili",label:"Domisili",class:"q-mt-sm no-padding"},null,8,["modelValue"])]),_:1}),e(q),e(k,{class:"q-pa-sm"},{default:n(()=>[e(ne,{"on-loading":r.value},null,8,["on-loading"])]),_:1}),e(q),e(B,{class:"bg-green-1"},{default:n(()=>[l("div",re,[h(" Total: "+c(m.value?.length||0)+" santri",1),s[4]||(s[4]=l("br",null,null,-1)),s[5]||(s[5]=h(" Hanya menampilkan santri yang statusnya â€œAktifâ€ dan belum masuk ke tabel mutasi ",-1))]),e(I),s[6]||(s[6]=l("div",null,null,-1))]),_:1})]),_:1}))}},ue={__name:"EditMutasi",props:{data:{type:Object,required:!0}},setup(d){const t=d,a=b({}),r=b(!1);return H(()=>{a.value=t.data}),(m,u)=>(v(),V(F,{class:"full-width",style:{"max-width":"425px"}},{default:n(()=>[e(te,null,{default:n(()=>[e(k,{class:"bg-green-7 text-green-11 q-pa-sm"},{default:n(()=>[e(P,{class:"q-px-sm",style:{"min-height":"0"}},{default:n(()=>[e(E,{class:"text-subtitle1 text-green-11"},{default:n(()=>[...u[2]||(u[2]=[h(" Data Domisili Baru â€” ",-1),l("span",{class:"text-italic"},"Edit",-1)])]),_:1}),u[3]||(u[3]=l("span",{class:"text-italic text-caption"}," Auto Update ",-1))]),_:1})]),_:1}),e(k,null,{default:n(()=>[e(Q,{"model-value":a.value.nama+" ("+a.value.santri_id+")",class:"",disable:"",filled:"",dense:"",outlined:"",label:"Nama (ID)"},null,8,["model-value"]),e(Q,{"model-value":a.value.tingkat+" â€” "+a.value.kelas,class:"q-mt-sm",disable:"",filled:"",dense:"",outlined:"",label:"Tingkat â€” Kelas"},null,8,["model-value"]),e(Q,{"model-value":a.value.domisili,class:"q-mt-sm",disable:"",filled:"",dense:"",outlined:"",label:"Domisili (Asal)"},null,8,["model-value"]),e(C,{modelValue:a.value.new_domisili,"onUpdate:modelValue":u[0]||(u[0]=o=>a.value.new_domisili=o),url:"domisili",label:"Domisili (Baru) *",class:"q-mt-sm",rules:[o=>!!o||"Harus diisi!"],clearable:!1},null,8,["modelValue","rules"]),e(Q,{modelValue:a.value.new_keterangan,"onUpdate:modelValue":u[1]||(u[1]=o=>a.value.new_keterangan=o),class:"q-mt-sm",dense:"",outlined:"",label:"Keterangan (Baru)",autogrow:!0},null,8,["modelValue"])]),_:1}),e(B,{class:"bg-green-6 flex"},{default:n(()=>[e(I),O(e(g,{label:"Tutup",class:"bg-green-11","no-caps":"",id:"btn-close"},null,512),[[le]])]),_:1}),e(M,{showing:r.value},{default:n(()=>[e(ee,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1})]),_:1}))}},me={class:"text-left"},pe={class:"text-right"},ce={class:"text-left"},ge={class:"text-right"},fe={__name:"RightTable",props:{onLoading:{type:Boolean,default:!1}},setup(d){const t=d,a=D(),r=$(()=>a.getProsesTrue()),m=b(!1),u=A(()=>t.onLoading),o=b({}),s=b(!1);function i(){const w=r.value.length;if(!w)return;let p=0;m.value=!0,r.value.forEach(_=>{setTimeout(()=>{a.prosesFalse(_.id),p++,p===w&&(m.value=!1)},500)})}function f(w){o.value=w,s.value=!0}return(w,p)=>(v(),y(S,null,[e(R,{flat:"",bordered:"",style:{height:"530px"}},{default:n(()=>[l("thead",null,[l("tr",null,[l("th",me,[e(g,{icon:"keyboard_double_arrow_left",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!r.value.length,onClick:i},null,8,["disable"])]),p[1]||(p[1]=l("th",{class:"text-left"},"Nama",-1)),p[2]||(p[2]=l("th",{class:"text-left"},"Domisili Asal",-1)),p[3]||(p[3]=l("th",{class:"text-left"},"Domisili Baru *",-1)),p[4]||(p[4]=l("th",{class:"text-left"},"Keterangan",-1)),l("th",pe,[e(g,{icon:"edit",dense:"",flat:"",disable:"",color:"green-10"})])])]),l("tbody",null,[(v(!0),y(S,null,N(r.value,(_,z)=>(v(),y("tr",{key:z},[l("td",ce,[e(g,{icon:"arrow_left",dense:"",outline:"",color:"green-10",glossy:"",onClick:G=>x(a).prosesFalse(_.id)},null,8,["onClick"])]),l("td",null,c(_.nama),1),l("td",null,c(_.domisili),1),l("td",null,c(_.new_domisili),1),l("td",null,c(_.new_keterangan??"-"),1),l("td",ge,[e(g,{icon:"edit",dense:"",flat:"",color:"green-10",onClick:G=>f(_)},null,8,["onClick"])])]))),128))]),e(M,{showing:u.value||m.value},{default:n(()=>[e(K,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1}),e(W,{modelValue:s.value,"onUpdate:modelValue":p[0]||(p[0]=_=>s.value=_)},{default:n(()=>[e(ue,{data:o.value},null,8,["data"])]),_:1},8,["modelValue"])],64))}},_e={class:"row"},ve={class:"text-caption text-italic"},be={__name:"RightCard",setup(d){const t=D(),{newFilter:a}=X(t),r=$(()=>t.getProsesTrue()),m=b(!1);async function u(){const s={santri:r.value.map(i=>({santri_id:i.santri_id,new_domisili:i.new_domisili,new_keterangan:i.new_keterangan}))};try{m.value=!0,await j.create({data:s,confirm:!0})&&t.deleteTrueProses()}catch(i){console.error("ðŸš€ ~ onSubmit ~ error:",i)}finally{m.value=!1}}return(o,s)=>(v(),V(F,{class:"",flat:"",bordered:""},{default:n(()=>[e(k,{class:"q-pa-sm bg-green-7"},{default:n(()=>[e(P,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:n(()=>[e(E,{class:"text-subtitle1"},{default:n(()=>[...s[3]||(s[3]=[h(" Data Mutasi ",-1)])]),_:1}),e(g,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:i=>null,disable:""})]),_:1})]),_:1}),e(k,{class:"q-pa-sm"},{default:n(()=>[l("div",_e,[e(U,{modelValue:x(a).tingkat_id,"onUpdate:modelValue":s[0]||(s[0]=i=>x(a).tingkat_id=i),label:"",class:"col no-padding q-mr-md",filled:"",outlined:"",dense:"",disable:""},null,8,["modelValue"]),e(U,{modelValue:x(a).kelas,"onUpdate:modelValue":s[1]||(s[1]=i=>x(a).kelas=i),label:"",class:"col no-padding",filled:"",outlined:"",dense:"",disable:""},null,8,["modelValue"])]),e(C,{modelValue:x(a).domisili,"onUpdate:modelValue":s[2]||(s[2]=i=>x(a).domisili=i),url:"domisili",label:"Domisili Baru",class:"q-mt-sm no-padding"},null,8,["modelValue"])]),_:1}),e(q),e(k,{class:"q-pa-sm"},{default:n(()=>[e(fe,{"on-loading":m.value},null,8,["on-loading"])]),_:1}),e(q),e(B,{class:"bg-green-1"},{default:n(()=>[l("div",ve,[h(" Total: "+c(r.value?.length||0)+" santri",1),s[4]||(s[4]=l("br",null,null,-1)),s[5]||(s[5]=h(" Teliti kembali data domisili baru! ",-1))]),e(I),l("div",null,[e(g,{label:"Simpan","no-caps":"",icon:"save",color:"green-10",class:"text-green-11",onClick:u,disable:!r.value.length>0},null,8,["disable"])])]),_:1})]),_:1}))}},ke={class:"col q-py-sm q-mx-sm",style:{"min-width":"400px"}},xe={class:"col q-py-sm q-mx-sm",style:{"min-width":"500px"}},Ze={__name:"ProsesiIndex",setup(d){return H(()=>{const t=document.getElementById("toggle-drawer");t&&t.click()}),(t,a)=>{const r=L("CardHeader"),m=L("CardPage");return v(),V(m,null,{default:n(()=>[e(r,{title:"Modul Mutasi Domisili",showReload:!1},{buttons:n(()=>[e(g,{icon:"visibility",label:"Hasil Mutasi",dense:"",outline:"","no-caps":"",class:"q-px-sm",to:"/mutasi/result"})]),_:1}),e(k,{class:"no-padding full-width row no-wrap justify-between items-start content-start scroll"},{default:n(()=>[l("div",ke,[e(de)]),l("div",xe,[e(be)])]),_:1})]),_:1})}}};export{Ze as default};
