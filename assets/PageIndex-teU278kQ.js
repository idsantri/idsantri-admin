import{Q as D}from"./QSelect-CrgZ1FsI.js";import{A as p,B as y,c as Q,o as d,w as u,b as l,ab as $,e as H,C as A,Q as C,a5 as h,x as I,U as O,g as F,a as e,f as x,t as q,F as T,y as M,z as g,E}from"./index-DwrbA0R8.js";import{Q as L}from"./QSpinnerFacebook-mAFO7hhu.js";import{Q as R}from"./QMarkupTable-DzcRgr6j.js";import{Q as j}from"./QPage-BU8r9xHl.js";import{a as z}from"./api-get-D4W4lze7.js";import{Q as J}from"./QForm-DCEv1Ikv.js";import{l as K}from"./lists-store-Cp7AZ7Mr.js";import{_ as G}from"./InputCurrency-eCUqEcSC.js";import{_ as W}from"./InputSelectArray-DFe88pva.js";import{A as X}from"./ApiCrud-KwrbSuI8.js";import{u as Y}from"./useCrudForm-DF0rM6hG.js";import"./QChip-DvUCR8tL.js";import"./QItemSection-CeSY4hvW.js";import"./QItemLabel-Dzdetwv2.js";import"./QMenu-BEnErdhw.js";import"./selection-DRCgFU0J.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./index-B6LiMDVO.js";import"./index-BlZcD66n.js";import"./api-error-DGWaEiw1.js";import"./DropDownAfter-D2Wgui76.js";import"./QBtnDropdown-DqbNLFX1.js";import"./QBtnGroup-CPjXoyXA.js";import"./ClosePopup-kZj4_oIv.js";import"./Lists-g9uME9Wy.js";import"./Api-DWdZFNbG.js";class Z extends X{constructor(){super("iuran-paket")}}const tt=new Z,et={__name:"IuranPaketForm",props:{data:{type:Object,required:!1,default:()=>{}}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(V,{emit:c}){const i=V,m=c,f=K().getStateByKey("iuran"),n=p({...i.data}),k=p([...f]),v=!i.data?.id,{handleDelete:_,handleCreate:P,handleUpdate:w,loading:N}=Y(tt,{emit:m,responseKey:"iuran_paket"}),s=a=>{const r=k.value.find(b=>b.val0===a);r&&(n.value.nominal=r.val1)},t=async()=>{const a=JSON.parse(JSON.stringify(n.value));return delete a.id,v?await P(a,!0):await w(i.data.id,a,!0)},S=async()=>await _(i.data.id);return(a,r)=>{const b=y("FormHeader"),U=y("FormLoading"),B=y("FormActions");return d(),Q(I,{class:"full-width",style:{"max-width":"425px"}},{default:u(()=>[l(J,{onSubmit:$(t,["prevent"])},{default:u(()=>[l(b,{title:"Input Paket Iuran","is-new":v}),A(N)?(d(),Q(U,{key:0})):H("",!0),l(C,null,{default:u(()=>[l(h,{dense:"",class:"q-my-sm",outlined:"",modelValue:n.value.urut,"onUpdate:modelValue":r[0]||(r[0]=o=>n.value.urut=o),label:"Nomor Urut",rules:[o=>!o||!isNaN(o)||"Hanya angka"]},null,8,["modelValue","rules"]),l(h,{dense:"",class:"q-my-sm",outlined:"",modelValue:n.value.paket,"onUpdate:modelValue":r[1]||(r[1]=o=>n.value.paket=o),required:"",label:"Nama Paket",rules:[o=>!!o||"Harus diisi!"]},null,8,["modelValue","rules"]),l(W,{modelValue:n.value.item,"onUpdate:modelValue":[r[2]||(r[2]=o=>n.value.item=o),s],url:"iuran",label:"Nama Iuran",class:"q-my-sm"},null,8,["modelValue"]),l(G,{dense:"",class:"q-my-sm",outlined:"",modelValue:n.value.nominal,"onUpdate:modelValue":r[3]||(r[3]=o=>n.value.nominal=o),required:"",label:"Nominal",rules:[o=>!!o||"Harus diisi!"]},null,8,["modelValue","rules"])]),_:1}),l(B,{"btn-delete":!v,onOnDelete:S},null,8,["btn-delete"])]),_:1})]),_:1})}}},at={key:0},lt={colspan:"7",class:"text-center bg-grey-1 no-padding"},nt={key:1},ot={key:2},st={class:"text-center"},rt={class:"text-left"},it={class:"text-left"},ut={class:"text-right"},dt={class:"text-center"},mt={class:"bg-green-1"},pt={class:"text-right text-bold"},Mt={__name:"PageIndex",setup(V){const c=p(!1),i=p([]),m=p(""),f=p(!1),n=p({});async function k(){const s=await z({endPoint:"iuran-paket",loading:c});s&&(i.value=s.iuran_paket)}O(async()=>{await k()});function v(){const s=i.value.map(t=>t.paket);return Array.from(new Set(s))}function _(){return i.value.filter(s=>s.paket==m.value)}function P(){return _().reduce(function(s,t){return s+Number(t.nominal)},0)}function w(){n.value={paket:m.value},f.value=!0}function N(s){n.value=s,f.value=!0}return(s,t)=>{const S=y("CardHeader");return d(),Q(j,{class:"q-pa-sm"},{default:u(()=>[l(I,{class:"",style:{"max-width":"800px"}},{default:u(()=>[l(S,{title:"Pengaturan Paket Iuran",onOnReload:k}),l(C,{class:"q-pa-sm flex justify-between"},{default:u(()=>[l(D,{label:"Pilih nama paket",dense:"",outlined:"",options:v(),loading:c.value,modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=a=>m.value=a),clearable:"",style:{width:"250px","min-width":"200px"}},null,8,["options","loading","modelValue"]),l(F,{dense:"",icon:"add",label:"Baru",color:"green-10","no-caps":"",outline:"",class:"q-px-sm",title:"Buat/tambahkan data baru",onClick:t[1]||(t[1]=a=>w())})]),_:1}),l(C,{class:"q-pa-sm"},{default:u(()=>[l(R,{flat:"",bordered:""},{default:u(()=>[t[9]||(t[9]=e("thead",null,[e("tr",null,[e("th",{class:"text-center"},"No"),e("th",{class:"text-left"},"Nama Paket"),e("th",{class:"text-left"},"Iuran"),e("th",{class:"text-right"},"Nominal"),e("th",{class:"text-center"},"Edit")])],-1)),e("tbody",null,[c.value?(d(),x("tr",at,[e("td",lt,[l(L,{color:"green",size:"md"})])])):!i.value.length&&!c.value?(d(),x("tr",nt,[...t[5]||(t[5]=[e("td",{colspan:"7",class:"text-center text-italic text-negative bg-red-2"},[q(" Tidak ada data untuk ditampikan!"),e("br"),q(" Silakan Tambahkan data baru! ")],-1)])])):m.value?(d(!0),x(T,{key:3},M(_(),(a,r)=>(d(),x("tr",{key:r},[e("td",st,g(a.urut),1),e("td",rt,g(a.paket),1),e("td",it,g(a.item),1),e("td",ut,g(a.nominal.toRupiah()),1),e("td",dt,[l(F,{icon:"edit",flat:"",color:"green-10",onClick:b=>N(a)},null,8,["onClick"])])]))),128)):(d(),x("tr",ot,[...t[6]||(t[6]=[e("td",{colspan:"7",class:"text-center text-italic text-negative bg-red-1"},"Pilih filter!",-1)])]))]),e("tfoot",null,[e("tr",mt,[t[7]||(t[7]=e("td",{class:"text-right text-italic",colspan:"3"},"Total",-1)),e("td",pt,g(P().toRupiah()),1),t[8]||(t[8]=e("td",{class:"text-center"},null,-1))])])]),_:1})]),_:1})]),_:1}),l(E,{modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=a=>f.value=a)},{default:u(()=>[l(et,{data:n.value,onSuccessSubmit:t[2]||(t[2]=a=>k()),onSuccessDelete:t[3]||(t[3]=a=>k())},null,8,["data"])]),_:1},8,["modelValue"])]),_:1})}}};export{Mt as default};
