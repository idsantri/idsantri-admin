import{Q as F}from"./QSelect-Co09SqkM.js";import{x as p,R as B,y as P,c as V,o as c,w as d,b as n,a9 as h,a as I,n as w,a3 as S,s as C,f as Q,q as t,g,p as q,F as U,t as $,v as x,B as D}from"./index-Bf-p91mW.js";import{Q as O}from"./QSpinnerFacebook--3EcTKDy.js";import{Q as T}from"./QMarkupTable-BU6ysEzR.js";import{Q as H}from"./QPage-DbeGPrD5.js";import{a as E}from"./api-get-CiRdORW1.js";import{Q as M}from"./QForm-OmDQHoiq.js";import{l as R}from"./lists-store-F5P_xNBX.js";import{a as j}from"./api-delete-BVHfd1pG.js";import{a as A}from"./api-update-BYe6B3v5.js";import{a as L}from"./api-post-CHcQycZS.js";import{_ as J}from"./InputCurrency-DnJI6KCw.js";import{_ as z}from"./InputSelectArray-Jz4ksDX6.js";import{_ as G}from"./CardHeader-AnL1K4iE.js";import"./QChip-DeZPZCXp.js";import"./QItemSection-Bl4rOme3.js";import"./QItemLabel-sjS6zLD0.js";import"./QMenu-BvL1IfNl.js";import"./selection-CE9S_xiH.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./index-D7WC_quC.js";import"./index-BtaF3-6r.js";import"./api-error-C0HjZ2a3.js";import"./lists-data-mcTvx2m2.js";import"./DropDownAfter-wYSCUu7Z.js";import"./QBtnDropdown-Br6y2eVM.js";import"./QBtnGroup-BDP931ZD.js";import"./ClosePopup-HTVnKVBl.js";import"./Lists-DSwT9YX9.js";import"./ApiCrud-SVFtkNw7.js";import"./QSpace-DJeipgZa.js";const K={__name:"IuranPaketForm",props:{data:{type:Object,required:!1,default:()=>{}}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(N,{emit:k}){const v=N,u=k,a=p({}),m=p(!1),f=p([]);B(async()=>{Object.assign(a.value,v.data),f.value=R().getStateByKey("iuran")});const b=r=>{const l=f.value.find(o=>o.val0===r);l&&(a.value.nominal=l.val1)},_=async()=>{const r=JSON.parse(JSON.stringify(a.value));delete r.id;let l=null;const o=!a.value.id;o?l=await L({endPoint:"iuran-paket",data:r,loading:m}):l=await A({endPoint:`iuran-paket/${a.value.id}`,data:r,confirm:!0,notify:!0,loading:m}),l&&(document.getElementById("btn-close-form").click(),u("successSubmit",l?.iuran_paket),u(o?"successCreate":"successUpdate",l?.iuran_paket))},y=async()=>{const r=a.value.id;await j({endPoint:`iuran-paket/${r}`,loading:m})&&(document.getElementById("btn-close-form").click(),u("successDelete",r))};return(r,l)=>{const o=P("FormHeader"),e=P("FormLoading"),i=P("FormActions");return c(),V(C,{class:"full-width",style:{"max-width":"425px"}},{default:d(()=>[n(M,{onSubmit:h(_,["prevent"])},{default:d(()=>[n(o,{title:"Input Paket Iuran","is-new":!a.value.id},null,8,["is-new"]),m.value?(c(),V(e,{key:0})):I("",!0),n(w,null,{default:d(()=>[n(S,{dense:"",class:"q-my-sm",outlined:"",modelValue:a.value.urut,"onUpdate:modelValue":l[0]||(l[0]=s=>a.value.urut=s),label:"Nomor Urut",rules:[s=>!s||!isNaN(s)||"Hanya angka"]},null,8,["modelValue","rules"]),n(S,{dense:"",class:"q-my-sm",outlined:"",modelValue:a.value.paket,"onUpdate:modelValue":l[1]||(l[1]=s=>a.value.paket=s),required:"",label:"Nama Paket",rules:[s=>!!s||"Harus diisi!"]},null,8,["modelValue","rules"]),n(z,{modelValue:a.value.item,"onUpdate:modelValue":[l[2]||(l[2]=s=>a.value.item=s),b],url:"iuran",label:"Nama Iuran",class:"q-my-sm"},null,8,["modelValue"]),n(J,{dense:"",class:"q-my-sm",outlined:"",modelValue:a.value.nominal,"onUpdate:modelValue":l[3]||(l[3]=s=>a.value.nominal=s),required:"",label:"Nominal",rules:[s=>!!s||"Harus diisi!"]},null,8,["modelValue","rules"])]),_:1}),n(i,{"btn-delete":!!a.value.id,onOnDelete:y},null,8,["btn-delete"])]),_:1})]),_:1})}}},W={key:0},X={colspan:"7",class:"text-center bg-grey-1 no-padding"},Y={key:1},Z={key:2},ee={class:"text-center"},te={class:"text-left"},ae={class:"text-left"},le={class:"text-right"},ne={class:"text-center"},oe={class:"bg-green-1"},se={class:"text-right text-bold"},Ee={__name:"PageIndex",setup(N){const k=p(!1),v=p([]),u=p(""),a=p(!1),m=p({});async function f(){const o=await E({endPoint:"iuran-paket",loading:k});o&&(v.value=o.iuran_paket)}B(async()=>{await f()});function b(){const o=v.value.map(e=>e.paket);return Array.from(new Set(o))}function _(){return v.value.filter(o=>o.paket==u.value)}function y(){return _().reduce(function(o,e){return o+Number(e.nominal)},0)}function r(){m.value={paket:u.value},a.value=!0}function l(o){m.value=o,a.value=!0}return(o,e)=>(c(),V(H,{class:"q-pa-sm"},{default:d(()=>[n(C,{class:"",style:{"max-width":"800px"}},{default:d(()=>[n(G,{title:"Pengaturan Paket Iuran",onOnReload:f}),n(w,{class:"q-pa-sm flex justify-between"},{default:d(()=>[n(F,{label:"Pilih nama paket",dense:"",outlined:"",options:b(),loading:k.value,modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=i=>u.value=i),clearable:"",style:{width:"250px","min-width":"200px"}},null,8,["options","loading","modelValue"]),n(Q,{dense:"",icon:"add",label:"Baru",color:"green-10","no-caps":"",outline:"",class:"q-px-sm",title:"Buat/tambahkan data baru",onClick:e[1]||(e[1]=i=>r())})]),_:1}),n(w,{class:"q-pa-sm"},{default:d(()=>[n(T,{flat:"",bordered:""},{default:d(()=>[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",{class:"text-center"},"No"),t("th",{class:"text-left"},"Nama Paket"),t("th",{class:"text-left"},"Iuran"),t("th",{class:"text-right"},"Nominal"),t("th",{class:"text-center"},"Edit")])],-1)),t("tbody",null,[k.value?(c(),g("tr",W,[t("td",X,[n(O,{color:"green",size:"md"})])])):!v.value.length&&!k.value?(c(),g("tr",Y,[...e[5]||(e[5]=[t("td",{colspan:"7",class:"text-center text-italic text-negative bg-red-2"},[q(" Tidak ada data untuk ditampikan!"),t("br"),q(" Silakan Tambahkan data baru! ")],-1)])])):u.value?(c(!0),g(U,{key:3},$(_(),(i,s)=>(c(),g("tr",{key:s},[t("td",ee,x(i.urut),1),t("td",te,x(i.paket),1),t("td",ae,x(i.item),1),t("td",le,x(i.nominal.toRupiah()),1),t("td",ne,[n(Q,{icon:"edit",flat:"",color:"green-10",onClick:ie=>l(i)},null,8,["onClick"])])]))),128)):(c(),g("tr",Z,[...e[6]||(e[6]=[t("td",{colspan:"7",class:"text-center text-italic text-negative bg-red-1"}," Pilih filter! ",-1)])]))]),t("tfoot",null,[t("tr",oe,[e[7]||(e[7]=t("td",{class:"text-right text-italic",colspan:"3"}," Total ",-1)),t("td",se,x(y().toRupiah()),1),e[8]||(e[8]=t("td",{class:"text-center"},null,-1))])])]),_:1})]),_:1})]),_:1}),n(D,{modelValue:a.value,"onUpdate:modelValue":e[4]||(e[4]=i=>a.value=i)},{default:d(()=>[n(K,{data:m.value,onSuccessSubmit:e[2]||(e[2]=i=>f()),onSuccessDelete:e[3]||(e[3]=i=>f())},null,8,["data"])]),_:1},8,["modelValue"])]),_:1}))}};export{Ee as default};
