import{Q as G}from"./QList-B01KHQyb.js";import{Q as V}from"./QSelect-DG0UTNMZ.js";import{q as Q,ap as K,s as I,Y as P,E as _,c as j,o as D,w as l,g as a,af as O,f as L,G as n,Q as v,l as H,ae as M,N as S,n as z,ag as h,a9 as E,p as $,a as F,a4 as J,e as q,aq as Y,J as W}from"./index-BjwPH8FF.js";import{Q as w}from"./QTd-JyBH1_v-.js";import{Q as X}from"./QTable-CGDGx2T1.js";import{Q as Z}from"./QForm-B-tb8GAo.js";import{u as aa}from"./useCrudForm-d1k0sjgN.js";import{_ as ea}from"./InputSelectTahunAjaran-DEDfTCSi.js";import{A as ta,u as la}from"./apb-budgets-store-CAGUPJcD.js";import{c as oa}from"./index-C-UlpWnA.js";import{T as na}from"./ToBudgetConfig-BHxEf2uk.js";import{T as sa}from"./ToAccount-Cjtm6SbY.js";import{T as ia}from"./ToAccountAsset-BM9x3mXT.js";import{T as ra}from"./ToAccountGroup-FnrD2A9F.js";import"./QField-ByOWwheS.js";import"./QChip-DvWKrUSh.js";import"./QItem-CsqH32k4.js";import"./QItemLabel-BFTSoDAR.js";import"./QMenu-BekTf8G3.js";import"./selection-DiJ6Q-Vu.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./QMarkupTable-do9Aoic-.js";import"./use-fullscreen-BtRK7KQO.js";import"./lists-store-MtkfrqvS.js";import"./ArrayCrud-DeaxgM1Q.js";import"./DropDownAfter-fp8kMr4A.js";import"./QBtnDropdown-DCLbnrW2.js";import"./QBtnGroup-UJjf5I6N.js";import"./ClosePopup-UiwGJ_I-.js";import"./Lists-Cka2Qv50.js";import"./ApiCrud-ggAtBQJ_.js";import"./Api-Dq7M9uDD.js";import"./index-nmeLrqlN.js";import"./apiPost-Bua6HjJD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ua={__name:"ApbBudgetForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(B,{emit:m}){const p=B,d=m,s=Q({...p.data}),f=!p.data?.id,c=K("firstInput");I(async()=>{await P(),c.value&&c.value.focus()});const{handleDelete:k,handleCreate:g,loading:y}=aa(ta,{emit:d,responseKey:"budgets"}),A=async()=>{const r=`<hr><div class="text-bold q-py-sm">Buat Anggaran?</div><hr>
		<div class="text-italic q-mt-md">
			<div>PERHATIAN:</div>
			<ul style="list-style-type: square;" class="q-ml-md">
				<li>Buat Anggaran baru untuk tahun ajaran <strong>${s.value.th_ajaran_h}</strong>.</li>
				<li>Akun dan Tahun Ajaran bersifat unik (no duplicate). Data yang sudah ada TIDAK akan ditimpa.</li>
				<li>Aksi ini akan menyalin seluruh akun dengan kategori Pendapatan dan Biaya.</li>
				<li>Akun yang disembunyikan (hidden) tidak akan disertakan.</li>
			</ul>
		</div>`;if(await oa(r))return await g({th_ajaran_h:s.value.th_ajaran_h},!1)},u=async()=>await k(p.data.id);return(r,i)=>{const T=_("FormHeader"),x=_("FormLoading"),C=_("FormActions");return D(),j(H,{class:"full-width",style:{"max-width":"425px"}},{default:l(()=>[a(Z,{onSubmit:O(A,["prevent"])},{default:l(()=>[a(T,{title:"Buat Anggaran","is-new":f}),n(y)?(D(),j(x,{key:0})):L("",!0),a(v,null,{default:l(()=>[a(ea,{modelValue:s.value.th_ajaran_h,"onUpdate:modelValue":i[0]||(i[0]=b=>s.value.th_ajaran_h=b),rules:[b=>!!b||"Harus diisi!"],class:"q-my-sm",ref_key:"firstInput",ref:c},null,8,["modelValue","rules"])]),_:1}),a(C,{"btn-delete":!f,onOnDelete:u},null,8,["btn-delete"])]),_:1})]),_:1})}}},za={__name:"PageIndex",setup(B){const m=Q(!1),p=Q(!1),d=la(),{filterThAjaranH:s,budgets:f,loading:c,loadingTh:k,optionsThAjaran:g,optionsCategory:y,optionsGroup:A,filterText:u,filterCategory:r,filterGroup:i,filteredData:T}=M(d),x=async()=>{await d.listTahun(),r.value="",i.value="",u.value="",s.value&&(await d.loadByTahun(s.value),m.value=!0)},C=async e=>{await d.removeData(e.id)},b=e=>{f.value=e,m.value=!0,r.value="",i.value="",u.value="",g.value.push(e[0].th_ajaran_h),s.value=e[0].th_ajaran_h};I(async()=>{m.value=!1,g.value?.length||await d.listTahun()}),S(s,async e=>{i.value="",r.value="",u.value="",e?(await d.loadByTahun(e),m.value=!0):f.value=[]}),S(r,()=>{i.value=""});const N=[{name:"actions",label:"!",align:"center"},{name:"th_ajaran_h",label:"Tahun Ajaran",align:"left",field:"th_ajaran_h",sortable:!0},{name:"account_id",label:"Akun ID",align:"left",field:"account_id",sortable:!0},{name:"group_name",label:"Akun ",field:e=>`${e.group}: ${e.name}`,align:"left",sortable:!0,style:"white-space: normal; word-wrap: break-word;"},{name:"total_budget",label:"Total Anggaran",field:"total_budget",format:e=>`${e?e.toRupiah():0}`,align:"right",sortable:!0,classes:e=>e.status=="unbudgeted"?"bg-negative text-white	":""},{name:"total_absorbed",label:"Total Serapan",field:"total_absorbed",format:e=>`${e?e.toRupiah():0}`,align:"right",sortable:!0},{name:"sisa",label:"Sisa",field:"sisa",format:e=>`${e?(Number(e)>=0?"+":"-")+Math.abs(e).toRupiah():0}`,align:"right",sortable:!0,classes:e=>Number(e.sisa)>0?"text-primary":"text-negative"},{name:"percentage",label:"%",field:"percentage",format:e=>`${e}%`,align:"right",sortable:!0},{name:"locked",label:"Kunci",field:"locked",align:"center"},{name:"delete",label:"Hapus",align:"center"}];return(e,o)=>{const R=_("CardHeader"),U=_("CardPage");return D(),j(U,null,{default:l(()=>[a(R,{title:"Daftar Anggaran",onOnReload:x,"show-add":!0,"label-add":"Anggaran Baru",onOnAdd:o[0]||(o[0]=t=>p.value=!0),"icon-add":"sym_o_variable_add"},{more:l(()=>[a(G,null,{default:l(()=>[a(na),a(sa),a(ra),a(ia)]),_:1})]),_:1}),a(v,{class:"q-pt-sm q-pb-none q-px-sm"},{default:l(()=>[a(H,{bordered:"",flat:"",class:""},{default:l(()=>[a(v,{class:"tw:grid tw:sm:flex tw:sm:justify-between tw:gap-2 q-pa-sm"},{default:l(()=>[a(V,{dense:"",class:"tw:w-full tw:sm:max-w-sm",outlined:"",label:"Tahun Ajaran","emit-value":"","map-options":"",modelValue:n(s),"onUpdate:modelValue":o[1]||(o[1]=t=>h(s)?s.value=t:null),options:n(g),loading:n(k),clearable:"",behavior:"menu"},null,8,["modelValue","options","loading"]),a(V,{dense:"",class:"full-width",outlined:"",label:"Kategori Akun","emit-value":"","map-options":"",modelValue:n(r),"onUpdate:modelValue":o[2]||(o[2]=t=>h(r)?r.value=t:null),options:n(y),loading:n(c),clearable:"",behavior:"menu"},null,8,["modelValue","options","loading"]),a(V,{dense:"",class:"full-width",outlined:"",label:"Group","emit-value":"","map-options":"",modelValue:n(i),"onUpdate:modelValue":o[3]||(o[3]=t=>h(i)?i.value=t:null),options:n(A),loading:n(c),clearable:"",behavior:"menu"},null,8,["modelValue","options","loading"]),a(E,{class:"tw:w-full tw:sm:max-w-sm",outlined:"",dense:"",debounce:"300",placeholder:"Cari data anggaran...",clearable:"",modelValue:n(u),"onUpdate:modelValue":o[4]||(o[4]=t=>h(u)?u.value=t:null)},{append:l(()=>[a($,{name:"search"})]),_:1},8,["modelValue"])]),_:1}),z(a(v,{class:"bg-warning q-pa-xs text-black"},{default:l(()=>[...o[7]||(o[7]=[F("div",{class:"text-caption text-center"}," Data tidak realtime! Klik tombol muat ulang untuk mendapatkan data terbaru. ",-1)])]),_:1},512),[[J,!m.value]])]),_:1})]),_:1}),a(v,{class:"q-pa-sm"},{default:l(()=>[a(X,{bordered:"",flat:"",rows:n(T),loading:n(c),"rows-per-page-options":[10,25,50,100,0],class:"dt",filter:n(u),"no-data-label":"Tidak ada data untuk ditampilkan!","no-results-label":"Tidak ditemukan kata kunci yang sesuai dengan pencarian Anda!","row-key":"id",columns:N},{"body-cell-actions":l(t=>[a(w,{props:t,title:"Detail Anggaran"},{default:l(()=>[a(q,{"no-caps":"",outline:"",size:"sm",class:"q-px-none",color:"green-7",to:`/apb/budgets/${t.row.id}`},{default:l(()=>[a($,{name:"info",class:"q-mx-xs"}),o[8]||(o[8]=F("span",{class:"q-mx-xs"}," Detail ",-1))]),_:1},8,["to"])]),_:2},1032,["props"])]),"body-cell-account_id":l(t=>[a(w,{props:t},{default:l(()=>[a(q,{size:"sm","no-caps":"",class:"q-px-sm",label:t.row.account_id,outline:"",color:"negative",to:`/apb/accounts/${t.row.account_id}`},null,8,["label","to"])]),_:2},1032,["props"])]),"body-cell-locked":l(t=>[a(w,{props:t},{default:l(()=>[a(Y,{"model-value":t.value||!1,"true-value":!0,"false-value":!1,color:"negative","unchecked-icon":t.value===!1?"lock_open":"clear","checked-icon":"lock",disable:"","keep-color":""},null,8,["model-value","unchecked-icon"])]),_:2},1032,["props"])]),"body-cell-delete":l(t=>[a(w,{props:t},{default:l(()=>[a(q,{icon:"delete",flat:"",color:"negative",onClick:da=>C(t.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","filter"])]),_:1}),a(W,{persistent:"",modelValue:p.value,"onUpdate:modelValue":o[6]||(o[6]=t=>p.value=t)},{default:l(()=>[a(ua,{data:{},onSuccessSubmit:o[5]||(o[5]=t=>b(t))})]),_:1},8,["modelValue"])]),_:1})}}};export{za as default};
