import{aA as O,bN as R,q as k,A as Q,c as h,o as f,w as n,a as s,g as e,e as g,b as q,F as P,D as H,t as b,G as x,s as D,N as V,Q as w,v as y,C as T,m as E,l as F,ae as J,f as B,a8 as C,n as W,J as X,ad as Y,E as M}from"./index-BKgLw7qS.js";import{Q as I,a as A}from"./QToolbar-ClFVgE74.js";import{Q as U}from"./QSpace-N2bd0vuM.js";import{a as Z}from"./api-get-Gv1bWbvV.js";import{d as ee}from"./index-CN_R4Poo.js";import{_ as S}from"./InputSelectArray-BFymZrXS.js";import{_ as te}from"./InputSelectTingkatPendidikan-C8s2s48o.js";import{Q as j}from"./QSpinnerBars-BQTDClv6.js";import{Q as L}from"./QInnerLoading-DKDqbLtn.js";import{Q as K}from"./QMarkupTable-DnYbRcfn.js";import{Q as N}from"./QSelect-D6dKkbgb.js";import{Q as le}from"./QSpinnerTail-Dfo6uegV.js";import{Q as se}from"./QForm-Bd5rsjRV.js";import{C as ae}from"./ClosePopup-BWix-O7W.js";import{a as ie}from"./api-delete-CLZMwmtn.js";import{a as ne}from"./api-update-M_gkVoIM.js";import{a as oe}from"./api-post-CUHbOWtL.js";import"./index-pAYl4WkA.js";import"./api-error-Dc8TQ_NU.js";import"./lists-store-Bm0br98Z.js";import"./DropDownAfter-B6ZPph_D.js";import"./QBtnDropdown-FSOTAPYO.js";import"./QBtnGroup-8_Gv106n.js";import"./QMenu-CDFwy_7K.js";import"./selection-CuC3BnQZ.js";import"./Lists-BdE10_X8.js";import"./ApiCrud-D4h2pOZE.js";import"./Api-BDEd3YK9.js";import"./QChip-CdmmyoJI.js";import"./QItemSection-Cp_-slAD.js";import"./QItemLabel-ErlEMvu3.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const $=O("mutasi-domisili",{state:()=>({santri:[],newFilter:{domisili:""}}),getters:{getSantri:u=>u.santri},actions:{resetSantri(){this.santri=[]},addSantri(u){this.resetSantri(),u.forEach(l=>{this.santri.push({id:l.id,santri_id:l.id,nama:l.nama,domisili:l.domisili,tingkat_id:l.tingkat_id,tingkat:l.tingkat,kelas:l.kelas,new_domisili:"",new_keterangan:"",proses:!1})})},getProsesTrue(){return this.santri.filter(u=>u.proses==!0)},getProsesFalse(){return this.santri.filter(u=>u.proses==!1)},prosesTrue(u){if(!this.newFilter.domisili)return ee("Tentukan domisili baru");const l=this.santri.findIndex(d=>d.id===u),r=this.santri[l];r.proses=!0,r.new_domisili=this.newFilter.domisili,r.new_keterangan="Mutasi Domisili"},prosesFalse(u){const l=this.santri.findIndex(d=>d.id===u),r=this.santri[l];r.proses=!1,r.new_domisili=null,r.new_keterangan=null},deleteTrueProses(){const u=[];this.santri.forEach(l=>{l.proses||u.push(l)}),this.santri=u}},persist:!0}),re={class:"text-right"},de={class:"text-center"},ue={class:"text-right"},me={__name:"LeftTable",props:{onLoading:{type:Boolean,default:!1}},setup(u){const l=u,r=R(()=>l.onLoading),d=k(!1),i=$(),c=Q(()=>i.getProsesFalse());function _(){const o=c.value.length;if(!o)return;let t=0;d.value=!0,c.value.forEach(a=>{setTimeout(()=>{i.prosesTrue(a.id),t++,t===o&&(d.value=!1)},500)})}return(o,t)=>(f(),h(K,{flat:"",bordered:"",style:{height:"520px"}},{default:n(()=>[s("thead",null,[s("tr",null,[t[0]||(t[0]=s("th",{class:"text-center"},"ID Santri",-1)),t[1]||(t[1]=s("th",{class:"text-left"},"Nama",-1)),t[2]||(t[2]=s("th",{class:"text-left"},"Domisili",-1)),t[3]||(t[3]=s("th",{class:"text-left"},"Kelas",-1)),t[4]||(t[4]=s("th",{class:"text-left"},"Tingkat",-1)),s("th",re,[e(g,{icon:"keyboard_double_arrow_right",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!c.value.length,onClick:_},null,8,["disable"])])])]),s("tbody",null,[(f(!0),q(P,null,H(c.value,(a,m)=>(f(),q("tr",{key:m},[s("td",de,b(a.id),1),s("td",null,b(a.nama),1),s("td",null,b(a.domisili),1),s("td",null,b(a.kelas),1),s("td",null,b(a.tingkat),1),s("td",ue,[e(g,{icon:"arrow_right",dense:"",outline:"",color:"green-10",glossy:"",onClick:p=>x(i).prosesTrue(a.id)},null,8,["onClick"])])]))),128))]),e(L,{showing:r.value||d.value},{default:n(()=>[e(j,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1}))}},ce={class:"row"},pe={class:"text-caption text-italic"},fe={__name:"LeftCard",setup(u){const l=k({tingkat_id:"",kelas:"",domisili:""}),r=$(),d=k(!1),i=Q(()=>r.getProsesFalse());D(()=>{c()});function c(){document.querySelectorAll("div.q-field__bottom.row.items-start.q-field__bottom").forEach(t=>t.remove())}V(()=>l.value.tingkat_id,o=>{o&&(l.value.kelas="",l.value.domisili="")}),V(()=>l.value.kelas,async o=>{o&&(l.value.domisili="")}),V(()=>l.value.domisili,async o=>{o&&(l.value.tingkat_id="",l.value.kelas="")}),V(l,async o=>{r.resetSantri(),o.tingkat_id&&o.kelas?await _({tingkat_id:o.tingkat_id,kelas:o.kelas}):o.domisili&&await _({domisili:o.domisili})},{deep:!0});async function _(o){const t=await Z({endPoint:"mutasi/not",params:o,loading:d});r.addSantri(t.santri)}return(o,t)=>(f(),h(F,{class:"",flat:"",bordered:""},{default:n(()=>[e(w,{class:"q-pa-sm bg-green-7"},{default:n(()=>[e(I,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:n(()=>[e(A,{class:"text-subtitle1"},{default:n(()=>[...t[3]||(t[3]=[y(" Data Santri ",-1)])]),_:1}),e(g,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:a=>null,disable:""})]),_:1})]),_:1}),e(w,{class:"q-pa-sm"},{default:n(()=>[s("div",ce,[e(te,{modelValue:l.value.tingkat_id,"onUpdate:modelValue":t[0]||(t[0]=a=>l.value.tingkat_id=a),label:"Tingkat Pendidikan",class:"col no-padding q-mr-md",hint:null},null,8,["modelValue"]),e(S,{modelValue:l.value.kelas,"onUpdate:modelValue":t[1]||(t[1]=a=>l.value.kelas=a),url:"kelas",label:"Kelas",class:"col no-padding",disable:!l.value.tingkat_id},null,8,["modelValue","disable"])]),e(S,{modelValue:l.value.domisili,"onUpdate:modelValue":t[2]||(t[2]=a=>l.value.domisili=a),url:"domisili",label:"Domisili",class:"q-mt-sm no-padding"},null,8,["modelValue"])]),_:1}),e(T),e(w,{class:"q-pa-sm"},{default:n(()=>[e(me,{"on-loading":d.value},null,8,["on-loading"])]),_:1}),e(T),e(E,{class:"bg-green-1"},{default:n(()=>[s("div",pe,[y(" Total: "+b(i.value?.length||0)+" santri",1),t[4]||(t[4]=s("br",null,null,-1)),t[5]||(t[5]=y(" Hanya menampilkan santri yang statusnya “Aktif” dan belum masuk ke tabel mutasi ",-1))]),e(U),t[6]||(t[6]=s("div",null,null,-1))]),_:1})]),_:1}))}},ge={key:0,class:"text-italic text-caption"},_e={__name:"EditMutasi",props:{data:{type:Object,required:!0},api:{type:Boolean,default:!1}},emits:["onDelete","onSubmit"],setup(u,{emit:l}){const r=l,d=u,i=k({}),c=k(!1);D(()=>{d.api?Object.assign(i.value,d.data):i.value=d.data});async function _(){await ie({endPoint:`mutasi/${i.value.id}`,loading:c})&&(document.getElementById("btn-close").click(),r("onDelete"))}async function o(){const t={new_domisili:i.value.new_domisili,new_keterangan:i.value.new_keterangan};await ne({endPoint:`mutasi/${i.value.id}`,loading:c,data:t})&&(document.getElementById("btn-close").click(),r("onSubmit"))}return(t,a)=>(f(),h(F,{class:"full-width",style:{"max-width":"425px"}},{default:n(()=>[e(se,{onSubmit:J(o,["prevent"])},{default:n(()=>[e(w,{class:"bg-green-7 text-green-11 q-pa-sm"},{default:n(()=>[e(I,{class:"q-px-sm",style:{"min-height":"0"}},{default:n(()=>[e(A,{class:"text-subtitle1 text-green-11"},{default:n(()=>[...a[2]||(a[2]=[y(" Data Domisili Baru — ",-1),s("span",{class:"text-italic"},"Edit",-1)])]),_:1}),d.api?B("",!0):(f(),q("span",ge," Auto Update "))]),_:1})]),_:1}),e(w,null,{default:n(()=>[e(C,{"model-value":i.value.nama+" ("+i.value.santri_id+")",class:"",disable:"",filled:"",dense:"",outlined:"",label:"Nama (ID)"},null,8,["model-value"]),e(C,{"model-value":i.value.tingkat+" — "+i.value.kelas,class:"q-mt-sm",disable:"",filled:"",dense:"",outlined:"",label:"Tingkat — Kelas"},null,8,["model-value"]),e(C,{"model-value":i.value.domisili,class:"q-mt-sm",disable:"",filled:"",dense:"",outlined:"",label:"Domisili (Asal)"},null,8,["model-value"]),e(S,{modelValue:i.value.new_domisili,"onUpdate:modelValue":a[0]||(a[0]=m=>i.value.new_domisili=m),url:"domisili",label:"Domisili (Baru) *",class:"q-mt-sm",rules:[m=>!!m||"Harus diisi!"],clearable:!1},null,8,["modelValue","rules"]),e(C,{modelValue:i.value.new_keterangan,"onUpdate:modelValue":a[1]||(a[1]=m=>i.value.new_keterangan=m),class:"q-mt-sm",dense:"",outlined:"",label:"Keterangan (Baru)",autogrow:!0},null,8,["modelValue"])]),_:1}),e(E,{class:"bg-green-6 flex"},{default:n(()=>[d.api?(f(),h(g,{key:0,label:"Hapus",class:"bg-red text-red-1","no-caps":"",onClick:_})):B("",!0),e(U),W(e(g,{label:"Tutup",class:"bg-green-11","no-caps":"",id:"btn-close"},null,512),[[ae]]),d.api?(f(),h(g,{key:1,type:"submit",label:"Simpan",class:"bg-green-10 text-green-11","no-caps":""})):B("",!0)]),_:1}),e(L,{showing:c.value},{default:n(()=>[e(le,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1})]),_:1}))}},be={class:"text-left"},ve={class:"text-right"},ke={class:"text-left"},we={class:"text-right"},xe={__name:"RightTable",props:{onLoading:{type:Boolean,default:!1}},setup(u){const l=u,r=$(),d=Q(()=>r.getProsesTrue()),i=k(!1),c=R(()=>l.onLoading),_=k({}),o=k(!1);function t(){const m=d.value.length;if(!m)return;let p=0;i.value=!0,d.value.forEach(v=>{setTimeout(()=>{r.prosesFalse(v.id),p++,p===m&&(i.value=!1)},500)})}function a(m){_.value=m,o.value=!0}return(m,p)=>(f(),q(P,null,[e(K,{flat:"",bordered:"",style:{height:"520px"}},{default:n(()=>[s("thead",null,[s("tr",null,[s("th",be,[e(g,{icon:"keyboard_double_arrow_left",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!d.value.length,onClick:t},null,8,["disable"])]),p[1]||(p[1]=s("th",{class:"text-left"},"Nama",-1)),p[2]||(p[2]=s("th",{class:"text-left"},"Domisili Asal",-1)),p[3]||(p[3]=s("th",{class:"text-left"},"Domisili Baru *",-1)),p[4]||(p[4]=s("th",{class:"text-left"},"Keterangan",-1)),s("th",ve,[e(g,{icon:"edit",dense:"",flat:"",disable:"",color:"green-10"})])])]),s("tbody",null,[(f(!0),q(P,null,H(d.value,(v,z)=>(f(),q("tr",{key:z},[s("td",ke,[e(g,{icon:"arrow_left",dense:"",outline:"",color:"green-10",glossy:"",onClick:G=>x(r).prosesFalse(v.id)},null,8,["onClick"])]),s("td",null,b(v.nama),1),s("td",null,b(v.domisili),1),s("td",null,b(v.new_domisili),1),s("td",null,b(v.new_keterangan??"-"),1),s("td",we,[e(g,{icon:"edit",dense:"",flat:"",color:"green-10",onClick:G=>a(v)},null,8,["onClick"])])]))),128))]),e(L,{showing:c.value||i.value},{default:n(()=>[e(j,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1}),e(X,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=v=>o.value=v)},{default:n(()=>[e(_e,{data:_.value},null,8,["data"])]),_:1},8,["modelValue"])],64))}},he={class:"row"},ye={class:"text-caption text-italic"},qe={__name:"RightCard",setup(u){const l=$(),{newFilter:r}=Y(l),d=Q(()=>l.getProsesTrue()),i=k(!1);D(()=>{c()});function c(){document.querySelectorAll("div.q-field__bottom.row.items-start.q-field__bottom").forEach(t=>t.remove())}async function _(){const t={santri:d.value.map(m=>({santri_id:m.santri_id,new_domisili:m.new_domisili,new_keterangan:m.new_keterangan}))};await oe({endPoint:"mutasi",loading:i,data:t})&&l.deleteTrueProses()}return(o,t)=>(f(),h(F,{class:"",flat:"",bordered:""},{default:n(()=>[e(w,{class:"q-pa-sm bg-green-7"},{default:n(()=>[e(I,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:n(()=>[e(A,{class:"text-subtitle1"},{default:n(()=>[...t[3]||(t[3]=[y(" Data Mutasi ",-1)])]),_:1}),e(g,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:a=>null,disable:""})]),_:1})]),_:1}),e(w,{class:"q-pa-sm"},{default:n(()=>[s("div",he,[e(N,{modelValue:x(r).tingkat_id,"onUpdate:modelValue":t[0]||(t[0]=a=>x(r).tingkat_id=a),label:"",class:"col no-padding q-mr-md",filled:"",outlined:"",dense:"",disable:""},null,8,["modelValue"]),e(N,{modelValue:x(r).kelas,"onUpdate:modelValue":t[1]||(t[1]=a=>x(r).kelas=a),label:"",class:"col no-padding",filled:"",outlined:"",dense:"",disable:""},null,8,["modelValue"])]),e(S,{modelValue:x(r).domisili,"onUpdate:modelValue":t[2]||(t[2]=a=>x(r).domisili=a),url:"domisili",label:"Domisili Baru",class:"q-mt-sm no-padding"},null,8,["modelValue"])]),_:1}),e(T),e(w,{class:"q-pa-sm"},{default:n(()=>[e(xe,{"on-loading":i.value},null,8,["on-loading"])]),_:1}),e(T),e(E,{class:"bg-green-1"},{default:n(()=>[s("div",ye,[y(" Total: "+b(d.value?.length||0)+" santri",1),t[4]||(t[4]=s("br",null,null,-1)),t[5]||(t[5]=y(" Teliti kembali data domisili baru! ",-1))]),e(U),s("div",null,[e(g,{label:"Simpan","no-caps":"",icon:"save",color:"green-10",class:"text-green-11",onClick:_,disable:!d.value.length>0},null,8,["disable"])])]),_:1})]),_:1}))}},Ve={class:"col q-py-sm q-mx-sm",style:{"min-width":"400px"}},Ce={class:"col q-py-sm q-mx-sm",style:{"min-width":"500px"}},nt={__name:"ProsesiIndex",setup(u){return D(()=>{const l=document.getElementById("toggle-drawer");l&&l.click()}),(l,r)=>{const d=M("CardHeader"),i=M("CardPage");return f(),h(i,null,{default:n(()=>[e(d,{title:"Modul Mutasi Domisili",showReload:!1},{buttons:n(()=>[e(g,{icon:"visibility",label:"Hasil Mutasi",dense:"",outline:"","no-caps":"",class:"q-px-sm",to:"/mutasi/result"})]),_:1}),e(w,{class:"no-padding full-width row no-wrap justify-between items-start content-start scroll"},{default:n(()=>[s("div",Ve,[e(fe)]),s("div",Ce,[e(qe)])]),_:1})]),_:1})}}};export{nt as default};
