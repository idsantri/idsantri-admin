import{q as d,s as T,N as h,E as p,c as V,o as C,w as o,g as n,e as g,Q as k,ae as q,l as w,a8 as N,m as Q}from"./index-DfaJsQuV.js";import{Q as m}from"./QSelect-BkBU4KOv.js";import{Q as A}from"./QForm-Bl0353G9.js";import{a as U}from"./api-get-ClIlRT6p.js";import{l as r,g as c}from"./api-get-lists-BlG4oeQJ.js";import{n as x}from"./index-Bls4-9QV.js";import"./QChip-G3n0284F.js";import"./QItemSection-I2_1bSue.js";import"./QItemLabel-DSRXTJi9.js";import"./QMenu-Df8K6tyN.js";import"./selection-CZ2_muTF.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./index-DevCNWvu.js";import"./api-error-CZUuRwC1.js";const X={__name:"DownloadPage",setup(H){const v=d(!1),l=d({}),u=d([]),i=d([]),_=[{value:"ujian",label:"Nilai Ujian"},{value:"harian",label:"Nilai Harian"},{value:"rapor",label:"Nilai Rapor"},{value:"ijazah",label:"Nilai Ijazah"}],f=r().getThAjaran;i.value.th_ajaran=f,T(async()=>{const t=r().getThAjaran;if(i.value.th_ajaran=t,t.length==0){const a=await c({url:"kelas/lists",key:"th_ajaran",loadingArray:u});r().setThAjaran(a),i.value.th_ajaran=a}else i.value.th_ajaran=t});async function b(){const t=JSON.parse(JSON.stringify(l.value)),a=await U({endPoint:"export/nilai-mapel",loading:v,params:t});if(!a)return;if(!a.url)return x("Url tidak ditemukan");const s=document.createElement("a");s.href=a.url,s.click(),s.remove()}return h(()=>l.value.th_ajaran_h,async t=>{if(l.value.tingkat_id="",l.value.kelas="",t){const a=r().getTingkatByTahun(t);if(a.length)i.value.tingkat=a;else{const s=await c({url:"kelas/lists",params:{th_ajaran_h:t},key:"tingkat",loadingArray:u,sort:"asc"});r().addTingkatToTahun(s,t),i.value.tingkat=s}}else i.value.tingkat=[];i.value.kelas=[]}),h(()=>l.value.tingkat_id,async t=>{if(l.value.kelas="",t){const a=r().getKelasByTingkatAndTahun(t,l.value.th_ajaran_h);if(a.length)i.value.kelas=a;else{const s=await c({url:"kelas/lists",params:{th_ajaran_h:l.value.th_ajaran_h,tingkat_id:t},key:"kelas",loadingArray:u,sort:"asc"});r().addKelasToTingkatByTahun(s,t,l.value.th_ajaran_h),i.value.kelas=s}}else i.value.kelas=[]}),(t,a)=>{const s=p("CardHeader"),j=p("CardLoading"),y=p("CardPage");return C(),V(y,null,{default:o(()=>[n(s,{title:"Download Nilai","show-reload":!1},{buttons:o(()=>[n(g,{label:"Nilai Mapel",to:"/madrasah/nilai-mapel",dense:"",outline:"","no-caps":"",class:"q-px-sm",icon:"show_chart"}),n(g,{label:"Upload",to:"/madrasah/nilai-mapel/upload",dense:"",outline:"","no-caps":"",icon:"upload",class:"q-px-sm"})]),_:1}),n(k,{class:"q-pa-sm"},{default:o(()=>[n(A,{onSubmit:q(b,["prevent"])},{default:o(()=>[n(w,{style:{"max-width":"425px"}},{default:o(()=>[n(k,{class:"q-pa-sm"},{default:o(()=>[n(m,{dense:"",class:"",outlined:"",label:"Tahun Ajaran","emit-value":"","map-options":"",modelValue:l.value.th_ajaran_h,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.th_ajaran_h=e),options:i.value.th_ajaran,"option-value":"th_ajaran_h","option-label":"th_ajaran_h",clearable:"",behavior:"menu",required:"",rules:[e=>!!e||"Harus diisi!"]},null,8,["modelValue","options","rules"]),n(m,{dense:"",class:"",outlined:"",label:"Tingkat Pendidikan","emit-value":"","map-options":"","option-value":"tingkat_id","option-label":"tingkat",modelValue:l.value.tingkat_id,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.tingkat_id=e),options:i.value.tingkat,loading:u.value.tingkat,clearable:"",behavior:"menu",required:"",rules:[e=>!!e||"Harus diisi!"]},null,8,["modelValue","options","loading","rules"]),n(m,{dense:"",class:"",outlined:"",label:"Kelas","emit-value":"","map-options":"",modelValue:l.value.kelas,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.kelas=e),options:i.value.kelas,loading:u.value.kelas,clearable:"",behavior:"menu",required:"",rules:[e=>!!e||"Harus diisi!"]},null,8,["modelValue","options","loading","rules"]),n(m,{dense:"",class:"q-mt-sm",outlined:"",label:"Kategori Nilai",modelValue:l.value.category,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.category=e),behavior:"menu",required:"",options:_,"emit-value":"","map-options":"",rules:[e=>!!e||"Harus diisi!"]},null,8,["modelValue","rules"]),n(N,{dense:"",class:"q-mt-sm",outlined:"",label:"Ujian Ke",modelValue:l.value.ujian_ke,"onUpdate:modelValue":a[4]||(a[4]=e=>l.value.ujian_ke=e),required:"",type:"number",rules:[e=>e>0&&e<5||"antara 1 s.d. 4"]},null,8,["modelValue","rules"])]),_:1}),n(Q,{class:"bg-green-6",align:"right"},{default:o(()=>[n(g,{class:"",type:"submit",label:"Download",icon:"download",color:"green-11","no-caps":"",outline:"",dense:""})]),_:1}),n(j,{showing:v.value},null,8,["showing"])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{X as default};
