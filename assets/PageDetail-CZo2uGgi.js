import{Q as I}from"./QList-lYFPv4gX.js";import{q as j,ap as ue,s as W,Y as ne,E as Q,c as S,o as k,w as t,g as e,af as oe,f as Y,G as F,Q as G,a9 as N,l as P,A as R,N as ee,a as o,v as i,e as D,t as r,b as M,F as E,D as te,J as se,C as L,aq as de,ad as ae,ae as J,aj as O,p as re,ac as ie,br as ce}from"./index-Bq9vEVpm.js";import{u as le}from"./apb-budgets-store-DsIwx7j6.js";import{Q as me}from"./QTooltip-P3hmDDZu.js";import{Q as fe}from"./QMarkupTable-Cf71QnvW.js";import{Q as ge}from"./QForm-SO4eXMV7.js";import{_ as z}from"./InputSelectArray-BWJ7f9dh.js";import{u as pe}from"./useCrudForm-ClP9AI2Z.js";import{A as ve}from"./ApiCrud-woLT0QRy.js";import{_ as _e}from"./InputCurrency-BSzDqzp4.js";import{A as $}from"./ArrayCrud-CByp4EUn.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as m}from"./QItemLabel-DVdAmw96.js";import{Q as C,a as p}from"./QItem-CW_Sum8h.js";import{Q as X}from"./QTab-DBsUyMHn.js";import{Q as ye}from"./QTabs-IcblbHos.js";import{a as Z,Q as xe}from"./QTabPanels-DPMfIsNp.js";import{u as he}from"./apb-budget-configs-store-BApARkqV.js";import{T as ke}from"./ToAccount-Cygzfby3.js";import{T as we}from"./ToAccountGroup-CEYTox8N.js";import{T as Te}from"./ToAccountAsset-C4JjPpin.js";import"./index-pVAv07ZB.js";import"./QMenu-B9x7iWWZ.js";import"./selection-CtidnRVe.js";import"./QSelect-CylIL8wH.js";import"./QField-DO2QERKB.js";import"./QChip-cMNpj8At.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./lists-store-lKsHaSFq.js";import"./DropDownAfter-BdLBQtTB.js";import"./QBtnDropdown-oeFyHpBZ.js";import"./QBtnGroup-DEls6wbe.js";import"./ClosePopup-CGS3d8mi.js";import"./Lists-b4hZiHkH.js";import"./Api-DxYgvftP.js";import"./index-B2_mozAq.js";import"./apiPost-9br4fRKw.js";import"./QResizeObserver-D4GMD7_6.js";import"./use-panel-rJm0e5ai.js";import"./touch-BjYP5sR0.js";class qe extends ve{constructor(){super("apb/budget-details")}}const K=new qe,Ce={__name:"ApbBudgetDetailForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(u,{emit:_}){const s=u,b=_,n=j({unit:"kali",...s.data}),x=!s.data?.id,d=ue("firstInput");W(async()=>{await ne(),d.value&&d.value.focus()});const{handleDelete:V,handleCreate:h,handleUpdate:B,loading:f}=pe(K,{emit:b,responseKey:"detail"}),w=async()=>{const q={budget_id:n.value.budget_id,sequence:n.value.sequence??null,item:n.value.item,qty:n.value.qty,unit:n.value.unit,price:n.value.price,cycle:n.value.cycle,needed_at:n.value.needed_at,executor:n.value.executor,note:n.value.note};return x?await h(q,!0):await B(s.data.id,q,!0)},T=async()=>await V(s.data.id);return(q,v)=>{const y=Q("FormHeader"),g=Q("FormLoading"),A=Q("FormActions");return k(),S(P,{class:"full-width",style:{"max-width":"425px"}},{default:t(()=>[e(ge,{onSubmit:oe(w,["prevent"])},{default:t(()=>[e(y,{title:"Input Detail APB","is-new":x}),F(f)?(k(),S(g,{key:0})):Y("",!0),e(G,null,{default:t(()=>[e(N,{label:"Item *",modelValue:n.value.item,"onUpdate:modelValue":v[0]||(v[0]=a=>n.value.item=a),dense:"",outlined:"",class:"q-my-sm",rules:[a=>!!a||"Harus diisi!"],ref_key:"firstInput",ref:d},null,8,["modelValue","rules"]),e(N,{label:"Kuantitas / Banyaknya *",modelValue:n.value.qty,"onUpdate:modelValue":v[1]||(v[1]=a=>n.value.qty=a),dense:"",outlined:"",class:"q-my-sm",rules:[a=>!!a||"Harus diisi!"],type:"number"},null,8,["modelValue","rules"]),e(z,{modelValue:n.value.unit,"onUpdate:modelValue":v[2]||(v[2]=a=>n.value.unit=a),url:"satuan",label:"Satuan *",rules:[a=>!!a||"Harus diisi!"],class:"q-my-sm"},null,8,["modelValue","rules"]),e(_e,{dense:"",class:"q-my-sm",outlined:"",modelValue:n.value.price,"onUpdate:modelValue":v[3]||(v[3]=a=>n.value.price=a),required:"",label:"Nominal",rules:[a=>!!a||"Harus diisi!"]},null,8,["modelValue","rules"]),e(z,{modelValue:n.value.cycle,"onUpdate:modelValue":v[4]||(v[4]=a=>n.value.cycle=a),url:"siklus",label:"Siklus",class:"q-my-sm"},null,8,["modelValue"]),e(N,{dense:"",class:"q-my-sm",outlined:"",label:"Waktu",modelValue:n.value.needed_at,"onUpdate:modelValue":v[5]||(v[5]=a=>n.value.needed_at=a)},null,8,["modelValue"]),e(N,{dense:"",class:"q-my-sm",outlined:"",label:"Penanggung Jawab",modelValue:n.value.executor,"onUpdate:modelValue":v[6]||(v[6]=a=>n.value.executor=a),autogrow:""},null,8,["modelValue"]),e(N,{dense:"",class:"q-my-sm",outlined:"",label:"Catatan",modelValue:n.value.note,"onUpdate:modelValue":v[7]||(v[7]=a=>n.value.note=a),autogrow:""},null,8,["modelValue"])]),_:1}),e(A,{"btn-delete":!x,onOnDelete:T},null,8,["btn-delete"])]),_:1})]),_:1})}}},Ve={class:"text-center"},Ae={class:"text-center",style:{width:"75px"},title:"klik untuk mengubah nomor urut"},De={class:"text-left"},Qe={class:"text-right"},Se={class:"text-left"},Be={class:"text-right"},je={class:"text-right"},Ne={class:"text-left"},$e={class:"text-left"},Re={class:"text-left"},Ue={class:"text-left"},Ie={class:"text-center"},Le={class:"bg-green-12"},Fe={class:"text-right text-bold"},Ge={__name:"CardDetail",props:{budget_id:{type:[String,Number],required:!0},account_id:{type:[String]},th_ajaran_h:{type:[String]}},emits:["updateTotalBudget"],setup(u,{emit:_}){const s=u,b=_,n=j(!1),x=j({}),d=j([]),V=j(!1),h=R(()=>d.value.reduce((a,l)=>a+Number(l.sub_total),0)),B=R(()=>$.sort(d.value,"sequence","asc",!1));async function f(){try{V.value=!0;const a=await K.getAll({params:{budget_id:s.budget_id}});d.value=a.details,b("updateTotalBudget",h.value)}catch(a){console.error("ðŸš€ ~ loadData ~ error:",a)}finally{V.value=!1}}W(async()=>{await f()});const w=a=>{x.value=a,n.value=!0},T=()=>{x.value={budget_id:s.budget_id},n.value=!0},q=a=>{d.value=$.create(d.value,a),b("updateTotalBudget",h.value)},v=a=>{d.value=$.update(d.value,a.id,a),b("updateTotalBudget",h.value)},y=a=>{d.value=$.remove(d.value,a),b("updateTotalBudget",h.value)},g=ee(()=>d.value.map(a=>a.sequence),(a,l)=>{l.length===0||a.length!==l.length||a.forEach(async(U,c)=>{if(U!==l[c]){const H=d.value[c].id;await A(H,a[c],l[c])}})});async function A(a,l,U){try{await K.update({id:a,data:{sequence:l},notifySuccess:!1})}catch(c){d.value=$.update(d.value,a,{sequence:U}),console.error("ðŸš€ ~ updateNomorUrut ~ e:",c),g()}}return(a,l)=>{const U=Q("CardLoading");return k(),S(P,{bordered:"",flat:"",class:""},{default:t(()=>[e(G,{class:"bg-green-7 text-green-11 q-pa-sm flex justify-between items-center"},{default:t(()=>[o("div",null,[e(D,{onClick:f,icon:"sync","no-caps":"",dense:"",flat:"",class:"q-mr-xs",title:"Muat ulang"}),i(" Detail Anggaran ["+r(u.budget_id)+"] ",1)]),e(D,{class:"q-px-sm",dense:"",outline:"",glossy:"",icon:"sym_o_credit_card_clock",label:"Data Transaksi","no-caps":"",to:`/apb/accounts/${u.account_id}?th=${u.th_ajaran_h}`},{default:t(()=>[e(me,{class:"bg-green-1 text-green-10"},{default:t(()=>[i(" Riwayat transaksi akun "+r(u.account_id)+" ",1),l[1]||(l[1]=o("br",null,null,-1)),i("pada tahun ajaran "+r(u.th_ajaran_h),1)]),_:1})]),_:1},8,["to"])]),_:1}),e(G,{class:"q-pa-sm"},{default:t(()=>[e(fe,{bordered:"",flat:""},{default:t(()=>[e(U,{showing:V.value},null,8,["showing"]),o("thead",null,[o("tr",null,[l[2]||(l[2]=o("th",{class:"text-center"},"No",-1)),l[3]||(l[3]=o("th",{class:"text-left"},"Nama Item",-1)),l[4]||(l[4]=o("th",{class:"text-right"},"Q",-1)),l[5]||(l[5]=o("th",{class:"text-left"},"Satuan",-1)),l[6]||(l[6]=o("th",{class:"text-right"},"Harga",-1)),l[7]||(l[7]=o("th",{class:"text-right"},"Sub Total",-1)),l[8]||(l[8]=o("th",{class:"text-left"},"Siklus",-1)),l[9]||(l[9]=o("th",{class:"text-left"},"Waktu",-1)),l[10]||(l[10]=o("th",{class:"text-left"},"PJ",-1)),l[11]||(l[11]=o("th",{class:"text-left"},"Catatan",-1)),o("th",Ve,[e(D,{onClick:T,icon:"add","no-caps":"",dense:"",glossy:"",outline:"",color:"green-10",class:"q-px-sm"})])])]),o("tbody",null,[(k(!0),M(E,null,te(B.value,c=>(k(),M("tr",{key:c.id},[o("td",Ae,[e(N,{borderless:"",dense:"",modelValue:c.sequence,"onUpdate:modelValue":H=>c.sequence=H,"input-class":"text-center"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",De,r(c?.item),1),o("td",Qe,r(c?.qty),1),o("td",Se,r(c?.unit),1),o("td",Be,r(c?.price?c?.price?.toRupiah():"-"),1),o("td",je,r(c?.sub_total?c?.sub_total?.toRupiah():"-"),1),o("td",Ne,r(c?.cycle),1),o("td",$e,r(c?.needed_at),1),o("td",Re,r(c?.executor),1),o("td",Ue,r(c?.note),1),o("td",Ie,[e(D,{onClick:H=>w(c),icon:"edit","no-caps":"",dense:"",outline:"",color:"primary",class:"q-px-sm",glossy:""},null,8,["onClick"])])]))),128))]),o("tfoot",Le,[o("tr",null,[l[12]||(l[12]=o("td",{class:"text-right text-italic",colspan:"5"},"Total",-1)),o("td",Fe,r(h.value?h.value?.toRupiah():"-"),1),l[13]||(l[13]=o("td",{class:"text-center"},null,-1)),l[14]||(l[14]=o("td",{class:"text-center"},null,-1)),l[15]||(l[15]=o("td",{class:"text-center"},null,-1)),l[16]||(l[16]=o("td",{class:"text-center"},null,-1)),l[17]||(l[17]=o("td",{class:"text-center"},null,-1))])])]),_:1})]),_:1}),e(se,{persistent:"",modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=c=>n.value=c)},{default:t(()=>[e(Ce,{data:x.value,onSuccessCreate:q,onSuccessUpdate:v,onSuccessDelete:y},null,8,["data"])]),_:1},8,["modelValue"])]),_:1})}}},He=be(Ge,[["__scopeId","data-v-2a790d21"]]),Pe={__name:"CardBudget",props:{budget:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1}},setup(u){return(_,s)=>{const b=Q("CardLoading");return k(),S(I,{class:"",bordered:""},{default:t(()=>[e(b,{showing:u.loading},null,8,["showing"]),e(C,null,{default:t(()=>[e(p,{class:""},{default:t(()=>[e(m,{caption:""},{default:t(()=>[...s[1]||(s[1]=[i("Tahun Ajaran",-1)])]),_:1}),e(m,{overline:""},{default:t(()=>[i(r(u.budget?.th_ajaran_h),1)]),_:1})]),_:1}),e(p,{avatar:"",class:""},{default:t(()=>[e(D,{icon:"sym_o_delete",dense:"",flat:"","no-caps":"",color:"negative",onClick:s[0]||(s[0]=n=>_.$emit("onDelete"))})]),_:1})]),_:1}),e(L,{inset:""}),e(C,null,{default:t(()=>[e(p,{class:""},{default:t(()=>[e(m,{caption:""},{default:t(()=>[...s[2]||(s[2]=[i("Akun",-1)])]),_:1}),e(m,{overline:""},{default:t(()=>[i(" ["+r(u.budget?.account_id)+"] "+r(u.budget?.category)+" "+r(u.budget?.group)+": ",1),o("strong",null,r(u.budget?.name),1)]),_:1})]),_:1})]),_:1}),e(L,{inset:""}),e(C,null,{default:t(()=>[e(p,{class:""},{default:t(()=>[e(m,{caption:""},{default:t(()=>[...s[3]||(s[3]=[i("Total Anggaran",-1)])]),_:1}),e(m,{overline:""},{default:t(()=>[i(r(u.budget?.total_budget?.toRupiah()),1)]),_:1})]),_:1}),e(p,{class:""},{default:t(()=>[e(m,{caption:"",lines:1},{default:t(()=>[...s[4]||(s[4]=[i("Total Serapan/Alokasi ",-1)])]),_:1}),e(m,{overline:""},{default:t(()=>[i(r(u.budget?.total_absorbed?u.budget?.total_absorbed?.toRupiah():0),1)]),_:1})]),_:1}),e(p,{class:""},{default:t(()=>[e(m,{caption:""},{default:t(()=>[...s[5]||(s[5]=[i("Sisa",-1)])]),_:1}),e(m,{overline:""},{default:t(()=>[i(r((Number(u.budget?.total_budget)-Number(u.budget?.total_absorbed)).toRupiah()),1)]),_:1})]),_:1})]),_:1}),e(L,{inset:""}),e(C,null,{default:t(()=>[e(p,{class:""},{default:t(()=>[e(m,{caption:""},{default:t(()=>[...s[6]||(s[6]=[i("Status Anggaran",-1)])]),_:1}),e(m,{overline:"",class:""},{default:t(()=>[e(de,{dense:"",class:"q-pr-lg","model-value":u.budget?.locked||!1,disabled:"",label:u.budget?.locked===!0?"Terkunci":u.budget?.locked===!1?"Terbuka":"Tidak diatur",color:"negative","unchecked-icon":u.budget?.value===!1?"lock_open":"clear","checked-icon":"lock"},null,8,["model-value","label","unchecked-icon"])]),_:1}),u.budget?.locked?(k(),S(m,{key:0,class:"text-italic text-caption"},{default:t(()=>[...s[7]||(s[7]=[i(" Anggaran terkunci. Anda tidak dapat melakukan perubahan. Hubungi Admin! ",-1)])]),_:1})):Y("",!0)]),_:1}),e(p,{avatar:"",class:""},{default:t(()=>[e(D,{"icon-right":"settings",dense:"",flat:"","no-caps":"",color:"positive",to:`/apb/budgets/configs?th=${u.budget?.th_ajaran_h}&category=${u.budget?.category}&text=${u.budget?.group}`},null,8,["to"])]),_:1})]),_:1})]),_:1})}}},Me={__name:"CardGroup",props:{th_ajaran_h:{type:String,required:!0},group:{type:String,required:!0},category:{type:String,required:!0},account_id:{type:String,required:!0}},setup(u){const _=u,s=j("group"),{query:b}=ae(),n=le(),x=he(),{budgets:d,loading:V}=J(n),{getConfigs:h,loading:B}=J(x);W(()=>{b.tab&&(s.value=b.tab)});const f=R(()=>h.value.find(y=>y.th_ajaran_h===_.th_ajaran_h&&y.group===_.group)),w=R(()=>d.value.filter(y=>y.th_ajaran_h===_.th_ajaran_h&&y.group===_.group)),T=R(()=>w.value.reduce((y,g)=>y+Number(g.total_budget),0)),q=R(()=>!!(f.value&&(f.value.category=="BIAYA"&&Number(f.value.limit_rp)<T.value||f.value.category=="PENDAPATAN"&&Number(f.value.limit_rp)>T.value))),v=()=>{x.loadByTahun(_.th_ajaran_h)};return ee(()=>[_.th_ajaran_h,_.group],async y=>{const g=y[0],A=y[1];g&&A&&!w.value?.length&&await n.loadByTahun(g),g&&A&&!f.value&&await x.loadByTahun(g)},{immediate:!0,deep:!0}),(y,g)=>{const A=Q("CardLoading");return k(),M(E,null,[e(I,null,{default:t(()=>[e(C,{class:"bg-green-1 q-py-none"},{default:t(()=>[e(p,{class:""},{default:t(()=>[e(m,null,{default:t(()=>[i(r(u.th_ajaran_h)+" / "+r(u.group),1)]),_:1})]),_:1}),e(p,null,{default:t(()=>[e(ye,{modelValue:s.value,"onUpdate:modelValue":g[0]||(g[0]=a=>s.value=a),dense:"",align:"right",class:"","active-bg-color":"green-11"},{default:t(()=>[e(X,{name:"accounts",dense:"","no-caps":"",class:"",label:"Akun"}),e(X,{name:"group",dense:"","no-caps":"",class:"",label:"Grup"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(xe,{modelValue:s.value,"onUpdate:modelValue":g[1]||(g[1]=a=>s.value=a),animated:"",class:""},{default:t(()=>[e(Z,{name:"accounts",class:"no-padding"},{default:t(()=>[e(A,{showing:F(V)},null,8,["showing"]),e(I,{class:"",separator:""},{default:t(()=>[(k(!0),M(E,null,te(w.value,a=>(k(),S(C,{key:a.id},{default:t(()=>[e(p,null,{default:t(()=>[e(m,{caption:"",class:O(a.account_id==u.account_id?"text-black":"")},{default:t(()=>[i(r(a.account_id)+": "+r(a.name),1)]),_:2},1032,["class"])]),_:2},1024),e(p,{class:"text-right"},{default:t(()=>[e(m,{overline:"",class:O(a.account_id==u.account_id?"text-black text-weight-bold":"")},{default:t(()=>[i(r(a?.total_budget?.toRupiah()),1)]),_:2},1032,["class"])]),_:2},1024),e(p,{class:"",avatar:""},{default:t(()=>[e(D,{disable:a.account_id==u.account_id,icon:a.account_id!=u.account_id?"info":"sym_o_info",dense:"",flat:"","no-caps":"",color:"info",to:`/apb/budgets/${a.id}?tab=accounts`,replace:""},null,8,["disable","icon","to"])]),_:2},1024)]),_:2},1024))),128)),e(C,{class:"bg-green-1"},{default:t(()=>[e(p,{class:""},{default:t(()=>[e(m,{caption:"",class:"text-italic"},{default:t(()=>[...g[2]||(g[2]=[i("Total Grup",-1)])]),_:1})]),_:1}),e(p,{class:"text-right"},{default:t(()=>[e(m,{overline:"",class:"text-bold"},{default:t(()=>[i(r(T.value.toRupiah()),1)]),_:1})]),_:1}),e(p,{class:"",avatar:""})]),_:1})]),_:1})]),_:1}),e(Z,{name:"group"},{default:t(()=>[e(I,{class:"",separator:""},{default:t(()=>[e(A,{showing:F(B)},null,8,["showing"]),e(C,null,{default:t(()=>[e(p,null,{default:t(()=>[e(m,{caption:""},{default:t(()=>[...g[3]||(g[3]=[i(" Target/Limit Grup (%)",-1)])]),_:1}),e(m,{overline:""},{default:t(()=>[i(r(f.value?f.value?.limit+"%":"Tidak diatur"),1)]),_:1})]),_:1}),e(p,{class:"",avatar:""},{default:t(()=>[e(D,{icon:"sync",dense:"",flat:"","no-caps":"",color:"info",onClick:v})]),_:1})]),_:1}),e(L,{inset:""}),e(C,null,{default:t(()=>[e(p,null,{default:t(()=>[e(m,{caption:""},{default:t(()=>[...g[4]||(g[4]=[i(" Target/Limit Grup (Rp)",-1)])]),_:1}),e(m,{overline:""},{default:t(()=>[i(r(f.value?f.value?.limit_rp?.toRupiah():"Tidak diatur"),1)]),_:1})]),_:1}),e(p,{class:"",avatar:""},{default:t(()=>[e(D,{icon:"sym_o_info",dense:"",flat:"","no-caps":"",color:"info",to:`/apb/budgets/configs?th=${u.th_ajaran_h}&category=${u.category}&text=${u.group}`},null,8,["to"])]),_:1})]),_:1}),e(L,{inset:""}),e(C,null,{default:t(()=>[e(p,{class:""},{default:t(()=>[e(m,{caption:"",class:""},{default:t(()=>[...g[5]||(g[5]=[i(" Total Grup ",-1)])]),_:1}),e(m,{overline:"",class:O(q.value?"text-negative text-bold":"")},{default:t(()=>[i(r(T.value.toRupiah()),1)]),_:1},8,["class"])]),_:1}),e(p,{class:"",avatar:""},{default:t(()=>[q.value?(k(),S(re,{key:0,class:"q-mx-xs",name:"sym_o_warning",dense:"",flat:"","no-caps":"",color:"negative"})):Y("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Bt={__name:"PageDetail",setup(u){const _=le(),s=ie(),{params:b}=ae(),{budgets:n,loading:x}=J(_),d=j({});ce(async()=>{let f=n.value.find(w=>w.id==b.id);f||(f=await _.loadById(b.id)),d.value=f});async function V(){await _.loadByTahun(d.value.th_ajaran_h)}const h=f=>{n.value=$.update(n.value,d.value.id,{...d.value,total_budget:f})},B=async()=>{await _.removeData(d.value.id)&&s.go(-1)};return(f,w)=>{const T=Q("CardHeader"),q=Q("CardPage");return k(),S(q,null,{default:t(()=>[e(T,{title:"Detail Anggaran","show-reload":!0,onOnReload:V,"show-edit":!1},{more:t(()=>[e(I,null,{default:t(()=>[e(ke),e(we),e(Te)]),_:1})]),_:1}),e(G,{class:"tw:grid tw:sm:flex tw:sm:justify-between tw:gap-2 q-pa-sm"},{default:t(()=>[e(P,{class:"tw:w-full",bordered:"",flat:""},{default:t(()=>[e(Pe,{budget:d.value,onOnDelete:B,loading:F(x)},null,8,["budget","loading"])]),_:1}),e(P,{class:"tw:w-full",bordered:"",flat:""},{default:t(()=>[e(Me,{th_ajaran_h:d.value?.th_ajaran_h,group:d.value?.group,account_id:d.value?.account_id,category:d.value?.category},null,8,["th_ajaran_h","group","account_id","category"])]),_:1})]),_:1}),e(G,{class:"q-px-sm q-pb-sm q-pt-none"},{default:t(()=>[e(He,{budget_id:F(b).id,th_ajaran_h:d.value?.th_ajaran_h,account_id:d.value?.account_id,onUpdateTotalBudget:h},null,8,["budget_id","th_ajaran_h","account_id"])]),_:1})]),_:1})}}};export{Bt as default};
