import{be as ea,q as j,ae as R,bQ as ta,s as E,N as C,b as F,o as b,g as a,G as f,A as z,c as P,w as i,Q as x,v as V,e as v,C as Q,a as n,F as M,D as G,t as w,m as L,l as U,a9 as N,n as la,J as na,E as H}from"./index-DM_jncYt.js";import{Q as I,a as J}from"./QToolbar-DwN98rxO.js";import{Q as W}from"./QSpinnerBars-BRlfxEzv.js";import{Q as X}from"./QInnerLoading-DOY-7Vus.js";import{Q as Y}from"./QMarkupTable-Bdc0Nhnt.js";import{Q as Z}from"./QSpace-JASAi6Cv.js";import{Q as A}from"./QSelect-BYyrPAR2.js";import{K}from"./Kelas-mefURdl4.js";import{e as $,c as sa}from"./index-BpLO8DFE.js";import{l as D}from"./lists-madrasah-store-BJAj84On.js";import{_ as O}from"./InputSelectArray-Li_TWQTX.js";import{_ as aa}from"./InputSelectTingkatPendidikan-Bd63wD8J.js";import{C as ra}from"./ClosePopup-DsIrMGS2.js";import"./QField-CMH2dchU.js";import"./QChip-fyYFzEry.js";import"./QItem-HDmkhoZf.js";import"./QItemLabel-UugIBA3Q.js";import"./QMenu-CrcesN8E.js";import"./selection-B5gSKtbS.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./ApiCrud-CFKNXvgl.js";import"./Api-BiHTUPZy.js";import"./index-DvSXiYm3.js";import"./apiPost-k9GJBscs.js";import"./lists-store-CzXztFDE.js";import"./ArrayCrud-CByp4EUn.js";import"./DropDownAfter-CW368Jcm.js";import"./QBtnDropdown-CflmhBFO.js";import"./QBtnGroup-CuS_Q55_.js";import"./Lists-BdblbFOX.js";const S={th_ajaran_h:"",tingkat_id:"",kelas:""},T=ea("kenaikan-kelas",{state:()=>({murid:[],oldDataFilter:JSON.parse(JSON.stringify(S)),newDataFilter:JSON.parse(JSON.stringify(S))}),getters:{getMurid:o=>o.murid},actions:{resetMurid(){this.murid=[]},resetOldFilter(){this.oldDataFilter=JSON.parse(JSON.stringify(S))},resetNewFilter(){this.newDataFilter=JSON.parse(JSON.stringify(S))},addMurid(o){this.resetMurid(),o.forEach(t=>{this.murid.push({id:t.id,santri_id:t.santri_id,th_ajaran_h:t.th_ajaran_h,tingkat_id:t.tingkat_id,tingkat:t.tingkat,kelas:t.kelas,no_absen:t.no_absen,nama:t.nama,domisili:t.domisili,proses:!1,new_th_ajaran_h:null,new_tingkat_id:null,new_kelas:null,new_keterangan:null})})},addNewDataFilter(o){this.newDataFilter=o},addOldDataFilter(o){this.oldDataFilter=o},getMuridFalse(){return this.murid.filter(o=>o.proses==!1)},getMuridTrue(){return this.murid.filter(o=>o.proses==!0)},prosesTrue(o){if(!this.newDataFilter.th_ajaran_h)return $("Tentukan tahun ajaran baru");if(!this.newDataFilter.tingkat_id)return $("Tentukan tingkat pendidikan baru");if(!this.newDataFilter.kelas)return $("Tentukan kelas baru");const t=this.murid.findIndex(r=>r.id===o),e=this.murid[t];e.proses=!0,e.new_th_ajaran_h=this.newDataFilter.th_ajaran_h,e.new_tingkat_id=this.newDataFilter.tingkat_id,e.new_kelas=this.newDataFilter.kelas,e.new_keterangan=null},prosesFalse(o){const t=this.murid.findIndex(r=>r.id===o),e=this.murid[t];e.proses=!1,e.new_th_ajaran_h=null,e.new_tingkat_id=null,e.new_kelas=null,e.new_keterangan=null},deleteTrueProses(){const o=[];this.murid.forEach(t=>{t.proses||o.push(t)}),this.murid=o}},persist:!0}),ia={__name:"HeadLeft",props:{reload:{type:Boolean,default:!1}},emits:["onLoading"],setup(o,{emit:t}){const e=j([]),r=j([]),{oldDataFilter:l}=R(T()),g=o,y=t,d=ta(g,"reload");E(async()=>{await q()});async function p(){try{r.value.th_ajaran=!0;const s=await K.list();D().setThAjaran(s.th_ajaran),e.value.th_ajaran=s.th_ajaran}catch(s){console.error("ðŸš€ ~ loadTahun ~ error:",s)}finally{r.value.th_ajaran=!1}}async function q(){const s=D().getThAjaran;s?.length?e.value.th_ajaran=s:await p()}async function c(s){try{r.value.tingkat=!0;const u=await K.list({th_ajaran_h:s});D().addTingkatToTahun(u.tingkat,s),e.value.tingkat=u.tingkat}catch(u){console.error("ðŸš€ ~ loadTingkat ~ error:",u)}finally{r.value.tingkat=!1}}async function m(s){const u=D().getTingkatByTahun(s);u?.length?e.value.tingkat=u:await c(s)}async function _(s,u){try{r.value.kelas=!0;const k=await K.list({th_ajaran_h:s,tingkat_id:u});D().addKelasToTingkatByTahun(k.kelas,u,s),e.value.kelas=k.kelas}catch(k){console.error("ðŸš€ ~ loadKelas ~ error:",k)}finally{r.value.kelas=!1}}async function h(s,u){const k=D().getKelasByTingkatAndTahun(u,s);k?.length?e.value.kelas=k:await _(s,u)}C(()=>l.value.th_ajaran_h,async s=>{s&&(l.value.tingkat_id="",l.value.kelas="",await m(s),e.value.kelas=null)}),C(()=>l.value.tingkat_id,async s=>{s&&(l.value.kelas="",await h(l.value.th_ajaran_h,s))}),C(d,async()=>{e.value=[],T().resetOldFilter(),D().$reset(),await q()});async function B(s={}){try{return y("onLoading",!0),await K.getAll({params:s,notifySuccess:!1})}catch(u){return console.error("ðŸš€ ~ getDataKelas ~ error:",u),null}finally{y("onLoading",!1)}}return C(l,async s=>{if(T().addOldDataFilter(s),T().resetMurid(),s.th_ajaran_h&&s.tingkat_id&&s.kelas){s.status="Aktif",s.aktif=!0;const u=await B(s);T().addMurid(u.murid)}},{deep:!0}),(s,u)=>(b(),F("div",null,[a(A,{"model-value":f(l).th_ajaran_h,"onUpdate:modelValue":u[0]||(u[0]=k=>f(l).th_ajaran_h=k.th_ajaran_h),options:e.value.th_ajaran,loading:r.value.th_ajaran,"option-value":"th_ajaran_h","option-label":"th_ajaran_h",outlined:"",dense:"",class:"",label:"Tahun Ajaran","hide-bottom-space":""},null,8,["model-value","options","loading"]),a(A,{"model-value":f(l).tingkat_id,"onUpdate:modelValue":u[1]||(u[1]=k=>f(l).tingkat_id=k.tingkat_id),options:e.value.tingkat,loading:r.value.tingkat,"option-value":"tingkat_id","option-label":"tingkat",outlined:"",dense:"",class:"q-mt-sm",label:"Tingkat"},null,8,["model-value","options","loading"]),a(A,{modelValue:f(l).kelas,"onUpdate:modelValue":u[2]||(u[2]=k=>f(l).kelas=k),options:e.value.kelas,loading:r.value.kelas,outlined:"",dense:"",class:"q-mt-sm",label:"Kelas"},null,8,["modelValue","options","loading"])]))}},oa={class:"text-right"},da={class:"text-center"},ua={class:"text-right"},ma={class:"text-caption text-italic"},ga={__name:"DataLeft",setup(o){const t=j(!1),e=j(!1),r=T(),l=z(()=>r.getMuridFalse());function g(){const y=l.value.length;if(!y)return;let d=0;e.value=!0,l.value.forEach(p=>{setTimeout(()=>{r.prosesTrue(p.id),d++,d===y&&(e.value=!1)},500)})}return(y,d)=>(b(),P(U,{class:"",flat:"",bordered:""},{default:i(()=>[a(x,{class:"q-pa-sm bg-green-7"},{default:i(()=>[a(I,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:i(()=>[a(J,{class:"text-subtitle1"},{default:i(()=>[...d[2]||(d[2]=[V(" Kelas Lama ",-1)])]),_:1}),a(v,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:d[0]||(d[0]=p=>t.value=!t.value)})]),_:1})]),_:1}),a(x,{class:"q-pa-sm"},{default:i(()=>[a(ia,{reload:t.value,onOnLoading:d[1]||(d[1]=p=>e.value=p)},null,8,["reload"])]),_:1}),a(Q),a(x,{class:"q-pa-sm"},{default:i(()=>[a(Y,{flat:"",bordered:"",style:{height:"500px"}},{default:i(()=>[n("thead",null,[n("tr",null,[d[3]||(d[3]=n("th",{class:"text-center"},"No.",-1)),d[4]||(d[4]=n("th",{class:"text-left"},"Nama",-1)),d[5]||(d[5]=n("th",{class:"text-left"},"Domisili",-1)),n("th",oa,[a(v,{icon:"keyboard_double_arrow_right",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!l.value.length,onClick:g},null,8,["disable"])])])]),n("tbody",null,[(b(!0),F(M,null,G(l.value,(p,q)=>(b(),F("tr",{key:q},[n("td",da,w(p.no_absen?String(p.no_absen).padStart(2,"0"):""),1),n("td",null,w(p.nama),1),n("td",null,w(p.domisili),1),n("td",ua,[a(v,{icon:"arrow_right",dense:"",outline:"",color:"green-10",glossy:"",onClick:c=>f(r).prosesTrue(p.id)},null,8,["onClick"])])]))),128))]),a(X,{showing:e.value},{default:i(()=>[a(W,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1})]),_:1}),a(Q),a(L,{class:"bg-green-1"},{default:i(()=>[n("div",ma,[V(" Total: "+w(l.value.length)+" murid",1),d[6]||(d[6]=n("br",null,null,-1)),d[7]||(d[7]=V(" Hanya menampilkan murid dengan Kelas = Aktif dan Status = Aktif ",-1))]),a(Z),d[8]||(d[8]=n("div",null,null,-1))]),_:1})]),_:1}))}},fa={__name:"HeadRight",setup(o){const{newDataFilter:t}=R(T());E(async()=>{e()});function e(){document.querySelectorAll("div.q-field__bottom.row.items-start.q-field__bottom").forEach(l=>l.remove())}return(r,l)=>(b(),F("div",null,[a(O,{modelValue:f(t).th_ajaran_h,"onUpdate:modelValue":l[0]||(l[0]=g=>f(t).th_ajaran_h=g),url:"tahun-ajaran",label:"Tahun Ajaran *",sort:"desc",class:"no-padding",disable:!!f(t).th_ajaran_h},null,8,["modelValue","disable"]),a(aa,{modelValue:f(t).tingkat_id,"onUpdate:modelValue":l[1]||(l[1]=g=>f(t).tingkat_id=g),label:"Tingkat Pendidikan *",class:"q-mt-sm no-padding",hint:null,disable:!!f(t).tingkat_id},null,8,["modelValue","disable"]),a(O,{modelValue:f(t).kelas,"onUpdate:modelValue":l[2]||(l[2]=g=>f(t).kelas=g),url:"kelas",label:"Kelas *",class:"q-mt-sm no-padding",disable:!!f(t).kelas},null,8,["modelValue","disable"])]))}},ca={__name:"EditNewMurid",props:{data:{type:Object,required:!0}},setup(o){const e=j(o.data);return(r,l)=>(b(),P(U,{class:"full-width",style:{"max-width":"425px"}},{default:i(()=>[a(x,{class:"bg-green-7 text-green-11 q-pa-sm"},{default:i(()=>[a(I,{class:"q-px-sm",style:{"min-height":"0"}},{default:i(()=>[a(J,{class:"text-subtitle1 text-green-11"},{default:i(()=>[...l[3]||(l[3]=[V(" Data Kelas Baru â€” ",-1),n("span",{class:"text-italic"},"Edit",-1)])]),_:1}),l[4]||(l[4]=n("span",{class:"text-italic text-caption"}," Auto Update ",-1))]),_:1})]),_:1}),a(x,null,{default:i(()=>[a(N,{"model-value":e.value.nama+" ("+e.value.santri_id+")",class:"",disable:"",filled:"",dense:"",outlined:"",label:"Nama (ID)"},null,8,["model-value"]),a(N,{"model-value":e.value.new_th_ajaran_h,class:"q-mt-sm",disable:"",filled:"",dense:"",outlined:"",label:"Tahun Ajaran (Baru) *"},null,8,["model-value"]),a(aa,{modelValue:e.value.new_tingkat_id,"onUpdate:modelValue":l[0]||(l[0]=g=>e.value.new_tingkat_id=g),label:"Tingkat Pendidikan (Baru) *",class:"q-mt-sm",selected:e.value.new_tingkat_id,rules:[g=>!!g||"Harus diisi!"],clearable:!1},null,8,["modelValue","selected","rules"]),a(O,{modelValue:e.value.new_kelas,"onUpdate:modelValue":l[1]||(l[1]=g=>e.value.new_kelas=g),url:"kelas",label:"Kelas (Baru) *",class:"q-mt-sm",rules:[g=>!!g||"Harus diisi!"],clearable:!1},null,8,["modelValue","rules"]),a(N,{modelValue:e.value.new_keterangan,"onUpdate:modelValue":l[2]||(l[2]=g=>e.value.new_keterangan=g),class:"q-mt-sm",dense:"",outlined:"",label:"Keterangan (Baru)",autogrow:!0},null,8,["modelValue"])]),_:1}),a(L,{align:"right",class:"bg-green-6"},{default:i(()=>[la(a(v,{label:"Tutup",color:"green-11","no-caps":"",outline:""},null,512),[[ra]])]),_:1})]),_:1}))}},_a={class:"text-left"},pa={class:"text-right"},ka={class:"text-left"},ha={class:"text-right"},va={class:"text-caption text-italic"},wa={__name:"DataRight",setup(o){const t=T(),e=z(()=>t.getMuridTrue()),r=j(!1),l=j(!1),g=j({});function y(){const c=e.value.length;if(!c)return;let m=0;r.value=!0,e.value.forEach(_=>{setTimeout(()=>{t.prosesFalse(_.id),m++,m===c&&(r.value=!1)},500)})}function d(){t.resetNewFilter(),y()}function p(c){g.value=c,l.value=!0}async function q(){let c="";if(c+="<hr/>",c+='<p style="margin:0">Tahun Ajaran Baru: <strong>'+e.value[0].new_th_ajaran_h+"</strong></p>",c+="<hr/>",c+="Pastikan Anda sudah meneliti dengan seksama:",c+=`<ul style="margin:0">
		<li>â€” Tingkat Pendidikan</li>
		<li>â€” Kelas</li>
		</ul>
		`,c+="<strong>Pada setiap barisnya!</strong>",!await sa(c,!0))return;const _=e.value.map(h=>({santri_id:h.santri_id,th_ajaran_h:h.new_th_ajaran_h,tingkat_id:h.new_tingkat_id,kelas:h.new_kelas,keterangan:h.new_keterangan}));try{r.value=!0,await K.kenaikan({murid:_}),t.deleteTrueProses(),t.newDataFilter.tingkat_id="",t.newDataFilter.kelas=""}catch(h){console.error("ðŸš€ ~ onSubmit ~ error:",h)}finally{r.value=!1}}return(c,m)=>(b(),F(M,null,[a(U,{class:"",flat:"",bordered:""},{default:i(()=>[a(x,{class:"q-pa-sm bg-green-7"},{default:i(()=>[a(I,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:i(()=>[a(J,{class:"text-subtitle1"},{default:i(()=>[...m[1]||(m[1]=[V(" Kelas Baru ",-1)])]),_:1}),a(v,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:d})]),_:1})]),_:1}),a(x,{class:"q-pa-sm"},{default:i(()=>[a(fa)]),_:1}),a(Q),a(x,{class:"q-pa-sm"},{default:i(()=>[a(Y,{flat:"",bordered:"",style:{height:"500px"}},{default:i(()=>[n("thead",null,[n("tr",null,[n("th",_a,[a(v,{icon:"keyboard_double_arrow_left",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!e.value.length,onClick:y},null,8,["disable"])]),m[2]||(m[2]=n("th",{class:"text-left"},"Nama",-1)),m[3]||(m[3]=n("th",{class:"text-left"},"Domisili",-1)),m[4]||(m[4]=n("th",{class:"text-left"},"Tingkat*",-1)),m[5]||(m[5]=n("th",{class:"text-left"},"Kelas*",-1)),m[6]||(m[6]=n("th",{class:"text-left"},"Keterangan",-1)),n("th",pa,[a(v,{icon:"edit",dense:"",flat:"",disable:"",color:"green-10"})])])]),n("tbody",null,[(b(!0),F(M,null,G(e.value,(_,h)=>(b(),F("tr",{key:h},[n("td",ka,[a(v,{icon:"arrow_left",dense:"",outline:"",color:"green-10",glossy:"",onClick:B=>f(t).prosesFalse(_.id)},null,8,["onClick"])]),n("td",null,w(_.nama),1),n("td",null,w(_.domisili),1),n("td",null,w(_.new_tingkat_id),1),n("td",null,w(_.new_kelas),1),n("td",null,w(_.new_keterangan||"-"),1),n("td",ha,[a(v,{icon:"edit",dense:"",flat:"",color:"green-10",onClick:B=>p(_)},null,8,["onClick"])])]))),128))]),a(X,{showing:r.value},{default:i(()=>[a(W,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1})]),_:1}),a(Q),a(L,{class:"bg-green-1"},{default:i(()=>[n("div",va,[V(" Total: "+w(e.value.length)+" murid",1),m[7]||(m[7]=n("br",null,null,-1)),m[8]||(m[8]=V(" Pastikan data sudah benar-benar valid (kesalahan akan sulit diperbaiki). ",-1))]),a(Z),n("div",null,[a(v,{label:"Proses","no-caps":"",icon:"save",color:"green-10",class:"text-green-11",disable:!e.value.length>0,onClick:q},null,8,["disable"])])]),_:1})]),_:1}),a(na,{modelValue:l.value,"onUpdate:modelValue":m[0]||(m[0]=_=>l.value=_)},{default:i(()=>[a(ca,{data:g.value},null,8,["data"])]),_:1},8,["modelValue"])],64))}},ba={class:"col q-py-sm",style:{"min-width":"400px"}},ya={class:"col q-py-sm",style:{"min-width":"500px"}},ae={__name:"KenaikanKelas",setup(o){return E(()=>{const t=document.getElementById("toggle-drawer");t&&t.click()}),(t,e)=>{const r=H("CardHeader"),l=H("CardPage");return b(),P(l,null,{default:i(()=>[a(r,{title:"Modul Kenaikan Kelas","show-reload":!1}),a(x,{class:"no-padding full-width row no-wrap justify-between items-start content-start scroll q-gutter-x-sm"},{default:i(()=>[n("div",ba,[a(ga)]),n("div",ya,[a(wa)])]),_:1})]),_:1})}}};export{ae as default};
