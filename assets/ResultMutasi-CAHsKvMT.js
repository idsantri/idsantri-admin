import{q as k,E as g,c,o as _,w as e,g as a,af as H,f as N,G as L,Q as T,a9 as b,l as $,aa as K,s as E,n as A,v as i,p as M,e as v,t as y,m as O,a as R,J as G}from"./index-B4cgRUYO.js";import{Q as P}from"./QItemLabel-CwfJ-FXf.js";import{Q as U,a as m}from"./QItem-2FhwRmS0.js";import{Q as j}from"./QList-B3oM_0ji.js";import{Q as J,a as p}from"./QTable-DLMPxYbt.js";import{Q as B}from"./QTr-BP2EaDPo.js";import{Q as f}from"./QTd-BSRHd_ZZ.js";import{C as F}from"./ClosePopup-CkPSupUz.js";import{a as W}from"./api-delete-Dt9q-cXn.js";import{a as I}from"./api-get-B5No0uSU.js";import{a as h}from"./api-post-DNWgPv1D.js";import{l as z}from"./loading-store-DTLU4Weo.js";import{n as X}from"./index-C6wQ9iCE.js";import{Q as Y}from"./QForm-D5dn9dNC.js";import{_ as Z}from"./InputSelectArray-DM1COeyS.js";import{A as aa}from"./ApiCrud-DvdKryYe.js";import{u as ea}from"./useCrudForm-B8AmedPK.js";import"./QMarkupTable-Cr886gAl.js";import"./QSelect-Dur_NzhU.js";import"./QChip-DCEkVw4n.js";import"./QMenu-BvZtuO17.js";import"./selection-DzMKN9sr.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-CQZIFs7F.js";import"./index-GF_WWTiL.js";import"./api-error-B6W5wGpQ.js";import"./lists-store-DRjz9sb9.js";import"./ArrayCrud-CkcA-ixF.js";import"./DropDownAfter-Crv5EYdh.js";import"./QBtnDropdown-QOLI_zBn.js";import"./QBtnGroup-Ci2YXV4s.js";import"./Lists-B6wC9akJ.js";import"./Api-B2onMMsp.js";class ta extends aa{constructor(){super("mutasi")}}const la=new ta,sa={__name:"MutasiForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(D,{emit:u}){const d=u,n=D,o=k({...n.data}),{handleDelete:Q,handleUpdate:r,loading:x}=ea(la,{emit:d,responseKey:"mutasi"});async function C(){const w={new_domisili:o.value.new_domisili,new_keterangan:o.value.new_keterangan};return await r(n.data.id,w,!0)}async function S(){return await Q(n.data.id)}return(w,s)=>{const t=g("FormHeader"),q=g("FormLoading"),V=g("FormActions");return _(),c($,{class:"full-width",style:{"max-width":"425px"}},{default:e(()=>[a(Y,{onSubmit:H(C,["prevent"])},{default:e(()=>[a(t,{title:"Data Domisili Baru","is-new":!1}),L(x)?(_(),c(q,{key:0})):N("",!0),a(T,null,{default:e(()=>[a(b,{"model-value":o.value.nama+" ("+o.value.santri_id+")",class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Nama (ID)"},null,8,["model-value"]),a(b,{"model-value":o.value.tingkat+" — "+o.value.kelas,class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Tingkat — Kelas"},null,8,["model-value"]),a(b,{"model-value":o.value.domisili,class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Domisili (Asal)"},null,8,["model-value"]),a(Z,{modelValue:o.value.new_domisili,"onUpdate:modelValue":s[0]||(s[0]=l=>o.value.new_domisili=l),url:"domisili",label:"Domisili (Baru) *",class:"q-my-sm",rules:[l=>!!l||"Harus diisi!"],clearable:!1},null,8,["modelValue","rules"]),a(b,{modelValue:o.value.new_keterangan,"onUpdate:modelValue":s[1]||(s[1]=l=>o.value.new_keterangan=l),class:"q-my-sm",dense:"",outlined:"",label:"Keterangan (Baru)",autogrow:!0},null,8,["modelValue"])]),_:1}),a(V,{"btn-delete":!0,onOnDelete:S})]),_:1})]),_:1})}}},$a={__name:"ResultMutasi",setup(D){const u=k([]),d=k(!1),n=k(!1),o=k({}),{loadingMain:Q}=K(z());async function r(){const s=await I({endPoint:"mutasi",loading:d});s&&(u.value=s.mutasi.map(t=>({...t,tk:t.tingkat_id+" "+t.kelas})))}E(async()=>{await r()});async function x(s){o.value=s,n.value=!0}async function C(){await h({endPoint:"mutasi/execute",data:null,loading:d,confirm:!0,message:`<hr><span style="color:blue">Update Domisili?</span><hr>
		<em>
			<strong>Peringatan:</strong>
			<ul style="margin:0">
				<li>Pastikan semua keperluan Administrasi (terkait domisili asal) telah selesai!</li>
				<li>Sebaiknya data di-download/ diunduh terlebih dahulu sebagai backup!</li>
				<li>Setelah update selesai, semua data mutasi akan <strong>dihapus</strong>!</li>
			</ul>
		</em>`})&&await r()}async function S(){await W({endPoint:"mutasi/clean",loading:d,message:"Hapus semua data mutasi?"})&&(u.value=[])}async function w(){const s=await I({endPoint:"export/mutasi",loading:Q,notify:!0});if(!s)return;if(!s.url)return X("Url tidak ditemukan");const t=document.createElement("a");t.href=s.url,t.click(),t.remove()}return(s,t)=>{const q=g("CardHeader"),V=g("CardPage");return _(),c(V,null,{default:e(()=>[a(q,{title:"Data Mutasi Domisili",onOnReload:r},{buttons:e(()=>[a(v,{icon:"tune",label:"Atur Mutasi",dense:"",outline:"","no-caps":"",class:"q-px-sm",to:"/mutasi/start"})]),more:e(()=>[a(j,null,{default:e(()=>[A((_(),c(U,{to:"/info/download"},{default:e(()=>[a(m,null,{default:e(()=>[a(P,null,{default:e(()=>[...t[1]||(t[1]=[i("Cetak",-1)])]),_:1})]),_:1}),a(m,{avatar:""},{default:e(()=>[a(M,{name:"print",flat:""})]),_:1})]),_:1})),[[F]]),A((_(),c(U,{onClick:w,clickable:""},{default:e(()=>[a(m,null,{default:e(()=>[a(P,null,{default:e(()=>[...t[2]||(t[2]=[i("Unduh/Download",-1)])]),_:1})]),_:1}),a(m,{avatar:""},{default:e(()=>[a(M,{name:"download",flat:""})]),_:1})]),_:1})),[[F]]),A((_(),c(U,{onClick:S,clickable:""},{default:e(()=>[a(m,null,{default:e(()=>[a(P,null,{default:e(()=>[...t[3]||(t[3]=[i("Hapus Semua",-1)])]),_:1})]),_:1}),a(m,{avatar:""},{default:e(()=>[a(M,{name:"delete_forever",flat:""})]),_:1})]),_:1})),[[F]])]),_:1})]),_:1}),a(T,{class:"q-pa-sm"},{default:e(()=>[a(J,{class:"q-pa-sm",rows:u.value,loading:d.value,"rows-per-page-options":[10,25,50,75,100,0],flat:"",bordered:""},{header:e(l=>[a(B,{props:l},{default:e(()=>[a(p,{key:"santri_id",props:l,class:"text-left"},{default:e(()=>[...t[4]||(t[4]=[i(" ID Santri ",-1)])]),_:1},8,["props"]),a(p,{key:"nama",props:l},{default:e(()=>[...t[5]||(t[5]=[i(" Nama ",-1)])]),_:1},8,["props"]),a(p,{key:"tk",props:l},{default:e(()=>[...t[6]||(t[6]=[i(" Tingkat — Kelas ",-1)])]),_:1},8,["props"]),a(p,{key:"domisili",props:l},{default:e(()=>[...t[7]||(t[7]=[i(" Domisili (Asal) ",-1)])]),_:1},8,["props"]),a(p,{key:"new_domisili",props:l},{default:e(()=>[...t[8]||(t[8]=[i(" Domisili (Baru) ",-1)])]),_:1},8,["props"]),a(p,{class:"text-center"})]),_:2},1032,["props"])]),body:e(l=>[a(B,{props:l},{default:e(()=>[a(f,{key:"santri_id",props:l,class:"text-left"},{default:e(()=>[a(v,{label:l.row.santri_id,outline:"",color:"green-10",class:"text-caption q-px-sm",dense:"",to:`/santri/${l.row.santri_id}`},null,8,["label","to"])]),_:2},1032,["props"]),a(f,{key:"nama",props:l},{default:e(()=>[i(y(l.row.nama),1)]),_:2},1032,["props"]),a(f,{key:"tk",props:l},{default:e(()=>[i(y(l.row.tk),1)]),_:2},1032,["props"]),a(f,{key:"domisili",props:l},{default:e(()=>[i(y(l.row.domisili),1)]),_:2},1032,["props"]),a(f,{key:"new_domisili",props:l},{default:e(()=>[i(y(l.row.new_domisili),1)]),_:2},1032,["props"]),a(f,{key:"id",props:l,class:"text-center"},{default:e(()=>[a(v,{icon:"edit",flat:"",color:"green-10",onClick:oa=>x(l.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1}),a(O,{class:"q-pa-sm bg-green-7 text-green-11 row"},{default:e(()=>[t[9]||(t[9]=R("div",{class:"col text-italic"}," 1) Teliti kembali sebelum Anda menekan tombol Update; 2) Lakukan backup data dengan menekan tombol download!; ",-1)),a(v,{style:{"max-width":"150px"},class:"col bg-green-8 q-ml-md",label:"Update Domisili",glossy:"","no-caps":"",dense:"",outline:"",icon:"settings_applications",disable:!u.value.length>0,onClick:C},null,8,["disable"])]),_:1}),a(G,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l)},{default:e(()=>[a(sa,{data:o.value,onSuccessDelete:r,onSuccessSubmit:r},null,8,["data"])]),_:1},8,["modelValue"])]),_:1})}}};export{$a as default};
