import{Q as B}from"./QSelect-xTRYeUSd.js";import{q as c,E as b,c as Q,o as d,w as r,g as l,ae as $,f as H,G as O,Q as V,a8 as q,l as D,s as T,e as F,a,b as g,v as I,F as A,D as M,t as _,J as E}from"./index-B5O5P5Ry.js";import{Q as J}from"./QSpinnerFacebook-DnlNESo3.js";import{Q as L}from"./QMarkupTable-Co4iNoNd.js";import{a as R}from"./api-get-ZrjIYo6i.js";import{Q as j}from"./QForm-CF2UBXVT.js";import{l as G}from"./lists-store-BCZVVUEH.js";import{_ as K}from"./InputCurrency-9rY_nLkg.js";import{_ as z}from"./InputSelectArray-C6vzgilV.js";import{A as W}from"./ApiCrud-BhqBrU2G.js";import{u as X}from"./useCrudForm-CwtToDj4.js";import"./QChip-D4oaA5k_.js";import"./QItem-Cr1Dcaui.js";import"./QItemLabel-3gBEkM0R.js";import"./QMenu-D0kvENJP.js";import"./selection-fiEadeFU.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./index-CEzVsPZE.js";import"./index-ByMNP9F_.js";import"./api-error-YC6vo3yD.js";import"./ArrayCrud-CkcA-ixF.js";import"./DropDownAfter-LbchEByA.js";import"./QBtnDropdown-d4fuuhr1.js";import"./QBtnGroup-BtpXq10Z.js";import"./ClosePopup-C7wVtTS5.js";import"./Lists-B7r4Qy-D.js";import"./Api-B3PKpG0U.js";class Y extends W{constructor(){super("iuran-paket")}}const Z=new Y,ee={__name:"IuranPaketForm",props:{data:{type:Object,required:!1,default:()=>{}}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(P,{emit:p}){const u=P,m=p,f=G().getStateByKey("iuran"),n=c({...u.data}),k=c([...f]),x=!u.data?.id,{handleDelete:y,handleCreate:w,handleUpdate:N,loading:S}=X(Z,{emit:m,responseKey:"iuran_paket"}),s=i=>{const t=k.value.find(v=>v.val0===i);t&&(n.value.nominal=t.val1)},e=async()=>{const i=JSON.parse(JSON.stringify(n.value));return delete i.id,x?await w(i,!0):await N(u.data.id,i,!0)},C=async()=>await y(u.data.id);return(i,t)=>{const v=b("FormHeader"),h=b("FormLoading"),U=b("FormActions");return d(),Q(D,{class:"full-width",style:{"max-width":"425px"}},{default:r(()=>[l(j,{onSubmit:$(e,["prevent"])},{default:r(()=>[l(v,{title:"Input Paket Iuran","is-new":x}),O(S)?(d(),Q(h,{key:0})):H("",!0),l(V,null,{default:r(()=>[l(q,{dense:"",class:"q-my-sm",outlined:"",modelValue:n.value.urut,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value.urut=o),label:"Nomor Urut",rules:[o=>!o||!isNaN(o)||"Hanya angka"]},null,8,["modelValue","rules"]),l(q,{dense:"",class:"q-my-sm",outlined:"",modelValue:n.value.paket,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value.paket=o),required:"",label:"Nama Paket",rules:[o=>!!o||"Harus diisi!"]},null,8,["modelValue","rules"]),l(z,{modelValue:n.value.item,"onUpdate:modelValue":[t[2]||(t[2]=o=>n.value.item=o),s],url:"iuran",label:"Nama Iuran",class:"q-my-sm"},null,8,["modelValue"]),l(K,{dense:"",class:"q-my-sm",outlined:"",modelValue:n.value.nominal,"onUpdate:modelValue":t[3]||(t[3]=o=>n.value.nominal=o),required:"",label:"Nominal",rules:[o=>!!o||"Harus diisi!"]},null,8,["modelValue","rules"])]),_:1}),l(U,{"btn-delete":!x,onOnDelete:C},null,8,["btn-delete"])]),_:1})]),_:1})}}},te={key:0},ae={colspan:"7",class:"text-center bg-grey-1 no-padding"},le={key:1},ne={key:2},oe={class:"text-center"},se={class:"text-left"},re={class:"text-left"},ue={class:"text-right"},ie={class:"text-center"},de={class:"bg-green-1"},me={class:"text-right text-bold"},Ae={__name:"PageIndex",setup(P){const p=c(!1),u=c([]),m=c(""),f=c(!1),n=c({});async function k(){const s=await R({endPoint:"iuran-paket",loading:p});s&&(u.value=s.iuran_paket)}T(async()=>{await k()});function x(){const s=u.value.map(e=>e.paket);return Array.from(new Set(s))}function y(){return u.value.filter(s=>s.paket==m.value)}function w(){return y().reduce(function(s,e){return s+Number(e.nominal)},0)}function N(){n.value={paket:m.value},f.value=!0}function S(s){n.value=s,f.value=!0}return(s,e)=>{const C=b("CardHeader"),i=b("CardPage");return d(),Q(i,null,{default:r(()=>[l(C,{title:"Pengaturan Paket Iuran",onOnReload:k}),l(V,{class:"q-pa-sm"},{default:r(()=>[l(D,{style:{"max-width":"800px"},flat:"",bordered:""},{default:r(()=>[l(V,{class:"q-pa-sm flex justify-between"},{default:r(()=>[l(B,{label:"Pilih nama paket",dense:"",outlined:"",options:x(),loading:p.value,modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),clearable:"",style:{width:"250px","min-width":"200px"}},null,8,["options","loading","modelValue"]),l(F,{dense:"",icon:"add",label:"Baru",color:"green-10","no-caps":"",outline:"",class:"q-px-sm",title:"Buat/tambahkan data baru",onClick:e[1]||(e[1]=t=>N())})]),_:1}),l(V,{class:"q-pa-sm"},{default:r(()=>[l(L,{flat:"",bordered:""},{default:r(()=>[e[9]||(e[9]=a("thead",null,[a("tr",null,[a("th",{class:"text-center"},"No"),a("th",{class:"text-left"},"Nama Paket"),a("th",{class:"text-left"},"Iuran"),a("th",{class:"text-right"},"Nominal"),a("th",{class:"text-center"},"Edit")])],-1)),a("tbody",null,[p.value?(d(),g("tr",te,[a("td",ae,[l(J,{color:"green",size:"md",class:"text-center flex flex-center q-mx-auto"})])])):!u.value.length&&!p.value?(d(),g("tr",le,[...e[5]||(e[5]=[a("td",{colspan:"7",class:"text-center text-italic text-negative bg-red-2"},[I(" Tidak ada data untuk ditampikan!"),a("br"),I(" Silakan Tambahkan data baru! ")],-1)])])):m.value?(d(!0),g(A,{key:3},M(y(),(t,v)=>(d(),g("tr",{key:v},[a("td",oe,_(t.urut),1),a("td",se,_(t.paket),1),a("td",re,_(t.item),1),a("td",ue,_(t.nominal.toRupiah()),1),a("td",ie,[l(F,{icon:"edit",flat:"",color:"green-10",onClick:h=>S(t)},null,8,["onClick"])])]))),128)):(d(),g("tr",ne,[...e[6]||(e[6]=[a("td",{colspan:"7",class:"text-center text-italic text-negative bg-red-1"}," Pilih filter! ",-1)])]))]),a("tfoot",null,[a("tr",de,[e[7]||(e[7]=a("td",{class:"text-right text-italic",colspan:"3"},"Total",-1)),a("td",me,_(w().toRupiah()),1),e[8]||(e[8]=a("td",{class:"text-center"},null,-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),l(E,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=t=>f.value=t)},{default:r(()=>[l(ee,{data:n.value,onSuccessSubmit:e[2]||(e[2]=t=>k()),onSuccessDelete:e[3]||(e[3]=t=>k())},null,8,["data"])]),_:1},8,["modelValue"])]),_:1})}}};export{Ae as default};
