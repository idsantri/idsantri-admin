import{Q as P}from"./QSelect-Bl7xxck0.js";import{A as h,c as y,o as x,w as g,a as t,g as c,G as Q,l as L,b as C,F as z,D as $,t as r,q as f,s as q,N as B,E as I,Q as w,C as F}from"./index-CywAldKl.js";import{I as K}from"./IzinPesantren-DkX3tq-x.js";import{C as V,p as j,a as E,b as N,B as U,c as H,L as M,d as R,S as G}from"./index-Bts1rPVa.js";import{A as J}from"./ArrayCrud-CkcA-ixF.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as A}from"./QMarkupTable-CTxn4HIt.js";import"./QField-CiR_afiF.js";import"./QChip-DVn2Kp_f.js";import"./QItem-C5PltTt6.js";import"./QItemLabel-BFoWDjd1.js";import"./QMenu-Cw0XRxru.js";import"./selection-DNdgDFiB.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./ApiCrud-iWe9qsRt.js";import"./Api-DNggAt6a.js";import"./index-DpzgZQa-.js";import"./index-BpCflRzf.js";import"./api-error-BDflpWxB.js";const Z={class:"chart-container",style:{position:"relative","min-height":"400px"}},W={__name:"StatistikChartAsrama",props:{asrama:Array},emits:["slice-click"],setup(b,{emit:_}){V.register(j,E,N,U,H,M);const n=b,d=_,m=h(()=>({labels:n.asrama.map(a=>`Asrama ${a.asrama}`),datasets:[{label:"Total Terlambat",data:n.asrama.map(a=>parseInt(a.total_late)),backgroundColor:"lightcoral"},{label:"Total Disiplin",data:n.asrama.map(a=>{const s=parseInt(a.total_izin),u=parseInt(a.total_late);return s-u}),backgroundColor:"#00FA9A"}]})),o=h(()=>"Data Izin dan Keterlambatan per Asrama"+(n.asrama?.length>0?` (${n.asrama[0]?.th_ajaran_h} H)`:"")),l=h(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:o.value},tooltip:{callbacks:{footer:e=>{const a=e[0].dataIndex;return`Total Izin: ${parseInt(n.asrama[a].total_izin)}`}}}},scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:"Jumlah"}}},onClick:(e,a)=>{if(a.length>0){const s=a[0].index;d("slice-click",n.asrama[s])}else d("slice-click",null)}}));return(e,a)=>(x(),y(L,{flat:"",bordered:"",class:"container"},{default:g(()=>[t("div",Z,[c(Q(R),{data:m.value,options:l.value},null,8,["data","options"])])]),_:1}))}},X=O(W,[["__scopeId","data-v-bda51058"]]),Y=["onClick"],tt={class:"text-center"},at={class:"text-right"},et={class:"text-right"},st={class:"text-right"},lt={class:"text-right"},ot={class:"bg-green-1"},rt={class:"text-right text-bold"},nt={class:"text-right text-bold"},it={class:"text-right text-bold"},ct={class:"text-right text-bold"},dt={__name:"StatistikTabelAsrama",props:{asrama:Array},emits:["rowClick"],setup(b,{emit:_}){const n=b,d=_,m=h(()=>n.asrama.map(e=>{const a=parseInt(e.total_izin),s=parseInt(e.total_late),u=a-s,v=a>0?(s/a*100).toFixed(1):0;return{asrama:e.asrama,totalIzin:a,totalDisiplin:u,totalLate:s,persenLate:v}})),o=h(()=>{const e=m.value.reduce((v,i)=>v+i.totalLate,0),a=m.value.reduce((v,i)=>v+i.totalIzin,0),s=a-e,u=a>0?(e/a*100).toFixed(1):0;return{totalLate:e,totalIzin:a,totalDisiplin:s,totalPersenLate:u}}),l=e=>{d("rowClick",e)};return(e,a)=>(x(),C("div",null,[a[2]||(a[2]=t("div",{class:"bg-green-1 text-green-10 text-overline text-center"},"Tabel Asrama (Total)",-1)),c(A,{flat:"",bordered:"",class:"q-my-sm"},{default:g(()=>[a[1]||(a[1]=t("thead",{class:"bg-green-2"},[t("tr",null,[t("th",null,"Asrama"),t("th",{class:"text-right"},"Izin"),t("th",{class:"text-right"},"Disiplin"),t("th",{class:"text-right"},"Terlambat"),t("th",{class:"text-right"},"% Terlambat")])],-1)),t("tbody",null,[(x(!0),C(z,null,$(m.value,s=>(x(),C("tr",{key:s.asrama,onClick:u=>l(s)},[t("td",tt,r(s.asrama),1),t("td",at,r(s.totalIzin),1),t("td",et,r(s.totalDisiplin),1),t("td",st,r(s.totalLate),1),t("td",lt,r(s.persenLate)+"%",1)],8,Y))),128))]),t("tfoot",ot,[t("tr",null,[a[0]||(a[0]=t("td",{class:"text-center text-bold"},"Total",-1)),t("td",rt,r(o.value.totalIzin),1),t("td",nt,r(o.value.totalDisiplin),1),t("td",it,r(o.value.totalLate),1),t("td",ct,r(o.value.totalPersenLate)+" % ",1)])])]),_:1}),a[3]||(a[3]=t("div",{class:"q-pa-sm bg-green-2 text-center text-green-10"},"Klik baris untuk filter kamar",-1))]))}},ut=["onClick"],pt={class:"text-left"},mt={class:"text-right"},_t={class:"text-right"},gt={class:"text-right"},ht={class:"text-right"},xt={class:"bg-green-1"},vt={class:"text-right text-bold"},ft={class:"text-right text-bold"},bt={class:"text-right text-bold"},kt={class:"text-right text-bold"},Ct={__name:"StatistikTabelKamar",props:{kamar:Array},setup(b){const _=b,n=h(()=>_.kamar.map(o=>{const l=parseInt(o.total_izin),e=parseInt(o.total_late),a=l-e,s=l>0?(e/l*100).toFixed(1):0;return{kamar:o.kamar,totalIzin:l,totalDisiplin:a,totalLate:e,persenLate:s}})),d=h(()=>{const o=n.value.reduce((s,u)=>s+u.totalLate,0),l=n.value.reduce((s,u)=>s+u.totalIzin,0),e=l-o,a=l>0?(o/l*100).toFixed(1):0;return{totalLate:o,totalIzin:l,totalDisiplin:e,totalPersenLate:a}}),m=o=>{console.log(o)};return(o,l)=>(x(),C("div",null,[l[2]||(l[2]=t("div",{class:"bg-green-1 text-green-10 text-overline text-center"},"Tabel Kamar (Total)",-1)),c(A,{flat:"",bordered:"",class:"q-my-sm"},{default:g(()=>[l[1]||(l[1]=t("thead",{class:"bg-green-2"},[t("tr",null,[t("th",{class:"text-left"},"Kamar"),t("th",{class:"text-right"},"Izin"),t("th",{class:"text-right"},"Disiplin"),t("th",{class:"text-right"},"Terlambat"),t("th",{class:"text-right"},"% Terlambat")])],-1)),t("tbody",null,[(x(!0),C(z,null,$(n.value,e=>(x(),C("tr",{key:e.kamar,onClick:a=>m(e)},[t("td",pt,r(e.kamar),1),t("td",mt,r(e.totalIzin),1),t("td",_t,r(e.totalDisiplin),1),t("td",gt,r(e.totalLate),1),t("td",ht,r(e.persenLate)+"%",1)],8,ut))),128))]),t("tfoot",xt,[t("tr",null,[l[0]||(l[0]=t("td",{class:"text-left text-bold"},"Total",-1)),t("td",vt,r(d.value.totalIzin),1),t("td",ft,r(d.value.totalDisiplin),1),t("td",bt,r(d.value.totalLate),1),t("td",kt,r(d.value.totalPersenLate)+" % ",1)])])]),_:1})]))}},It={class:"tw:flex tw:flex-col tw:gap-2 tw:w-full"},wt={class:"tw:grid tw:grid-cols-1 tw:sm:grid-cols-2 tw:gap-2"},Mt={__name:"IzinStatistik",setup(b){const _=f(null),n=f(!1),d=f(!1),m=f([]),o=f([]),l=f([]),e=f("");function a(){l.value=[],o.value=[],e.value=""}async function s(){try{n.value=!0;const i=await K.listThAjaran();m.value=J.sortPrimitiveArray(i.th_ajaran_h,"desc")}catch(i){console.error("ðŸš€ ~ getList ~ error:",i)}finally{n.value=!1}}q(async()=>{await s()});async function u(i){if(i)try{d.value=!0;const p=await G.izinPesantren(i);o.value=p.kamar,l.value=p.asrama}catch(p){console.error("ðŸš€ ~ get statistik ~ error:",p)}finally{d.value=!1}}B(_,async i=>{a(),i&&await u(i)});const v=h(()=>e.value?o.value.filter(i=>i.asrama.toUpperCase()===e.value.toUpperCase()):o.value);return(i,p)=>{const D=I("CardHeader"),T=I("CardLoading"),S=I("CardPage");return x(),y(S,null,{default:g(()=>[c(D,{title:"Statistik Izin Pesantren","show-reload":!1}),c(w,{class:"q-pa-sm"},{default:g(()=>[c(L,{bordered:"",flat:""},{default:g(()=>[c(w,{class:"q-pa-sm"},{default:g(()=>[c(P,{dense:"",modelValue:_.value,"onUpdate:modelValue":p[0]||(p[0]=k=>_.value=k),label:"Pilih Tahun Ajaran",class:"text-green-10",outlined:"",style:{"max-width":"300px"},behavior:"menu",options:m.value,loading:n.value,clearable:""},null,8,["modelValue","options","loading"])]),_:1}),c(F),c(w,{class:"q-pa-sm relative-position"},{default:g(()=>[c(T,{showing:d.value},null,8,["showing"]),t("div",It,[c(X,{asrama:l.value,onSliceClick:p[1]||(p[1]=k=>e.value=k?.asrama?k.asrama:"")},null,8,["asrama"]),t("div",wt,[c(dt,{class:"tw:col-span-1",asrama:l.value,onRowClick:p[2]||(p[2]=k=>e.value=k.asrama)},null,8,["asrama"]),c(Ct,{class:"tw:col-span-1",kamar:v.value},null,8,["kamar"])])])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Mt as default};
