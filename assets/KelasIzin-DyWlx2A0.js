import{q as o,ap as q,s as F,Y as U,E as b,c as C,o as D,w as f,g as l,af as $,f as x,G as z,Q as M,a9 as _,l as H,ad as Q,b as A,J as I}from"./index-BjwPH8FF.js";import{i as K,f as N,a as B}from"./format-date-DBaFa2rd.js";import{f as E,m as O}from"./hijri-m7PeZ38X.js";import{g as T}from"./array-object-BytDdNh7.js";import{_ as P}from"./TemplateArray-BOKb9xpI.js";import{Q as R}from"./QForm-B-tb8GAo.js";import{_ as S}from"./InputSelectArray-m6KANiN-.js";import{u as G}from"./useCrudForm-d1k0sjgN.js";import{A as L}from"./ApiCrud-ggAtBQJ_.js";import{_ as J}from"./ReportViewer-brLsp84N.js";import"./id-BuNGTsqN.js";import"./format-number-B34ySHL_.js";import"./QItem-CsqH32k4.js";import"./QItemLabel-BFTSoDAR.js";import"./QList-B01KHQyb.js";import"./QSelect-DG0UTNMZ.js";import"./QField-ByOWwheS.js";import"./QChip-DvWKrUSh.js";import"./QMenu-BekTf8G3.js";import"./selection-DiJ6Q-Vu.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./lists-store-MtkfrqvS.js";import"./ArrayCrud-DeaxgM1Q.js";import"./DropDownAfter-fp8kMr4A.js";import"./QBtnDropdown-DCLbnrW2.js";import"./QBtnGroup-UJjf5I6N.js";import"./ClosePopup-UiwGJ_I-.js";import"./Lists-Cka2Qv50.js";import"./Api-Dq7M9uDD.js";import"./index-C-UlpWnA.js";import"./index-nmeLrqlN.js";import"./apiPost-Bua6HjJD.js";class Y extends L{constructor(){super("izin-madrasah")}async riwayat(g){const i=await this._apiGet({endPoint:`${this._path}/kelas/${g}`});return this._showSuccess(i.message),i.data}}const j=new Y,W={__name:"IzinMadrasahForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(y,{emit:g}){const i=y,k=g,a=o({keperluan:"Sakit",durasi:1,...i.data}),e=!i.data?.id,d=q("firstInput");F(async()=>{await U(),d.value&&d.value.focus()});const{handleDelete:p,handleCreate:r,handleUpdate:h,loading:c}=G(j,{emit:k,responseKey:"izin_madrasah"}),V=async()=>{const m={kelas_id:a.value.kelas_id,dari_tgl:a.value.dari_tgl,durasi:a.value.durasi,keperluan:a.value.keperluan,keterangan:a.value.keterangan,catatan:a.value.catatan};return e?await r(m,!0):await h(i.data.id,m,!0)},w=async()=>await p(i.data.id);return(m,s)=>{const u=b("FormHeader"),n=b("FormLoading"),v=b("FormActions");return D(),C(H,{class:"full-width",style:{"max-width":"425px"}},{default:f(()=>[l(R,{onSubmit:$(V,["prevent"])},{default:f(()=>[l(u,{title:"Input Izin Madrasah","is-new":e}),z(c)?(D(),C(n,{key:0})):x("",!0),l(M,null,{default:f(()=>[l(_,{dense:"",class:"q-my-sm",outlined:"",label:"Nama","model-value":a.value?.nama+" ("+a.value?.santri_id+")",disable:"",filled:""},null,8,["model-value"]),l(_,{dense:"",class:"q-my-sm",outlined:"",label:"Data Kelas","model-value":a.value?.th_ajaran_h+" | "+a.value?.tingkat_id+" | "+a.value?.kelas,disable:"",filled:""},null,8,["model-value"]),l(_,{dense:"",hint:z(K)(a.value.dari_tgl)?z(N)(a.value.dari_tgl):"",class:"q-my-sm",outlined:"",label:"Tanggal (M)*",modelValue:a.value.dari_tgl,"onUpdate:modelValue":s[0]||(s[0]=t=>a.value.dari_tgl=t),type:"date",rules:[t=>!!t||"Harus diisi!"],"error-color":"negative",ref_key:"firstInput",ref:d},null,8,["hint","modelValue","rules"]),l(_,{dense:"",class:"q-my-sm",outlined:"",label:"Durasi (hari)*",modelValue:a.value.durasi,"onUpdate:modelValue":s[1]||(s[1]=t=>a.value.durasi=t),rules:[t=>!!t||"Harus diisi!",t=>!t||!isNaN(t)||"Hanya angka"],"error-color":"negative"},null,8,["modelValue","rules"]),l(S,{modelValue:a.value.keperluan,"onUpdate:modelValue":s[2]||(s[2]=t=>a.value.keperluan=t),url:"keperluan-izin",label:"Keperluan *",class:"q-my-sm",rules:[t=>!!t||"Harus diisi!"]},null,8,["modelValue","rules"]),l(S,{modelValue:a.value.keterangan,"onUpdate:modelValue":s[3]||(s[3]=t=>a.value.keterangan=t),url:"keterangan-izin",label:"Keterangan",class:"q-my-sm"},null,8,["modelValue"]),l(_,{dense:"",class:"q-my-sm",outlined:"",label:"Catatan",modelValue:a.value.catatan,"onUpdate:modelValue":s[4]||(s[4]=t=>a.value.catatan=t),autogrow:""},null,8,["modelValue"])]),_:1}),l(v,{"btn-delete":!e,onOnDelete:w},null,8,["btn-delete"])]),_:1})]),_:1})}}},qa={__name:"KelasIzin",setup(y){const i=Q().params,k=o([]),a=o([]),e=o({}),d=o(!1),p=o(!1),r=o({}),h=o("");async function c(){try{d.value=!0;const u=await j.riwayat(i.id);k.value=u.izin_madrasah,r.value=u.kelas,a.value=u.izin_madrasah.map(n=>({Tanggal:B(n.dari_tgl)+" | "+E(O(n.dari_tgl)),Durasi:n.durasi+" hari",Keperluan:n.keperluan+`${n.keterangan?.length>0?" ("+n.keterangan+")":""}`,Catatan:n.catatan,id:n.id}))}catch(u){console.error("ðŸš€ ~ loadData ~ error:",u)}finally{d.value=!1}}F(async()=>{await c()});const V=()=>{e.value={},e.value.santri_id=r.value.santri_id,e.value.nama=r.value.nama,e.value.th_ajaran_h=r.value.th_ajaran_h,e.value.tingkat_id=r.value.tingkat_id,e.value.kelas=r.value.kelas,e.value.kelas_id=r.value.id,p.value=!0},w=({id:u})=>{e.value={},e.value=T(k,u),e.value.santri_id=r.value.santri_id,e.value.nama=r.value.nama,e.value.th_ajaran_h=r.value.th_ajaran_h,e.value.tingkat_id=r.value.tingkat_id,e.value.kelas=r.value.kelas,p.value=!0},m=o(!1);function s(u){h.value=`reports/izin-madrasah/view?id=${u.id}}`,m.value=!0}return(u,n)=>(D(),A("div",null,[l(P,{data:a.value,spinner:d.value,"btn-print":!0,onAdd:V,onEdit:w,onPrint:s},null,8,["data","spinner"]),l(I,{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=v=>p.value=v)},{default:f(()=>[l(W,{data:e.value,onSuccessSubmit:c,onSuccessDelete:c},null,8,["data"])]),_:1},8,["modelValue"]),l(I,{modelValue:m.value,"onUpdate:modelValue":n[1]||(n[1]=v=>m.value=v)},{default:f(()=>[l(J,{url:h.value},null,8,["url"])]),_:1},8,["modelValue"])]))}};export{qa as default};
