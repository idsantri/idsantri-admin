import{B as o,C as w,c as D,o as z,w as v,g as l,ae as F,f as $,D as y,Q as j,a8 as c,l as U,ac as q,X as H,b as I,H as C}from"./index-BSwPLBvN.js";import{i as M,f as x,b as Q}from"./format-date-DlwYCgkJ.js";import{f as A,m as K}from"./hijri--5qD4USW.js";import{g as N}from"./array-object-BytDdNh7.js";import{a as B}from"./api-get-DLoYpnPD.js";import{_ as O}from"./TemplateArray-DMCxN__-.js";import{Q as P}from"./QForm-pLnIPDm5.js";import{_ as S}from"./InputSelectArray-CW313qGw.js";import{u as E}from"./useCrudForm-Di2BQFx5.js";import{A as G}from"./ApiCrud-CsgpJEPb.js";import{_ as L}from"./ReportViewer-BZTaVeVr.js";import"./id-BuNGTsqN.js";import"./format-number-B34ySHL_.js";import"./index-BaAeepf0.js";import"./index-DWKPJyX7.js";import"./api-error-CD6hOSn6.js";import"./QItemSection-WqxvrlOw.js";import"./QItemLabel-CIOWhTht.js";import"./QList-Dn-IYx8z.js";import"./QSelect-BjGQaI4Q.js";import"./QChip-Br_mmnnr.js";import"./QMenu-BnIg5_Ug.js";import"./selection-CiLPAPFJ.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./lists-store-BQBJ2JOd.js";import"./DropDownAfter-B_WHSSYE.js";import"./QBtnDropdown-C4ZtMkBn.js";import"./QBtnGroup-CFUVAF62.js";import"./ClosePopup-9H5qeAFV.js";import"./Lists-kDpWTKyN.js";import"./Api-gH9zfM44.js";class R extends G{constructor(){super("izin-madrasah")}async riwayat(_){const u=await this._apiGet({endPoint:`${this._path}/kelas/${_}`});return this._showSuccess(u.message),u.data}}const T=new R,X={__name:"IzinMadrasahForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(h,{emit:_}){const u=h,f=_,a=o({keperluan:"Sakit",durasi:1,...u.data}),t=!u.data?.id,{handleDelete:g,handleCreate:d,handleUpdate:s,loading:k}=E(T,{emit:f,responseKey:"izin_madrasah"}),m=async()=>{const p={kelas_id:a.value.kelas_id,dari_tgl:a.value.dari_tgl,durasi:a.value.durasi,keperluan:a.value.keperluan,keterangan:a.value.keterangan,catatan:a.value.catatan};return t?await d(p,!0):await s(u.data.id,p,!0)},V=async()=>await g(u.data.id);return(p,r)=>{const b=w("FormHeader"),i=w("FormLoading"),n=w("FormActions");return z(),D(U,{class:"full-width",style:{"max-width":"425px"}},{default:v(()=>[l(P,{onSubmit:F(m,["prevent"])},{default:v(()=>[l(b,{title:"Input Izin Madrasah","is-new":t}),y(k)?(z(),D(i,{key:0})):$("",!0),l(j,null,{default:v(()=>[l(c,{dense:"",class:"q-my-sm",outlined:"",label:"Nama","model-value":a.value?.nama+" ("+a.value?.santri_id+")",disable:"",filled:""},null,8,["model-value"]),l(c,{dense:"",class:"q-my-sm",outlined:"",label:"Data Kelas","model-value":a.value?.th_ajaran_h+" | "+a.value?.tingkat_id+" | "+a.value?.kelas,disable:"",filled:""},null,8,["model-value"]),l(c,{dense:"",hint:y(M)(a.value.dari_tgl)?y(x)(a.value.dari_tgl):"",class:"q-my-sm",outlined:"",label:"Tanggal (M)*",modelValue:a.value.dari_tgl,"onUpdate:modelValue":r[0]||(r[0]=e=>a.value.dari_tgl=e),type:"date",rules:[e=>!!e||"Harus diisi!"],"error-color":"negative"},null,8,["hint","modelValue","rules"]),l(c,{dense:"",class:"q-my-sm",outlined:"",label:"Durasi (hari)*",modelValue:a.value.durasi,"onUpdate:modelValue":r[1]||(r[1]=e=>a.value.durasi=e),rules:[e=>!!e||"Harus diisi!",e=>!e||!isNaN(e)||"Hanya angka"],"error-color":"negative"},null,8,["modelValue","rules"]),l(S,{modelValue:a.value.keperluan,"onUpdate:modelValue":r[2]||(r[2]=e=>a.value.keperluan=e),url:"keperluan-izin",label:"Keperluan *",class:"q-my-sm",rules:[e=>!!e||"Harus diisi!"]},null,8,["modelValue","rules"]),l(S,{modelValue:a.value.keterangan,"onUpdate:modelValue":r[3]||(r[3]=e=>a.value.keterangan=e),url:"keterangan-izin",label:"Keterangan",class:"q-my-sm"},null,8,["modelValue"]),l(c,{dense:"",class:"q-my-sm",outlined:"",label:"Catatan",modelValue:a.value.catatan,"onUpdate:modelValue":r[4]||(r[4]=e=>a.value.catatan=e),autogrow:""},null,8,["modelValue"])]),_:1}),l(n,{"btn-delete":!t,onOnDelete:V},null,8,["btn-delete"])]),_:1})]),_:1})}}},Fa={__name:"KelasIzin",setup(h){const u=q().params,f=o([]),a=o([]),t=o({}),g=o(!1),d=o(!1),s=o({}),k=o("");async function m(){const i=await B({endPoint:`izin-madrasah/kelas/${u.id}`,loading:g});i.izin_madrasah&&(f.value=i.izin_madrasah,s.value=i.kelas,a.value=i.izin_madrasah.map(n=>({Tanggal:Q(n.dari_tgl)+" | "+A(K(n.dari_tgl)),Durasi:n.durasi+" hari",Keperluan:n.keperluan+`${n.keterangan?.length>0?" ("+n.keterangan+")":""}`,Catatan:n.catatan,id:n.id})))}H(async()=>{await m()});const V=()=>{t.value={},t.value.santri_id=s.value.santri_id,t.value.nama=s.value.nama,t.value.th_ajaran_h=s.value.th_ajaran_h,t.value.tingkat_id=s.value.tingkat_id,t.value.kelas=s.value.kelas,t.value.kelas_id=s.value.id,d.value=!0},p=({id:i})=>{t.value={},t.value=N(f,i),t.value.santri_id=s.value.santri_id,t.value.nama=s.value.nama,t.value.th_ajaran_h=s.value.th_ajaran_h,t.value.tingkat_id=s.value.tingkat_id,t.value.kelas=s.value.kelas,d.value=!0},r=o(!1);function b(i){k.value=`reports/izin-madrasah/view?id=${i.id}}`,r.value=!0}return(i,n)=>(z(),I("div",null,[l(O,{data:a.value,spinner:g.value,"btn-print":!0,onAdd:V,onEdit:p,onPrint:b},null,8,["data","spinner"]),l(C,{modelValue:d.value,"onUpdate:modelValue":n[0]||(n[0]=e=>d.value=e)},{default:v(()=>[l(X,{data:t.value,onSuccessSubmit:m,onSuccessDelete:m},null,8,["data"])]),_:1},8,["modelValue"]),l(C,{modelValue:r.value,"onUpdate:modelValue":n[1]||(n[1]=e=>r.value=e)},{default:v(()=>[l(L,{url:k.value},null,8,["url"])]),_:1},8,["modelValue"])]))}};export{Fa as default};
