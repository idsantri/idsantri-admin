import{bb as Z,q as v,ae as J,bQ as aa,s as $,N as V,b as j,o as b,g as a,G as p,A as H,c as M,w as i,Q as w,v as D,e as c,C,a as s,F as K,D as R,t as h,m as P,l as O,a9 as Q,n as ea,J as ta,E as I}from"./index-B4cgRUYO.js";import{Q as E,a as L}from"./QToolbar-DqCGs045.js";import{Q as z}from"./QSpinnerBars-CN_p_zRA.js";import{Q as G}from"./QInnerLoading-BmWd7o5S.js";import{Q as W}from"./QMarkupTable-Cr886gAl.js";import{Q as X}from"./QSpace-BEBsQfW0.js";import{Q as S}from"./QSelect-Dur_NzhU.js";import{a as la}from"./api-get-B5No0uSU.js";import{l as T,g as B}from"./api-get-lists-D5RPgxrG.js";import{d as N,c as na}from"./index-C6wQ9iCE.js";import{_ as A}from"./InputSelectArray-DM1COeyS.js";import{_ as Y}from"./InputSelectTingkatPendidikan-C2VhUkHn.js";import{C as sa}from"./ClosePopup-CkPSupUz.js";import{a as ia}from"./api-post-DNWgPv1D.js";import"./QChip-DCEkVw4n.js";import"./QItem-2FhwRmS0.js";import"./QItemLabel-CwfJ-FXf.js";import"./QMenu-BvZtuO17.js";import"./selection-DzMKN9sr.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./index-GF_WWTiL.js";import"./api-error-B6W5wGpQ.js";import"./lists-store-DRjz9sb9.js";import"./ArrayCrud-CkcA-ixF.js";import"./DropDownAfter-Crv5EYdh.js";import"./QBtnDropdown-QOLI_zBn.js";import"./QBtnGroup-Ci2YXV4s.js";import"./Lists-B6wC9akJ.js";import"./ApiCrud-DvdKryYe.js";import"./Api-B2onMMsp.js";const q={th_ajaran_h:"",tingkat_id:"",kelas:""},y=Z("kenaikan-kelas",{state:()=>({murid:[],oldDataFilter:JSON.parse(JSON.stringify(q)),newDataFilter:JSON.parse(JSON.stringify(q))}),getters:{getMurid:r=>r.murid},actions:{resetMurid(){this.murid=[]},resetOldFilter(){this.oldDataFilter=JSON.parse(JSON.stringify(q))},resetNewFilter(){this.newDataFilter=JSON.parse(JSON.stringify(q))},addMurid(r){this.resetMurid(),r.forEach(t=>{this.murid.push({id:t.id,santri_id:t.santri_id,th_ajaran_h:t.th_ajaran_h,tingkat_id:t.tingkat_id,tingkat:t.tingkat,kelas:t.kelas,no_absen:t.no_absen,nama:t.nama,domisili:t.domisili,proses:!1,new_th_ajaran_h:null,new_tingkat_id:null,new_kelas:null,new_keterangan:null})})},addNewDataFilter(r){this.newDataFilter=r},addOldDataFilter(r){this.oldDataFilter=r},getMuridFalse(){return this.murid.filter(r=>r.proses==!1)},getMuridTrue(){return this.murid.filter(r=>r.proses==!0)},prosesTrue(r){if(!this.newDataFilter.th_ajaran_h)return N("Tentukan tahun ajaran baru");if(!this.newDataFilter.tingkat_id)return N("Tentukan tingkat pendidikan baru");if(!this.newDataFilter.kelas)return N("Tentukan kelas baru");const t=this.murid.findIndex(d=>d.id===r),e=this.murid[t];e.proses=!0,e.new_th_ajaran_h=this.newDataFilter.th_ajaran_h,e.new_tingkat_id=this.newDataFilter.tingkat_id,e.new_kelas=this.newDataFilter.kelas,e.new_keterangan=null},prosesFalse(r){const t=this.murid.findIndex(d=>d.id===r),e=this.murid[t];e.proses=!1,e.new_th_ajaran_h=null,e.new_tingkat_id=null,e.new_kelas=null,e.new_keterangan=null},deleteTrueProses(){const r=[];this.murid.forEach(t=>{t.proses||r.push(t)}),this.murid=r}},persist:!0}),ra={__name:"HeadLeft",props:{reload:{type:Boolean,default:!1}},emits:["onLoading"],setup(r,{emit:t}){const e=v([]),d=v([]),{oldDataFilter:l}=J(y()),m=v(!1),x=r,o=t,k=aa(x,"reload");$(async()=>{await F()});async function F(){const n=T().getThAjaran;if(n.length)e.value.th_ajaran=n;else{const g=await B({url:"kelas/lists",key:"th_ajaran",loadingArray:d});T().setThAjaran(g),e.value.th_ajaran=g}}async function f(n){const g=T().getTingkatByTahun(n);if(g.length)e.value.tingkat=g;else{const _=await B({url:"kelas/lists",params:{th_ajaran_h:n},key:"tingkat",loadingArray:d,sort:"asc"});T().addTingkatToTahun(_,n),e.value.tingkat=_}}async function u(n,g){const _=T().getKelasByTingkatAndTahun(n,g);if(_.length)e.value.kelas=_;else{const U=await B({url:"kelas/lists",params:{th_ajaran_h:g,tingkat_id:n},key:"kelas",loadingArray:d,sort:"asc"});T().addKelasToTingkatByTahun(U,n,g),e.value.kelas=U}}return V(()=>l.value.th_ajaran_h,async n=>{n&&(l.value.tingkat_id="",l.value.kelas="",await f(n),e.value.kelas=null)}),V(()=>l.value.tingkat_id,async n=>{n&&(l.value.kelas="",await u(n,l.value.th_ajaran_h))}),V(k,async()=>{e.value=[],y().resetOldFilter(),T().$reset(),await F()}),V(l,async n=>{if(y().addOldDataFilter(n),y().resetMurid(),n.th_ajaran_h&&n.tingkat_id&&n.kelas){n.status="Aktif",n.aktif=!0,o("onLoading",!0);const g=await la({endPoint:"kelas",params:n,loading:m});y().addMurid(g.murid),o("onLoading",!1)}},{deep:!0}),(n,g)=>(b(),j("div",null,[a(S,{"model-value":p(l).th_ajaran_h,"onUpdate:modelValue":g[0]||(g[0]=_=>p(l).th_ajaran_h=_.th_ajaran_h),options:e.value.th_ajaran,loading:d.value.th_ajaran,"option-value":"th_ajaran_h","option-label":"th_ajaran_h",outlined:"",dense:"",class:"",label:"Tahun Ajaran","hide-bottom-space":""},null,8,["model-value","options","loading"]),a(S,{"model-value":p(l).tingkat_id,"onUpdate:modelValue":g[1]||(g[1]=_=>p(l).tingkat_id=_.tingkat_id),options:e.value.tingkat,loading:d.value.tingkat,"option-value":"tingkat_id","option-label":"tingkat",outlined:"",dense:"",class:"q-mt-sm",label:"Tingkat"},null,8,["model-value","options","loading"]),a(S,{modelValue:p(l).kelas,"onUpdate:modelValue":g[2]||(g[2]=_=>p(l).kelas=_),options:e.value.kelas,loading:d.value.kelas,outlined:"",dense:"",class:"q-mt-sm",label:"Kelas"},null,8,["modelValue","options","loading"])]))}},oa={class:"text-right"},da={class:"text-center"},ua={class:"text-right"},ma={class:"text-caption text-italic"},ga={__name:"DataLeft",setup(r){const t=v(!1),e=v(!1),d=y(),l=H(()=>d.getMuridFalse());function m(){const x=l.value.length;if(!x)return;let o=0;e.value=!0,l.value.forEach(k=>{setTimeout(()=>{d.prosesTrue(k.id),o++,o===x&&(e.value=!1)},500)})}return(x,o)=>(b(),M(O,{class:"",flat:"",bordered:""},{default:i(()=>[a(w,{class:"q-pa-sm bg-green-7"},{default:i(()=>[a(E,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:i(()=>[a(L,{class:"text-subtitle1"},{default:i(()=>[...o[2]||(o[2]=[D(" Kelas Lama ",-1)])]),_:1}),a(c,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:o[0]||(o[0]=k=>t.value=!t.value)})]),_:1})]),_:1}),a(w,{class:"q-pa-sm"},{default:i(()=>[a(ra,{reload:t.value,onOnLoading:o[1]||(o[1]=k=>e.value=k)},null,8,["reload"])]),_:1}),a(C),a(w,{class:"q-pa-sm"},{default:i(()=>[a(W,{flat:"",bordered:"",style:{height:"500px"}},{default:i(()=>[s("thead",null,[s("tr",null,[o[3]||(o[3]=s("th",{class:"text-center"},"No.",-1)),o[4]||(o[4]=s("th",{class:"text-left"},"Nama",-1)),o[5]||(o[5]=s("th",{class:"text-left"},"Domisili",-1)),s("th",oa,[a(c,{icon:"keyboard_double_arrow_right",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!l.value.length,onClick:m},null,8,["disable"])])])]),s("tbody",null,[(b(!0),j(K,null,R(l.value,(k,F)=>(b(),j("tr",{key:F},[s("td",da,h(k.no_absen?String(k.no_absen).padStart(2,"0"):""),1),s("td",null,h(k.nama),1),s("td",null,h(k.domisili),1),s("td",ua,[a(c,{icon:"arrow_right",dense:"",outline:"",color:"green-10",glossy:"",onClick:f=>p(d).prosesTrue(k.id)},null,8,["onClick"])])]))),128))]),a(G,{showing:e.value},{default:i(()=>[a(z,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1})]),_:1}),a(C),a(P,{class:"bg-green-1"},{default:i(()=>[s("div",ma,[D(" Total: "+h(l.value.length)+" murid",1),o[6]||(o[6]=s("br",null,null,-1)),o[7]||(o[7]=D(" Hanya menampilkan murid dengan Kelas = Aktif dan Status = Aktif ",-1))]),a(X),o[8]||(o[8]=s("div",null,null,-1))]),_:1})]),_:1}))}},_a={__name:"HeadRight",setup(r){const{newDataFilter:t}=J(y());$(async()=>{e()});function e(){document.querySelectorAll("div.q-field__bottom.row.items-start.q-field__bottom").forEach(l=>l.remove())}return(d,l)=>(b(),j("div",null,[a(A,{modelValue:p(t).th_ajaran_h,"onUpdate:modelValue":l[0]||(l[0]=m=>p(t).th_ajaran_h=m),url:"tahun-ajaran",label:"Tahun Ajaran *",sort:"desc",class:"no-padding",disable:!!p(t).th_ajaran_h},null,8,["modelValue","disable"]),a(Y,{modelValue:p(t).tingkat_id,"onUpdate:modelValue":l[1]||(l[1]=m=>p(t).tingkat_id=m),label:"Tingkat Pendidikan *",class:"q-mt-sm no-padding",hint:null,disable:!!p(t).tingkat_id},null,8,["modelValue","disable"]),a(A,{modelValue:p(t).kelas,"onUpdate:modelValue":l[2]||(l[2]=m=>p(t).kelas=m),url:"kelas",label:"Kelas *",class:"q-mt-sm no-padding",disable:!!p(t).kelas},null,8,["modelValue","disable"])]))}},pa={__name:"EditNewMurid",props:{data:{type:Object,required:!0}},setup(r){const e=v(r.data);return(d,l)=>(b(),M(O,{class:"full-width",style:{"max-width":"425px"}},{default:i(()=>[a(w,{class:"bg-green-7 text-green-11 q-pa-sm"},{default:i(()=>[a(E,{class:"q-px-sm",style:{"min-height":"0"}},{default:i(()=>[a(L,{class:"text-subtitle1 text-green-11"},{default:i(()=>[...l[3]||(l[3]=[D(" Data Kelas Baru — ",-1),s("span",{class:"text-italic"},"Edit",-1)])]),_:1}),l[4]||(l[4]=s("span",{class:"text-italic text-caption"}," Auto Update ",-1))]),_:1})]),_:1}),a(w,null,{default:i(()=>[a(Q,{"model-value":e.value.nama+" ("+e.value.santri_id+")",class:"",disable:"",filled:"",dense:"",outlined:"",label:"Nama (ID)"},null,8,["model-value"]),a(Q,{"model-value":e.value.new_th_ajaran_h,class:"q-mt-sm",disable:"",filled:"",dense:"",outlined:"",label:"Tahun Ajaran (Baru) *"},null,8,["model-value"]),a(Y,{modelValue:e.value.new_tingkat_id,"onUpdate:modelValue":l[0]||(l[0]=m=>e.value.new_tingkat_id=m),label:"Tingkat Pendidikan (Baru) *",class:"q-mt-sm",selected:e.value.new_tingkat_id,rules:[m=>!!m||"Harus diisi!"],clearable:!1},null,8,["modelValue","selected","rules"]),a(A,{modelValue:e.value.new_kelas,"onUpdate:modelValue":l[1]||(l[1]=m=>e.value.new_kelas=m),url:"kelas",label:"Kelas (Baru) *",class:"q-mt-sm",rules:[m=>!!m||"Harus diisi!"],clearable:!1},null,8,["modelValue","rules"]),a(Q,{modelValue:e.value.new_keterangan,"onUpdate:modelValue":l[2]||(l[2]=m=>e.value.new_keterangan=m),class:"q-mt-sm",dense:"",outlined:"",label:"Keterangan (Baru)",autogrow:!0},null,8,["modelValue"])]),_:1}),a(P,{align:"right",class:"bg-green-6"},{default:i(()=>[ea(a(c,{label:"Tutup",color:"green-11","no-caps":"",outline:""},null,512),[[sa]])]),_:1})]),_:1}))}},fa={class:"text-left"},ka={class:"text-right"},ca={class:"text-left"},ha={class:"text-right"},ba={class:"text-caption text-italic"},va={__name:"DataRight",setup(r){const t=y(),e=H(()=>t.getMuridTrue()),d=v(!1),l=v(!1),m=v({});function x(){const f=e.value.length;if(!f)return;let u=0;d.value=!0,e.value.forEach(n=>{setTimeout(()=>{t.prosesFalse(n.id),u++,u===f&&(d.value=!1)},500)})}function o(){t.resetNewFilter(),x()}function k(f){m.value=f,l.value=!0}async function F(){let f="";if(f+="<hr/>",f+='<p style="margin:0">Tahun Ajaran Baru: <strong>'+e.value[0].new_th_ajaran_h+"</strong></p>",f+="<hr/>",f+="Pastikan Anda sudah meneliti dengan seksama:",f+=`<ul style="margin:0">
		<li>— Tingkat Pendidikan</li>
		<li>— Kelas</li>
		</ul>
		`,f+="<strong>Pada setiap barisnya!</strong>",!await na(f,!0))return;const n=e.value.map(_=>({santri_id:_.santri_id,th_ajaran_h:_.new_th_ajaran_h,tingkat_id:_.new_tingkat_id,kelas:_.new_kelas,keterangan:_.new_keterangan}));await ia({endPoint:"kelas/kenaikan",loading:d,data:{murid:n}})&&(t.deleteTrueProses(),t.newDataFilter.tingkat_id="",t.newDataFilter.kelas="")}return(f,u)=>(b(),j(K,null,[a(O,{class:"",flat:"",bordered:""},{default:i(()=>[a(w,{class:"q-pa-sm bg-green-7"},{default:i(()=>[a(E,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:i(()=>[a(L,{class:"text-subtitle1"},{default:i(()=>[...u[1]||(u[1]=[D(" Kelas Baru ",-1)])]),_:1}),a(c,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:o})]),_:1})]),_:1}),a(w,{class:"q-pa-sm"},{default:i(()=>[a(_a)]),_:1}),a(C),a(w,{class:"q-pa-sm"},{default:i(()=>[a(W,{flat:"",bordered:"",style:{height:"500px"}},{default:i(()=>[s("thead",null,[s("tr",null,[s("th",fa,[a(c,{icon:"keyboard_double_arrow_left",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!e.value.length,onClick:x},null,8,["disable"])]),u[2]||(u[2]=s("th",{class:"text-left"},"Nama",-1)),u[3]||(u[3]=s("th",{class:"text-left"},"Domisili",-1)),u[4]||(u[4]=s("th",{class:"text-left"},"Tingkat*",-1)),u[5]||(u[5]=s("th",{class:"text-left"},"Kelas*",-1)),u[6]||(u[6]=s("th",{class:"text-left"},"Keterangan",-1)),s("th",ka,[a(c,{icon:"edit",dense:"",flat:"",disable:"",color:"green-10"})])])]),s("tbody",null,[(b(!0),j(K,null,R(e.value,(n,g)=>(b(),j("tr",{key:g},[s("td",ca,[a(c,{icon:"arrow_left",dense:"",outline:"",color:"green-10",glossy:"",onClick:_=>p(t).prosesFalse(n.id)},null,8,["onClick"])]),s("td",null,h(n.nama),1),s("td",null,h(n.domisili),1),s("td",null,h(n.new_tingkat_id),1),s("td",null,h(n.new_kelas),1),s("td",null,h(n.new_keterangan||"-"),1),s("td",ha,[a(c,{icon:"edit",dense:"",flat:"",color:"green-10",onClick:_=>k(n)},null,8,["onClick"])])]))),128))]),a(G,{showing:d.value},{default:i(()=>[a(z,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1})]),_:1}),a(C),a(P,{class:"bg-green-1"},{default:i(()=>[s("div",ba,[D(" Total: "+h(e.value.length)+" murid",1),u[7]||(u[7]=s("br",null,null,-1)),u[8]||(u[8]=D(" Pastikan data sudah benar-benar valid (kesalahan akan sulit diperbaiki). ",-1))]),a(X),s("div",null,[a(c,{label:"Proses","no-caps":"",icon:"save",color:"green-10",class:"text-green-11",disable:!e.value.length>0,onClick:F},null,8,["disable"])])]),_:1})]),_:1}),a(ta,{modelValue:l.value,"onUpdate:modelValue":u[0]||(u[0]=n=>l.value=n)},{default:i(()=>[a(pa,{data:m.value},null,8,["data"])]),_:1},8,["modelValue"])],64))}},wa={class:"col q-py-sm",style:{"min-width":"400px"}},xa={class:"col q-py-sm",style:{"min-width":"500px"}},ae={__name:"KenaikanKelas",setup(r){return $(()=>{const t=document.getElementById("toggle-drawer");t&&t.click()}),(t,e)=>{const d=I("CardHeader"),l=I("CardPage");return b(),M(l,null,{default:i(()=>[a(d,{title:"Modul Kenaikan Kelas","show-reload":!1}),a(w,{class:"no-padding full-width row no-wrap justify-between items-start content-start scroll q-gutter-x-sm"},{default:i(()=>[s("div",wa,[a(ga)]),s("div",xa,[a(va)])]),_:1})]),_:1})}}};export{ae as default};
