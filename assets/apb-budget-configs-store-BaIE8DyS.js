import{be as l}from"./index-CWye4qEt.js";import{A as d}from"./ApiCrud-Ci_9uIPb.js";import{A as i}from"./ArrayCrud-CByp4EUn.js";import{u as g}from"./apb-budgets-store-B9UA7eMq.js";class c extends d{constructor(){super("apb/budget-configs")}async listTahunAjaran(){return(await this._apiGet({endPoint:`${this._path}/lists/th-ajaran-h`})).data}}const o=new c,m=l("budget-configs-store",{state:()=>({loading:!1,loadingTh:!1,configs:[],total_budget:{},thAjaranH:[],filterText:"",filterTahun:"",filterCategory:""}),getters:{getConfigs:({configs:t,total_budget:a,filterCategory:e})=>{const r=t.map(s=>{const n=s.category=="BIAYA"?a?.budget_4*Number(s.limit||0)/100:a?.budget_5*Number(s.limit||0)/100;return{...s,limit_rp:n}});return e?r.filter(s=>s.category===e):r},categories:t=>{const a=t.configs.map(e=>e.category);return[...new Set(a)]},totalLimitCategory(){return this.filterCategory?this.configs.filter(t=>t.category===this.filterCategory).reduce((t,a)=>t+Number(a.limit),0).toFixed(2):0}},actions:{async loadListTahun(){try{this.loadingTh=!0;const t=await o.listTahunAjaran();this.thAjaranH=t.th_ajaran_h}catch(t){console.error(t)}finally{this.loadingTh=!1}},async loadByTahun(t){try{this.loading=!0;const a=await o.getAll({params:{th_ajaran_h:t}});this.configs=a.configs,this.total_budget=a.total_budget}catch(a){console.error("ðŸš€ ~ loadData ~ _err:",a)}finally{this.loading=!1}},updateBudgets(t){const a=g();a.budgets.filter(r=>r.th_ajaran_h===t.th_ajaran_h&&r.group===t.group).forEach(r=>{a.budgets=i.update(a.budgets,r.id,{locked:!!t.locked})})},async toggleLock(t,a){try{this.loading=!0,this.configs=i.update(this.configs,t,{locked:!!a});const e=await o.update({id:t,data:{locked:a}});this.updateBudgets(e.config)}catch(e){this.configs=i.update(this.configs,t,{locked:!a}),console.error("ðŸš€ ~ toggleHidden ~ err:",e)}finally{this.loading=!1}},async updateLimit(t,{oldValue:a,newValue:e}){try{this.loading=!0;const r=await o.update({id:t,data:{limit:e}});this.configs=i.update(this.configs,t,r.config)}catch(r){this.configs=i.update(this.configs,t,{limit:a}),console.error("ðŸš€ ~ toggleHidden ~ err:",r)}finally{this.loading=!1}}},persist:{storage:sessionStorage}});export{o as A,m as u};
