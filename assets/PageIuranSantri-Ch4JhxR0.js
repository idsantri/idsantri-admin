import{A as _,B as D,c as S,o as c,w as e,b as a,ad as K,e as L,C as U,Q,l as A,a2 as ma,a7 as H,y as N,a8 as pa,W as z,f as $,v as w,g as T,G as E,F as R,ab as J,H as ca,K as fa,V as va,a as m,t as j,z as na,af as aa,x as _a,a3 as ea,aa as sa,r as ga,bI as ka,bJ as ba,aj as ya}from"./index-Bjf6jOrL.js";import{Q as wa}from"./QSpace-CT-pwkHs.js";import{Q as oa}from"./QSpinnerCube-gZ5RTjBb.js";import{Q as xa}from"./QRouteTab-BbT6Cfz6.js";import{Q as Va}from"./QTabs-BtnDgiOP.js";import{a as M}from"./api-get-SNzLoUbu.js";import{Q as P,a as h}from"./QItemSection-D4HO8eJd.js";import{Q as C}from"./QItemLabel-Clz1Xits.js";import{Q as Y}from"./QList-DrJ2aexG.js";import{a as ta}from"./api-update-CBHu08Ks.js";import{c as ha}from"./format-date-DlwYCgkJ.js";import{Q as X}from"./QForm-CQ61mLzh.js";import{_ as ua}from"./InputCurrency-B2DtLOoj.js";import{_ as ia}from"./InputSelectSantriId-D8kOsYb_.js";import{_ as O}from"./InputSelectArray-DTVIQacW.js";import{u as $a}from"./useCrudForm-D9Qtfi7L.js";import{A as Sa}from"./ApiCrud-Cz799mD5.js";import{l as qa}from"./lists-store-Ddm_j1AX.js";import{r as la,d as Ca}from"./array-object-BytDdNh7.js";import{s as Ia,a as ja,b as Ua,c as Fa}from"./utils-CiaEZYac.js";import{Q as ra}from"./QBtnDropdown-CATaFFO-.js";import{C as B}from"./ClosePopup-Ced6Y-Os.js";import{a as W}from"./api-download-CVMK4Z0_.js";import{l as Pa}from"./loading-store-BkVX4bDB.js";import{_ as Qa}from"./ReportViewer-LM4oNrBP.js";import{_ as Da}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Q as Ta}from"./QToolbarTitle-DexAJwlS.js";import{Q as Aa}from"./QToolbar-Bk7787Iv.js";import{Q as La}from"./QSelect-BCDk0qVl.js";import{_ as Na}from"./CardSantriSimple-CNVgFgCm.js";import{_ as Ha}from"./InputSelectIuranPaket-Cz0A9xLI.js";import"./QResizeObserver-DNb83RcI.js";import"./rtl-DFPa-2ov.js";import"./index-DV84x6RN.js";import"./index-BRCx2Z00.js";import"./api-error-C_UMNjEa.js";import"./id-BuNGTsqN.js";import"./Santri-DUg8M8r9.js";import"./DropDownAfter-BWotgQpI.js";import"./Lists-DcfSSLIw.js";import"./Api-v4AqqFFf.js";import"./QBtnGroup-BZf-O_co.js";import"./QMenu-DO2tkYnP.js";import"./selection-C-yT_gHt.js";import"./QChip-CKBUwVMq.js";import"./format-CJebrXOQ.js";import"./QSkeleton-Dg6K1xsX.js";import"./QImg-B6Zk7vAt.js";import"./santri-store-CQA3wJKJ.js";import"./QSlideTransition-BiANi7-L.js";class Oa extends Sa{constructor(){super("iuran")}async setLunas({id:u,data:r,message:v}){if(!await this._notifyConfirm(v||"Update data ini?"))return!1;const t=await this._apiUpdate({endPoint:`${this._path}/${u}/lunas`,data:r});return this._showSuccess(t.message),t.data||!0}async storePaketSantri({data:u,message:r}){if(!await this._notifyConfirm(r||"Simpan data ini?"))return!1;const s=await this._apiPost({endPoint:`${this._path}/paket`,data:u});return this._showSuccess(s.message),s.data||!0}}const Z=new Oa,da={__name:"IuranForm",props:{data:{type:Object,required:!1,default:()=>{}},disableSantriId:{type:Boolean,default:!1},disableThAjaran:{type:Boolean,default:!1}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(q,{emit:u}){const r=q,v=u,s=qa().getStateByKey("iuran"),t=_({...r.data}),x=_([...s]),o=!r.data?.id,{handleDelete:p,handleCreate:g,handleUpdate:y,loading:I}=$a(Z,{emit:v,responseKey:"iuran"}),V=b=>{const d=x.value.find(l=>l.val0===b);d&&(t.value.nominal=d.val1)},i=async()=>{const b={santri_id:t.value.santri_id,th_ajaran_h:t.value.th_ajaran_h,item:t.value.item,nominal:t.value.nominal,via:t.value.via,keterangan:t.value.keterangan};return o?await g(b,!0):await y(r.data.id,b,!0)},f=async()=>await p(r.data.id);return(b,d)=>{const l=D("FormHeader"),n=D("FormLoading"),F=D("FormActions");return c(),S(N,{class:"full-width",style:{"max-width":"425px"}},{default:e(()=>[a(X,{onSubmit:K(i,["prevent"])},{default:e(()=>[a(l,{title:"Input Iuran","is-new":o}),U(I)?(c(),S(n,{key:0})):L("",!0),a(Q,null,{default:e(()=>[a(ia,{"active-only":!0,onEmitInput:d[0]||(d[0]=k=>Object.assign(t.value,k)),data:r.data,class:"q-my-sm"},null,8,["data"]),a(O,{modelValue:t.value.th_ajaran_h,"onUpdate:modelValue":d[1]||(d[1]=k=>t.value.th_ajaran_h=k),url:"tahun-ajaran",label:"Tahun Ajaran",sort:"desc",class:"q-my-sm",rules:[k=>!!k||"Harus diisi!"],selected:t.value.th_ajaran_h,disable:r.disableThAjaran},null,8,["modelValue","rules","selected","disable"]),a(O,{modelValue:t.value.item,"onUpdate:modelValue":[d[2]||(d[2]=k=>t.value.item=k),V],url:"iuran",label:"Nama Iuran",class:"q-my-sm"},null,8,["modelValue"]),a(ua,{dense:"",class:"q-my-sm",outlined:"",modelValue:t.value.nominal,"onUpdate:modelValue":d[3]||(d[3]=k=>t.value.nominal=k),required:"",label:"Nominal",rules:[k=>!!k||"Harus diisi!"]},null,8,["modelValue","rules"]),A(a(O,{modelValue:t.value.via,"onUpdate:modelValue":d[4]||(d[4]=k=>t.value.via=k),url:"metode-pembayaran",label:"Via",class:"q-my-sm"},null,8,["modelValue"]),[[ma,t.value.id&&t.value.lunas]]),a(H,{label:"Keterangan",modelValue:t.value.keterangan,"onUpdate:modelValue":d[5]||(d[5]=k=>t.value.keterangan=k),dense:"",outlined:"",class:"q-my-sm",autogrow:""},null,8,["modelValue"])]),_:1}),a(F,{"btn-delete":!o,onOnDelete:f},null,8,["btn-delete"])]),_:1})]),_:1})}}},Ba={__name:"DropDownPrint",props:{data:{}},setup(q){const{loadingMain:u}=pa(Pa()),r=_(""),v=_(!1),s=q,t=_("");z(()=>{t.value=new URLSearchParams(s.data).toString()});async function x(){await W({endPoint:`reports/iuran-card/download?${t.value}`,loading:u,fileName:"iuran-card",confirm:!0,message:"Download kartu iuran?"})}async function o(){await W({endPoint:`reports/iuran-cover/download?${t.value}`,loading:u,fileName:"iuran-cover",confirm:!0,message:"Download cover kartu iuran?"})}async function p(){await W({endPoint:`reports/iuran-kuitansi/download?${t.value}`,loading:u,fileName:"iuran-kuitansi",confirm:!0,message:"Download kuitansi iuran?"})}function g(){r.value=`reports/iuran-card/view?${t.value}`,v.value=!0}function y(){r.value=`reports/iuran-cover/view?${t.value}`,v.value=!0}function I(){r.value=`reports/iuran-kuitansi/view?${t.value}`,v.value=!0}return(V,i)=>(c(),$(R,null,[a(ra,{color:"green-11",label:"Cetak",icon:"print","no-caps":"",class:"text-green-10 q-px-md",dense:""},{default:e(()=>[a(Y,null,{default:e(()=>[A((c(),S(P,null,{default:e(()=>[a(h,null,{default:e(()=>[a(C,null,{default:e(()=>[...i[1]||(i[1]=[w("Kartu",-1)])]),_:1})]),_:1}),a(h,{avatar:""},{default:e(()=>[a(T,{icon:"download",flat:"",onClick:x})]),_:1}),a(h,{avatar:""},{default:e(()=>[a(T,{icon:"print",flat:"",onClick:g})]),_:1})]),_:1})),[[B]]),A((c(),S(P,null,{default:e(()=>[a(h,null,{default:e(()=>[a(C,null,{default:e(()=>[...i[2]||(i[2]=[w("Cover",-1)])]),_:1})]),_:1}),a(h,{avatar:""},{default:e(()=>[a(T,{icon:"download",flat:"",onClick:o})]),_:1}),a(h,{avatar:""},{default:e(()=>[a(T,{icon:"print",flat:"",onClick:y})]),_:1})]),_:1})),[[B]]),A((c(),S(P,null,{default:e(()=>[a(h,null,{default:e(()=>[a(C,null,{default:e(()=>[...i[3]||(i[3]=[w("Kuitansi",-1)])]),_:1})]),_:1}),a(h,{avatar:""},{default:e(()=>[a(T,{icon:"download",flat:"",onClick:p})]),_:1}),a(h,{avatar:""},{default:e(()=>[a(T,{icon:"print",flat:"",onClick:I})]),_:1})]),_:1})),[[B]])]),_:1})]),_:1}),a(E,{modelValue:v.value,"onUpdate:modelValue":i[0]||(i[0]=f=>v.value=f)},{default:e(()=>[a(Qa,{url:r.value},null,8,["url"])]),_:1},8,["modelValue"])],64))}},Ka={__name:"IuranLunasForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(q,{emit:u}){const r=q,v=u,s=_({...r.data}),t=_(!1),x=async()=>{try{t.value=!0;const o=await Z.setLunas({id:r.data.id,data:{via:s.value.via},message:"Iuran/tagihan lunas?"});o&&(document.getElementById("btn-close-form").click(),v("successSubmit",o?.iuran),v("successUpdate",o?.iuran))}catch(o){console.error("err set lunas ",o)}finally{t.value=!1}};return(o,p)=>{const g=D("FormHeader"),y=D("FormLoading"),I=D("FormActions");return c(),S(N,{class:"full-width",style:{"max-width":"425px"}},{default:e(()=>[a(X,{onSubmit:K(x,["prevent"])},{default:e(()=>[a(g,{title:"Set Iuran Lunas","is-new":!1}),t.value?(c(),S(y,{key:0})):L("",!0),a(Q,null,{default:e(()=>[a(H,{disable:"",label:"Nama",modelValue:s.value.nama,"onUpdate:modelValue":p[0]||(p[0]=V=>s.value.nama=V),dense:"",outlined:"",class:"q-my-sm"},null,8,["modelValue"]),a(H,{disable:"",label:"Tahun Ajaran",modelValue:s.value.th_ajaran_h,"onUpdate:modelValue":p[1]||(p[1]=V=>s.value.th_ajaran_h=V),dense:"",outlined:"",class:"q-my-sm"},null,8,["modelValue"]),a(H,{disable:"",label:"Nama Iuran",modelValue:s.value.item,"onUpdate:modelValue":p[2]||(p[2]=V=>s.value.item=V),dense:"",outlined:"",class:"q-my-sm"},null,8,["modelValue"]),a(ua,{disable:"",dense:"",class:"q-my-sm",outlined:"",modelValue:s.value.nominal,"onUpdate:modelValue":p[3]||(p[3]=V=>s.value.nominal=V),required:"",label:"Nominal"},null,8,["modelValue"]),a(O,{modelValue:s.value.via,"onUpdate:modelValue":p[4]||(p[4]=V=>s.value.via=V),url:"metode-pembayaran",label:"Via",class:"q-my-sm",rules:[V=>!!V||"Harus diisi!"]},null,8,["modelValue","rules"])]),_:1}),a(I,{"btn-delete":!1})]),_:1})]),_:1})}}},Ea={key:0},Ra={key:1},Ma={key:0},za={class:"",style:{"min-width":"250px","max-width":"300px"}},Ja={class:"text-right"},Ga={class:"text-right"},Wa={class:"text-right text-weight-bold"},Ya={class:"flex items-center q-gutter-x-sm"},Xa={class:"q-card--bordered rounded-borders q-px-sm"},Za={class:"q-card--bordered rounded-borders q-px-sm"},ae={class:"text-subtitle1 text-weight-bold"},ee={class:"flex flex-center"},te={key:1,class:"q-ma-lg"},le={__name:"IuranSantriByTh",setup(q){const{params:u}=J(),r=_(u.thAjaranH),v=_(u.id),s=_(!1),t=_([]),x=_(!1),o=_({}),p=ca("santri"),g=_(!1);function y(d){o.value=d,o.value.nama=p.value.nama,o.value.data_akhir=p.value.data_akhir,x.value=!0}async function I(){if(r.value&&v.value){const d=await M({endPoint:`iuran/santri/${v.value}`,params:{th_ajaran_h:r.value},loading:s});d&&(t.value=b(d.iuran))}}z(async()=>await I());async function V(d,l,n,F){await ta({endPoint:`iuran/${n.id}/cetak`,confirm:!1,notify:!1})||(t.value[F].cetak=d==1?0:1)}async function i(d,l,n,F){if(d)return f(n,F);const k=await ta({endPoint:`iuran/${n.id}/not-lunas`,message:"Iuran/tagihan TIDAK lunas?",loading:s});k?t.value[F]=k.iuran:t.value[F].isLunas=d!=!0}async function f(d,l){o.value=d,o.value.nama=p.value.nama,o.value.data_akhir=p.value.data_akhir,g.value=!0,t.value[l].isLunas=!1}fa(t,async(d,l)=>{await va();const n=b([...d]);JSON.stringify(n)!==JSON.stringify(l)&&(t.value=n)},{deep:!0});function b(d){return d.sort((l,n)=>l.lunas===null&&n.lunas===null?0:l.lunas===null?1:n.lunas===null?-1:new Date(l.lunas)-new Date(n.lunas)).map(l=>({...l,isLunas:!!l.lunas,show:Object.prototype.hasOwnProperty.call(l,"show")?l.show:!1}))}return(d,l)=>(c(),$(R,null,[s.value?(c(),$("div",Ea,[a(oa,{color:"green-12",size:"8em",class:"flex q-ma-lg q-mx-auto"})])):(c(),$("div",Ra,[t.value.length>0?(c(),$("div",Ma,[a(Y,null,{default:e(()=>[a(P,{class:"q-pa-sm bg-green-11"},{default:e(()=>[a(h,{class:"flex"},{default:e(()=>[m("table",za,[m("tbody",null,[m("tr",null,[l[6]||(l[6]=m("td",{class:"text-caption text-italic q-pr-md"}," Total Tagihan ",-1)),m("td",Ja,j(U(Ia)(t.value).toRupiah()),1)]),m("tr",null,[l[7]||(l[7]=m("td",{class:"text-caption text-italic q-pr-md"}," Total Pembayaran ",-1)),m("td",Ga,j(U(ja)(t.value).toRupiah()),1)]),m("tr",null,[l[8]||(l[8]=m("td",{class:"text-caption text-italic q-pr-md"}," Sisa Tagihan ",-1)),m("td",Wa,j(U(Ua)(t.value).toRupiah()),1)])])])]),_:1})]),_:1}),(c(!0),$(R,null,na(t.value,(n,F)=>(c(),$("div",{key:F},[a(P,{class:"q-px-sm",clickable:"",onClick:K(k=>n.show=!n.show,["stop"])},{default:e(()=>[a(h,null,{default:e(()=>[a(C,{overline:""},{default:e(()=>[w(j(n.item),1)]),_:2},1024),a(C,null,{default:e(()=>[w(j(n.nominal.toRupiah()),1)]),_:2},1024)]),_:2},1024),a(h,{side:""},{default:e(()=>[m("div",Ya,[m("div",Xa,[a(aa,{label:"Lunas",color:"green",class:"text-green-10",modelValue:n.isLunas,"onUpdate:modelValue":[k=>n.isLunas=k,(k,G)=>i(k,G,n,F)],"checked-icon":"check","unchecked-icon":"clear","true-value":!0,"false-value":!1},null,8,["modelValue","onUpdate:modelValue"])]),m("div",Za,[a(aa,{disable:!n.lunas,label:"Cetak",color:"green",class:"text-green-10",modelValue:n.cetak,"onUpdate:modelValue":[k=>n.cetak=k,(k,G)=>V(k,G,n,F)],"checked-icon":"check","unchecked-icon":"clear","true-value":1,"false-value":0},null,8,["disable","modelValue","onUpdate:modelValue"])]),a(T,{icon:"edit",glossy:"",outline:"",dense:"",round:"",color:"green-8",unelevated:"",onClick:K(k=>y(n),["stop"])},null,8,["onClick"])])]),_:2},1024)]),_:2},1032,["onClick"]),n.show?(c(),S(P,{key:0,class:"q-px-sm q-pb-sm q-pt-none"},{default:e(()=>[a(h,null,{default:e(()=>[a(C,null,{default:e(()=>[l[9]||(l[9]=m("em",null,"Lunas:",-1)),w("  "+j(n.lunas?U(ha)(n.lunas,"'hari' EEEE, 'tanggal' dd MMMM yyyy, 'pukul' HH:mm"):"-"),1)]),_:2},1024),a(C,{caption:""},{default:e(()=>[l[10]||(l[10]=m("em",null,"Kasir:",-1)),l[11]||(l[11]=w(" ",-1)),m("strong",null,j(n.kasir||"-"),1),l[12]||(l[12]=w("; ",-1)),l[13]||(l[13]=m("em",null,"Via:",-1)),l[14]||(l[14]=w(" ",-1)),m("strong",null,j(n.via||"-"),1),l[15]||(l[15]=w("; ",-1)),l[16]||(l[16]=m("em",null,"Ket.:",-1)),l[17]||(l[17]=w(" ",-1)),m("strong",null,j(n.keterangan||"-"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):L("",!0),a(_a)]))),128)),a(P,{class:"q-pa-sm bg-green-8"},{default:e(()=>[a(h,{class:"text-green-11"},{default:e(()=>[a(C,{overline:"",class:"text-green-1"},{default:e(()=>[l[18]||(l[18]=w(" TOTAL CETAK ",-1)),m("span",ae,j(U(Fa)(t.value).toRupiah()),1)]),_:1})]),_:1}),a(h,{side:"",class:""},{default:e(()=>[m("div",ee,[a(Ba,{data:{santri_id:v.value,th_ajaran_h:r.value}},null,8,["data"])])]),_:1})]),_:1})]),_:1})])):(c(),$("div",te,[...l[19]||(l[19]=[m("div",{class:"text-body2 text-italic text-center"}," Tidak ada data untuk ditampilkan! ",-1),m("hr",null,null,-1),m("div",{class:"text-weight-thin text-italic text-center"}," Klik angka tahun disamping, atau tambahkan data! ",-1)])]))])),a(E,{modelValue:x.value,"onUpdate:modelValue":l[3]||(l[3]=n=>x.value=n)},{default:e(()=>[a(da,{data:o.value,onSuccessDelete:l[0]||(l[0]=n=>U(Ca)(t.value,n)),onSuccessCreate:l[1]||(l[1]=n=>t.value.push(n)),onSuccessUpdate:l[2]||(l[2]=n=>U(la)(t.value,n.id,n)),"disable-santri-id":!0,"disable-th-ajaran":!0},null,8,["data"])]),_:1},8,["modelValue"]),a(E,{modelValue:g.value,"onUpdate:modelValue":l[5]||(l[5]=n=>g.value=n)},{default:e(()=>[a(Ka,{data:o.value,onSuccessUpdate:l[4]||(l[4]=n=>U(la)(t.value,n.id,n))},null,8,["data"])]),_:1},8,["modelValue"])],64))}},ne={key:0},se={key:1,class:"row"},oe={class:"col bg-green-1",style:{"max-width":"90px"}},ue={class:"col"},ie={key:0,class:"q-ma-lg"},re={key:1},de={key:2,class:"q-ma-lg"},me={__name:"TabThAjaran",setup(q){const u=_([]),r=_(!1),{params:v}=J(),s=_([]);async function t(){const x=await M({endPoint:"iuran/santri/"+v.id,loading:r});x&&(u.value=x.iuran??[],s.value=u.value.map(o=>o.th_ajaran_h))}return z(async()=>{v.id&&await t()}),(x,o)=>r.value?(c(),$("div",ne,[a(oa,{color:"green-12",size:"8em",class:"flex q-ma-lg q-mx-auto"})])):u.value?.length>0?(c(),$("div",se,[m("div",oe,[a(Va,{vertical:"",dense:"",align:"left","no-caps":"","active-bg-color":"green-11"},{default:e(()=>[(c(!0),$(R,null,na(s.value,(p,g)=>(c(),$("div",{key:g},[a(xa,{name:p,label:p,to:`/iuran/santri/${U(v).id}/${p}`},null,8,["name","label","to"])]))),128))]),_:1})]),m("div",ue,[U(v).thAjaranH?(c(),$("div",re,[a(le)])):(c(),$("div",ie,[...o[0]||(o[0]=[m("div",{class:"text-italic text-center"}," Klik angka tahun disamping, atau tambahkan data! ",-1)])]))])])):(c(),$("div",de,[...o[1]||(o[1]=[m("div",{class:"text-body2 text-italic text-center"}," Tidak ada data untuk ditampilkan! ",-1),m("hr",null,null,-1),m("div",{class:"text-weight-thin text-italic text-center"},[w(" Yang bersangkutan belum pernah melakuan pembayaran. "),m("br"),w(" Silakan klik tombol tambah! ")],-1)])]))}},pe={};function ce(q,u){return c(),S(ra,{split:"",dense:"",label:"Tambah","no-caps":"",icon:"add",color:"green-10",padding:"xs sm","text-color":"green-11",onClick:u[1]||(u[1]=r=>q.$emit("onAdd"))},{default:e(()=>[a(Y,null,{default:e(()=>[A((c(),S(P,{clickable:"",onClick:u[0]||(u[0]=r=>q.$emit("showPaket"))},{default:e(()=>[a(h,{avatar:""},{default:e(()=>[a(ea,{name:"local_atm",color:"green"})]),_:1}),a(h,null,{default:e(()=>[a(C,null,{default:e(()=>[...u[2]||(u[2]=[w("Paket",-1)])]),_:1}),a(C,{caption:""},{default:e(()=>[...u[3]||(u[3]=[w("Pembayaran/Tagihan",-1)])]),_:1})]),_:1})]),_:1})),[[B]]),A((c(),S(P,{clickable:"",to:"/iuran/paket"},{default:e(()=>[a(h,{avatar:""},{default:e(()=>[a(ea,{name:"settings",color:"green"})]),_:1}),a(h,null,{default:e(()=>[a(C,null,{default:e(()=>[...u[4]||(u[4]=[w("Setting",-1)])]),_:1}),a(C,{caption:""},{default:e(()=>[...u[5]||(u[5]=[w("Atur Paket",-1)])]),_:1})]),_:1})]),_:1})),[[B]])]),_:1})]),_:1})}const fe=Da(pe,[["render",ce]]),ve={class:"flex content-start items-center",style:{"max-width":"1000px",width:"100%"}},_e={key:0,class:"q-pa-sm"},ge={key:1,class:"q-pa-sm text-negative"},ke={__name:"FilterSantri",props:{startUrl:String,activeOnly:{type:Boolean}},emits:["dataFilter"],setup(q,{emit:u}){const r=q,v=u,s=J(),t=sa(),x={id:s.params.id},o=_(x.id),p=_(!1),g=_([]),y=_(!1);z(async()=>{if(v("dataFilter",{display:'<div class="text-green-13 text-italic">Tentukan filter!</div>'}),o.value){const i=await M({endPoint:`santri/${o.value}`}),f={display:`
			➡️ ${o.value}
			| <strong>${i.santri.nama}</strong>
			| ${i.santri.data_akhir}
			`};v("dataFilter",f)}});function I(i){i?t.push(`${r.startUrl}/${i}`):t.push(`${r.startUrl}`)}async function V(i,f){if(!i){f(()=>{g.value=[]});return}const b=await M({endPoint:"santri/ids",loading:p,params:{active_only:!!r.activeOnly,q:i}});y.value=!b.lists.length,f(()=>g.value=b.lists,d=>{i!==""&&d.options.length&&(d.setOptionIndex(-1),d.moveOptionSelection(1,!0))})}return(i,f)=>(c(),S(N,null,{default:e(()=>[a(Q,{class:"q-px-sm q-py-sm bg-green-11"},{default:e(()=>[a(Aa,{class:"no-padding",style:{"min-height":"0"}},{default:e(()=>[a(Ta,{class:"text-subtitle1"},{default:e(()=>[...f[1]||(f[1]=[m("div",{class:"text-subtitle2 text-weight-bold"}," Filter ID Santri ",-1)])]),_:1}),ga(i.$slots,"default")]),_:3})]),_:3}),a(Q,{class:"no-padding"},{default:e(()=>[m("div",ve,[a(La,{class:"q-pa-sm",dense:"",outlined:"",label:"ID Santri",modelValue:o.value,"onUpdate:modelValue":[f[0]||(f[0]=b=>o.value=b),I],options:g.value,"emit-value":"","map-options":"","option-value":"id","option-label":"id","error-color":"negative",loading:p.value,"use-input":"",clearable:"",onFilter:V,behavior:"menu"},{option:e(b=>[a(P,ka(ba(b.itemProps)),{default:e(()=>[a(h,null,{default:e(()=>[a(C,null,{default:e(()=>[w(j(b.opt.id)+" — "+j(b.opt.nama),1)]),_:2},1024),a(C,{caption:""},{default:e(()=>[w(j(b.opt.data_akhir),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","loading"]),o.value?L("",!0):(c(),$("div",_e,"Ketikkan ID Santri")),y.value?(c(),$("div",ge," Data Tidak ditemukan ")):L("",!0)])]),_:1})]),_:3}))}},be={__name:"IuranPaketSantriForm",props:{data:{type:Object,required:!1,default:()=>{}},title:{type:String,default:()=>"Input"}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(q,{emit:u}){const r=q,v=u,s=_({...r.data}),t=_(!1),x=_([]),o=async()=>{const p=x.value.map(y=>({item:y.item,nominal:y.nominal})),g={santri_id:s.value.santri_id,th_ajaran_h:s.value.th_ajaran_h,keterangan:s.value.keterangan||"",paket:p};try{t.value=!0;const y=await Z.storePaketSantri({data:g,message:"PERHATIAN<br/>Jika item iuran sudah terdapat dalam daftar maka akan diabaikan."});y&&(document.getElementById("btn-close-form").click(),v("successSubmit",y?.iuran),v("successCreate",y?.iuran))}catch(y){console.error("err set paket iuran",y)}finally{t.value=!1}};return(p,g)=>{const y=D("FormHeader"),I=D("FormLoading"),V=D("FormActions");return c(),S(N,{class:"full-width",style:{"max-width":"425px"}},{default:e(()=>[a(X,{onSubmit:K(o,["prevent"])},{default:e(()=>[a(y,{title:"Modul Paket","is-new":!0}),t.value?(c(),S(I,{key:0})):L("",!0),a(Q,null,{default:e(()=>[a(ia,{"active-only":!0,onEmitInput:g[0]||(g[0]=i=>Object.assign(s.value,i)),data:r.data,class:"q-my-sm"},null,8,["data"]),a(O,{modelValue:s.value.th_ajaran_h,"onUpdate:modelValue":g[1]||(g[1]=i=>s.value.th_ajaran_h=i),url:"tahun-ajaran",label:"Tahun Ajaran",sort:"desc",class:"q-my-sm",rules:[i=>!!i||"Harus diisi!"],selected:s.value.th_ajaran_h,disable:r.disableThAjaran},null,8,["modelValue","rules","selected","disable"]),a(Ha,{class:"q-my-sm",onOnInput:g[2]||(g[2]=i=>x.value=i)}),a(H,{label:"Keterangan",modelValue:s.value.keterangan,"onUpdate:modelValue":g[3]||(g[3]=i=>s.value.keterangan=i),dense:"",outlined:"",class:"q-my-sm"},null,8,["modelValue"])]),_:1}),a(V,{"btn-delete":!1})]),_:1})]),_:1})}}},ye={class:"q-mt-sm"},gt={__name:"PageIuranSantri",setup(q){const{params:u}=J(),r=sa(),v=_({}),s=_(0),t=_({}),x=_(!1),o=_(!1),p=_({});ya("santri",p);function g(){t.value={santri_id:p.value.id,nama:p.value.nama,data_akhir:p.value.data_akhir,th_ajaran_h:u.thAjaranH||""}}function y(){g(),x.value=!0}function I(){g(),o.value=!0}const V=i=>{i.th_ajaran_h==u.thAjaranH&&s.value++,r.push(`/iuran/santri/${i.santri_id}/${i.th_ajaran_h}`)};return(i,f)=>(c(),$("div",null,[a(ke,{"start-url":"/iuran/santri",onDataFilter:f[0]||(f[0]=b=>v.value=b),"active-only":!1,bordered:"",flat:"",class:""}),m("div",ye,[U(u).id?(c(),S(Na,{key:0,id:U(u).id,onLoaded:f[1]||(f[1]=b=>p.value=b)},null,8,["id"])):(c(),S(N,{key:1,bordered:"",flat:""},{default:e(()=>[a(Q,{class:"q-pa-sm bg-green-11 text-subtitle2"},{default:e(()=>[...f[6]||(f[6]=[w(" No data ",-1)])]),_:1}),a(Q,{class:"q-pa-lg text-body1 text-center"},{default:e(()=>[...f[7]||(f[7]=[w(" Pilih Santri ",-1)])]),_:1})]),_:1}))]),a(N,{flat:"",bordered:"",class:"q-mt-sm"},{default:e(()=>[a(Q,{class:"q-pa-sm text-subtitle1 bg-green-6 text-green-11 flex items-center"},{default:e(()=>[f[8]||(f[8]=w(" Data Iuran ",-1)),a(wa),a(T,{icon:"sync",outline:"",dense:"",onClick:f[2]||(f[2]=b=>s.value++),class:"q-px-sm q-mr-sm"}),a(fe,{onOnAdd:y,onShowPaket:I})]),_:1}),a(Q,{class:"no-padding"},{default:e(()=>[(c(),S(me,{key:s.value}))]),_:1})]),_:1}),a(E,{modelValue:x.value,"onUpdate:modelValue":f[3]||(f[3]=b=>x.value=b)},{default:e(()=>[a(da,{data:t.value,onSuccessCreate:V,"disable-santri-id":!0},null,8,["data"])]),_:1},8,["modelValue"]),a(E,{modelValue:o.value,"onUpdate:modelValue":f[5]||(f[5]=b=>o.value=b)},{default:e(()=>[a(be,{data:t.value,onSuccessSubmit:f[4]||(f[4]=b=>s.value++)},null,8,["data"])]),_:1},8,["modelValue"])]))}};export{gt as default};
