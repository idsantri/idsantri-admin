import{q as F,ap as I,s as S,Y as j,E as c,c as f,o as h,w as m,g as o,af as k,f as x,G as B,Q,a9 as p,l as q,be as H}from"./index-CWye4qEt.js";import{Q as U}from"./QForm-BHvBL2Fw.js";import{u as N}from"./useCrudForm-NWLDtITy.js";import{A as i}from"./ApbTransaction-Sx6Ev9QD.js";import{A as y}from"./ArrayCrud-CByp4EUn.js";const G={__name:"ApbTransactionForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(a,{emit:t}){const n=a,g=t,e=F({...n.data}),l=!n.data?.id,d=I("firstInput");S(async()=>{await j(),d.value&&d.value.focus()});const{handleDelete:_,handleCreate:w,handleUpdate:b,loading:v}=N(i,{emit:g,responseKey:"transaction"}),A=async()=>{const u={description:e.value.description,by_name:e.value.by_name,note:e.value.note};return l?await w(u,!0):await b(n.data.id,u,!0)},T=async()=>await _(n.data.id);return(u,r)=>{const C=c("FormHeader"),V=c("FormLoading"),D=c("FormActions");return h(),f(q,{class:"full-width",style:{"max-width":"425px"}},{default:m(()=>[o(U,{onSubmit:k(A,["prevent"])},{default:m(()=>[o(C,{title:"Input Transaksi","is-new":l}),B(v)?(h(),f(V,{key:0})):x("",!0),o(Q,null,{default:m(()=>[o(p,{dense:"",class:"q-my-sm",outlined:"",label:"Keterangan",modelValue:e.value.description,"onUpdate:modelValue":r[0]||(r[0]=s=>e.value.description=s),autogrow:"",rules:[s=>!!s||"Harus diisi!"],ref_key:"firstInput",ref:d},null,8,["modelValue","rules"]),o(p,{dense:"",class:"q-my-sm",outlined:"",label:"Atas Nama",modelValue:e.value.by_name,"onUpdate:modelValue":r[1]||(r[1]=s=>e.value.by_name=s),autogrow:"",rules:[s=>!!s||"Harus diisi!"]},null,8,["modelValue","rules"]),o(p,{dense:"",class:"q-my-sm",outlined:"",label:"Catatan",modelValue:e.value.note,"onUpdate:modelValue":r[2]||(r[2]=s=>e.value.note=s),autogrow:""},null,8,["modelValue"])]),_:1}),o(D,{"btn-delete":!l,onOnDelete:T},null,8,["btn-delete"])]),_:1})]),_:1})}}},R=H("transactions-store",{state:()=>({transactions:[],loading:!1,loadingTh:!1,optionsThAjaran:[],thAjaranH:"",filter:"",startDate:"",endDate:""}),actions:{async listTahun(){try{this.loadingTh=!0;const a=await i.listTahunAjaran();this.optionsThAjaran=a.th_ajaran_h}catch(a){console.error(a)}finally{this.loadingTh=!1}},async loadByTahun(a){try{this.transactions=[],this.loading=!0;const t=await i.getAll({params:{th_ajaran_h:a}});this.transactions=t.transactions}catch(t){console.error("ðŸš€ ~ loadData ~ _err:",t)}finally{this.loading=!1}},add(a){this.transactions=y.updateOrCreate(this.transactions,a,"id","first")},remove(a){this.transactions=y.remove(this.transactions,a)},async loadById(a){try{this.loading=!0;const t=await i.getById({id:a});return this.add(t.transaction),t.transaction}catch(t){console.error("ðŸš€ ~ loadData ~ _err:",t)}finally{this.loading=!1}},async loadByDate(a,t){try{this.transactions=[],this.loading=!0;const n=await i.getAll({params:{start_date:a,end_date:t}});this.transactions=n.transactions}catch(n){console.error("ðŸš€ ~ loadData ~ _err:",n)}finally{this.loading=!1}}},persist:{storage:sessionStorage}});export{G as _,R as u};
