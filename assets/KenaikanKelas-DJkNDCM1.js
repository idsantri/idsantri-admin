import{Q as S}from"./QToolbarTitle-Bi7GnpK1.js";import{ay as Y,A as w,ac as I,bN as Z,W as P,K as q,f as D,o as v,b as a,C as _,q as J,c as L,w as i,Q as b,v as T,g as c,x as Q,a as s,F as M,z as R,t as h,k as E,y as C,a7 as $,l as aa,G as ea}from"./index-0PBDf7I0.js";import{Q as K}from"./QToolbar-CIornAnt.js";import{Q as ta}from"./QPage-B2JjDCGV.js";import{Q as H}from"./QSpinnerBars-CVXqukPZ.js";import{Q as z}from"./QInnerLoading-BCkgQo3N.js";import{Q as G}from"./QMarkupTable-s8nx6cOi.js";import{Q as W}from"./QSpace-BYMtWShY.js";import{Q as B}from"./QSelect-Cpr8vW2V.js";import{a as la}from"./api-get-CJU_3mwN.js";import{g as N}from"./api-get-lists-BbchY3y_.js";import{d as A,c as na}from"./index-BDNa_dSq.js";import{l as j}from"./lists-madrasah-store-k2SSsLMu.js";import{_ as O}from"./InputSelectArray-BGoSDEHL.js";import{_ as X}from"./InputSelectTingkatPendidikan-T6npfMRK.js";import{C as sa}from"./ClosePopup-5qpDiF0T.js";import{a as ia}from"./api-post-B8OlYMtG.js";import"./QChip-DG5_EyRB.js";import"./QItemSection-DpSW8XO7.js";import"./QItemLabel-DR97WW3U.js";import"./QMenu-3oalsLjd.js";import"./selection-DeDWR_N3.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./index-BXLuJznK.js";import"./api-error-C1WPqECD.js";import"./lists-store-C4dqSiKA.js";import"./DropDownAfter-f-uzuh2w.js";import"./QBtnDropdown-CEycuZRG.js";import"./QBtnGroup-BBlBx6YD.js";import"./Lists-B91eApHM.js";import"./ApiCrud-CgUuq5zB.js";import"./Api--YdEMrhi.js";const V={th_ajaran_h:"",tingkat_id:"",kelas:""},y=Y("kenaikan-kelas",{state:()=>({murid:[],oldDataFilter:JSON.parse(JSON.stringify(V)),newDataFilter:JSON.parse(JSON.stringify(V))}),getters:{getMurid:r=>r.murid},actions:{resetMurid(){this.murid=[]},resetOldFilter(){this.oldDataFilter=JSON.parse(JSON.stringify(V))},resetNewFilter(){this.newDataFilter=JSON.parse(JSON.stringify(V))},addMurid(r){this.resetMurid(),r.forEach(t=>{this.murid.push({id:t.id,santri_id:t.santri_id,th_ajaran_h:t.th_ajaran_h,tingkat_id:t.tingkat_id,tingkat:t.tingkat,kelas:t.kelas,no_absen:t.no_absen,nama:t.nama,domisili:t.domisili,proses:!1,new_th_ajaran_h:null,new_tingkat_id:null,new_kelas:null,new_keterangan:null})})},addNewDataFilter(r){this.newDataFilter=r},addOldDataFilter(r){this.oldDataFilter=r},getMuridFalse(){return this.murid.filter(r=>r.proses==!1)},getMuridTrue(){return this.murid.filter(r=>r.proses==!0)},prosesTrue(r){if(!this.newDataFilter.th_ajaran_h)return A("Tentukan tahun ajaran baru");if(!this.newDataFilter.tingkat_id)return A("Tentukan tingkat pendidikan baru");if(!this.newDataFilter.kelas)return A("Tentukan kelas baru");const t=this.murid.findIndex(u=>u.id===r),e=this.murid[t];e.proses=!0,e.new_th_ajaran_h=this.newDataFilter.th_ajaran_h,e.new_tingkat_id=this.newDataFilter.tingkat_id,e.new_kelas=this.newDataFilter.kelas,e.new_keterangan=null},prosesFalse(r){const t=this.murid.findIndex(u=>u.id===r),e=this.murid[t];e.proses=!1,e.new_th_ajaran_h=null,e.new_tingkat_id=null,e.new_kelas=null,e.new_keterangan=null},deleteTrueProses(){const r=[];this.murid.forEach(t=>{t.proses||r.push(t)}),this.murid=r}},persist:!0}),ra={__name:"HeadLeft",props:{reload:{type:Boolean,default:!1}},emits:["onLoading"],setup(r,{emit:t}){const e=w([]),u=w([]),{oldDataFilter:l}=I(y()),m=w(!1),x=r,o=t,k=Z(x,"reload");P(async()=>{await F()});async function F(){const n=j().getThAjaran;if(n.length)e.value.th_ajaran=n;else{const g=await N({url:"kelas/lists",key:"th_ajaran",loadingArray:u});j().setThAjaran(g),e.value.th_ajaran=g}}async function f(n){const g=j().getTingkatByTahun(n);if(g.length)e.value.tingkat=g;else{const p=await N({url:"kelas/lists",params:{th_ajaran_h:n},key:"tingkat",loadingArray:u,sort:"asc"});j().addTingkatToTahun(p,n),e.value.tingkat=p}}async function d(n,g){const p=j().getKelasByTingkatAndTahun(n,g);if(p.length)e.value.kelas=p;else{const U=await N({url:"kelas/lists",params:{th_ajaran_h:g,tingkat_id:n},key:"kelas",loadingArray:u,sort:"asc"});j().addKelasToTingkatByTahun(U,n,g),e.value.kelas=U}}return q(()=>l.value.th_ajaran_h,async n=>{n&&(l.value.tingkat_id="",l.value.kelas="",await f(n),e.value.kelas=null)}),q(()=>l.value.tingkat_id,async n=>{n&&(l.value.kelas="",await d(n,l.value.th_ajaran_h))}),q(k,async()=>{e.value=[],y().resetOldFilter(),j().$reset(),await F()}),q(l,async n=>{if(y().addOldDataFilter(n),y().resetMurid(),n.th_ajaran_h&&n.tingkat_id&&n.kelas){n.status="Aktif",n.aktif=!0,o("onLoading",!0);const g=await la({endPoint:"kelas",params:n,loading:m});y().addMurid(g.murid),o("onLoading",!1)}},{deep:!0}),(n,g)=>(v(),D("div",null,[a(B,{"model-value":_(l).th_ajaran_h,"onUpdate:modelValue":g[0]||(g[0]=p=>_(l).th_ajaran_h=p.th_ajaran_h),options:e.value.th_ajaran,loading:u.value.th_ajaran,"option-value":"th_ajaran_h","option-label":"th_ajaran_h",outlined:"",dense:"",class:"",label:"Tahun Ajaran","hide-bottom-space":""},null,8,["model-value","options","loading"]),a(B,{"model-value":_(l).tingkat_id,"onUpdate:modelValue":g[1]||(g[1]=p=>_(l).tingkat_id=p.tingkat_id),options:e.value.tingkat,loading:u.value.tingkat,"option-value":"tingkat_id","option-label":"tingkat",outlined:"",dense:"",class:"q-mt-sm",label:"Tingkat"},null,8,["model-value","options","loading"]),a(B,{modelValue:_(l).kelas,"onUpdate:modelValue":g[2]||(g[2]=p=>_(l).kelas=p),options:e.value.kelas,loading:u.value.kelas,outlined:"",dense:"",class:"q-mt-sm",label:"Kelas"},null,8,["modelValue","options","loading"])]))}},oa={class:"text-right"},da={class:"text-center"},ua={class:"text-right"},ma={class:"text-caption text-italic"},ga={__name:"DataLeft",setup(r){const t=w(!1),e=w(!1),u=y(),l=J(()=>u.getMuridFalse());function m(){const x=l.value.length;if(!x)return;let o=0;e.value=!0,l.value.forEach(k=>{setTimeout(()=>{u.prosesTrue(k.id),o++,o===x&&(e.value=!1)},500)})}return(x,o)=>(v(),L(C,{class:""},{default:i(()=>[a(b,{class:"q-pa-sm bg-green-7"},{default:i(()=>[a(K,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:i(()=>[a(S,{class:"text-subtitle1"},{default:i(()=>[...o[2]||(o[2]=[T(" Kelas Lama ",-1)])]),_:1}),a(c,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:o[0]||(o[0]=k=>t.value=!t.value)})]),_:1})]),_:1}),a(b,{class:"q-pa-sm"},{default:i(()=>[a(ra,{reload:t.value,onOnLoading:o[1]||(o[1]=k=>e.value=k)},null,8,["reload"])]),_:1}),a(Q),a(b,{class:"q-pa-sm"},{default:i(()=>[a(G,{flat:"",bordered:"",style:{height:"500px"}},{default:i(()=>[s("thead",null,[s("tr",null,[o[3]||(o[3]=s("th",{class:"text-center"},"No.",-1)),o[4]||(o[4]=s("th",{class:"text-left"},"Nama",-1)),o[5]||(o[5]=s("th",{class:"text-left"},"Domisili",-1)),s("th",oa,[a(c,{icon:"keyboard_double_arrow_right",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!l.value.length,onClick:m},null,8,["disable"])])])]),s("tbody",null,[(v(!0),D(M,null,R(l.value,(k,F)=>(v(),D("tr",{key:F},[s("td",da,h(k.no_absen?String(k.no_absen).padStart(2,"0"):""),1),s("td",null,h(k.nama),1),s("td",null,h(k.domisili),1),s("td",ua,[a(c,{icon:"arrow_right",dense:"",outline:"",color:"green-10",glossy:"",onClick:f=>_(u).prosesTrue(k.id)},null,8,["onClick"])])]))),128))]),a(z,{showing:e.value},{default:i(()=>[a(H,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1})]),_:1}),a(Q),a(E,{class:"bg-green-1"},{default:i(()=>[s("div",ma,[T(" Total: "+h(l.value.length)+" murid",1),o[6]||(o[6]=s("br",null,null,-1)),o[7]||(o[7]=T(" Hanya menampilkan murid dengan Kelas = Aktif dan Status = Aktif ",-1))]),a(W),o[8]||(o[8]=s("div",null,null,-1))]),_:1})]),_:1}))}},pa={__name:"HeadRight",setup(r){const{newDataFilter:t}=I(y());P(async()=>{e()});function e(){document.querySelectorAll("div.q-field__bottom.row.items-start.q-field__bottom").forEach(l=>l.remove())}return(u,l)=>(v(),D("div",null,[a(O,{modelValue:_(t).th_ajaran_h,"onUpdate:modelValue":l[0]||(l[0]=m=>_(t).th_ajaran_h=m),url:"tahun-ajaran",label:"Tahun Ajaran *",sort:"desc",class:"no-padding",disable:!!_(t).th_ajaran_h},null,8,["modelValue","disable"]),a(X,{modelValue:_(t).tingkat_id,"onUpdate:modelValue":l[1]||(l[1]=m=>_(t).tingkat_id=m),label:"Tingkat Pendidikan *",class:"q-mt-sm no-padding",hint:null,disable:!!_(t).tingkat_id},null,8,["modelValue","disable"]),a(O,{modelValue:_(t).kelas,"onUpdate:modelValue":l[2]||(l[2]=m=>_(t).kelas=m),url:"kelas",label:"Kelas *",class:"q-mt-sm no-padding",disable:!!_(t).kelas},null,8,["modelValue","disable"])]))}},_a={__name:"EditNewMurid",props:{data:{type:Object,required:!0}},setup(r){const e=w(r.data);return(u,l)=>(v(),L(C,{class:"full-width",style:{"max-width":"425px"}},{default:i(()=>[a(b,{class:"bg-green-7 text-green-11 q-pa-sm"},{default:i(()=>[a(K,{class:"q-px-sm",style:{"min-height":"0"}},{default:i(()=>[a(S,{class:"text-subtitle1 text-green-11"},{default:i(()=>[...l[3]||(l[3]=[T(" Data Kelas Baru â€” ",-1),s("span",{class:"text-italic"},"Edit",-1)])]),_:1}),l[4]||(l[4]=s("span",{class:"text-italic text-caption"}," Auto Update ",-1))]),_:1})]),_:1}),a(b,null,{default:i(()=>[a($,{"model-value":e.value.nama+" ("+e.value.santri_id+")",class:"",disable:"",filled:"",dense:"",outlined:"",label:"Nama (ID)"},null,8,["model-value"]),a($,{"model-value":e.value.new_th_ajaran_h,class:"q-mt-sm",disable:"",filled:"",dense:"",outlined:"",label:"Tahun Ajaran (Baru) *"},null,8,["model-value"]),a(X,{modelValue:e.value.new_tingkat_id,"onUpdate:modelValue":l[0]||(l[0]=m=>e.value.new_tingkat_id=m),label:"Tingkat Pendidikan (Baru) *",class:"q-mt-sm",selected:e.value.new_tingkat_id,rules:[m=>!!m||"Harus diisi!"],clearable:!1},null,8,["modelValue","selected","rules"]),a(O,{modelValue:e.value.new_kelas,"onUpdate:modelValue":l[1]||(l[1]=m=>e.value.new_kelas=m),url:"kelas",label:"Kelas (Baru) *",class:"q-mt-sm",rules:[m=>!!m||"Harus diisi!"],clearable:!1},null,8,["modelValue","rules"]),a($,{modelValue:e.value.new_keterangan,"onUpdate:modelValue":l[2]||(l[2]=m=>e.value.new_keterangan=m),class:"q-mt-sm",dense:"",outlined:"",label:"Keterangan (Baru)",autogrow:!0},null,8,["modelValue"])]),_:1}),a(E,{align:"right",class:"bg-green-6"},{default:i(()=>[aa(a(c,{label:"Tutup",color:"green-11","no-caps":"",outline:""},null,512),[[sa]])]),_:1})]),_:1}))}},fa={class:"text-left"},ka={class:"text-right"},ca={class:"text-left"},ha={class:"text-right"},va={class:"text-caption text-italic"},ba={__name:"DataRight",setup(r){const t=y(),e=J(()=>t.getMuridTrue()),u=w(!1),l=w(!1),m=w({});function x(){const f=e.value.length;if(!f)return;let d=0;u.value=!0,e.value.forEach(n=>{setTimeout(()=>{t.prosesFalse(n.id),d++,d===f&&(u.value=!1)},500)})}function o(){t.resetNewFilter(),x()}function k(f){m.value=f,l.value=!0}async function F(){let f="";if(f+="<hr/>",f+='<p style="margin:0">Tahun Ajaran Baru: <strong>'+e.value[0].new_th_ajaran_h+"</strong></p>",f+="<hr/>",f+="Pastikan Anda sudah meneliti dengan seksama:",f+=`<ul style="margin:0">
		<li>Tingkat Pendidikan</li>
		<li>Kelas</li>
		</ul>
		`,f+="<strong>Pada setiap barisnya!</strong>",!await na(f,!0))return;const n=e.value.map(p=>({santri_id:p.santri_id,th_ajaran_h:p.new_th_ajaran_h,tingkat_id:p.new_tingkat_id,kelas:p.new_kelas,keterangan:p.new_keterangan}));await ia({endPoint:"kelas/kenaikan",loading:u,data:{murid:n}})&&(t.deleteTrueProses(),t.newDataFilter.tingkat_id="",t.newDataFilter.kelas="")}return(f,d)=>(v(),D(M,null,[a(C,{class:""},{default:i(()=>[a(b,{class:"q-pa-sm bg-green-7"},{default:i(()=>[a(K,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:i(()=>[a(S,{class:"text-subtitle1"},{default:i(()=>[...d[1]||(d[1]=[T(" Kelas Baru ",-1)])]),_:1}),a(c,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:o})]),_:1})]),_:1}),a(b,{class:"q-pa-sm"},{default:i(()=>[a(pa)]),_:1}),a(Q),a(b,{class:"q-pa-sm"},{default:i(()=>[a(G,{flat:"",bordered:"",style:{height:"500px"}},{default:i(()=>[s("thead",null,[s("tr",null,[s("th",fa,[a(c,{icon:"keyboard_double_arrow_left",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!e.value.length,onClick:x},null,8,["disable"])]),d[2]||(d[2]=s("th",{class:"text-left"},"Nama",-1)),d[3]||(d[3]=s("th",{class:"text-left"},"Domisili",-1)),d[4]||(d[4]=s("th",{class:"text-left"},"Tingkat*",-1)),d[5]||(d[5]=s("th",{class:"text-left"},"Kelas*",-1)),d[6]||(d[6]=s("th",{class:"text-left"},"Keterangan",-1)),s("th",ka,[a(c,{icon:"edit",dense:"",flat:"",disable:"",color:"green-10"})])])]),s("tbody",null,[(v(!0),D(M,null,R(e.value,(n,g)=>(v(),D("tr",{key:g},[s("td",ca,[a(c,{icon:"arrow_left",dense:"",outline:"",color:"green-10",glossy:"",onClick:p=>_(t).prosesFalse(n.id)},null,8,["onClick"])]),s("td",null,h(n.nama),1),s("td",null,h(n.domisili),1),s("td",null,h(n.new_tingkat_id),1),s("td",null,h(n.new_kelas),1),s("td",null,h(n.new_keterangan||"-"),1),s("td",ha,[a(c,{icon:"edit",dense:"",flat:"",color:"green-10",onClick:p=>k(n)},null,8,["onClick"])])]))),128))]),a(z,{showing:u.value},{default:i(()=>[a(H,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1})]),_:1}),a(Q),a(E,{class:"bg-green-1"},{default:i(()=>[s("div",va,[T(" Total: "+h(e.value.length)+" murid",1),d[7]||(d[7]=s("br",null,null,-1)),d[8]||(d[8]=T(" Pastikan data sudah benar-benar valid (kesalahan akan sulit diperbaiki). ",-1))]),a(W),s("div",null,[a(c,{label:"Proses","no-caps":"",icon:"save",color:"green-10",class:"text-green-11",disable:!e.value.length>0,onClick:F},null,8,["disable"])])]),_:1})]),_:1}),a(ea,{modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=n=>l.value=n)},{default:i(()=>[a(_a,{data:m.value},null,8,["data"])]),_:1},8,["modelValue"])],64))}},wa={class:"row"},xa={class:"col-6 q-pa-sm"},ya={class:"col-6 q-pa-sm"},le={__name:"KenaikanKelas",setup(r){return P(()=>{const t=document.getElementById("toggle-drawer");t&&t.click()}),(t,e)=>(v(),L(ta,{class:"q-pa-sm"},{default:i(()=>[a(C,{class:"",style:{"min-width":"1200px"}},{default:i(()=>[a(b,{class:"bg-green-8 text-green-11 q-pa-sm"},{default:i(()=>[a(K,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:i(()=>[a(S,{class:"text-subtitle1"},{default:i(()=>[...e[1]||(e[1]=[T(" Modul Kenaikan Kelas ",-1)])]),_:1}),a(c,{"no-caps":"",label:"Kembali",icon:"reply",dense:"",class:"q-px-md",outline:"",onClick:e[0]||(e[0]=u=>t.$router.go(-1))})]),_:1})]),_:1}),a(b,{class:"no-padding"},{default:i(()=>[s("div",wa,[s("div",xa,[a(ga)]),s("div",ya,[a(ba)])])]),_:1})]),_:1})]),_:1}))}};export{le as default};
