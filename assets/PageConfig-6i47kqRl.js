import{Q as le}from"./QList-DxuGxdz8.js";import{Q as Y}from"./QSelect-BPcFPUdZ.js";import{h as re,y as ie,q as S,A as $,bM as de,Y as oe,bz as ce,k as P,e as J,ae as ne,s as z,E as R,c as T,o as C,w as a,g as e,b as me,n as K,G as f,F as fe,D as pe,v as V,t as v,ap as ge,af as be,f as G,Q as B,l as L,ad as ve,ac as _e,N as U,ag as H,a9 as W,p as X,a as Q,a4 as we,ay as ye,aq as he,aj as xe,J as ke}from"./index-BhNrssHr.js";import{Q as Ve}from"./QBtnDropdown-CKvAkW5R.js";import{Q as y}from"./QTd-DU4kbO1s.js";import{Q as Ce}from"./QMenu-lfUwDmLC.js";import{Q as Z}from"./QTooltip-Dp1sjQ0t.js";import{Q as Ae}from"./QTr-DzHltz0h.js";import{Q as Te}from"./QTable-DdL4Iw4p.js";import{A as qe,u as Qe}from"./apb-budget-configs-store-CwVjnG9p.js";import{Q as N}from"./QItemLabel-BODfowdk.js";import{Q as ee,a as te}from"./QItem-Cr1HBVIS.js";import{C as ae}from"./ClosePopup-Dc0LwGVK.js";import{u as Se}from"./apb-budgets-store-Crrai4p-.js";import{Q as je}from"./QForm-DomdkE2s.js";import{_ as Be}from"./InputSelectTahunAjaran-DWCw9OiC.js";import{c as Re}from"./index-DcSvzz47.js";import{T as Pe}from"./ToBudget-UfSufQH3.js";import{T as De}from"./ToAccount-BUXgstKw.js";import{T as Ne}from"./ToAccountAsset-xWpPFlXB.js";import{T as Le}from"./ToAccountGroup-CD6G1y4o.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QField-CTzMATWn.js";import"./QChip-3Bxr7esK.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./QBtnGroup-CWuo4TYS.js";import"./selection-Ar_MOr7D.js";import"./QMarkupTable-B4LKpcsr.js";import"./use-fullscreen-BaIuFIeg.js";import"./ApiCrud-Y9YyvD4T.js";import"./Api-AFAYKZcw.js";import"./index-BTJ4P_xk.js";import"./apiPost-Cy9rOp67.js";import"./ArrayCrud-DeaxgM1Q.js";import"./lists-store-Wjhiehi1.js";import"./DropDownAfter-BUGSFTKq.js";import"./Lists-cqCQ-d7A.js";function D(t,s=new WeakMap){if(Object(t)!==t)return t;if(s.has(t))return s.get(t);const u=t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t.source,t.flags):t instanceof Set?new Set:t instanceof Map?new Map:typeof t.constructor!="function"?Object.create(null):t.prototype!==void 0&&typeof t.prototype.constructor=="function"?t:new t.constructor;if(typeof t.constructor=="function"&&typeof t.valueOf=="function"){const i=t.valueOf();if(Object(i)!==i){const p=new t.constructor(i);return s.set(t,p),p}}return s.set(t,u),t instanceof Set?t.forEach(i=>{u.add(D(i,s))}):t instanceof Map&&t.forEach((i,p)=>{u.set(p,D(i,s))}),Object.assign(u,...Object.keys(t).map(i=>({[i]:D(t[i],s)})))}const Ee=re({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(t,{slots:s,emit:u}){const{proxy:i}=ie(),{$q:p}=i,g=S(null),c=S(""),r=S("");let m=!1;const b=$(()=>de({initialValue:c.value,validate:t.validate,set:d,cancel:_,updatePosition:w},"value",()=>r.value,x=>{r.value=x}));function d(){t.validate(r.value)!==!1&&(q()===!0&&(u("save",r.value,c.value),u("update:modelValue",r.value)),h())}function _(){q()===!0&&u("cancel",r.value,c.value),h()}function w(){oe(()=>{g.value.updatePosition()})}function q(){return ce(r.value,c.value)===!1}function h(){m=!0,g.value.hide()}function k(){m=!1,c.value=D(t.modelValue),r.value=D(t.modelValue),u("beforeShow")}function j(){u("show")}function I(){m===!1&&q()===!0&&(t.autoSave===!0&&t.validate(r.value)===!0?(u("save",r.value,c.value),u("update:modelValue",r.value)):u("cancel",r.value,c.value)),u("beforeHide")}function E(){u("hide")}function F(){const x=s.default!==void 0?[].concat(s.default(b.value)):[];return t.title&&x.unshift(P("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},t.title)),t.buttons===!0&&x.push(P("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[P(J,{flat:!0,color:t.color,label:t.labelCancel||p.lang.label.cancel,onClick:_}),P(J,{flat:!0,color:t.color,label:t.labelSet||p.lang.label.set,onClick:d})])),x}return Object.assign(i,{set:d,cancel:_,show(x){g.value?.show(x)},hide(x){g.value?.hide(x)},updatePosition:w}),()=>{if(t.disable!==!0)return P(Ce,{ref:g,class:"q-popup-edit",cover:t.cover,onBeforeShow:k,onShow:j,onBeforeHide:I,onHide:E,onEscapeKey:_},F)}}}),Fe={__name:"ConfigMenus",props:{config:{type:Object,required:!0}},setup(t){const s=t,u=Se(),{budgets:i,loading:p}=ne(u),g=$(()=>i.value.filter(r=>r.th_ajaran_h===s.config.th_ajaran_h&&r.group===s.config.group)),c=$(()=>g.value.reduce((r,m)=>r+Number(m.total_budget),0));return z(async()=>{g.value?.length||await u.loadByTahun(s.config.th_ajaran_h)}),(r,m)=>{const b=R("CardLoading");return C(),T(le,{class:"tw:bg-green-100/25",style:{"min-width":"200px"}},{default:a(()=>[e(b,{showing:f(p),message:""},null,8,["showing"]),(C(!0),me(fe,null,pe(g.value,d=>K((C(),T(ee,{clickable:"",onClick:_=>null,key:d.id,to:`/apb/budgets/${d.id}`},{default:a(()=>[e(te,null,{default:a(()=>[e(N,{caption:""},{default:a(()=>[V("["+v(d.account_id)+"] "+v(d.group)+": "+v(d.name),1)]),_:2},1024),e(N,{overline:"",class:"text-right"},{default:a(()=>[V(v(d?.total_budget?.toRupiah()),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["to"])),[[ae]])),128)),K((C(),T(ee,{class:"tw:bg-green-200"},{default:a(()=>[e(te,null,{default:a(()=>[e(N,{caption:""},{default:a(()=>[...m[0]||(m[0]=[V("Total Anggaran:",-1)])]),_:1}),e(N,{overline:"",class:"text-right"},{default:a(()=>[V(v(c.value.toRupiah())+":",1)]),_:1})]),_:1})]),_:1})),[[ae]])]),_:1})}}},Oe={__name:"ApbBudgetConfigForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(t,{emit:s}){const u=t,i=s,p=S({...u.data}),g=!u.data?.id,c=S(!1),r=ge("firstInput");z(async()=>{await oe(),r.value&&r.value.focus()});const m=async()=>{const d=`<hr><div class="text-bold q-py-sm">Buat Pengaturan Anggaran?</div><hr>
		<div class="text-italic q-mt-md">
			<div>PERHATIAN:</div>
			<ul style="list-style-type: square;" class="q-ml-md">
				<li>Buat Pengaturan Anggaran baru untuk tahun ajaran <strong>${p.value.th_ajaran_h}</strong>.</li>
				<li>Grup dan Tahun Ajaran bersifat unik (no duplicate). Data yang sudah ada TIDAK akan ditimpa.</li>
				<li>Aksi ini akan menyalin seluruh grup dengan kategori Pendapatan dan Biaya.</li>
				<li>Grup non aktif tidak akan disertakan.</li>
			</ul>
		</div>`;if(await Re(d))try{c.value=!0;const w=await qe.create({data:{th_ajaran_h:p.value.th_ajaran_h}});i("successSubmit",w),i("successCreate",w)}catch(w){console.error("Error creating data:",w)}finally{c.value=!1}},b=async()=>await handleDelete(u.data.id);return(d,_)=>{const w=R("FormHeader"),q=R("FormLoading"),h=R("FormActions");return C(),T(L,{class:"full-width",style:{"max-width":"425px"}},{default:a(()=>[e(je,{onSubmit:be(m,["prevent"])},{default:a(()=>[e(w,{title:"Buat Pengaturan Anggaran","is-new":g}),c.value?(C(),T(q,{key:0})):G("",!0),e(B,null,{default:a(()=>[e(Be,{modelValue:p.value.th_ajaran_h,"onUpdate:modelValue":_[0]||(_[0]=k=>p.value.th_ajaran_h=k),rules:[k=>!!k||"Harus diisi!"],class:"q-my-sm",ref_key:"firstInput",ref:r},null,8,["modelValue","rules"])]),_:1}),e(h,{"btn-delete":!g,onOnDelete:b},null,8,["btn-delete"])]),_:1})]),_:1})}}},Me={class:"text-subtitle2"},Ue={class:"text-subtitle2"},He={class:"text-pre-wrap"},$e={__name:"PageConfig",setup(t){const s=Qe(),u=S(!1),{loading:i,loadingTh:p,configs:g,total_budget:c,getConfigs:r,filterText:m,filterTahun:b,filterCategory:d,totalLimitCategory:_,thAjaranH:w,categories:q}=ne(s),{query:h}=ve(),k=_e(),j=S(!1),I=l=>{j.value=!1,g.value=l.configs,c.value=l.total_budget,b.value=l.total_budget.th_ajaran_h,u.value=!0},E=async()=>{await s.loadListTahun(),b.value&&(await s.loadByTahun(b.value),u.value=!0)},F=async(l,n)=>{await s.toggleLock(l,n)},x=async(l,{oldValue:n,newValue:O})=>{await s.updateLimit(l,{oldValue:n,newValue:O})};z(async()=>{w.value?.length||await s.loadListTahun(),h.th&&(b.value=h.th),h.category&&(d.value=h.category),h.text&&(m.value=h.text)}),U(b,async l=>{d.value="",m.value="",l?(k.replace({query:{th:l}}),await s.loadByTahun(l),u.value=!0):(k.replace({query:{}}),g.value=[],c.value={})}),U(d,async l=>{m.value="",k.replace({query:{category:l}})}),U(m,async l=>{k.replace({query:{text:l}})});const ue=[{name:"expand",label:"!",align:"center",field:"",sortable:!1},{name:"locked",label:"Kunci",align:"center",field:"locked",sortable:!1},{name:"th_ajaran_h",label:"Tahun Ajaran",align:"left",field:"th_ajaran_h",sortable:!1},{name:"category",label:"Kategori",align:"left",field:"category",sortable:!0},{name:"group",label:"Grup",align:"left",field:"group",sortable:!0},{name:"limit",label:"Limit/Target (%)",align:"right",field:l=>Number(l.limit),format:l=>`${l?.toFixed(2)??0}%`,sortable:!0},{name:"limit_rp",label:"Limit/Target (Rp)",align:"right",field:"limit_rp",format:l=>`${l?l.toRupiah(!0,2):0}`,sortable:!0},{name:"total_budget_group",label:"Dianggarkan (Rp)",align:"right",field:"total_budget_group",format:l=>`${l?l.toRupiah(!0,2):0}`,sortable:!0,classes:l=>l.category=="BIAYA"?Number(l.total_budget_group)>Number(l.limit_rp)?"text-negative":"text-primary":Number(l.total_budget_group)<Number(l.limit_rp)?"text-negative":"text-primary"}];return(l,n)=>{const O=R("CardHeader"),se=R("CardPage");return C(),T(se,null,{default:a(()=>[e(O,{title:"Konfigurasi Limitasi/Target Anggaran",onOnReload:E,"show-add":!0,onOnAdd:n[0]||(n[0]=o=>j.value=!0),"label-add":"Konfigurasi Baru","icon-add":"sym_o_create_new_folder"},{more:a(()=>[e(le,null,{default:a(()=>[e(Pe),e(De),e(Le),e(Ne)]),_:1})]),_:1}),e(B,{class:"q-pt-sm q-pb-none q-px-sm"},{default:a(()=>[e(L,{bordered:"",flat:"",class:""},{default:a(()=>[e(B,{class:"tw:grid tw:sm:flex tw:sm:justify-between tw:gap-2 q-pa-sm"},{default:a(()=>[e(Y,{dense:"",class:"tw:w-full tw:sm:max-w-sm",outlined:"",label:"Tahun Ajaran","emit-value":"","map-options":"",modelValue:f(b),"onUpdate:modelValue":n[1]||(n[1]=o=>H(b)?b.value=o:null),options:f(w),loading:f(p),clearable:"",behavior:"menu"},null,8,["modelValue","options","loading"]),e(Y,{dense:"",class:"tw:w-full tw:sm:max-w-sm",outlined:"",label:"Kategori Akun","emit-value":"","map-options":"",modelValue:f(d),"onUpdate:modelValue":n[2]||(n[2]=o=>H(d)?d.value=o:null),options:f(q),loading:f(i),clearable:"",behavior:"menu"},null,8,["modelValue","options","loading"]),e(W,{class:"tw:w-full tw:sm:max-w-sm",outlined:"",dense:"",debounce:"300",placeholder:"Cari data anggaran...",clearable:"",modelValue:f(m),"onUpdate:modelValue":n[3]||(n[3]=o=>H(m)?m.value=o:null)},{append:a(()=>[e(X,{name:"search"})]),_:1},8,["modelValue"])]),_:1}),e(B,{class:"tw:grid tw:sm:flex tw:sm:justify-between tw:gap-2 q-pa-sm bg-green-11 text-green-10"},{default:a(()=>[e(L,{bordered:"",flat:"",class:"tw:w-full tw:sm:max-w-sm tw:flex tw:items-center tw:justify-between bg-green-12 q-pa-sm"},{default:a(()=>[n[6]||(n[6]=Q("span",{class:"text-italic"},"Anggaran Pendapatan",-1)),n[7]||(n[7]=V("   ",-1)),Q("span",Me,v(f(c).budget_4?.toRupiah()),1)]),_:1}),e(L,{bordered:"",flat:"",class:"tw:w-full tw:sm:max-w-sm tw:flex tw:items-center tw:justify-between bg-green-12 q-pa-sm"},{default:a(()=>[n[8]||(n[8]=Q("span",{class:"text-italic"},"Anggaran Biaya",-1)),n[9]||(n[9]=V("   ",-1)),Q("span",Ue,v(f(c).budget_5?.toRupiah()),1)]),_:1})]),_:1}),K(e(B,{class:"bg-warning q-pa-xs text-black"},{default:a(()=>[...n[10]||(n[10]=[Q("div",{class:"text-caption text-center"}," Data tidak realtime! Klik tombol muat ulang untuk mendapatkan data terbaru. ",-1)])]),_:1},512),[[we,!u.value&&f(g).length]])]),_:1})]),_:1}),e(B,{class:"q-pa-sm"},{default:a(()=>[e(Te,{bordered:"",flat:"",rows:f(r),loading:f(i),"rows-per-page-options":[10,25,50,100,0],columns:ue,filter:f(m),"no-data-label":"Tidak ada data untuk ditampilkan!","no-results-label":"Tidak ditemukan kata kunci yang sesuai dengan pencarian Anda!","row-key":"id"},ye({"body-cell-expand":a(o=>[e(y,{props:o},{default:a(()=>[e(Ve,{"menu-self":"top start",color:"info",dense:"",size:"sm",outline:"",class:"q-px-sm",disabled:!o.row.total_budget_group>0},{default:a(()=>[e(Fe,{config:o.row},null,8,["config"])]),_:2},1032,["disabled"])]),_:2},1032,["props"])]),"body-cell-limit":a(o=>[e(y,{props:o},{default:a(()=>[Q("span",He,v(o.value),1),e(X,{name:"edit",color:"primary",class:"q-ml-xs"}),e(Ee,{modelValue:o.row.limit,"onUpdate:modelValue":A=>o.row.limit=A,buttons:"",onSave:(A,M)=>x(o.row.id,{newValue:Number(A),oldValue:Number(M)})},{default:a(A=>[e(W,{type:"number",modelValue:A.value,"onUpdate:modelValue":M=>A.value=M,dense:"",outline:"",autofocus:"",hint:"% dari anggaran pendapatan"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["props"])]),"body-cell-locked":a(o=>[e(y,{props:o},{default:a(()=>[e(he,{"model-value":o.value,"true-value":!0,"false-value":!1,color:"negative","unchecked-icon":"lock_open","checked-icon":"lock","onUpdate:modelValue":A=>F(o.row.id,A)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-limit_rp":a(o=>[e(y,{props:o},{default:a(()=>[o.row.category=="BIAYA"?(C(),T(Z,{key:0},{default:a(()=>[V(" Pendapatan ("+v(f(c).budget_4?.toRupiah())+") x "+v(o.row.limit)+"% ",1)]),_:2},1024)):G("",!0),o.row.category=="PENDAPATAN"?(C(),T(Z,{key:1},{default:a(()=>[V(" Biaya ("+v(f(c).budget_5?.toRupiah())+") x "+v(o.row.limit)+"% ",1)]),_:2},1024)):G("",!0),V(" "+v(o.value),1)]),_:2},1032,["props"])]),_:2},[f(d)?{name:"bottom-row",fn:a(()=>[e(Ae,{class:xe(["total-row",f(_)>100?"bg-red-2 text-red-10":"bg-green-11 text-green-10"])},{default:a(()=>[e(y,{class:""}),e(y,{class:""}),e(y,{class:""}),e(y,{class:""}),e(y,{class:""}),e(y,{class:"text-right"},{default:a(()=>[V(v(f(_))+"% ",1),n[11]||(n[11]=Q("span",{class:"q-pl-md"},null,-1))]),_:1}),e(y,{class:""}),e(y,{class:""})]),_:1},8,["class"])]),key:"0"}:void 0]),1032,["rows","loading","filter"])]),_:1}),e(ke,{persistent:"",modelValue:j.value,"onUpdate:modelValue":n[5]||(n[5]=o=>j.value=o)},{default:a(()=>[e(Oe,{data:{},onSuccessSubmit:n[4]||(n[4]=o=>I(o))})]),_:1},8,["modelValue"])]),_:1})}}},St=Ie($e,[["__scopeId","data-v-61b38186"]]);export{St as default};
