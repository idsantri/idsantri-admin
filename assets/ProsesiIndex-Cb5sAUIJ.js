import{av as j,bN as F,x,k as V,c as Q,o as v,w as o,q as l,b as e,f as p,g as y,F as S,t as E,v as f,z as b,R as B,G as q,n as h,p as w,r as T,Q as L,s as P,B as G,a8 as H}from"./index-Bf-p91mW.js";import{Q as J}from"./QPage-DbeGPrD5.js";import{_ as O}from"./CardHeader-AnL1K4iE.js";import{Q as I}from"./QToolbarTitle-Bi6rSosy.js";import{Q as R}from"./QToolbar-CUFZpZSE.js";import{Q as A}from"./QSpace-DJeipgZa.js";import{a as W}from"./api-get-CiRdORW1.js";import{d as X}from"./index-BtaF3-6r.js";import{_ as C}from"./InputSelectArray-Jz4ksDX6.js";import{_ as Y}from"./InputSelectTingkatPendidikan-C_EqL8ok.js";import{Q as M}from"./QSpinnerBars-1F8Nsou7.js";import{Q as U}from"./QInnerLoading-D-UeUIT6.js";import{Q as N}from"./QMarkupTable-BU6ysEzR.js";import{Q as D}from"./QSelect-Co09SqkM.js";import{_ as Z}from"./EditMutasi-CWOUXgpV.js";import{a as tt}from"./api-post-CHcQycZS.js";import"./index-D7WC_quC.js";import"./api-error-C0HjZ2a3.js";import"./lists-store-F5P_xNBX.js";import"./lists-data-mcTvx2m2.js";import"./DropDownAfter-wYSCUu7Z.js";import"./QBtnDropdown-Br6y2eVM.js";import"./QBtnGroup-BDP931ZD.js";import"./QMenu-BvL1IfNl.js";import"./selection-CE9S_xiH.js";import"./ClosePopup-HTVnKVBl.js";import"./Lists-DSwT9YX9.js";import"./ApiCrud-SVFtkNw7.js";import"./QChip-DeZPZCXp.js";import"./QItemSection-Bl4rOme3.js";import"./QItemLabel-sjS6zLD0.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./QForm-OmDQHoiq.js";import"./api-delete-BVHfd1pG.js";import"./api-update-BYe6B3v5.js";const $=j("mutasi-domisili",{state:()=>({santri:[],newFilter:{domisili:""}}),getters:{getSantri:r=>r.santri},actions:{resetSantri(){this.santri=[]},addSantri(r){this.resetSantri(),r.forEach(s=>{this.santri.push({id:s.id,santri_id:s.id,nama:s.nama,domisili:s.domisili,tingkat_id:s.tingkat_id,tingkat:s.tingkat,kelas:s.kelas,new_domisili:"",new_keterangan:"",proses:!1})})},getProsesTrue(){return this.santri.filter(r=>r.proses==!0)},getProsesFalse(){return this.santri.filter(r=>r.proses==!1)},prosesTrue(r){if(!this.newFilter.domisili)return X("Tentukan domisili baru");const s=this.santri.findIndex(d=>d.id===r),i=this.santri[s];i.proses=!0,i.new_domisili=this.newFilter.domisili,i.new_keterangan="Mutasi Domisili"},prosesFalse(r){const s=this.santri.findIndex(d=>d.id===r),i=this.santri[s];i.proses=!1,i.new_domisili=null,i.new_keterangan=null},deleteTrueProses(){const r=[];this.santri.forEach(s=>{s.proses||r.push(s)}),this.santri=r}},persist:!0}),et={class:"text-right"},st={class:"text-center"},lt={class:"text-right"},at={__name:"LeftTable",props:{onLoading:{type:Boolean,default:!1}},setup(r){const s=r,i=F(()=>s.onLoading),d=x(!1),m=$(),g=V(()=>m.getProsesFalse());function k(){const a=g.value.length;if(!a)return;let t=0;d.value=!0,g.value.forEach(n=>{setTimeout(()=>{m.prosesTrue(n.id),t++,t===a&&(d.value=!1)},500)})}return(a,t)=>(v(),Q(N,{flat:"",bordered:"",style:{height:"550px"}},{default:o(()=>[l("thead",null,[l("tr",null,[t[0]||(t[0]=l("th",{class:"text-center"},"ID Santri",-1)),t[1]||(t[1]=l("th",{class:"text-left"},"Nama",-1)),t[2]||(t[2]=l("th",{class:"text-left"},"Domisili",-1)),t[3]||(t[3]=l("th",{class:"text-left"},"Kelas",-1)),t[4]||(t[4]=l("th",{class:"text-left"},"Tingkat",-1)),l("th",et,[e(p,{icon:"keyboard_double_arrow_right",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!g.value.length,onClick:k},null,8,["disable"])])])]),l("tbody",null,[(v(!0),y(S,null,E(g.value,(n,c)=>(v(),y("tr",{key:c},[l("td",st,f(n.id),1),l("td",null,f(n.nama),1),l("td",null,f(n.domisili),1),l("td",null,f(n.kelas),1),l("td",null,f(n.tingkat),1),l("td",lt,[e(p,{icon:"arrow_right",dense:"",outline:"",color:"green-10",glossy:"",onClick:u=>b(m).prosesTrue(n.id)},null,8,["onClick"])])]))),128))]),e(U,{showing:i.value||d.value},{default:o(()=>[e(M,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1}))}},it={class:"row"},nt={class:"text-caption text-italic"},ot={__name:"LeftCard",setup(r){const s=x({tingkat_id:"",kelas:"",domisili:""}),i=$(),d=x(!1),m=V(()=>i.getProsesFalse());B(()=>{g()});function g(){document.querySelectorAll("div.q-field__bottom.row.items-start.q-field__bottom").forEach(t=>t.remove())}q(()=>s.value.tingkat_id,a=>{a&&(s.value.kelas="",s.value.domisili="")}),q(()=>s.value.kelas,async a=>{a&&(s.value.domisili="")}),q(()=>s.value.domisili,async a=>{a&&(s.value.tingkat_id="",s.value.kelas="")}),q(s,async a=>{i.resetSantri(),a.tingkat_id&&a.kelas?await k({tingkat_id:a.tingkat_id,kelas:a.kelas}):a.domisili&&await k({domisili:a.domisili})},{deep:!0});async function k(a){const t=await W({endPoint:"mutasi/not",params:a,loading:d});i.addSantri(t.santri)}return(a,t)=>(v(),Q(P,{class:""},{default:o(()=>[e(h,{class:"q-pa-sm bg-green-7"},{default:o(()=>[e(R,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:o(()=>[e(I,{class:"text-subtitle1"},{default:o(()=>[...t[3]||(t[3]=[w(" Data Santri ",-1)])]),_:1}),e(p,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:n=>null,disable:""})]),_:1})]),_:1}),e(h,{class:"q-pa-sm"},{default:o(()=>[l("div",it,[e(Y,{modelValue:s.value.tingkat_id,"onUpdate:modelValue":t[0]||(t[0]=n=>s.value.tingkat_id=n),label:"Tingkat Pendidikan",class:"col no-padding q-mr-md",hint:null},null,8,["modelValue"]),e(C,{modelValue:s.value.kelas,"onUpdate:modelValue":t[1]||(t[1]=n=>s.value.kelas=n),url:"kelas",label:"Kelas",class:"col no-padding",disable:!s.value.tingkat_id},null,8,["modelValue","disable"])]),e(C,{modelValue:s.value.domisili,"onUpdate:modelValue":t[2]||(t[2]=n=>s.value.domisili=n),url:"domisili",label:"Domisili",class:"q-mt-sm no-padding"},null,8,["modelValue"])]),_:1}),e(T),e(h,{class:"q-pa-sm"},{default:o(()=>[e(at,{"on-loading":d.value},null,8,["on-loading"])]),_:1}),e(T),e(L,{class:"bg-green-1"},{default:o(()=>[l("div",nt,[w(" Total: "+f(m.value?.length||0)+" santri",1),t[4]||(t[4]=l("br",null,null,-1)),t[5]||(t[5]=w(" Hanya menampilkan santri yang statusnya “Aktif” dan belum masuk ke tabel mutasi ",-1))]),e(A),t[6]||(t[6]=l("div",null,null,-1))]),_:1})]),_:1}))}},rt={class:"text-left"},dt={class:"text-right"},ut={class:"text-left"},mt={class:"text-right"},ct={__name:"RightTable",props:{onLoading:{type:Boolean,default:!1}},setup(r){const s=r,i=$(),d=V(()=>i.getProsesTrue()),m=x(!1),g=F(()=>s.onLoading),k=x({}),a=x(!1);function t(){const c=d.value.length;if(!c)return;let u=0;m.value=!0,d.value.forEach(_=>{setTimeout(()=>{i.prosesFalse(_.id),u++,u===c&&(m.value=!1)},500)})}function n(c){k.value=c,a.value=!0}return(c,u)=>(v(),y(S,null,[e(N,{flat:"",bordered:"",style:{height:"550px"}},{default:o(()=>[l("thead",null,[l("tr",null,[l("th",rt,[e(p,{icon:"keyboard_double_arrow_left",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!d.value.length,onClick:t},null,8,["disable"])]),u[1]||(u[1]=l("th",{class:"text-left"},"Nama",-1)),u[2]||(u[2]=l("th",{class:"text-left"},"Domisili Asal",-1)),u[3]||(u[3]=l("th",{class:"text-left"},"Domisili Baru *",-1)),u[4]||(u[4]=l("th",{class:"text-left"},"Keterangan",-1)),l("th",dt,[e(p,{icon:"edit",dense:"",flat:"",disable:"",color:"green-10"})])])]),l("tbody",null,[(v(!0),y(S,null,E(d.value,(_,z)=>(v(),y("tr",{key:z},[l("td",ut,[e(p,{icon:"arrow_left",dense:"",outline:"",color:"green-10",glossy:"",onClick:K=>b(i).prosesFalse(_.id)},null,8,["onClick"])]),l("td",null,f(_.nama),1),l("td",null,f(_.domisili),1),l("td",null,f(_.new_domisili),1),l("td",null,f(_.new_keterangan??"-"),1),l("td",mt,[e(p,{icon:"edit",dense:"",flat:"",color:"green-10",onClick:K=>n(_)},null,8,["onClick"])])]))),128))]),e(U,{showing:g.value||m.value},{default:o(()=>[e(M,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1}),e(G,{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=_=>a.value=_)},{default:o(()=>[e(Z,{data:k.value},null,8,["data"])]),_:1},8,["modelValue"])],64))}},ft={class:"row"},pt={class:"text-caption text-italic"},gt={__name:"RightCard",setup(r){const s=$(),{newFilter:i}=H(s),d=V(()=>s.getProsesTrue()),m=x(!1);B(()=>{g()});function g(){document.querySelectorAll("div.q-field__bottom.row.items-start.q-field__bottom").forEach(t=>t.remove())}async function k(){const t={santri:d.value.map(c=>({santri_id:c.santri_id,new_domisili:c.new_domisili,new_keterangan:c.new_keterangan}))};await tt({endPoint:"mutasi",loading:m,data:t})&&s.deleteTrueProses()}return(a,t)=>(v(),Q(P,{class:""},{default:o(()=>[e(h,{class:"q-pa-sm bg-green-7"},{default:o(()=>[e(R,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:o(()=>[e(I,{class:"text-subtitle1"},{default:o(()=>[...t[3]||(t[3]=[w(" Data Mutasi ",-1)])]),_:1}),e(p,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:n=>null,disable:""})]),_:1})]),_:1}),e(h,{class:"q-pa-sm"},{default:o(()=>[l("div",ft,[e(D,{modelValue:b(i).tingkat_id,"onUpdate:modelValue":t[0]||(t[0]=n=>b(i).tingkat_id=n),label:"",class:"col no-padding q-mr-md",filled:"",outlined:"",dense:"",disable:""},null,8,["modelValue"]),e(D,{modelValue:b(i).kelas,"onUpdate:modelValue":t[1]||(t[1]=n=>b(i).kelas=n),label:"",class:"col no-padding",filled:"",outlined:"",dense:"",disable:""},null,8,["modelValue"])]),e(C,{modelValue:b(i).domisili,"onUpdate:modelValue":t[2]||(t[2]=n=>b(i).domisili=n),url:"domisili",label:"Domisili Baru",class:"q-mt-sm no-padding"},null,8,["modelValue"])]),_:1}),e(T),e(h,{class:"q-pa-sm"},{default:o(()=>[e(ct,{"on-loading":m.value},null,8,["on-loading"])]),_:1}),e(T),e(L,{class:"bg-green-1"},{default:o(()=>[l("div",pt,[w(" Total: "+f(d.value?.length||0)+" santri",1),t[4]||(t[4]=l("br",null,null,-1)),t[5]||(t[5]=w(" Teliti kembali data domisili baru! ",-1))]),e(A),l("div",null,[e(p,{label:"Simpan","no-caps":"",icon:"save",color:"green-10",class:"text-green-11",onClick:k,disable:!d.value.length>0},null,8,["disable"])])]),_:1})]),_:1}))}},_t={class:"row"},kt={class:"col q-pa-sm"},vt={class:"col q-pa-sm"},ee={__name:"ProsesiIndex",setup(r){return B(()=>{const s=document.getElementById("toggle-drawer");s&&s.click()}),(s,i)=>(v(),Q(J,{class:"q-pa-sm"},{default:o(()=>[e(P,{class:"",style:{"min-width":"1200px"}},{default:o(()=>[e(O,{title:"Modul Mutasi Domisili",showReload:!1},{right:o(()=>[e(p,{icon:"visibility",label:"Hasil Mutasi",dense:"",outline:"","no-caps":"",class:"q-ml-sm q-px-sm",to:"/mutasi/result"}),e(p,{disable:"",flat:"",dense:"",icon:"more_vert",class:"q-ml-sm",color:"green-11"})]),_:1}),e(h,{class:"no-padding"},{default:o(()=>[l("div",_t,[l("div",kt,[e(ot)]),l("div",vt,[e(gt)])])]),_:1})]),_:1})]),_:1}))}};export{ee as default};
