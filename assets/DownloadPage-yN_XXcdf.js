import{Q as b}from"./QSpace-DIvX2TzF.js";import{a6 as j,A as d,U as y,J as v,c as V,o as T,w as n,b as s,x as k,Q as m,a as q,g as p,ab as Q,a5 as x,k as A}from"./index-DwrbA0R8.js";import{Q as u}from"./QSelect-CrgZ1FsI.js";import{Q as N}from"./QForm-DCEv1Ikv.js";import{Q as U}from"./QPage-BU8r9xHl.js";import{a as S}from"./api-get-D4W4lze7.js";import{g}from"./api-get-lists-8M14e61j.js";import{l as o}from"./lists-madrasah-store-BHcaFkmm.js";import{l as w}from"./loading-store-DcVNMmYX.js";import{n as B}from"./index-BlZcD66n.js";import"./QChip-DvUCR8tL.js";import"./QItemSection-CeSY4hvW.js";import"./QItemLabel-Dzdetwv2.js";import"./QMenu-BEnErdhw.js";import"./selection-DRCgFU0J.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./index-B6LiMDVO.js";import"./api-error-DGWaEiw1.js";const aa={__name:"DownloadPage",setup(K){const{loadingMain:c}=j(w()),l=d({}),r=d([]),i=d([]),h=[{value:"ujian",label:"Nilai Ujian"},{value:"harian",label:"Nilai Harian"},{value:"rapor",label:"Nilai Rapor"},{value:"ijazah",label:"Nilai Ijazah"}],_=o().getThAjaran;i.value.th_ajaran=_,y(async()=>{const t=o().getThAjaran;if(i.value.th_ajaran=t,t.length==0){const e=await g({url:"kelas/lists",key:"th_ajaran",loadingArray:r});o().setThAjaran(e),i.value.th_ajaran=e}else i.value.th_ajaran=t});async function f(){const t=JSON.parse(JSON.stringify(l.value)),e=await S({endPoint:"export/nilai-mapel",loading:c,params:t});if(!e)return;if(!e.url)return B("Url tidak ditemukan");const a=document.createElement("a");a.href=e.url,a.click(),a.remove()}return v(()=>l.value.th_ajaran_h,async t=>{if(l.value.tingkat_id="",l.value.kelas="",t){const e=o().getTingkatByTahun(t);if(e.length)i.value.tingkat=e;else{const a=await g({url:"kelas/lists",params:{th_ajaran_h:t},key:"tingkat",loadingArray:r,sort:"asc"});o().addTingkatToTahun(a,t),i.value.tingkat=a}}else i.value.tingkat=[];i.value.kelas=[]}),v(()=>l.value.tingkat_id,async t=>{if(l.value.kelas="",t){const e=o().getKelasByTingkatAndTahun(t,l.value.th_ajaran_h);if(e.length)i.value.kelas=e;else{const a=await g({url:"kelas/lists",params:{th_ajaran_h:l.value.th_ajaran_h,tingkat_id:t},key:"kelas",loadingArray:r,sort:"asc"});o().addKelasToTingkatByTahun(a,t,l.value.th_ajaran_h),i.value.kelas=a}}else i.value.kelas=[]}),(t,e)=>(T(),V(U,{class:"q-pa-sm"},{default:n(()=>[s(k,null,{default:n(()=>[s(m,{class:"q-pa-sm bg-green-8 text-green-11 flex"},{default:n(()=>[e[5]||(e[5]=q("div",{tag:"h1",class:"text-subtitle1"},"Download Nilai",-1)),s(b),s(p,{label:"Kembali",to:"/madrasah/nilai-mapel",dense:"",outline:"","no-caps":"",icon:"arrow_back",class:"q-px-sm q-mr-md"}),s(p,{label:"Upload",to:"/madrasah/nilai-mapel/upload",dense:"",outline:"","no-caps":"",icon:"upload",class:"q-px-sm"})]),_:1}),s(m,{class:"q-pa-sm"},{default:n(()=>[s(N,{onSubmit:Q(f,["prevent"])},{default:n(()=>[s(k,{style:{"max-width":"425px"}},{default:n(()=>[s(m,{class:"q-pa-sm"},{default:n(()=>[s(u,{dense:"",class:"",outlined:"",label:"Tahun Ajaran","emit-value":"","map-options":"",modelValue:l.value.th_ajaran_h,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.th_ajaran_h=a),options:i.value.th_ajaran,"option-value":"th_ajaran_h","option-label":"th_ajaran_h",clearable:"",behavior:"menu",required:"",rules:[a=>!!a||"Harus diisi!"]},null,8,["modelValue","options","rules"]),s(u,{dense:"",class:"",outlined:"",label:"Tingkat Pendidikan","emit-value":"","map-options":"","option-value":"tingkat_id","option-label":"tingkat",modelValue:l.value.tingkat_id,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.tingkat_id=a),options:i.value.tingkat,loading:r.value.tingkat,clearable:"",behavior:"menu",required:"",rules:[a=>!!a||"Harus diisi!"]},null,8,["modelValue","options","loading","rules"]),s(u,{dense:"",class:"",outlined:"",label:"Kelas","emit-value":"","map-options":"",modelValue:l.value.kelas,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.kelas=a),options:i.value.kelas,loading:r.value.kelas,clearable:"",behavior:"menu",required:"",rules:[a=>!!a||"Harus diisi!"]},null,8,["modelValue","options","loading","rules"]),s(u,{dense:"",class:"q-mt-sm",outlined:"",label:"Kategori Nilai",modelValue:l.value.category,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.category=a),behavior:"menu",required:"",options:h,"emit-value":"","map-options":"",rules:[a=>!!a||"Harus diisi!"]},null,8,["modelValue","rules"]),s(x,{dense:"",class:"q-mt-sm",outlined:"",label:"Ujian Ke",modelValue:l.value.ujian_ke,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.ujian_ke=a),required:"",type:"number",rules:[a=>a>0&&a<5||"antara 1 s.d. 4"]},null,8,["modelValue","rules"])]),_:1}),s(A,{class:"bg-green-6",align:"right"},{default:n(()=>[s(p,{class:"",type:"submit",label:"Download",icon:"download",color:"green-11","no-caps":"",outline:"",dense:""})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{aa as default};
