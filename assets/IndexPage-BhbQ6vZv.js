import{q as d,A as O,s as P,E as b,c as v,o as u,w as l,g as e,Q as y,v as c,l as Q,ah as A,b as _,F as S,D as T,e as V,t as w}from"./index-hOL5A6cm.js";import{Q as F,a as h}from"./QTable-fdgK0zKb.js";import{Q as M}from"./QTr-BU_7HvY1.js";import{Q as x}from"./QTd-Yg8ttfxq.js";import{Q as H}from"./QTooltip--LgBHbKp.js";import{_ as U}from"./InputSearch-BqxncBUs.js";import{A as j}from"./ApiCrud-C0P1pqwF.js";import{A as $}from"./ArrayCrud-CkcA-ixF.js";import{c as K}from"./format-date-OVhbBx9F.js";import{c as q}from"./index-uhNqAWVd.js";import"./QList-psTvccOF.js";import"./QMarkupTable-B-16obXc.js";import"./QSelect-DH-3drUQ.js";import"./QChip-hOI8Fwk1.js";import"./QItem-BANBEVbr.js";import"./QItemLabel-Cay7Uljr.js";import"./QMenu-sXy5Axos.js";import"./selection-DaCFfV6A.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-Bf_st-kF.js";import"./Api-COnWASsw.js";import"./index-D-qXO6AO.js";import"./api-error-rS4-Nvfb.js";import"./id-BuNGTsqN.js";class z extends j{constructor(){super("alumni")}}const C=new z,J={key:0},R={key:1},ya={__name:"IndexPage",setup(B){const s=d([]),p=d(!1),g=d(!1),k=d(""),m=d(!1);async function D(){try{p.value=!0;const a=await C.getAll();s.value=a.alumni}catch(a){console.log("üöÄ ~ loadData ~ error:",a)}finally{p.value=!1}}async function E(a){const n=!!a.sent_to_alumni_at;try{m.value=!0;const i=["belum terkirim","sudah terkirim"],f=["Data yang sudah terkirim tidak bisa ditarik lagi!","Jika data belum terkirim, Anda perlu klik tombol kirim setelah ini!"];let o=`Tandai ${n?i[0]:i[1]}?`;if(o+="<br/><br/><hr/>",o+="<small>",o+="<em>Aksi ini hanya mengubah status!</em><br/>",o+=`<em>${n?f[0]:f[1]}</em><br/>`,o+="</small>",o+="<hr/>",!await q(o))return;await C.update({id:a.id,data:{activated:!n}});const r={...a,sent_to_alumni_at:a.sent_to_alumni_at?null:new Date().toISOString()};s.value=$.update(s.value,a.id,r)}catch(i){console.log("Error updating sent status:",i)}finally{m.value=!1}}async function I(a){if(await q("Kirim data ke aplikasi alumni?"))try{m.value=!0,await C.create({data:{id:a.id}});const i={...a,sent_to_alumni_at:new Date().toISOString()};s.value=$.update(s.value,a.id,i)}catch(i){console.log("Error updating sent status:",i)}finally{m.value=!1}}const L=O(()=>g.value?s.value.filter(a=>a.sent_to_alumni_at):s.value.filter(a=>!a.sent_to_alumni_at));P(async()=>{await D()});const N=[{name:"santri_id",label:"Santri ID",align:"center",field:"santri_id",sortable:!0},{name:"nama",label:"Name",align:"left",field:"nama",sortable:!0},{name:"tgl_daftar_m",label:"Masuk",field:"tgl_daftar_m",format:a=>K(a,"dd-MM-yyyy"),sortable:!0},{name:"created_at",label:"Keluar",field:"created_at",format:a=>K(a,"dd-MM-yyyy"),sortable:!0},{name:"alamat",label:"Alamat",align:"left",field:a=>a.desa+" "+a.kecamatan+" "+a.kabupaten}];return(a,n)=>{const i=b("CardHeader"),f=b("CardLoading"),o=b("CardPage");return u(),v(o,null,{default:l(()=>[e(i,{title:"Data Alumni",onOnReload:D}),e(y,{class:"bg-green-12 q-pa-xs text-caption"},{default:l(()=>[...n[2]||(n[2]=[c(" Menampilkan data santri berhenti/diberhentikan ",-1)])]),_:1}),e(y,{class:"q-pa-sm tw:grid tw:grid-cols-1 tw:sm:flex tw:sm:justify-between tw:gap-2 bg-green-11"},{default:l(()=>[e(Q,{flat:"",bordered:"",style:{"min-width":"300px"}},{default:l(()=>[e(A,{modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=t=>g.value=t),label:"Terkirim",color:"green-7","checked-icon":"check","unchecked-icon":"clear"},null,8,["modelValue"])]),_:1}),e(Q,{flat:"",bordered:"",style:{"min-width":"300px"}},{default:l(()=>[e(U,{modelValue:k.value,"onUpdate:modelValue":n[1]||(n[1]=t=>k.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{class:"q-pa-sm"},{default:l(()=>[e(f,{showing:m.value},null,8,["showing"]),e(F,{rows:L.value,loading:p.value,filter:k.value,"rows-per-page-options":[10,25,50,75,100,0],flat:"",bordered:"","row-key":"id",columns:N},{header:l(t=>[e(M,{props:t},{default:l(()=>[(u(!0),_(S,null,T(t.cols,r=>(u(),v(h,{key:r.name,props:t},{default:l(()=>[c(w(r.label),1)]),_:2},1032,["props"]))),128)),e(h,{class:"text-center"},{default:l(()=>[...n[3]||(n[3]=[c("Kirim",-1)])]),_:1}),e(h,{class:"text-center"},{default:l(()=>[...n[4]||(n[4]=[c("Selesai",-1)])]),_:1})]),_:2},1032,["props"])]),body:l(t=>[e(M,{props:t},{default:l(()=>[(u(!0),_(S,null,T(t.cols,r=>(u(),v(x,{key:r.name,props:t},{default:l(()=>[r.name=="santri_id"?(u(),_("span",J,[e(V,{label:r.value,"no-caps":"",size:"sm",outline:"",class:"text-green-10",to:`/santri/${r.value}`},null,8,["label","to"])])):(u(),_("span",R,w(r.value),1))]),_:2},1032,["props"]))),128)),e(x,{class:"text-center"},{default:l(()=>[e(V,{disable:!!t.row.sent_to_alumni_at,class:"q-px-sm",dense:"",icon:"sym_o_forward",outline:!!t.row.sent_to_alumni_at,color:"green",onClick:r=>I(t.row),label:"Kirim","no-caps":""},null,8,["disable","outline","onClick"])]),_:2},1024),e(x,{class:"text-center"},{default:l(()=>[e(A,{"model-value":!!t.row.sent_to_alumni_at,onClick:r=>E(t.row),"checked-icon":"check","unchecked-icon":"clear",color:"green-7"},null,8,["model-value","onClick"]),e(H,null,{default:l(()=>[c(w(t.row.sent_to_alumni_at?"Data sudah terkirim ‚úÖ ‚Äî Klik untuk mengubah status!":"Data belum terkirim ‚ùå ‚Äî Klik untuk mengubah status!"),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","loading","filter"])]),_:1})]),_:1})}}};export{ya as default};
