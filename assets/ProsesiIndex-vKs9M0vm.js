import{ay as G,bN as N,A as k,q as C,c as h,o as g,w as i,a as s,b as e,g as f,f as q,F as E,z as R,t as b,C as x,W as $,K as V,Q as w,v as y,x as T,k as F,y as D,ad as O,e as P,a7 as Q,l as W,G as J,ac as X,B as Y}from"./index-0PBDf7I0.js";import{Q as Z}from"./QPage-B2JjDCGV.js";import{Q as I}from"./QToolbarTitle-Bi7GnpK1.js";import{Q as U}from"./QToolbar-CIornAnt.js";import{Q as A}from"./QSpace-BYMtWShY.js";import{a as ee}from"./api-get-CJU_3mwN.js";import{d as te}from"./index-BDNa_dSq.js";import{_ as S}from"./InputSelectArray-BGoSDEHL.js";import{_ as le}from"./InputSelectTingkatPendidikan-T6npfMRK.js";import{Q as H}from"./QSpinnerBars-CVXqukPZ.js";import{Q as L}from"./QInnerLoading-BCkgQo3N.js";import{Q as K}from"./QMarkupTable-s8nx6cOi.js";import{Q as M}from"./QSelect-Cpr8vW2V.js";import{Q as se}from"./QSpinnerTail-BjeDmpEf.js";import{Q as ae}from"./QForm-ieTYlGnS.js";import{C as ie}from"./ClosePopup-5qpDiF0T.js";import{a as ne}from"./api-delete-LXot_cCK.js";import{a as oe}from"./api-update-C-LR0aqK.js";import{a as re}from"./api-post-B8OlYMtG.js";import"./index-BXLuJznK.js";import"./api-error-C1WPqECD.js";import"./lists-store-C4dqSiKA.js";import"./DropDownAfter-f-uzuh2w.js";import"./QBtnDropdown-CEycuZRG.js";import"./QBtnGroup-BBlBx6YD.js";import"./QMenu-3oalsLjd.js";import"./selection-DeDWR_N3.js";import"./Lists-B91eApHM.js";import"./ApiCrud-CgUuq5zB.js";import"./Api--YdEMrhi.js";import"./QChip-DG5_EyRB.js";import"./QItemSection-DpSW8XO7.js";import"./QItemLabel-DR97WW3U.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";const B=G("mutasi-domisili",{state:()=>({santri:[],newFilter:{domisili:""}}),getters:{getSantri:u=>u.santri},actions:{resetSantri(){this.santri=[]},addSantri(u){this.resetSantri(),u.forEach(l=>{this.santri.push({id:l.id,santri_id:l.id,nama:l.nama,domisili:l.domisili,tingkat_id:l.tingkat_id,tingkat:l.tingkat,kelas:l.kelas,new_domisili:"",new_keterangan:"",proses:!1})})},getProsesTrue(){return this.santri.filter(u=>u.proses==!0)},getProsesFalse(){return this.santri.filter(u=>u.proses==!1)},prosesTrue(u){if(!this.newFilter.domisili)return te("Tentukan domisili baru");const l=this.santri.findIndex(r=>r.id===u),o=this.santri[l];o.proses=!0,o.new_domisili=this.newFilter.domisili,o.new_keterangan="Mutasi Domisili"},prosesFalse(u){const l=this.santri.findIndex(r=>r.id===u),o=this.santri[l];o.proses=!1,o.new_domisili=null,o.new_keterangan=null},deleteTrueProses(){const u=[];this.santri.forEach(l=>{l.proses||u.push(l)}),this.santri=u}},persist:!0}),de={class:"text-right"},ue={class:"text-center"},me={class:"text-right"},ce={__name:"LeftTable",props:{onLoading:{type:Boolean,default:!1}},setup(u){const l=u,o=N(()=>l.onLoading),r=k(!1),d=B(),c=C(()=>d.getProsesFalse());function _(){const n=c.value.length;if(!n)return;let t=0;r.value=!0,c.value.forEach(a=>{setTimeout(()=>{d.prosesTrue(a.id),t++,t===n&&(r.value=!1)},500)})}return(n,t)=>(g(),h(K,{flat:"",bordered:"",style:{height:"550px"}},{default:i(()=>[s("thead",null,[s("tr",null,[t[0]||(t[0]=s("th",{class:"text-center"},"ID Santri",-1)),t[1]||(t[1]=s("th",{class:"text-left"},"Nama",-1)),t[2]||(t[2]=s("th",{class:"text-left"},"Domisili",-1)),t[3]||(t[3]=s("th",{class:"text-left"},"Kelas",-1)),t[4]||(t[4]=s("th",{class:"text-left"},"Tingkat",-1)),s("th",de,[e(f,{icon:"keyboard_double_arrow_right",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!c.value.length,onClick:_},null,8,["disable"])])])]),s("tbody",null,[(g(!0),q(E,null,R(c.value,(a,m)=>(g(),q("tr",{key:m},[s("td",ue,b(a.id),1),s("td",null,b(a.nama),1),s("td",null,b(a.domisili),1),s("td",null,b(a.kelas),1),s("td",null,b(a.tingkat),1),s("td",me,[e(f,{icon:"arrow_right",dense:"",outline:"",color:"green-10",glossy:"",onClick:p=>x(d).prosesTrue(a.id)},null,8,["onClick"])])]))),128))]),e(L,{showing:o.value||r.value},{default:i(()=>[e(H,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1}))}},pe={class:"row"},fe={class:"text-caption text-italic"},ge={__name:"LeftCard",setup(u){const l=k({tingkat_id:"",kelas:"",domisili:""}),o=B(),r=k(!1),d=C(()=>o.getProsesFalse());$(()=>{c()});function c(){document.querySelectorAll("div.q-field__bottom.row.items-start.q-field__bottom").forEach(t=>t.remove())}V(()=>l.value.tingkat_id,n=>{n&&(l.value.kelas="",l.value.domisili="")}),V(()=>l.value.kelas,async n=>{n&&(l.value.domisili="")}),V(()=>l.value.domisili,async n=>{n&&(l.value.tingkat_id="",l.value.kelas="")}),V(l,async n=>{o.resetSantri(),n.tingkat_id&&n.kelas?await _({tingkat_id:n.tingkat_id,kelas:n.kelas}):n.domisili&&await _({domisili:n.domisili})},{deep:!0});async function _(n){const t=await ee({endPoint:"mutasi/not",params:n,loading:r});o.addSantri(t.santri)}return(n,t)=>(g(),h(D,{class:""},{default:i(()=>[e(w,{class:"q-pa-sm bg-green-7"},{default:i(()=>[e(U,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:i(()=>[e(I,{class:"text-subtitle1"},{default:i(()=>[...t[3]||(t[3]=[y(" Data Santri ",-1)])]),_:1}),e(f,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:a=>null,disable:""})]),_:1})]),_:1}),e(w,{class:"q-pa-sm"},{default:i(()=>[s("div",pe,[e(le,{modelValue:l.value.tingkat_id,"onUpdate:modelValue":t[0]||(t[0]=a=>l.value.tingkat_id=a),label:"Tingkat Pendidikan",class:"col no-padding q-mr-md",hint:null},null,8,["modelValue"]),e(S,{modelValue:l.value.kelas,"onUpdate:modelValue":t[1]||(t[1]=a=>l.value.kelas=a),url:"kelas",label:"Kelas",class:"col no-padding",disable:!l.value.tingkat_id},null,8,["modelValue","disable"])]),e(S,{modelValue:l.value.domisili,"onUpdate:modelValue":t[2]||(t[2]=a=>l.value.domisili=a),url:"domisili",label:"Domisili",class:"q-mt-sm no-padding"},null,8,["modelValue"])]),_:1}),e(T),e(w,{class:"q-pa-sm"},{default:i(()=>[e(ce,{"on-loading":r.value},null,8,["on-loading"])]),_:1}),e(T),e(F,{class:"bg-green-1"},{default:i(()=>[s("div",fe,[y(" Total: "+b(d.value?.length||0)+" santri",1),t[4]||(t[4]=s("br",null,null,-1)),t[5]||(t[5]=y(" Hanya menampilkan santri yang statusnya “Aktif” dan belum masuk ke tabel mutasi ",-1))]),e(A),t[6]||(t[6]=s("div",null,null,-1))]),_:1})]),_:1}))}},_e={key:0,class:"text-italic text-caption"},be={__name:"EditMutasi",props:{data:{type:Object,required:!0},api:{type:Boolean,default:!1}},emits:["onDelete","onSubmit"],setup(u,{emit:l}){const o=l,r=u,d=k({}),c=k(!1);$(()=>{r.api?Object.assign(d.value,r.data):d.value=r.data});async function _(){await ne({endPoint:`mutasi/${d.value.id}`,loading:c})&&(document.getElementById("btn-close").click(),o("onDelete"))}async function n(){const t={new_domisili:d.value.new_domisili,new_keterangan:d.value.new_keterangan};await oe({endPoint:`mutasi/${d.value.id}`,loading:c,data:t})&&(document.getElementById("btn-close").click(),o("onSubmit"))}return(t,a)=>(g(),h(D,{class:"full-width",style:{"max-width":"425px"}},{default:i(()=>[e(ae,{onSubmit:O(n,["prevent"])},{default:i(()=>[e(w,{class:"bg-green-7 text-green-11 q-pa-sm"},{default:i(()=>[e(U,{class:"q-px-sm",style:{"min-height":"0"}},{default:i(()=>[e(I,{class:"text-subtitle1 text-green-11"},{default:i(()=>[...a[2]||(a[2]=[y(" Data Domisili Baru — ",-1),s("span",{class:"text-italic"},"Edit",-1)])]),_:1}),r.api?P("",!0):(g(),q("span",_e," Auto Update "))]),_:1})]),_:1}),e(w,null,{default:i(()=>[e(Q,{"model-value":d.value.nama+" ("+d.value.santri_id+")",class:"",disable:"",filled:"",dense:"",outlined:"",label:"Nama (ID)"},null,8,["model-value"]),e(Q,{"model-value":d.value.tingkat+" — "+d.value.kelas,class:"q-mt-sm",disable:"",filled:"",dense:"",outlined:"",label:"Tingkat — Kelas"},null,8,["model-value"]),e(Q,{"model-value":d.value.domisili,class:"q-mt-sm",disable:"",filled:"",dense:"",outlined:"",label:"Domisili (Asal)"},null,8,["model-value"]),e(S,{modelValue:d.value.new_domisili,"onUpdate:modelValue":a[0]||(a[0]=m=>d.value.new_domisili=m),url:"domisili",label:"Domisili (Baru) *",class:"q-mt-sm",rules:[m=>!!m||"Harus diisi!"],clearable:!1},null,8,["modelValue","rules"]),e(Q,{modelValue:d.value.new_keterangan,"onUpdate:modelValue":a[1]||(a[1]=m=>d.value.new_keterangan=m),class:"q-mt-sm",dense:"",outlined:"",label:"Keterangan (Baru)",autogrow:!0},null,8,["modelValue"])]),_:1}),e(F,{class:"bg-green-6 flex"},{default:i(()=>[r.api?(g(),h(f,{key:0,label:"Hapus",class:"bg-red text-red-1","no-caps":"",onClick:_})):P("",!0),e(A),W(e(f,{label:"Tutup",class:"bg-green-11","no-caps":"",id:"btn-close"},null,512),[[ie]]),r.api?(g(),h(f,{key:1,type:"submit",label:"Simpan",class:"bg-green-10 text-green-11","no-caps":""})):P("",!0)]),_:1}),e(L,{showing:c.value},{default:i(()=>[e(se,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1})]),_:1}))}},ve={class:"text-left"},ke={class:"text-right"},we={class:"text-left"},xe={class:"text-right"},he={__name:"RightTable",props:{onLoading:{type:Boolean,default:!1}},setup(u){const l=u,o=B(),r=C(()=>o.getProsesTrue()),d=k(!1),c=N(()=>l.onLoading),_=k({}),n=k(!1);function t(){const m=r.value.length;if(!m)return;let p=0;d.value=!0,r.value.forEach(v=>{setTimeout(()=>{o.prosesFalse(v.id),p++,p===m&&(d.value=!1)},500)})}function a(m){_.value=m,n.value=!0}return(m,p)=>(g(),q(E,null,[e(K,{flat:"",bordered:"",style:{height:"550px"}},{default:i(()=>[s("thead",null,[s("tr",null,[s("th",ve,[e(f,{icon:"keyboard_double_arrow_left",dense:"",color:"green-10",glossy:"",class:"text-green-11",disable:!r.value.length,onClick:t},null,8,["disable"])]),p[1]||(p[1]=s("th",{class:"text-left"},"Nama",-1)),p[2]||(p[2]=s("th",{class:"text-left"},"Domisili Asal",-1)),p[3]||(p[3]=s("th",{class:"text-left"},"Domisili Baru *",-1)),p[4]||(p[4]=s("th",{class:"text-left"},"Keterangan",-1)),s("th",ke,[e(f,{icon:"edit",dense:"",flat:"",disable:"",color:"green-10"})])])]),s("tbody",null,[(g(!0),q(E,null,R(r.value,(v,j)=>(g(),q("tr",{key:j},[s("td",we,[e(f,{icon:"arrow_left",dense:"",outline:"",color:"green-10",glossy:"",onClick:z=>x(o).prosesFalse(v.id)},null,8,["onClick"])]),s("td",null,b(v.nama),1),s("td",null,b(v.domisili),1),s("td",null,b(v.new_domisili),1),s("td",null,b(v.new_keterangan??"-"),1),s("td",xe,[e(f,{icon:"edit",dense:"",flat:"",color:"green-10",onClick:z=>a(v)},null,8,["onClick"])])]))),128))]),e(L,{showing:c.value||d.value},{default:i(()=>[e(H,{size:"4em",color:"green"})]),_:1},8,["showing"])]),_:1}),e(J,{modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=v=>n.value=v)},{default:i(()=>[e(be,{data:_.value},null,8,["data"])]),_:1},8,["modelValue"])],64))}},ye={class:"row"},qe={class:"text-caption text-italic"},Ve={__name:"RightCard",setup(u){const l=B(),{newFilter:o}=X(l),r=C(()=>l.getProsesTrue()),d=k(!1);$(()=>{c()});function c(){document.querySelectorAll("div.q-field__bottom.row.items-start.q-field__bottom").forEach(t=>t.remove())}async function _(){const t={santri:r.value.map(m=>({santri_id:m.santri_id,new_domisili:m.new_domisili,new_keterangan:m.new_keterangan}))};await re({endPoint:"mutasi",loading:d,data:t})&&l.deleteTrueProses()}return(n,t)=>(g(),h(D,{class:""},{default:i(()=>[e(w,{class:"q-pa-sm bg-green-7"},{default:i(()=>[e(U,{class:"no-padding text-green-11",style:{"min-height":"0"}},{default:i(()=>[e(I,{class:"text-subtitle1"},{default:i(()=>[...t[3]||(t[3]=[y(" Data Mutasi ",-1)])]),_:1}),e(f,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:a=>null,disable:""})]),_:1})]),_:1}),e(w,{class:"q-pa-sm"},{default:i(()=>[s("div",ye,[e(M,{modelValue:x(o).tingkat_id,"onUpdate:modelValue":t[0]||(t[0]=a=>x(o).tingkat_id=a),label:"",class:"col no-padding q-mr-md",filled:"",outlined:"",dense:"",disable:""},null,8,["modelValue"]),e(M,{modelValue:x(o).kelas,"onUpdate:modelValue":t[1]||(t[1]=a=>x(o).kelas=a),label:"",class:"col no-padding",filled:"",outlined:"",dense:"",disable:""},null,8,["modelValue"])]),e(S,{modelValue:x(o).domisili,"onUpdate:modelValue":t[2]||(t[2]=a=>x(o).domisili=a),url:"domisili",label:"Domisili Baru",class:"q-mt-sm no-padding"},null,8,["modelValue"])]),_:1}),e(T),e(w,{class:"q-pa-sm"},{default:i(()=>[e(he,{"on-loading":d.value},null,8,["on-loading"])]),_:1}),e(T),e(F,{class:"bg-green-1"},{default:i(()=>[s("div",qe,[y(" Total: "+b(r.value?.length||0)+" santri",1),t[4]||(t[4]=s("br",null,null,-1)),t[5]||(t[5]=y(" Teliti kembali data domisili baru! ",-1))]),e(A),s("div",null,[e(f,{label:"Simpan","no-caps":"",icon:"save",color:"green-10",class:"text-green-11",onClick:_,disable:!r.value.length>0},null,8,["disable"])])]),_:1})]),_:1}))}},Qe={class:"row"},Te={class:"col q-pa-sm"},Se={class:"col q-pa-sm"},ut={__name:"ProsesiIndex",setup(u){return $(()=>{const l=document.getElementById("toggle-drawer");l&&l.click()}),(l,o)=>{const r=Y("CardHeader");return g(),h(Z,{class:"q-pa-sm"},{default:i(()=>[e(D,{class:"",style:{"min-width":"1200px"}},{default:i(()=>[e(r,{title:"Modul Mutasi Domisili",showReload:!1},{right:i(()=>[e(f,{icon:"visibility",label:"Hasil Mutasi",dense:"",outline:"","no-caps":"",class:"q-ml-sm q-px-sm",to:"/mutasi/result"}),e(f,{disable:"",flat:"",dense:"",icon:"more_vert",class:"q-ml-sm",color:"green-11"})]),_:1}),e(w,{class:"no-padding"},{default:i(()=>[s("div",Qe,[s("div",Te,[e(ge)]),s("div",Se,[e(Ve)])])]),_:1})]),_:1})]),_:1})}}};export{ut as default};
