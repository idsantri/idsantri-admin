import{ai as A,q as r,ad as D,s as U,E as w,c as I,o as M,w as o,g as t,Q as c,a as l,aq as v,l as B,v as H,t as b,G as N,a9 as $,m as E,e as y}from"./index-B5Gb-mLe.js";import{Q as F}from"./QTable-CQ3k8xip.js";import{Q as K}from"./QSpace-2DRHuWxM.js";import{Q as G}from"./QSpinnerFacebook-B2kfD3iS.js";import{Q as J}from"./QInnerLoading-BrI1a_e5.js";import{_ as R}from"./FilterKelas-VpuaNEBn.js";import{_ as z}from"./InputSelectIuranPaket-noh6p1jK.js";import{e as x}from"./index-w3oJRLyV.js";import{K as L}from"./Kelas-CQD_ZF5L.js";import{I as O}from"./Iuran-B0xDHWOh.js";import{f as W,a as X}from"./id-BuNGTsqN.js";import"./QList-ByAu0Gcp.js";import"./QMarkupTable-aVQEVO1E.js";import"./QSelect-BqMes2y4.js";import"./QField-Bbp2qmBb.js";import"./QChip-D_d4F4g7.js";import"./QItem-BCXtxr0M.js";import"./QItemLabel-CLmt2hLx.js";import"./QMenu-CBRP4CDX.js";import"./selection-BzMZOoQD.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-DJFruW3J.js";import"./QToolbar-DxK_sqSc.js";import"./lists-madrasah-store-Ba-XlXdB.js";import"./AbsensiSetting-BFOOP_du.js";import"./ApiCrud-DSLkdATC.js";import"./Api-CNGT1L8P.js";import"./index-B2zugsq1.js";import"./apiPost-9wQ754O6.js";import"./QSlideTransition-DJWhS0ND.js";import"./ClosePopup-RThXykTF.js";import"./IuranPaket-CzEHGXsh.js";const Y={class:"no-padding full-width row no-wrap justify-between items-start content-start scroll"},Z={class:"q-mt-sm",style:{"min-width":"500px",width:"100%"}},aa={class:"q-mt-sm",style:{"min-width":"400px",width:"70%"}},ea={class:"vertical-top"},ta={class:"vertical-top"},la={class:"vertical-top"},sa={class:""},Na={__name:"PageTagihan",setup(oa){const V=A(),{email:q}=V.user,k=r(!1),Q=r(""),p=r(!1),{params:i}=D(),u=r([]),d=r([]),f=r([]),g=r(!1),h=r({th_ajaran_h:i.th_ajaran_h||""}),j=W(new Date,"yyyy-MM-dd HH:mm:ss",{locale:X})+" ~ "+q||"",m=r("");async function S(){try{p.value=!0;const s={th_ajaran_h:i.th_ajaran_h,tingkat_id:i.tingkat_id,kelas:i.kelas},a=await L.getAll({params:s,notifySuccess:!1});u.value=a.murid}catch(s){console.error("ðŸš€ ~ loadData ~ error:",s)}finally{p.value=!1}}U(async()=>{i.th_ajaran_h&&i.tingkat_id&&i.kelas?await S():u.value=[]});async function C(){if(!d.value.length)return x("Pilih murid terlebih dahulu");if(!f.value.length)return x("Pilih paket terlebih dahulu");const s={th_ajaran_h:h.value.th_ajaran_h,va_group:m.value,santri_id:d.value.map(n=>n.santri_id),paket:f.value.map(n=>({item:n.item,nominal:n.nominal}))},a=`PERHATIAN<br/>
			Jika item iuran sudah terdapat dalam daftar maka akan diabaikan.
			<hr/>
			<span style="color:red">Kesalahan akibat aksi ini sulit ditelusuri dan harus diperbaiki satu per satu.</span>`;try{g.value=!0,await O.storePaketMassal({data:s,message:a})}catch(n){console.error("ðŸš€ ~ onSubmit ~ error:",n)}finally{g.value=!1}}const P=[{name:"santri_id",label:"ID Santri",align:"left",field:"santri_id",sortable:!0},{name:"nama",label:"Nama",align:"left",field:"nama",sortable:!0},{name:"domisili",label:"Domisili",align:"left",field:"domisili",sortable:!0},{name:"status",label:"Status",align:"left",field:"status",sortable:!0},{name:"wali",label:"Wali",align:"left",field:s=>`${s.wali_nama} (${s.wali_sex}; ${s.wali_status})`,sortable:!0}];return(s,a)=>{const n=w("CardHeader"),T=w("CardPage");return M(),I(T,null,{default:o(()=>[t(n,{"show-reload":!1,title:"Modul Tagihan"}),t(c,{class:"q-pa-sm"},{default:o(()=>[t(R,{bordered:"",flat:"","show-ujian-ke":!1,"start-url":"/iuran/tagihan",onDataFilter:a[0]||(a[0]=e=>Q.value=e)}),l("div",Y,[l("div",Z,[t(F,{flat:"",bordered:"","table-header-class":"bg-green-2 text-green-10 text-subtitle1",class:"dt",rows:u.value,columns:P,loading:p.value,"row-key":"id",selection:"multiple",selected:d.value,"onUpdate:selected":a[1]||(a[1]=e=>d.value=e),"rows-per-page-options":[0],"hide-bottom":"",style:{height:"70vh"},"virtual-scroll":""},{"header-selection":o(e=>[t(v,{modelValue:e.selected,"onUpdate:modelValue":_=>e.selected=_,color:"green-7","checked-icon":"check","unchecked-icon":"clear"},null,8,["modelValue","onUpdate:modelValue"])]),"body-selection":o(e=>[t(v,{modelValue:e.selected,"onUpdate:modelValue":_=>e.selected=_,color:"green-5","checked-icon":"check","unchecked-icon":"clear"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["rows","loading","selected"])]),l("div",aa,[t(B,{bordered:"",flat:"",class:"q-ml-sm scroll",style:{height:"70vh"}},{default:o(()=>[t(c,{class:"q-px-sm q-py-md bg-green-2 text-green-10 text-subtitle2"},{default:o(()=>[...a[6]||(a[6]=[H(" Buat Tagihan Massal ",-1)])]),_:1}),t(c,{class:"q-pa-sm"},{default:o(()=>[l("table",null,[l("tbody",null,[l("tr",ea,[a[7]||(a[7]=l("td",{class:"text-no-wrap text-italic q-pr-md"},"Jumlah Murid",-1)),l("td",null,b(u.value.length),1)]),l("tr",ta,[a[8]||(a[8]=l("td",{class:"text-no-wrap text-italic q-pr-md"},"Terpilih",-1)),l("td",null,b(d.value.length)+" santri "+b(d.value.map(e=>e.santri_id)),1)]),l("tr",la,[a[9]||(a[9]=l("td",{class:"text-no-wrap text-italic q-pr-md"},"VA Group",-1)),l("td",sa,[t(v,{dense:"",modelValue:k.value,"onUpdate:modelValue":[a[2]||(a[2]=e=>k.value=e),a[3]||(a[3]=e=>e?m.value=N(j):m.value="")],color:"green",label:m.value},null,8,["modelValue","label"])])])])])]),_:1}),t(c,{class:"q-pa-sm"},{default:o(()=>[t($,{label:"Tahun Ajaran",outlined:"",dense:"",modelValue:h.value.th_ajaran_h,"onUpdate:modelValue":a[4]||(a[4]=e=>h.value.th_ajaran_h=e),disable:""},null,8,["modelValue"]),t(z,{class:"q-mt-sm",onOnInput:a[5]||(a[5]=e=>f.value=e)})]),_:1}),t(E,{class:"q-pa-sm bg-green-6 absolute-bottom"},{default:o(()=>[t(y,{label:"Unduh Data",glossy:"",color:"green-9",class:"text-green-11","no-caps":"",icon:"download",to:"/iuran/download"}),t(K),t(y,{label:"Simpan",glossy:"",outline:"",color:"green-10",class:"bg-green-11 right-0","no-caps":"",icon:"save",onClick:C})]),_:1}),t(J,{showing:g.value},{default:o(()=>[t(G,{color:"green-6",size:"6em"})]),_:1},8,["showing"])]),_:1})])])]),_:1})]),_:1})}}};export{Na as default};
