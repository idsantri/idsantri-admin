import{Q as q,a as K}from"./QToolbar-BY4F4qai.js";import{q as c,ad as m,ac as j,s as f,N as v,c as _,o as p,w as U,g as k,Q as T,r as S,a as B,e as P,f as $,l as D}from"./index-BTpW0qoK.js";import{Q as L}from"./QSpace-DOX5ArmE.js";import{l as h}from"./lists-madrasah-store-DeRmrEKz.js";import{Q as y}from"./QSelect-DLG5Hk7y.js";import{K as w}from"./Kelas-TEBsR-rh.js";import{A as M}from"./AbsensiSetting-BR4IpdVX.js";import{n as A}from"./index-pGTdy6rp.js";import{A as Q}from"./ApiCrud-D-UyIn70.js";const C={__name:"SelectTahunAjaran",props:{startUrl:{type:String,required:!0},routerPush:{type:Boolean,default:!0}},setup(i){const s=i,e=c([]),{params:n}=m(),o=c(n.th_ajaran_h),l=c(!1),u=j();return f(async()=>{const r=h().getThAjaran;if(r?.length)e.value=r;else try{l.value=!0;const a=await w.list();h().setThAjaran(a.th_ajaran),e.value=a.th_ajaran}catch(a){console.error("üöÄ ~ error:",a)}finally{l.value=!1}}),v(o,(r,a)=>{if(s.routerPush){if(!r){u.push(`${s.startUrl}`);return}if(r!=a){u.push(`${s.startUrl}/${r}`);return}}else return}),(r,a)=>(p(),_(y,{dense:"",outlined:"",label:"Tahun Ajaran",modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=t=>o.value=t),options:e.value,"option-value":"th_ajaran_h","option-label":"th_ajaran_h","emit-value":"","map-options":"",loading:l.value,behavior:"menu"},null,8,["modelValue","options","loading"]))}},V={__name:"SelectTingkat",props:{startUrl:{type:String,required:!0},routerPush:{type:Boolean,default:!0}},setup(i){const s=i,e=c([]),n=c(!1),o=j(),{params:l}=m(),u=c(l.tingkat_id),r=`${s.startUrl}/${l.th_ajaran_h}`;return f(async()=>{if(l.th_ajaran_h){const a=h().getTingkatByTahun(l.th_ajaran_h);if(a?.length)e.value=a;else try{n.value=!0;const t=await w.list({th_ajaran_h:l.th_ajaran_h});h().addTingkatToTahun(t.tingkat,l.th_ajaran_h),e.value=t.tingkat}catch(t){console.error("üöÄ ~ error:",t)}finally{n.value=!1}}}),v(u,(a,t)=>{if(s.routerPush){if(!a){o.push(r);return}if(a!=t){o.push(`${r}/${a}`);return}}else return}),(a,t)=>(p(),_(y,{dense:"",outlined:"",label:"Tingkat",modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=d=>u.value=d),options:e.value,"option-value":"tingkat_id","option-label":"tingkat","emit-value":"","map-options":"",loading:n.value,behavior:"menu",clearable:""},null,8,["modelValue","options","loading"]))}},F={__name:"SelectKelas",props:{startUrl:{type:String,required:!0},routerPush:{type:Boolean,default:!0}},emits:["onSelect"],setup(i,{emit:s}){const e=i,n=s,o=c([]),{params:l}=m(),u=c(l.kelas),r=c(!1),a=j(),t=`${e.startUrl}/${l.th_ajaran_h}/${l.tingkat_id}`;return f(async()=>{if(l.th_ajaran_h&&l.tingkat_id){const d=h().getKelasByTingkatAndTahun(l.tingkat_id,l.th_ajaran_h);if(d?.length)o.value=d;else try{r.value=!0;const g=await w.list({th_ajaran_h:l.th_ajaran_h,tingkat_id:l.tingkat_id});h().addKelasToTingkatByTahun(g.kelas,l.tingkat_id,l.th_ajaran_h),o.value=g.kelas}catch(g){console.error("üöÄ ~ error:",g)}finally{r.value=!1}}}),v(u,(d,g)=>{if(e.routerPush){if(!d){a.push(t);return}if(d!=g){let b="";l.bulan_ujian?b="/"+l.bulan_ujian:l.ujian_ke&&(b="/"+l.ujian_ke),a.push(`${t}/${d}${b}`),n("onSelect",d);return}}else return}),(d,g)=>(p(),_(y,{dense:"",outlined:"",label:"Kelas",modelValue:u.value,"onUpdate:modelValue":g[0]||(g[0]=b=>u.value=b),options:o.value,"emit-value":"","map-options":"",loading:r.value,clearable:"",behavior:"menu"},null,8,["modelValue","options","loading"]))}},N={__name:"SelectUjianKe",props:{startUrl:{type:String,required:!0},arrUjian:{type:Array,required:!0},routerPush:{type:Boolean,default:!0}},setup(i){const s=i,e=c([]),{params:n}=m(),o=c(n.ujian_ke),l=j(),u=`${s.startUrl}/${n.th_ajaran_h}/${n.tingkat_id}/${n.kelas}`;return f(()=>{n.th_ajaran_h&&n.tingkat_id&&n.kelas&&(e.value=h().getUjian.filter(r=>s.arrUjian.includes(r.value)))}),v(o,(r,a)=>{if(s.routerPush){if(!r){l.push(u);return}if(r!=a){l.push(`${u}/${r}`);return}}else return}),(r,a)=>(p(),_(y,{dense:"",outlined:"",label:"Cawu/Semester",modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=t=>o.value=t),options:e.value,"option-value":"value","option-label":"label","emit-value":"","map-options":"",clearable:"",behavior:"menu"},null,8,["modelValue","options"]))}},I={__name:"SelectBulanUjianSetting",props:{startUrl:{type:String,required:!0},routerPush:{type:Boolean,default:!0}},setup(i){const s=i,{params:e}=m(),n=j(),o=c(e.bulan_ujian),l=c(!1),u=c([]),r=`${s.startUrl}/${e.th_ajaran_h}/${e.tingkat_id}/${e.kelas||"*"}`;return f(async()=>{if(e.tingkat_id){const a=h().getBulanUjianSettingByTingkatId(e.tingkat_id);if(a?.length)u.value=a;else try{l.value=!0;const t=await M.getAll({params:{tingkat_id:e.tingkat_id},notifySuccess:!1});if(!t?.bulan_ujian?.length){A("Jadwal ujian untuk jenjang ini belum diatur.<br>Silakan masuk ke menu pengaturan (kanan atas)!");return}h().addBulanUjianSetting(t.bulan_ujian),u.value=t.bulan_ujian}catch(t){console.error("üöÄ ~ error:",t)}finally{l.value=!1}}}),v(o,(a,t)=>{if(s.routerPush){if(!a){n.push(r);return}if(a!=t){n.push(`${r}/${a}`);return}}else return}),(a,t)=>(p(),_(y,{dense:"",outlined:"",label:"Bulan (Ujian)",modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=d=>o.value=d),options:u.value,"option-value":"bu","option-label":"bulan_ujian","emit-value":"","map-options":"",loading:l.value,clearable:"",behavior:"menu"},null,8,["modelValue","options","loading"]))}};class x extends Q{constructor(s){super("absensi"),this._path=`${this._path}/${s}`}update(){throw new Error("Method not implemented.")}getById(){throw new Error("Method not implemented.")}remove(){throw new Error("Method not implemented.")}async removeAbsensi(s={}){if(!await this._notifyConfirm('<span style="color:red">Hapus data absensi untuk kelas ini?</span>'))return!1;const n=await this._apiDelete({endPoint:`${this._path}`,params:s});return this._showSuccess(n.message),n.data||!0}async getRekapUjian(s={}){return(await this._apiGet({endPoint:`${this._path}/rekap-ujian`,params:s})).data}async getNotNull(s={}){return(await this._apiGet({endPoint:`${this._path}/not-null`,params:s})).data}async getListBulanUjian(s={}){return(await this._apiGet({endPoint:`${this._path}/lists/bulan-ujian`,params:s})).data}}class E{Sekolah=new x("sekolah");Musyawarah=new x("musyawarah");async getListBulanUjian(s,e={}){if(s==="sekolah")return await this.Sekolah.getListBulanUjian(e);if(s==="musyawarah")return await this.Musyawarah.getListBulanUjian(e);throw new Error("Model tidak dikenali")}}const R=new E,G={__name:"SelectBulanUjianList",props:{startUrl:{type:String,required:!0},routerPush:{type:Boolean,default:!0}},setup(i){const s=i,{params:e}=m(),n=j(),o=c(e.list_bulan_ujian),l=c(!1),u=c([]),r=`${s.startUrl}/${e.th_ajaran_h}/${e.tingkat_id}`;return f(async()=>{if(e.th_ajaran_h&&e.tingkat_id){const a=h().getBulanUjianListByTahunAndTingkatId(e.th_ajaran_h,e.tingkat_id);if(a?.length)u.value=a;else try{l.value=!0;const t=await R.getListBulanUjian(e.absensi,{th_ajaran_h:e.th_ajaran_h,tingkat_id:e.tingkat_id});if(!t.bulan_ujian?.length){A("Tidak ada laporan untuk filter yang dipilih!");return}h().addBulanUjianList(t.bulan_ujian),u.value=t.bulan_ujian}catch(t){console.error("üöÄ ~ error:",t)}finally{l.value=!1}}}),v(o,(a,t)=>{if(s.routerPush){if(!a){n.push(r);return}if(a!=t){n.push(`${r}/${a}`);return}}else return}),(a,t)=>(p(),_(y,{dense:"",outlined:"",label:"Bulan (Ujian)",modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=d=>o.value=d),options:u.value,"option-value":"bu","option-label":"bulan_ujian","emit-value":"","map-options":"",loading:l.value,clearable:"",behavior:"menu"},null,8,["modelValue","options","loading"]))}},H={class:"text-subtitle1"},J=["innerHTML"],W={class:"row",style:{"max-width":"1000px",width:"100%"}},z={class:"q-pr-sm"},ra={__name:"FilterKelas",props:{startUrl:{type:String,required:!0},title:{type:String,default:"Filter Kelas"},showTingkat:{type:Boolean,default:!0},showKelas:{type:Boolean,default:!0},showUjianKe:{type:Boolean,default:!1},showSetBulanUjian:{type:Boolean,default:!1},showListBulanUjian:{type:Boolean,default:!1}},emits:["dataFilter"],setup(i,{emit:s}){const e=s,{params:n}=m(),o=c(0);function l(){h().$reset(),o.value++}f(()=>{e("dataFilter",u())});function u(){let r="<em>Tentukan Filter!</em>";if(n.th_ajaran_h&&(r='‚û°Ô∏è <em class="text-weight-light">Tahun Ajaran: </em><strong>'+n.th_ajaran_h+"</strong>"),n.tingkat_id){const a=h().getAllTingkat();if(a.length){const t=a.find(d=>d.tingkat_id==n.tingkat_id);r+=' ‚û°Ô∏è <em class="text-weight-light">Tingkat: </em><strong>'+t.tingkat+"</strong>"}}if(n.kelas&&(r+=' ‚û°Ô∏è <em class="text-weight-light">Kelas: </em><strong>'+n.kelas+"</strong>"),n.ujian_ke){const a=h().getUjian.find(t=>t.value==n.ujian_ke);r+=' ‚û°Ô∏è <em class="text-weight-light">Ujian Ke: </em><strong>'+a.label+"</strong>"}if(n.bulan_ujian){const t=h().getBulanUjianSettingByTingkatId(n.tingkat_id).find(d=>d.bu==n.bulan_ujian);r+=' ‚û°Ô∏è <em class="text-weight-light">Bulan (Ujian): </em><strong>'+t.bulan_ujian+"</strong>"}if(n.list_bulan_ujian){const t=h().getBulanUjianListByTahunAndTingkatId(n.th_ajaran_h,n.tingkat_id).find(d=>d.bu==n.list_bulan_ujian);r+=' ‚û°Ô∏è <em class="text-weight-light">Bulan (Ujian): </em><strong>'+t.bulan_ujian+"</strong>"}return r}return(r,a)=>(p(),_(D,{flat:"",bordered:""},{default:U(()=>[k(T,{class:"q-px-sm q-py-sm bg-green-11"},{default:U(()=>[k(q,{class:"no-padding",style:{"min-height":"0"}},{default:U(()=>[k(K,{class:"text-subtitle1"},{default:U(()=>[B("div",H,[B("span",{innerHTML:i.title},null,8,J)])]),_:1}),k(P,{icon:"sync",dense:"",flat:"",class:"q-mr-xs",onClick:l}),S(r.$slots,"default")]),_:3})]),_:3}),(p(),_(T,{class:"no-padding flex flex-center",key:o.value},{default:U(()=>[B("div",W,[k(C,{class:"col-12 col-md-3 q-pa-sm","start-url":i.startUrl},null,8,["start-url"]),i.showTingkat?(p(),_(V,{key:0,class:"col-12 col-md-3 q-pa-sm","start-url":i.startUrl},null,8,["start-url"])):$("",!0),i.showKelas?(p(),_(F,{key:1,class:"col-12 col-md-3 q-pa-sm","start-url":i.startUrl},null,8,["start-url"])):$("",!0),i.showUjianKe?(p(),_(N,{key:2,class:"col-12 col-md-3 q-pa-sm","start-url":i.startUrl,"arr-ujian":[1,2,3]},null,8,["start-url"])):$("",!0),i.showSetBulanUjian?(p(),_(I,{key:3,class:"col-12 col-md-3 q-pa-sm","start-url":i.startUrl},null,8,["start-url"])):$("",!0),i.showListBulanUjian?(p(),_(G,{key:4,class:"col-12 col-md-3 q-pa-sm","start-url":i.startUrl},null,8,["start-url"])):$("",!0)]),k(L),B("div",z,[S(r.$slots,"more")])]),_:3}))]),_:3}))}};export{R as A,ra as _};
