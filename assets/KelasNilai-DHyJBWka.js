import{Q as w}from"./QTab-CeNtmgKT.js";import{Q as I}from"./QSpace-RyUqKbav.js";import{q as x,ah as S,E as Q,b as k,o as p,g as e,a,w as f,bR as y,l as $,c as _,Q as N,v as b,F as M,D as R,t as m,a9 as F,e as j,s as K,N as E,C as B,ad as P,G as q,J as T}from"./index-DutRA_CO.js";import{Q as D}from"./QTabs-Bk8DSaVR.js";import{Q as z}from"./QMarkupTable-soH4YcMw.js";import{N as C}from"./NilaiMapel-C2mQDEHU.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QResizeObserver-B7htWBfh.js";import"./rtl-DFPa-2ov.js";import"./ApiCrud-CZFmsy5d.js";import"./Api-AjNxW92f.js";import"./index-BAyNzCk6.js";import"./index-Cpf3S9fo.js";import"./apiPost-BTbDNFlR.js";const H={class:"q-pa-none"},A={class:"bg-green-2 q-pr-sm"},G={class:"bg-green-11 q-pr-sm"},J={class:"q-pa-none q-mt-sm"},O={class:"text-left"},W={class:"text-center",style:{width:"100px"}},X={class:"text-center",style:{width:"100px"}},Y={class:"bg-green-11"},Z={class:"text-center"},aa={class:"text-center"},la={__name:"EditNilai",props:{kelasId:[String,Number]},emits:["update:nilaiMapel"],setup(i,{emit:r}){const u=i,d=r,o=x("ujian"),s=x(null),t=x([]),l=x(!1),V=async()=>{if(!(!u.kelasId||!s.value))try{l.value=!0;const g=await C.getAll({params:{kelas_id:u.kelasId,ujian_ke:s.value},notifySuccess:!1});t.value=g.nilai_mapel}catch(g){console.error("Error fetching nilai mapel:",g)}finally{l.value=!1}};S(()=>{V()});const v=async()=>{const g=t.value.map(h=>({kelas_id:h.kelas_id,mapel_id:h.mapel_id,nilai:o.value==="harian"?h.n_harian:h.n_ujian})),n={ujian_ke:s.value,kategori:o.value,data:g};try{l.value=!0,await C.create({data:n}),d("update:nilaiMapel",o.value)}catch(h){console.error("Error saving nilai mapel:",h)}finally{l.value=!1}};return(g,n)=>{const h=Q("CardLoading");return p(),k("div",null,[e(h,{showing:l.value},null,8,["showing"]),a("div",H,[e($,{flat:"",bordered:"",class:"tw:flex tw:items-center tw:w-full bg-transparent"},{default:f(()=>[n[6]||(n[6]=a("div",{class:"q-px-sm tw:flex-grow text-italic"},"Nilai:",-1)),a("div",A,[e(y,{modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=c=>s.value=c),val:1,label:"ke-1"},null,8,["modelValue"]),e(y,{modelValue:s.value,"onUpdate:modelValue":n[1]||(n[1]=c=>s.value=c),val:2,label:"ke-2"},null,8,["modelValue"]),e(y,{modelValue:s.value,"onUpdate:modelValue":n[2]||(n[2]=c=>s.value=c),val:3,label:"ke-3"},null,8,["modelValue"]),e(y,{modelValue:s.value,"onUpdate:modelValue":n[3]||(n[3]=c=>s.value=c),val:4,label:"ke-4"},null,8,["modelValue"])]),a("div",G,[e(y,{modelValue:o.value,"onUpdate:modelValue":n[4]||(n[4]=c=>o.value=c),val:"harian",label:"Harian"},null,8,["modelValue"]),e(y,{modelValue:o.value,"onUpdate:modelValue":n[5]||(n[5]=c=>o.value=c),val:"ujian",label:"Ujian"},null,8,["modelValue"])])]),_:1})]),a("div",J,[e($,{flat:"",bordered:"",class:""},{default:f(()=>[t.value.length==0&&!l.value?(p(),_(N,{key:0,class:"q-pa-sm text-italic"},{default:f(()=>[...n[7]||(n[7]=[b(" Pilih ujian ke-1, ke-2, ke-3, atau ke-4 untuk melihat nilai mapel pada ujian tersebut. ",-1),a("br",null,null,-1),b(" Pilih kategori harian atau ujian untuk melihat nilai harian atau nilai ujian. ",-1)])]),_:1})):(p(),_(N,{key:1,class:"q-pa-none"},{default:f(()=>[e(z,{flat:"",class:"text-green-10"},{default:f(()=>[n[9]||(n[9]=a("thead",null,[a("tr",null,[a("th",{class:"text-left"},"Mata Pelajaran"),a("th",{class:"text-center"},"Harian"),a("th",{class:"text-center"},"Ujian")])],-1)),a("tbody",null,[(p(!0),k(M,null,R(t.value,c=>(p(),k("tr",{key:c.mapel_id},[a("td",O,m(c.mapel_name),1),a("td",W,[e(F,{"input-class":"text-center",outlined:"",dense:"",modelValue:c.n_harian,"onUpdate:modelValue":U=>c.n_harian=U,disable:o.value=="ujian",filled:o.value=="ujian"},null,8,["modelValue","onUpdate:modelValue","disable","filled"])]),a("td",X,[e(F,{"input-class":"text-center",outlined:"",dense:"",modelValue:c.n_ujian,"onUpdate:modelValue":U=>c.n_ujian=U,disable:o.value=="harian",filled:o.value=="harian"},null,8,["modelValue","onUpdate:modelValue","disable","filled"])])]))),128))]),a("tfoot",Y,[a("tr",null,[n[8]||(n[8]=a("td",{class:"text-right text-italic"},"Simpan Nilai",-1)),a("td",Z,[e(j,{label:"Harian",color:"green-6",onClick:v,"no-caps":"",disable:o.value=="ujian"},null,8,["disable"])]),a("td",aa,[e(j,{label:"Ujian",color:"green-6",onClick:v,"no-caps":"",disable:o.value=="harian"},null,8,["disable"])])])])]),_:1})]),_:1}))]),_:1})])])}}},ea={key:0},ta={class:"text-right"},ia={class:"text-right"},na={class:"text-right"},sa={class:"text-right"},oa={class:"text-left"},ua={class:"text-left"},ra=["title"],da=["title"],ca=["title"],ma=["title"],va={title:"Nilai rata-rata",class:"text-right"},pa={class:"bg-green-2"},ba={class:"text-caption text-weight-bold text-green-10"},fa={class:"text-right"},ga={class:"text-right"},xa={class:"text-right"},ha={class:"text-right"},ka={class:"text-right"},_a={__name:"PivotNilai",props:{kelasId:[String,Number],tab:String},setup(i){const r=i,u=x([{}]),d=x(!1);async function o(t){try{d.value=!0;const l=await C.pivotByKelas(r.kelasId,t);u.value=l.nilai_mapel}catch(l){console.error("ðŸš€ ~ getNilaiPivot ~ error:",l)}finally{d.value=!1}}function s(t,l){let V=0,v=0;if(t?.length){t.forEach(n=>{n[l]!==null&&(V+=parseFloat(n[l]),v++)});const g=V/v;return isNaN(g)?null:g}else return null}return K(async()=>{await o(r.tab)}),E(()=>r.tab,async t=>{await o(t)}),(t,l)=>{const V=Q("CardLoading");return p(),k("div",null,[e(V,{showing:d.value},null,8,["showing"]),u.value?.length==0?(p(),k("div",ea,[...l[0]||(l[0]=[a("div",{class:"flex flex-center q-pa-lg text-center text-negative text-italic"},[b(" Tidak ada untuk ditampilkan "),a("br"),b("Silakan input nilai terlebih dahulu! ")],-1)])])):(p(),_(z,{key:1,flat:"",bordered:""},{default:f(()=>[a("thead",null,[a("tr",null,[l[1]||(l[1]=a("th",{class:"text-left"},"Kode",-1)),l[2]||(l[2]=a("th",{class:"text-left"},"Mapel",-1)),a("th",ta,m(i.tab.substring(0,1).toUpperCase()+"-1"),1),a("th",ia,m(i.tab.substring(0,1).toUpperCase()+"-2"),1),a("th",na,m(i.tab.substring(0,1).toUpperCase()+"-3"),1),a("th",sa,m(i.tab.substring(0,1).toUpperCase()+"-4"),1),l[3]||(l[3]=a("th",{class:"text-right"},"Rerata",-1))])]),a("tbody",null,[(p(!0),k(M,null,R(u.value,(v,g)=>(p(),k("tr",{key:g},[a("td",oa,m(v.id),1),a("td",ua,m(v.name),1),a("td",{title:"Nilai "+i.tab+" pada ujian ke-1",class:"text-right"},m(v.nilai_1),9,ra),a("td",{title:"Nilai "+i.tab+" pada ujian ke-2",class:"text-right"},m(v.nilai_2),9,da),a("td",{title:"Nilai "+i.tab+" pada ujian ke-3",class:"text-right"},m(v.nilai_3),9,ca),a("td",{title:"Nilai "+i.tab+" pada ujian ke-4",class:"text-right"},m(v.nilai_4),9,ma),a("td",va,m(isNaN(v.rerata)||v.rerata==null?null:i.tab=="rapor"||i.tab=="ijazah"?parseFloat(v.rerata).toFixed(1):parseFloat(v.rerata).toFixed(2)),1)]))),128))]),a("tfoot",pa,[a("tr",ba,[l[4]||(l[4]=a("td",{colspan:"2"},"Rata-Rata",-1)),a("td",fa,m(i.tab=="rapor"||i.tab=="ijazah"?s(u.value,"nilai_1")?.toFixed(1):s(u.value,"nilai_1")?.toFixed(2)),1),a("td",ga,m(i.tab=="rapor"||i.tab=="ijazah"?s(u.value,"nilai_2")?.toFixed(1):s(u.value,"nilai_2")?.toFixed(2)),1),a("td",xa,m(i.tab=="rapor"||i.tab=="ijazah"?s(u.value,"nilai_3")?.toFixed(1):s(u.value,"nilai_3")?.toFixed(2)),1),a("td",ha,m(i.tab=="rapor"||i.tab=="ijazah"?s(u.value,"nilai_4")?.toFixed(1):s(u.value,"nilai_4")?.toFixed(2)),1),a("td",ka,m(i.tab=="rapor"||i.tab=="ijazah"?s(u.value,"rerata")?.toFixed(1):s(u.value,"rerata")?.toFixed(2)),1)])])]),_:1}))])}}},ja={};function Va(i,r,u,d,o,s){return p(),_($,{class:"bg-green-1"},{default:f(()=>[e(N,{class:"q-pa-sm bg-green-8 text-green-11 flex items-center justify-between"},{default:f(()=>[r[1]||(r[1]=a("div",{class:"text-subtitle1"},"Perhatian",-1)),e(j,{icon:"close",flat:"",class:"",onClick:r[0]||(r[0]=t=>i.showInfo=!1),dense:""})]),_:1}),e(N,{class:""},{default:f(()=>[r[2]||(r[2]=a("div",null,[a("div",{class:"text-subtitle2"},"Kalkulasi Rerata Nilai Mapel"),a("div",{class:"text-caption text-italic text-red-10"},[b(" (Kosong ("),a("strong",null,"null"),b(") TIDAK sama dengan angka "),a("strong",null,"0"),b(") ")]),a("ul",null,[a("li",null,[b("75 + 75 + 75 = 225 Ã· 3 = "),a("strong",null,"75")]),a("li",null,[b(" 75 + 0 + 75 = 150 Ã· 3 = "),a("strong",null,"50"),b(" Â  "),a("em",null,"(0 tetap dihitung nilai, masuk pembagi)")]),a("li",null,[b(" 75 + '' + 75 = 150 Ã· 2 = "),a("strong",null,"75"),b(" Â  "),a("em",null,"(Kosong ('') bukan nilai, tidak masuk pembagi)")])])],-1)),e(B,{class:"q-my-md"}),r[3]||(r[3]=a("div",{class:""},[a("div",{class:"text-subtitle2"},"Kalkulasi Nilai Rapor dan Ijazah"),a("ul",null,[a("li",null,[b(" Dengan nilai harian: "),a("br"),a("code",null," (((nilai_ujian + nilai_remedial) * 2) + nilai_harian) / 3 / 10 ")]),a("li",null,[b(" Tanpa nilai harian: "),a("br"),a("code",null," (nilai_ujian + nilai_remedial) / 10 ")]),a("li",null,"Berlaku standar nilai-minimal-rapor dan nilai-minimal-ijazah.")])],-1))]),_:1})]),_:1})}const ya=L(ja,[["render",Va],["__scopeId","data-v-689d65dc"]]),Na={key:1,class:"bg-green-2 text-green-10 flex items-center q-pa-sm"},Ba={__name:"KelasNilai",setup(i){const r=x("ujian"),u=P(),d=x(!1),o=x(!1);return(s,t)=>(p(),_($,{flat:"",bordered:"",class:"bg-green-1"},{default:f(()=>[d.value?(p(),k("div",Na,[t[7]||(t[7]=a("div",{class:"text-subtitle2"},"Input Nilai Mapel",-1)),e(I),e(j,{icon:"info",flat:"",class:"",onClick:t[3]||(t[3]=l=>o.value=!0)}),e(j,{icon:d.value?"edit_off":"edit",flat:"",class:"",onClick:t[4]||(t[4]=l=>d.value=!d.value)},null,8,["icon"])])):(p(),_(D,{key:0,"no-caps":"","outside-arrows":"","mobile-arrows":"",class:"bg-green-2 text-green-10",modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=l=>r.value=l)},{default:f(()=>[e(w,{name:"harian",label:"Harian"}),e(w,{name:"ujian",label:"Ujian"}),e(w,{name:"rapor",label:"Rapor",disable:d.value},null,8,["disable"]),e(w,{name:"ijazah",label:"Ijazah",disable:d.value},null,8,["disable"]),e(I),e(j,{icon:"info",flat:"",class:"",onClick:t[0]||(t[0]=l=>o.value=!0)}),e(j,{icon:d.value?"edit_off":"edit",flat:"",class:"q-mr-sm",onClick:t[1]||(t[1]=l=>d.value=!d.value)},null,8,["icon"])]),_:1},8,["modelValue"])),d.value?(p(),_(N,{key:3,class:"q-pa-sm"},{default:f(()=>[e(la,{kelasId:q(u).params.id,"onUpdate:nilaiMapel":t[5]||(t[5]=l=>{r.value=l,d.value=!1})},null,8,["kelasId"])]),_:1})):(p(),_(N,{key:2,class:"q-pa-sm"},{default:f(()=>[e(_a,{kelasId:q(u).params.id,tab:r.value},null,8,["kelasId","tab"])]),_:1})),e(T,{modelValue:o.value,"onUpdate:modelValue":t[6]||(t[6]=l=>o.value=l)},{default:f(()=>[e(ya)]),_:1},8,["modelValue"])]),_:1}))}};export{Ba as default};
