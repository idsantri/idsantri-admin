import{A as w,B as Q,c as _,o as k,w as e,b as a,ab as N,e as L,C as $,Q as T,a5 as b,x as H,a6 as K,U as E,g as v,l as A,t as i,a1 as U,z as y,k as O,a as R,E as h}from"./index-DwrbA0R8.js";import{Q as B}from"./QItemLabel-Dzdetwv2.js";import{Q as M,a as p}from"./QItemSection-CeSY4hvW.js";import{Q as j}from"./QList-Cc6jCv1k.js";import{Q as z}from"./QBtnDropdown-DqbNLFX1.js";import{Q as G,a as f}from"./QTable-BIqFScuN.js";import{Q as P}from"./QTr-R9A0HBj-.js";import{Q as c}from"./QTd-CWnMEFGa.js";import{Q as W}from"./QPage-BU8r9xHl.js";import{C as F}from"./ClosePopup-kZj4_oIv.js";import{a as J}from"./api-delete-Bg9l1TPr.js";import{a as I}from"./api-get-D4W4lze7.js";import{a as X}from"./api-post-D71-L22w.js";import{l as Y}from"./loading-store-DcVNMmYX.js";import{n as Z}from"./index-BlZcD66n.js";import{Q as aa}from"./QForm-DCEv1Ikv.js";import{_ as ea}from"./InputSelectArray-DFe88pva.js";import{A as ta}from"./ApiCrud-KwrbSuI8.js";import{u as la}from"./useCrudForm-DF0rM6hG.js";import"./QBtnGroup-CPjXoyXA.js";import"./QMenu-BEnErdhw.js";import"./selection-DRCgFU0J.js";import"./QMarkupTable-DzcRgr6j.js";import"./QSelect-CrgZ1FsI.js";import"./QChip-DvUCR8tL.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-C-VxiWHj.js";import"./index-B6LiMDVO.js";import"./api-error-DGWaEiw1.js";import"./lists-store-Cp7AZ7Mr.js";import"./DropDownAfter-D2Wgui76.js";import"./Lists-g9uME9Wy.js";import"./Api-DWdZFNbG.js";class sa extends ta{constructor(){super("mutasi")}}const oa=new sa,ia={__name:"MutasiForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(D,{emit:u}){const d=u,n=D,o=w({...n.data}),{handleDelete:x,handleUpdate:r,loading:C}=la(oa,{emit:d,responseKey:"mutasi"});async function q(){const g={new_domisili:o.value.new_domisili,new_keterangan:o.value.new_keterangan};return await r(n.data.id,g,!0)}async function S(){return await x(n.data.id)}return(g,s)=>{const t=Q("FormHeader"),V=Q("FormLoading"),l=Q("FormActions");return k(),_(H,{class:"full-width",style:{"max-width":"425px"}},{default:e(()=>[a(aa,{onSubmit:N(q,["prevent"])},{default:e(()=>[a(t,{title:"Data Domisili Baru","is-new":!1}),$(C)?(k(),_(V,{key:0})):L("",!0),a(T,null,{default:e(()=>[a(b,{"model-value":o.value.nama+" ("+o.value.santri_id+")",class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Nama (ID)"},null,8,["model-value"]),a(b,{"model-value":o.value.tingkat+" — "+o.value.kelas,class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Tingkat — Kelas"},null,8,["model-value"]),a(b,{"model-value":o.value.domisili,class:"q-my-sm",disable:"",filled:"",dense:"",outlined:"",label:"Domisili (Asal)"},null,8,["model-value"]),a(ea,{modelValue:o.value.new_domisili,"onUpdate:modelValue":s[0]||(s[0]=m=>o.value.new_domisili=m),url:"domisili",label:"Domisili (Baru) *",class:"q-my-sm",rules:[m=>!!m||"Harus diisi!"],clearable:!1},null,8,["modelValue","rules"]),a(b,{modelValue:o.value.new_keterangan,"onUpdate:modelValue":s[1]||(s[1]=m=>o.value.new_keterangan=m),class:"q-my-sm",dense:"",outlined:"",label:"Keterangan (Baru)",autogrow:!0},null,8,["modelValue"])]),_:1}),a(l,{"btn-delete":!0,onOnDelete:S})]),_:1})]),_:1})}}},Ka={__name:"ResultMutasi",setup(D){const u=w([]),d=w(!1),n=w(!1),o=w({}),{loadingMain:x}=K(Y());async function r(){const s=await I({endPoint:"mutasi",loading:d});s&&(u.value=s.mutasi.map(t=>({...t,tk:t.tingkat_id+" "+t.kelas})))}E(async()=>{await r()});async function C(s){o.value=s,n.value=!0}async function q(){await X({endPoint:"mutasi/execute",data:null,loading:d,confirm:!0,message:`<hr><span style="color:blue">Update Domisili?</span><hr>
		<em>
			<strong>Peringatan:</strong>
			<ul style="margin:0">
				<li>Pastikan semua keperluan Administrasi (terkait domisili asal) telah selesai!</li>
				<li>Sebaiknya data di-download/ diunduh terlebih dahulu sebagai backup!</li>
				<li>Setelah update selesai, semua data mutasi akan <strong>dihapus</strong>!</li>
			</ul>
		</em>`})&&await r()}async function S(){await J({endPoint:"mutasi/clean",loading:d,message:"Hapus semua data mutasi?"})&&(u.value=[])}async function g(){const s=await I({endPoint:"export/mutasi",loading:x,notify:!0});if(!s)return;if(!s.url)return Z("Url tidak ditemukan");const t=document.createElement("a");t.href=s.url,t.click(),t.remove()}return(s,t)=>{const V=Q("CardHeader");return k(),_(W,{class:"q-pa-sm"},{default:e(()=>[a(H,{class:""},{default:e(()=>[a(V,{title:"Data Mutasi Domisili",onOnReload:r},{right:e(()=>[a(v,{icon:"tune",label:"Atur Mutasi",dense:"",outline:"","no-caps":"",class:"q-ml-sm q-px-sm",to:"/mutasi/start"}),a(z,{flat:"",dense:"","dropdown-icon":"more_vert",class:"q-ml-sm",color:"green-11"},{default:e(()=>[a(j,null,{default:e(()=>[A((k(),_(M,{to:"/info/download"},{default:e(()=>[a(p,null,{default:e(()=>[a(B,null,{default:e(()=>[...t[1]||(t[1]=[i("Cetak",-1)])]),_:1})]),_:1}),a(p,{avatar:""},{default:e(()=>[a(U,{name:"print",flat:""})]),_:1})]),_:1})),[[F]]),A((k(),_(M,{onClick:g,clickable:""},{default:e(()=>[a(p,null,{default:e(()=>[a(B,null,{default:e(()=>[...t[2]||(t[2]=[i("Unduh/Download",-1)])]),_:1})]),_:1}),a(p,{avatar:""},{default:e(()=>[a(U,{name:"download",flat:""})]),_:1})]),_:1})),[[F]]),A((k(),_(M,{onClick:S,clickable:""},{default:e(()=>[a(p,null,{default:e(()=>[a(B,null,{default:e(()=>[...t[3]||(t[3]=[i("Hapus Semua",-1)])]),_:1})]),_:1}),a(p,{avatar:""},{default:e(()=>[a(U,{name:"delete_forever",flat:""})]),_:1})]),_:1})),[[F]])]),_:1})]),_:1})]),_:1}),a(T,{class:"q-pa-sm"},{default:e(()=>[a(G,{class:"q-pa-sm",rows:u.value,loading:d.value,"rows-per-page-options":[10,25,50,75,100,0],flat:"",bordered:""},{header:e(l=>[a(P,{props:l},{default:e(()=>[a(f,{key:"santri_id",props:l,class:"text-left"},{default:e(()=>[...t[4]||(t[4]=[i(" ID Santri ",-1)])]),_:1},8,["props"]),a(f,{key:"nama",props:l},{default:e(()=>[...t[5]||(t[5]=[i(" Nama ",-1)])]),_:1},8,["props"]),a(f,{key:"tk",props:l},{default:e(()=>[...t[6]||(t[6]=[i(" Tingkat — Kelas ",-1)])]),_:1},8,["props"]),a(f,{key:"domisili",props:l},{default:e(()=>[...t[7]||(t[7]=[i(" Domisili (Asal) ",-1)])]),_:1},8,["props"]),a(f,{key:"new_domisili",props:l},{default:e(()=>[...t[8]||(t[8]=[i(" Domisili (Baru) ",-1)])]),_:1},8,["props"]),a(f,{class:"text-center"})]),_:2},1032,["props"])]),body:e(l=>[a(P,{props:l},{default:e(()=>[a(c,{key:"santri_id",props:l,class:"text-left"},{default:e(()=>[a(v,{label:l.row.santri_id,outline:"",color:"green-10",class:"text-caption q-px-sm",dense:"",to:`/santri/${l.row.santri_id}`},null,8,["label","to"])]),_:2},1032,["props"]),a(c,{key:"nama",props:l},{default:e(()=>[i(y(l.row.nama),1)]),_:2},1032,["props"]),a(c,{key:"tk",props:l},{default:e(()=>[i(y(l.row.tk),1)]),_:2},1032,["props"]),a(c,{key:"domisili",props:l},{default:e(()=>[i(y(l.row.domisili),1)]),_:2},1032,["props"]),a(c,{key:"new_domisili",props:l},{default:e(()=>[i(y(l.row.new_domisili),1)]),_:2},1032,["props"]),a(c,{key:"id",props:l,class:"text-center"},{default:e(()=>[a(v,{icon:"edit",flat:"",color:"green-10",onClick:m=>C(l.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1}),a(O,{class:"q-pa-sm bg-green-7 text-green-11 row"},{default:e(()=>[t[9]||(t[9]=R("div",{class:"col text-italic"}," 1) Teliti kembali sebelum Anda menekan tombol Update; 2) Lakukan backup data dengan menekan tombol download!; ",-1)),a(v,{style:{"max-width":"150px"},class:"col bg-green-8 q-ml-md",label:"Update Domisili",glossy:"","no-caps":"",dense:"",outline:"",icon:"settings_applications",disable:!u.value.length>0,onClick:q},null,8,["disable"])]),_:1})]),_:1}),a(h,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l)},{default:e(()=>[a(ia,{data:o.value,onSuccessDelete:r,onSuccessSubmit:r},null,8,["data"])]),_:1},8,["modelValue"])]),_:1})}}};export{Ka as default};
