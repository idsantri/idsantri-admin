import{Q as le}from"./QList-BNpCTGZO.js";import{Q as E}from"./QMarkupTable-CMV9tfmx.js";import{a8 as se,q as S,ae as P,A,ap as O,s as D,b as R,o as h,a as e,g as t,bW as T,w as r,l as I,n as U,e as V,C as ne,G as C,aj as z,Y as oe,E as Q,c as H,af as ue,Q as $,v as q,t as c,F as ie,D as re,J as W,a2 as J,p as de,ad as ce}from"./index-DR2CEZR0.js";import{c as me}from"./format-date-DBaFa2rd.js";import{A as F}from"./ApbJournal-LBymYxZ9.js";import{Q as pe}from"./QForm-DUbKQ737.js";import{_ as L}from"./InputCurrency-of3rJJoq.js";import{n as fe}from"./index-CfIJTyOD.js";import{Q as ve}from"./QBtnDropdown-Xh5cJJlX.js";import{Q as be}from"./QSelect-0U3eRCbl.js";import{C as M}from"./ClosePopup-Cvl-IIVx.js";import{u as j}from"./apb-accounts-store-nWUv_1lo.js";import{A as B}from"./ArrayCrud-CByp4EUn.js";import{u as _e,_ as ge}from"./apb-transactions-store-kmH5Ea3G.js";import{b as ye,m as xe}from"./hijri-CTUg_lXm.js";import{T as we}from"./ToAccount-ZmlXbble.js";import{a as N,Q as ke}from"./QItem-CIny6pNk.js";import{Q as K}from"./QItemLabel-CoqsRKEJ.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./id-BuNGTsqN.js";import"./ApiCrud-D-RefZRP.js";import"./Api-DR7rJy8H.js";import"./index-hOPLlut5.js";import"./apiPost-D8wci2uF.js";import"./QBtnGroup-CGwWHPu0.js";import"./QMenu-CWbJgUlK.js";import"./selection-udYJUrEX.js";import"./QField-DlBlyvWL.js";import"./QChip-BuVLeKi9.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./ApbAccount-BEyqHM_w.js";import"./useCrudForm-p-z8lbO1.js";import"./ApbTransaction-IycINio9.js";import"./format-number-B34ySHL_.js";const Ce={class:"tw:flex tw:gap-2 tw:items-center tw:justify-between tw:gap-x-4 q-mb-sm"},Ve={class:"tw:flex tw:gap-2 tw:items-center tw:justify-between tw:flex-grow"},Se={__name:"InputSelectAccount",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(w,{expose:f}){const d=se(w,"modelValue"),m=S(""),s=j(),{loading:p,accounts:l,optionsSelect:_}=P(s),g=A(()=>{if(d.value){const u=l.value?.find(i=>i?.id===d.value);return u?.category+" ["+u?.id+"] "+u?.group+": "+u?.name||""}else return"Pilih akun"}),a=A(()=>m.value?_.value.filter(u=>u.category.toLowerCase()===m.value.toLowerCase()):_.value),b=O("selectRef");f({focus:()=>{b.value&&b.value.focus()},showPopup:()=>{b.value&&b.value.showPopup()}});const x=()=>s.loadAll(!1);return D(async()=>{l.value?.length||await x()}),(u,i)=>(h(),R("div",{class:z([u.$attrs.class])},[e("div",Ce,[i[5]||(i[5]=e("div",{class:"text-italic text-caption"},"Kategori",-1)),e("div",Ve,[t(T,{modelValue:m.value,"onUpdate:modelValue":i[0]||(i[0]=y=>m.value=y),"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"Aktiva",label:"Aktiva",dense:""},null,8,["modelValue"]),t(T,{modelValue:m.value,"onUpdate:modelValue":i[1]||(i[1]=y=>m.value=y),"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"Pendapatan",label:"Pendapatan",dense:""},null,8,["modelValue"]),t(T,{modelValue:m.value,"onUpdate:modelValue":i[2]||(i[2]=y=>m.value=y),"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"Biaya",label:"Biaya",dense:""},null,8,["modelValue"]),i[4]||(i[4]=e("div",{style:{width:"40px"}},null,-1))])]),t(be,{label:"Nama Akun",dense:"",outlined:"","emit-value":"","map-options":"",options:a.value,loading:C(p),behavior:"menu","option-value":"id","option-label":"group_name",clearable:"",modelValue:d.value,"onUpdate:modelValue":i[3]||(i[3]=y=>d.value=y),rules:[y=>!!y||"Harus diisi!"],hint:g.value,ref_key:"selectRef",ref:b},{after:r(()=>[t(I,{flat:"",bordered:""},{default:r(()=>[t(ve,{flat:"","dropdown-icon":"more_vert",class:"q-px-sm",color:""},{default:r(()=>[U(t(V,{class:"block full-width","no-caps":"",label:"Muat ulang",icon:"sync",flat:"",onClick:x},null,512),[[M]]),t(ne),U(t(V,{class:"block full-width","no-caps":"",label:"Daftar akun",icon:"info",flat:"",to:"/apb/accounts"},null,512),[[M]])]),_:1})]),_:1})]),_:1},8,["options","loading","modelValue","rules","hint"])],2))}},he={__name:"ApbJournalForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(w,{emit:f}){const d=w,m=f,s=S({debit:0,credit:0,...d.data}),p=!d.data?.temp_id,l=O("firstInput");D(async()=>{await oe(),l.value&&l.value.focus()});const _=async()=>{if(!s.value.debit&&!s.value.credit||s.value.debit&&s.value.credit){fe("Harap isi salah satu antara debit atau kredit!");return}document.getElementById("btn-close-form")?.click(),m(p?"successCreate":"successUpdate",s.value)};return(g,a)=>{const b=Q("FormHeader"),x=Q("FormActions");return h(),H(I,{class:"full-width",style:{"max-width":"425px"}},{default:r(()=>[t(pe,{onSubmit:ue(_,["prevent"])},{default:r(()=>[t(b,{title:"Input Jurnal","is-new":p}),t($,null,{default:r(()=>[t(Se,{dense:"",class:"q-my-sm",outlined:"",label:"Jenis Akun",modelValue:s.value.account_id,"onUpdate:modelValue":a[0]||(a[0]=u=>s.value.account_id=u),rules:[u=>!!u||"Harus diisi!"],ref_key:"firstInput",ref:l},null,8,["modelValue","rules"]),t(L,{dense:"",class:"q-my-sm",outlined:"",modelValue:s.value.debit,"onUpdate:modelValue":a[1]||(a[1]=u=>s.value.debit=u),required:"",label:"Debit",rules:[u=>!!u||"Harus diisi!"]},null,8,["modelValue","rules"]),t(L,{dense:"",class:"q-my-sm",outlined:"",modelValue:s.value.credit,"onUpdate:modelValue":a[2]||(a[2]=u=>s.value.credit=u),required:"",label:"Kredit",rules:[u=>!!u||"Harus diisi!"]},null,8,["modelValue","rules"])]),_:1}),t(x,{"btn-delete":!1})]),_:1})]),_:1})}}},Ae={class:"text-center"},Qe={class:"text-center"},$e={class:"text-right",title:"Masuk"},qe={class:"text-right",title:"Keluar"},De={class:"text-center"},Ie={class:"bg-green-12"},He={class:"text-right"},Te={class:"text-right"},Je={class:"text-overline"},Be={__name:"CardJournal",props:{transactionId:{type:[Number,String],required:!0},thAjaranH:{type:String,required:!0}},emits:["update:isSaved"],setup(w,{emit:f}){const d=w,m=f,s=S(!0),p=S(!1),l=S([]),_=S(null),g=S(!1),{accounts:a}=P(j());async function b(){try{p.value=!0;const o=await F.getAll({params:{transaction_id:d.transactionId}});l.value=o.journals.map(n=>({...n,temp_id:J()})),s.value=!0}catch(o){console.error("ðŸš€ ~ loadData ~ _err:",o)}finally{p.value=!1}}const x=A(()=>l.value.reduce((o,n)=>o+(n.debit||0),0)),u=A(()=>l.value.reduce((o,n)=>o+(n.credit||0),0)),i=A(()=>x.value===u.value);D(()=>{b()});function y(o){_.value=o,g.value=!0}function Y(){_.value={transaction_id:d.transactionId},g.value=!0}function X(o){s.value=!1,o.temp_id=J(),o.account=a.value.find(n=>n.id==o.account_id),l.value=B.create(l.value,o)}function Z(o){s.value=!1,o.account=a.value.find(n=>n.id==o.account_id),l.value=B.update(l.value,o.temp_id,o,"temp_id")}function ee(o){s.value=!1,l.value=B.remove(l.value,o.temp_id,"temp_id")}async function te(){try{p.value=!0;const o=l.value.map(k=>({id:k.id||null,account_id:k.account_id,debit:k.debit,credit:k.credit})),n=await F.saveBatch(d.transactionId,o);n?.journals&&(l.value=n.journals.map(k=>({...k,temp_id:J()}))),s.value=!0,m("update:isSaved",x.value)}catch(o){console.error("ðŸš€ ~ saveJournals ~ _err:",o)}finally{p.value=!1}}return(o,n)=>{const k=Q("CardLoading");return h(),H(I,{bordered:"",flat:"",class:""},{default:r(()=>[t($,{class:"q-pa-sm bg-green-7 text-green-11 flex justify-between items-center"},{default:r(()=>[e("div",null,[t(V,{icon:"sync","no-caps":"",onClick:b,dense:"",flat:"",class:"q-mr-xs",title:"Muat ulang"}),q(" Jurnal ["+c(w.transactionId)+"] ",1)]),t(V,{class:"q-px-sm",dense:"",outline:"",glossy:"",icon:"add",label:"Tambah","no-caps":"",onClick:Y})]),_:1}),t(E,{flat:"",bordered:""},{default:r(()=>[t(k,{showing:p.value},null,8,["showing"]),n[5]||(n[5]=e("thead",null,[e("tr",{class:"bg-green-11 text-left"},[e("th",{class:"text-center"},"Edit"),e("th",{class:"text-center"},"Akun"),e("th",{class:""},"Nama Akun"),e("th",{class:"text-right"},"Debit"),e("th",{class:"text-right"},"Kredit"),e("th",{class:"text-center"},"Hapus")])],-1)),e("tbody",null,[(h(!0),R(ie,null,re(l.value,v=>(h(),R("tr",{key:v.id,class:"q-pa-sm"},[e("td",Ae,[t(V,{dense:"",flat:"",icon:"edit",color:"primary",onClick:ae=>y(v)},null,8,["onClick"])]),e("td",Qe,[t(V,{dense:"",outline:"",label:v.account_id,size:"sm",class:"q-px-sm",to:`/apb/accounts/${v.account_id}?th=${w.thAjaranH}`},null,8,["label","to"])]),e("td",null,c(v.account?.group)+": "+c(v.account?.name),1),e("td",$e,c(v.debit?v.debit.toRupiah():"-"),1),e("td",qe,c(v.credit?v.credit.toRupiah():"-"),1),e("td",De,[t(V,{dense:"",flat:"",icon:"sym_o_delete",color:"negative",onClick:ae=>ee(v)},null,8,["onClick"])])]))),128))]),e("tfoot",null,[e("tr",Ie,[n[1]||(n[1]=e("td",{class:""},null,-1)),n[2]||(n[2]=e("td",{class:""},null,-1)),n[3]||(n[3]=e("td",{class:"text-overline"},"Total",-1)),e("td",He,c(x.value.toRupiah()),1),e("td",Te,c(u.value.toRupiah()),1),n[4]||(n[4]=e("td",{class:"text-center text-green-10"},null,-1))])])]),_:1}),t($,{class:z(`flex justify-between items-center q-pa-sm ${s.value?"text-green-10 bg-green-13":"bg-red-1 text-red-10"}`)},{default:r(()=>[e("div",Je,[n[6]||(n[6]=e("span",{class:"text-bold"},"Status:",-1)),q(" "+c(i.value?"âœ… Seimbang":"âŒ Tidak Seimbang")+" dan "+c(s.value?"âœ… Tersimpan":"âŒ Belum Disimpan"),1)]),t(V,{class:"q-px-sm",dense:"",outline:"",color:s.value?"positive":"accent",glossy:"",icon:"save",label:"Simpan","no-caps":"",disable:s.value||!i.value,onClick:te},null,8,["color","disable"])]),_:1},8,["class"]),t(W,{persistent:"",modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=v=>g.value=v)},{default:r(()=>[t(he,{data:_.value,onSuccessCreate:X,onSuccessUpdate:Z},null,8,["data"])]),_:1},8,["modelValue"])]),_:1})}}},Re={};function Ue(w,f,d,m,s,p){return U((h(),H(ke,{clickable:"",to:"/apb/transactions"},{default:r(()=>[t(N,{avatar:"",class:"text-positive"},{default:r(()=>[t(de,{name:"sym_o_currency_exchange"})]),_:1}),t(N,null,{default:r(()=>[t(K,{overline:""},{default:r(()=>[...f[0]||(f[0]=[q(" Transaksi ",-1)])]),_:1}),t(K,{caption:""},{default:r(()=>[...f[1]||(f[1]=[q(" Daftar Transaksi Keuangan ",-1)])]),_:1})]),_:1})]),_:1})),[[M]])}const Me=G(Re,[["render",Ue]]),Pe={class:""},Fe={__name:"PageDetail",setup(w){const f=ce().params,d=_e(),{loading:m,transactions:s}=P(d),p=S(!1),l=A(()=>s.value.find(g=>g.id==f.id)),_=async()=>await d.loadById(f.id);return D(async()=>{l.value||await _()}),(g,a)=>{const b=Q("CardHeader"),x=Q("CardLoading"),u=Q("CardPage");return h(),H(u,null,{default:r(()=>[t(b,{title:"Detail Transaksi","show-reload":!0,onOnReload:_,"show-edit":!0,onOnEdit:a[0]||(a[0]=i=>p.value=!0)},{more:r(()=>[t(le,null,{default:r(()=>[t(we),t(Me)]),_:1})]),_:1}),t($,{class:"q-pa-sm q-gutter-y-sm",style:{"max-width":"1024px"}},{default:r(()=>[t(I,{bordered:"",flat:"",class:""},{default:r(()=>[t(E,null,{default:r(()=>[t(x,{showing:C(m)},null,8,["showing"]),e("tbody",Pe,[e("tr",null,[a[5]||(a[5]=e("td",{class:"label"},"ID",-1)),e("td",null,c(l.value?.id),1)]),e("tr",null,[a[6]||(a[6]=e("td",{class:"label"},"Dibuat Pada",-1)),e("td",null,c(C(me)(l.value?.created_at,"dd MMMM yyyy', Pukul 'HH:mm"))+" ("+c(C(ye)(C(xe)(l.value?.created_at)))+" H) ",1)]),e("tr",null,[a[7]||(a[7]=e("td",{class:"label"},"Tahun Ajaran",-1)),e("td",null,c(l.value?.th_ajaran_h),1)]),e("tr",null,[a[8]||(a[8]=e("td",{class:"label"},"Keterangan",-1)),e("td",null,c(l.value?.description),1)]),e("tr",null,[a[9]||(a[9]=e("td",{class:"label"},"Nilai",-1)),e("td",null,c(l.value?.amount?.toRupiah()),1)]),e("tr",null,[a[10]||(a[10]=e("td",{class:"label"},"Atas Nama",-1)),e("td",null,c(l.value?.by_name),1)]),e("tr",null,[a[11]||(a[11]=e("td",{class:"label"},"Catatan",-1)),e("td",null,c(l.value?.note),1)])])]),_:1})]),_:1}),t(Be,{transactionId:C(f).id,thAjaranH:l.value?.th_ajaran_h||"","onUpdate:isSaved":a[1]||(a[1]=i=>l.value.nilai=i)},null,8,["transactionId","thAjaranH"])]),_:1}),t(W,{persistent:"",modelValue:p.value,"onUpdate:modelValue":a[4]||(a[4]=i=>p.value=i)},{default:r(()=>[t(ge,{data:l.value,onSuccessSubmit:a[2]||(a[2]=i=>C(d).add(i)),onSuccessDelete:a[3]||(a[3]=()=>{C(d).remove(l.value.id),g.$router.go(-1)})},null,8,["data"])]),_:1},8,["modelValue"])]),_:1})}}},Ct=G(Fe,[["__scopeId","data-v-9e27d64c"]]);export{Ct as default};
