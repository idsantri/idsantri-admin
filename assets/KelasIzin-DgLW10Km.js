import{q as d,ap as T,s as H,Y as B,E as D,c as b,o as v,w as n,g as e,af as A,f as K,G as f,Q as M,a9 as k,l as N,ad as O,a as q,e as x,b as R,v as h,F as E,D as G,t as y,J as j}from"./index-B_fOp8I2.js";import{Q as P}from"./QSpace-DcIMlGPs.js";import{Q as C}from"./QItemLabel-Dzv1rcUf.js";import{Q as U,a as Q}from"./QItem-BIr2qAQs.js";import{Q as J}from"./QList-Bhy1FtzV.js";import{i as Y,f as W,a as X}from"./format-date-DBaFa2rd.js";import{f as Z,m as aa}from"./hijri-CTUg_lXm.js";import{g as ea}from"./array-object-BytDdNh7.js";import{Q as ta}from"./QForm-XW60lmKZ.js";import{_ as $}from"./InputSelectArray-CnP1463e.js";import{u as la}from"./useCrudForm-DYJRtmbD.js";import{A as na}from"./ApiCrud-DVH4XNNQ.js";import{_ as sa}from"./ReportViewer-DtN3-Gfu.js";import"./id-BuNGTsqN.js";import"./format-number-B34ySHL_.js";import"./QSelect-udWnZaoN.js";import"./QChip-5TM6hDLU.js";import"./QMenu-BsVEoqbp.js";import"./selection-CtPAXORa.js";import"./rtl-DFPa-2ov.js";import"./format-CJebrXOQ.js";import"./lists-store-CD0Hggyp.js";import"./ArrayCrud-CByp4EUn.js";import"./Lists-CqahsUVd.js";import"./lists-data-CZ3z29xr.js";import"./DropDownAfter-CV4tl_Qw.js";import"./QBtnDropdown-CfBCVMge.js";import"./QBtnGroup-DMJJVPpn.js";import"./ClosePopup-OWfInyoi.js";import"./Api-BNo_L0HG.js";import"./index-Bv8s4jzG.js";import"./index-BF457XYG.js";import"./apiPost-TFI76I_W.js";class ra extends na{constructor(){super("izin-madrasah")}async riwayat(w){const o=await this._apiGet({endPoint:`${this._path}/kelas/${w}`});return this._showSuccess(o.message),o.data}}const L=new ra,ua={__name:"IzinMadrasahForm",props:{data:{type:Object,required:!0}},emits:["successDelete","successSubmit","successUpdate","successCreate"],setup(z,{emit:w}){const o=z,c=w,a=d({keperluan:"Sakit",durasi:1,...o.data}),m=!o.data?.id,i=T("firstInput");H(async()=>{await B(),i.value&&i.value.focus()});const{handleDelete:r,handleCreate:V,handleUpdate:p,loading:I}=la(L,{emit:c,responseKey:"izin_madrasah"}),S=async()=>{const g={kelas_id:a.value.kelas_id,dari_tgl:a.value.dari_tgl,durasi:a.value.durasi,keperluan:a.value.keperluan,keterangan:a.value.keterangan,catatan:a.value.catatan};return m?await V(g,!0):await p(o.data.id,g,!0)},_=async()=>await r(o.data.id);return(g,t)=>{const u=D("FormHeader"),F=D("FormLoading"),s=D("FormActions");return v(),b(N,{class:"full-width",style:{"max-width":"425px"}},{default:n(()=>[e(ta,{onSubmit:A(S,["prevent"])},{default:n(()=>[e(u,{title:"Input Izin Madrasah","is-new":m}),f(I)?(v(),b(F,{key:0})):K("",!0),e(M,null,{default:n(()=>[e(k,{dense:"",class:"q-my-sm",outlined:"",label:"Nama","model-value":a.value?.nama+" ("+a.value?.santri_id+")",disable:"",filled:""},null,8,["model-value"]),e(k,{dense:"",class:"q-my-sm",outlined:"",label:"Data Kelas","model-value":a.value?.th_ajaran_h+" | "+a.value?.tingkat_id+" | "+a.value?.kelas,disable:"",filled:""},null,8,["model-value"]),e(k,{dense:"",hint:f(Y)(a.value.dari_tgl)?f(W)(a.value.dari_tgl):"",class:"q-my-sm",outlined:"",label:"Tanggal (M)*",modelValue:a.value.dari_tgl,"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.dari_tgl=l),type:"date",rules:[l=>!!l||"Harus diisi!"],"error-color":"negative",ref_key:"firstInput",ref:i},null,8,["hint","modelValue","rules"]),e(k,{dense:"",class:"q-my-sm",outlined:"",label:"Durasi (hari)*",modelValue:a.value.durasi,"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.durasi=l),rules:[l=>!!l||"Harus diisi!",l=>!l||!isNaN(l)||"Hanya angka"],"error-color":"negative"},null,8,["modelValue","rules"]),e($,{modelValue:a.value.keperluan,"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.keperluan=l),url:"keperluan-izin",label:"Keperluan *",class:"q-my-sm",rules:[l=>!!l||"Harus diisi!"]},null,8,["modelValue","rules"]),e($,{modelValue:a.value.keterangan,"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.keterangan=l),url:"keterangan-izin",label:"Keterangan",class:"q-my-sm"},null,8,["modelValue"]),e(k,{dense:"",class:"q-my-sm",outlined:"",label:"Catatan",modelValue:a.value.catatan,"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.catatan=l),autogrow:""},null,8,["modelValue"])]),_:1}),e(s,{"btn-delete":!m,onOnDelete:_},null,8,["btn-delete"])]),_:1})]),_:1})}}},Ba={__name:"KelasIzin",setup(z){const o=O().params,c=d([]),a=d({}),m=d(!1),i=d(!1),r=d({}),V=d("");async function p(){try{m.value=!0;const t=await L.riwayat(o.id);c.value=t.izin_madrasah,r.value=t.kelas}catch(t){console.error("ðŸš€ ~ loadData ~ error:",t)}finally{m.value=!1}}H(async()=>{await p()});const I=()=>{a.value={},a.value.santri_id=r.value.santri_id,a.value.nama=r.value.nama,a.value.th_ajaran_h=r.value.th_ajaran_h,a.value.tingkat_id=r.value.tingkat_id,a.value.kelas=r.value.kelas,a.value.kelas_id=r.value.id,i.value=!0},S=({id:t})=>{a.value={},a.value=ea(c,t),a.value.santri_id=r.value.santri_id,a.value.nama=r.value.nama,a.value.th_ajaran_h=r.value.th_ajaran_h,a.value.tingkat_id=r.value.tingkat_id,a.value.kelas=r.value.kelas,i.value=!0},_=d(!1);function g(t){V.value=`reports/izin-madrasah/view?id=${t.id}}`,_.value=!0}return(t,u)=>{const F=D("CardLoading");return v(),b(N,{bordered:"",flat:""},{default:n(()=>[e(M,{class:"bg-green-2 text-subtitle2 q-pa-sm flex items-center"},{default:n(()=>[e(x,{flat:"",dense:"",icon:"sync",onClick:p}),u[2]||(u[2]=q("div",{class:"text-green-10"},"Riwayat Izin Madrasah",-1)),e(P),e(x,{outline:"",icon:"add",onClick:I,label:"Tambah","no-caps":""})]),_:1}),e(F,{showing:m.value},null,8,["showing"]),e(J,{separator:""},{default:n(()=>[c.value.length?(v(!0),R(E,{key:1},G(c.value,s=>(v(),b(U,{key:s.id,class:""},{default:n(()=>[e(Q,{avatar:""},{default:n(()=>[e(x,{dense:"",glossy:"",icon:"edit",round:"",outline:"",color:"green-8",onClick:l=>S(s)},null,8,["onClick"])]),_:2},1024),e(Q,null,{default:n(()=>[e(C,{lines:"1"},{default:n(()=>[h(y(f(X)(s.dari_tgl)+" | "+f(Z)(f(aa)(s.dari_tgl)))+" ("+y(s.durasi)+" hari) ",1)]),_:2},1024),e(C,{overline:""},{default:n(()=>[h(y(s.keperluan)+" "+y(s.keterangan?"("+s.keterangan+")":""),1)]),_:2},1024),e(C,{caption:"",class:"text-italic"},{default:n(()=>[h(y(s.catatan?s.catatan:""),1)]),_:2},1024)]),_:2},1024),e(Q,{avatar:""},{default:n(()=>[e(x,{class:"bg-green-10 text-green-11",dense:"",glossy:"",icon:"print",round:"",onClick:l=>g(s)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)):(v(),b(U,{key:0},{default:n(()=>[e(Q,null,{default:n(()=>[e(C,{class:"text-center text-body2 text-negative text-italic q-pa-lg"},{default:n(()=>[...u[3]||(u[3]=[h(" Tidak ada data untuk ditampilkan.",-1),q("br",null,null,-1),h("Silakan tambahkan izin terlebih dahulu! ",-1)])]),_:1})]),_:1})]),_:1}))]),_:1}),e(j,{modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=s=>i.value=s)},{default:n(()=>[e(ua,{data:a.value,onSuccessSubmit:p,onSuccessDelete:p},null,8,["data"])]),_:1},8,["modelValue"]),e(j,{modelValue:_.value,"onUpdate:modelValue":u[1]||(u[1]=s=>_.value=s)},{default:n(()=>[e(sa,{url:V.value},null,8,["url"])]),_:1},8,["modelValue"])]),_:1})}}};export{Ba as default};
